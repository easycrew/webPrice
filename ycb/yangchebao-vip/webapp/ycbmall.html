<!DOCTYPE html>
<html>
	<head>
	<meta charset=utf-8>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
	<link rel="stylesheet" href="http://app.yangchebao.com.cn/group1/M00/00/9F/swiper.min.0000000000000000000.css">
	<link type="text/css" href="css/index.css" rel="stylesheet"/>
	<link rel="stylesheet" type="text/css" href="css/ycbmall/ycbmall.css"/>
	<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="js/jquery.dotdotdot.min.js" ></script>
	<script type="text/javascript" src="js/jquery.json-2.2.js"></script> 
	<script type="text/javascript" src="js/index.js"></script>
	<title>配件商城</title>
	<style>
		html{
			font-size: 62.5%;
		}
		.swiper-pagination-bullet{
			opacity: 0.5;
		}
		.swiper-pagination-bullet-active{
			opacity: 1;
			background: #FF8463;
		}
		.null-tip{
			width: 100%;
			font-size: 1.8rem;
		}
		.ll{
			margin-top: 0.78em;
		}
		.Gl{
			margin-top: 0;
			margin-bottom: 1.78em;
		}
		.om{
			font-size: 1.2rem;
			color: #707C92;
		}
		.note-wrap{
			z-index: 500;
			width: 100%;
			background: #A3AECD;
			padding:0.5rem;
			padding-right: 0;
		}
		.title_note{
			font-size: 1.2rem;
			font-family: STHeitiSC-Light;
			color: #FFFFFF;
		}
	</style>
	</head>
	<body style="width: 100%;">
		<section class="top-btn-wrap" style="display: none;">
		<div class="top-btn tbl-type">
			<span class="tbl-cell regular-top" style="width: 100%!important;">常规保养</span>
			<!--<span class="tbl-cell m"></span>-->
			<!--<span class="tbl-cell originality-top">创意新品</span>-->
		</div>
		</section>
		<section class="note-wrap" style="display: none;"></section>
		<section class="main-wrap main">
			<!--轮播banner-->
			<div class="swiper-container swiper1">
				<div class="swiper-wrapper" id="mySwipe">
					<!--<div class="swiper-slide">
						<a><img src="css/ycbmall/images/group_banner.png" class="img-responsive"/> </a>
					</div>-->
				</div>
				<div class="swiper-pagination"></div>
			</div>	
			<!--品类入口-->
			<div class="category-access">
				<ul class="tbl-type">
					<li class="tbl-cell regular">
						<a href="#">
							<span class="category-access-top" style="height: 10.8rem;position: relative;">
								<img class=" triangle-logo" src="css/ycbmall/images/car.png"/>
								<span>常规保养</span>
								<span class="triangle"></span>
							</span>
							<span class="category-access-footer">13大类上百种<br>正品配件商家专供</span>
						</a>
					</li>
					<li class="tbl-cell originality">
						<a href="javascript:void(0);">
							<span class="category-access-top originality-top" style="height: 10.8rem;position: relative;">
								<!--<img class="originality-logo" src="css/ycbmall/images/light.png"/>-->
								<img class="originality-logo" src="css/ycbmall/images/temporary_not_open.png"/>
								<span style="display: block;"></span>
								<span class="triangle"></span>
							</span>
							<span class="category-access-footer des">网罗创意新<br>品全面保养您的爱车</span>
						</a>
					</li>
				</ul>
			</div>
		</section>
		<!--限量购-->
		<section class="limit-wrap" id="limit-wrap">
			<h1 class="ui-tit"><span>限量购</span></h1>
			<div class="swiper-container swiper2" id="limitList">
				<div class="swiper-wrapper">
					<!--<div class="swiper-slide">
						<div class="limit-item-img">
							<img width="100%" class="limit-photo" src="css/ycbmall/images/limitNew.png"/>
						</div>
						<div class="limit-item-name">
							<span>美孚 金美孚1号全SN 0W-40…</span>
						</div>
						<div class="limit-item-price">
							<span class="limit-now-price">&yen;10.00</span>
						</div>
					</div>-->
					<!--<p class="null-tip ll">本地区暂无限量购商品</p>-->
				</div>
			</div>
		</section>
		<!--专享-->
		<section class="vip-wrap" id="vip-wrap" style="display: none;">
			<h1 class="ui-tit"><span>专享</span></h1>
			<div class="swiper-container swiper3" id="vipList">
				<div class="swiper-wrapper">
				</div>
			</div>
		</section>
		<!--团购-->
		<section class="group-wrap">
			<h1 class="ui-tit"><span>团购</span></h1>
			<ul class="group-new-list" style="position: relative;left: 0px;width: 100%;" id="groupList">
				<!--<li>
					<a href="#" class="group-item">
						<div class="group-item-img">
							<img src="css/ycbmall/images/groupNew.png" />
						</div>
						<p class="group-item-name">米其林轮胎9月众筹来袭</p>
						<p class="group-item-des">超值优惠，用户首选</p>
						<p class="group-item-num">
							目标完成: <span class="group-sale-num">400</span>/<span class="group-sell-num">1000</span>
							<span class="last-day">剩余<span>40</span>天</span>
						</p>
					</a>
				</li>-->
			</ul>
		</section>
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/swiper.3.1.2.jquery.min.0000000.js"></script> 
<script type="text/javascript">
$(document).ready(function(){
	var response = "1",page = 0,pagesize=10,isShowUnavailable=0;
	var userInfo_={};
//	var limitFlag=1;
//	获得限量购商品信息
	function getLimitGoodsList(userInfo,pagesize){
		$.ajax({
			url:'/ycbmall-app-ws/ws/0.1/limitedPurchasing/queryLimitedPurchasings?userInfoId='+userInfo.userId+'&areaCodeId='+userInfo.areaCodeId+'&isShowUnavailable='+isShowUnavailable+'&pageindex='+page+'&pagesize='+pagesize,
			type:'get',
			async:false,
			dataType:'json',
			success:function(data){
				var str="";
				if(data.totalCount>0){
					$.each(data.items,function(i){
						str+='<div class="swiper-slide">'
							+'<div>'
							+'<div class="limit-item-img">'
								+'<img width="100%" class="limit-photo" src="'+this.middlePicUrl+'"/>'
							+'</div>'
							+'<div class="limit-item-name">'
								+'<span class="Wraper">'+this.limitedPurchasingName+'</span>'
							+'</div>'
							+'<div class="limit-item-price">'
								+'<span class="limit-now-price">&yen;'+this.sellingPrice+'</span>'
							+'</div>'
							+'</div>'
						+'</div>'
					});
//					limitFlag=1
				}else{
					str+='<p class="null-tip ll">本地区暂无限量购商品</p>'
//					limitFlag=0
				}
				$("#limitList div.swiper-wrapper").html(str);
			},
			error:function(xhr){

			}
		});
		var swiper2=new Swiper('.swiper2',{
			pagination: null,
	        paginationClickable: true,
			autoplay:0,
	        slidesPerView:3.25
		});
		$(".Wraper").dotdotdot();
		var img_width=$(".limit-wrap img").width();
		$(".limit-wrap img").height(img_width);
	}
//查询用户权限（专享）
	function checkPrivilege(userInfoId){
		var isPrivilege=0;
		$.ajax({
			type:"get",
			url:"/ycbmall-app-ws/ws/0.1/user/getUserPrivilege",
			async:false,
			data:{userInfoId:userInfoId.userId},
			dataType:'json',
			success:function(data){
				isPrivilege=data.isPrivilege
			}
		});
		return isPrivilege
	}
//	获得专享商品信息
	function getVipGoodsList(userInfo,pagesize){
		$.ajax({
			url:'/ycbmall-app-ws/ws/0.1/commodity/queryCommodities?userInfoId='+userInfo.userId+'&areaCodeId='+userInfo.areaCodeId+'&isShowUnavailable='+isShowUnavailable+'&pageindex='+page+'&pagesize='+pagesize+'&commodityType=2',
			type:'get',
			async:false,
			dataType:'json',
			success:function(data){
				var str="";
				if(data.totalCount>0){
					$.each(data.items,function(i){
						str+='<div class="swiper-slide">'
							+'<div>'
							+'<div class="limit-item-img">'
								+'<img width="100%" height="100%" class="limit-photo" src="'+this.picUrl+'"/>'
							+'</div>'
							+'<div class="limit-item-name">'
								+'<span class="Wraper">'+this.name+'</span>'
							+'</div>'
							+'<div class="limit-item-price">'
								+'<span class="limit-now-price">&yen;'+this.sellingPrice+'</span>'
							+'</div>'
							+'</div>'
						+'</div>'
					});
				}else{
					str+='<p class="null-tip ll">本地区暂无专享商品</p>'
				}
				$("#vipList div.swiper-wrapper").html(str);
			},
			error:function(xhr){

			}
		});
		var swiper3=new Swiper('.swiper3',{
			pagination: null,
	        paginationClickable: true,
			autoplay:0,
	        slidesPerView:3.25
		});
		$(".Wraper").dotdotdot();
		var img_width=$(".vip-wrap .swiper-slide").width();
		$(".vip-wrap img").height(img_width);
		$(".vip-wrap img").width(img_width);
	}
//团购商品信息
	function getGroupGoodsList(userInfo,pagesize,owraper){
		type=2;
		response="1";
		isDivisionHot=0;
		$.ajax({
			url:'/ycbmall-app-ws/ws/0.1/groupPurchasing/queryGroupPurchasings?pageindex='+page+'&pagesize='+pagesize+'&userInfoId='+userInfo.userId+'&areaCodeId='+userInfo.areaCodeId+'&type='+type+'&isDivisionHot='+isDivisionHot,
			type:'get',
			async:false,
			dataType:'json',
			success:function(data){
				page++;
				var str="";
				var items=data.items;
				$.each(items, function(i) {
					var item=items[i];
					str+='<li groupPurchasingId="'+item.groupPurchasingId+'">'
						+'<a href="#" class="group-item">'
						+'<div class="group-item-img">'
						+'<img src="'+item.appActivePicUrl+'"/>'
						+'</div>'
						+'<p class="group-item-name">'+item.name+'</p>'
						+'<p class="group-item-des">'+item.subTitle+'</p>'
						+'<p class="group-item-num">'
						+'目标完成:<span class="group-sale-num">'+item.cumulativeNum+'</span>/<span class="group-sell-num">'+item.minNum+'</span>'
						+'<span class="last-day">剩余<span>'+item.daysRemaining+'</span>天</span>'
						+'<p></a></li>';
				});
				if(owraper!=undefined&&owraper!=''){
					$("#groupList").next('.null-tip').remove();
//					$(".top-btn-wrap").hide();
					$("#groupList").html(str);
					if(str==""){
						$("#groupList").after('<p class="null-tip Gl">暂无团购商品</p>');
					}
				}else{
					$("#groupList").append(str);
				}
				if(data.page>=data.totalPages-1){
//					$("#groupList").append('<p class="null-tip om">暂无更多团购</p>')
					response="0";
				}
				if(bIsAndroid()){
					$(".overlay-containter").css("min-height",$(window).height()-178);  
				}else{
					$(".overlay-containter").css("min-height",$(window).height()-130);  
				}
			},
			error:function(xhr){
				var error=JSON.param(xhr.responseText);
				alertRe('error[0].message');
			}
		});
		return response;
	}
	
	function bannerList(userInfo){
		var postData={};
		postData.areaCodeId=userInfo.areaCodeId;
		postData.location=1;
		postData.osInfo=userInfo.osInfo;
		var length=0
		$.ajax({
			type:"get",
			url:"/ycbmall-app-ws/ws/0.1/advertising/getAdvertisings",
			data:postData,
			async:false,
			dataType:'json',
			success:function(data){
				length=data.length;
				var str="";
				$.each(data, function(i) {
					var URl=this.turnToUrl.split('//');
					str+='<div class="swiper-slide">'
					if(this.turnToUrl==''){
						str+='<a><img class="img-responsive" src="'+this.adPicAddress+'" /></a>'
					}else{
						str+='<a href="'+this.turnToUrl+'"><img class="img-responsive" src="'+this.adPicAddress+'" /></a>'
					}
						str+='</div>';
				});
				$("#mySwipe").html(str);
			}
		});
		if(length==1){
			var myswiper = new Swiper('.swiper1', {});
		}else{
			var myswiper1 = new Swiper('.swiper1', {
		        pagination: '.swiper-pagination',
		        paginationClickable: true,
		        loop:true,
		        centeredSlides: true,
		        autoplay: 3000,
		        autoplayDisableOnInteraction: false
		    });
		}
	}

	function ISPrivilege(userInfo){
		userInfo_=userInfo;
		$.ajax({
			type:"get",
			url:"/ycbmall-app-ws/ws/0.1/areaCode/isOpened",
			data:{areaCodeId:userInfo.areaCodeId},
			async:true,
			success:function(data){
				var message="本地区暂未开通配件销售，详情动态敬请咨询养车宝售后！"
				if(!data.isOpened){
					$(".note-wrap").append('<div class="title_note">'+message+'</div>').slideDown(1000);
				}
			}
		});
		
	}
	function turnOPen(){
		window.location.href="http://w2l?login";
	}
index.init=function(userInfo,bridge){
	userInfo_=userInfo;
	if(userInfo_.areaCodeId==undefined||userInfo_.areaCodeId==''){
		if(bIsAndroid()){
			alertTasatOut("您好！使用配件商城需前往个人中心，进行账户切换重新登录。如忘记密码，请联系与您签约的业务人员。");
		}else{
			alertReF('您好！使用配件商城需点击"确定"按钮进行账户切换重新登录。如忘记密码，请联系与您签约的业务人员。','提示',turnOPen);
		}
		return false
	}
	ISPrivilege(userInfo_);
	var path=getPath();
	$("#groupList").delegate('li','touchstart click touched',function(e){
		var that=this;
		var home=path;
		switch(e.type){
			case 'touchstart': break;
			case 'click':
				var groupPurchasingId=$(that).attr("groupPurchasingId");
				window.location.href="http://w2nw?"+path+"/group.html?groupPurchasingId="+groupPurchasingId;
				break;
		}
	});
	$("#limitList").delegate('div.swiper-slide','touchstart click touched',function(e){
		var that=this;
		switch(e.type){
			case 'touchstart':break;
			case 'click':
				window.location.href="http://w2nw?"+path+"/limit.html";
				break;
		}
	});
	$("#vipList").delegate('div.swiper-slide','touchstart click touched',function(e){
		var that=this;
		switch(e.type){
			case 'touchstart':break;
			case 'click':
				window.location.href="http://w2nw?"+path+"/vipGoods.html";
				break;
		}
	});
	window.onscroll = function(){
		var _height=document.getElementById("limit-wrap").getBoundingClientRect().top;
		if(_height<=0){
			$(".top-btn-wrap").slideDown(100);
		}else{
			$(".top-btn-wrap").slideUp(100);
		}
	}
bannerList(userInfo_);
getLimitGoodsList(userInfo_,10);
if(checkPrivilege(userInfo_)){
	$("#vip-wrap").show();
	getVipGoodsList(userInfo_,10);
}
getGroupGoodsList(userInfo_,5,"html");
$(".regular a,span.regular-top").click(function(){
	//跳转到客户端分类页面
	window.location.href="http://w2l/?presentType=1&androidName=2&iosName=MachinePartsViewController"
});

// $(".originality a,span.originality-top").click(function(){
//	//跳转到页面限量购页面
//	window.location.href="http://w2nw?"+path+"/limit.html";
// });
return response;
}
//上拉加载更多
index.pullUpRefresh = function(bridge){
	getGroupGoodsList(userInfo_,5);
}
})
</script>
	</body>
</html>
