<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
		<meta content="yes" name="apple-mobile-web-app-capable"/>
		<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
		<link type="text/css" href="../css/base.css" rel="stylesheet"/>
		<link rel="stylesheet" href="css/detection.css" />
		<script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script> 
		<script type="text/javascript" src="../js/index.js"></script>
		<title></title>
		<style>
			body{
				font-size: 62.5%;
				width: 100%;
			}
		</style>
	</head>
	<body>
	<section class="order-wrap">
		<div class="order-list">
			
		</div>
	</section>
	<script type="text/javascript">
		$(function(){
			/*获得用户职员信息*/
			function getEmployeeInfo(userInfo){
				var shopName;
		 		$.ajax({
		 			type:"get",
		 			url:"/vip-app-ws/ws/0.1/common/getEmployeeInfo",
		 			async:false,
		 			data:{userId:userInfo.userId},
		 			dataType:'json',
		 			contentType:'application/json;charset=utf-8',
		 			success:function(data){
		 				shopName=data.shopName;
		 			},
		 			error:function(xhr){
		 				var error=eval('('+xhr.responseText+')');
						alertTasat(error[0].message);
						return
		 			}
		 		});
		 		return shopName
		 	}
			/*出库单列表*/
			function getDeliveryOrderList(userInfo){
				$.ajax({
					type:"get",
					url:"/vip-app-ws/ws/0.1/deliveryOrder/getDeliveryOrderList?shopAccountId="+userInfo.shopAccountId,
					async:false,
					dataType:'json',
					contentType:'application/json;charset=utf-8',
					success:function(data){
						var str='';
						$.each(data, function(i) {
							str+='<div class="order-item">'+
									'<input type="hidden" name="transferOrderId" value="'+this.transferOrderId+'">'+
									'<div class="order-time">'+
										'<div>'+
											'<span class="orderTime">'+this.updateTime+'</span>'+
										'</div>'+
										'<span class="orderStateN">'+this.orderStatusName+'</span>'+
									'</div>'+
									'<div class="car-info">'+
										'<div class="plateNumber">'+this.plateNumber+'</div>'
									/*3:未出库   1:已出库*/
									if(this.orderStatus=='3'){
										str+='<div class="btn sure">确认出库</div>'
									}else if(this.orderStatus=='1'){
										str+='<div class="btn search">查看详情</div>'
									}
									str+='</div>'+
								'</div>'
						});
						if(str==""){
							showEmpty("暂无出库单");
						}else{
							$(".order-list").html(str);
						}
					},
					error:function(xhr){
						var error=JSON.param(xhr.responseText);
						alertTasat(error[0].message);
					}
				});
			}
			index.init=function(userInfo,bridge){
				/*title 商家名称显示*/
				var shopName;
				shopName=getEmployeeInfo(userInfo);
				store.set('shopName',shopName);
				$("title").html(shopName);
				if(bIsAndroid()){
					window.mallTitle.getMallTitle('0',shopName);
				}else{
					 bridge.callHandler('sendShopNameTitle',{'shopNameTitle':shopName});
				}
				
				var path=getPath();
				
				getDeliveryOrderList(userInfo);
				
				$(".order-list").on('click','.sure',function(){
					var transferOrderId=$(this).parent().siblings('input[name="transferOrderId"]').val();
					var plateNumber=$(this).siblings('.plateNumber').html();
					$.ajax({
						type:"get",
						url:"/vip-app-ws/ws/0.1/deliveryOrder/checkStatus",/*状态校验接口*/
						async:false,
						data:{transferOrderId:transferOrderId},
						dataType:'json',
						success:function(data){
							window.location.href="http://w2nw?"+path+"/outboundOrderDetail.html?transferOrderId="+transferOrderId+"&plateNumber="+plateNumber;
						},
						error:function(xhr){
							var error=eval('('+xhr.responseText+')');
							alertTasatF(error[0].message,function(){window.location=location;});
						}
					});
				});
				$(".order-list").on('click','.search',function(){
					var plateNumber=$(this).siblings('.plateNumber').html();
					var transferOrderId=$(this).parent().siblings('input[name="transferOrderId"]').val();
					window.location.href="http://w2nw?"+path+"/outboundOrderDetail.html?transferOrderId="+transferOrderId+"&plateNumber="+plateNumber;
				});
				return 0;
			}
		})
	</script>
	</body>
</html>
