<!DOCTYPE html>
<html>
<head>
     <meta charset="utf-8" />
     <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
     <meta content="yes" name="apple-mobile-web-app-capable" />
     <meta content="black" name="apple-mobile-web-app-status-bar-style" />
     <link type="text/css" href="http://10.23.31.151/yangchebao-pubweb/sdk/css/sy.css" rel="stylesheet"/>
     <script type="text/javascript" src="http://10.23.31.151/yangchebao-pubweb/sdk/js/jquery-1.9.1.min.js"></script> 
	 <script type="text/javascript" src="http://10.23.31.151/yangchebao-pubweb/sdk/js/jquery.json-2.2.js"></script> 
	 <script type="text/javascript" src="http://10.23.31.151/yangchebao-pubweb/sdk/js/index.js"></script> 
     <title>养车宝app首页</title>
</head>   
<body>  
<input name="isShowTitle" type="hidden" value="0" />
<header>
<span class="left"><label id="city">北京</label><label class="arrow"></label></span>
<span class="right">我的订单</span>
</header>
<section class="service-wrap">
<ul class="list-service main-service clearfix">
  <li><a href="javascript:void(0);"><span class="service">&nbsp;</span></a>
  <p><label>洗车</label></p>
  </li>
  <li><a href="javascript:void(0);"><span class="service service3">&nbsp;</span></a> 
  <p><label>美容</label></p>
  </li>
  <li><a href="javascript:void(0);"><span class="service service2">&nbsp;</span></a>
  <p><label>保养</label></p>
  </li>
  <li><a href="javascript:void(0);"><span class="service service4">&nbsp;</span></a>
  <p><label>维修</label></p>
  </li> 
</ul>
</section>  
<section class="carwash-wrap">
    <a href="javascript:void(0);">
    <h1 class="ui-tit"><span>最近的洗车店</span></h1>
    <span class="more">全部洗车店</span></a> 
    <ul class="list-module-pic">
      <a href="javascript:void(0);">
      <li class="clearfix localpoint" style="border:none;" locationId="6">
        <div class="pic">
          <img src=""/>
        </div>
        <div>
          <h3><span class="tit"></span><span class="distanceLabel"></span></h3> 
          <p class="info"></p>
          <div><span class="notice"></span><span class="price"></span></div>
        </div>
      </li> 
      </a>
    </ul>
</section> 
<section class="service-list-wrap" id="nearby-wrap">
	<h1 class="ui-tit"><span>最近的店</span></h1>
    <ul class="list-module"> 
      <!--li class="clearfix localpoint"  locationId="6"> 
        <div>
          <h3><span class="tit">美车源（东直门店）</span><span class="distanceLabel">100m</span></h3> 
          <h2>打蜡打蜡<span class="price">¥ 21</span></h2>
          <p class="info">北京市东城区东直门银座地下一层直门银座地下一层</p> 
        </div>
      </li-->    
    </ul>
</section>
<section class="vehicle-list">
	<header>
		城市列表<span class="close"><label></label></span>
	</header>
	<div class="sorted-list"> 

	</div>
	<ul class="sorter">
			<li><span>A</span></li>
			<li><span>B</span></li>
			<li><span>C</span></li>
			<li><span>D</span></li>
			<li><span>E</span></li>
			<li><span>F</span></li>
			<li><span>G</span></li>
			<li><span>H</span></li>
			<li><span>I</span></li>
			<li><span>J</span></li>
			<li><span>K</span></li>
			<li><span>L</span></li>
			<li><span>M</span></li>
			<li><span>N</span></li>
			<li><span>O</span></li>
			<li><span>P</span></li>
			<li><span>Q</span></li>
			<li><span>R</span></li>
			<li><span>S</span></li>
			<li><span>T</span></li>
			<li><span>U</span></li>
			<li><span>V</span></li>
			<li><span>W</span></li>
			<li><span>X</span></li>
			<li><span>Y</span></li>
			<li><span>Z</span></li>
			<li><span>#</span></li>
		</ul>
</section> 
<script>  
/**function getTitleInfos(){
  window.TitleHelper.getTitleInfos(0,""); 
} **/ 
var paramJson = {};   
function getCarwash(){   
    $.ajax({
          url: '/yangchebao-app-ws/ws/0.1/shop/business/page/v2?areaName='+paramJson.cityName+'&modelId='+paramJson.modelId+'&service=1&lon='+paramJson.lon+'&lat='+paramJson.lat+'&pageindex=0&pagesize=1&specialServiceId=11&osInfo='+paramJson.osInfo,
          type: 'get',  
          dataType: 'json',
          success: function(data) {  
         var item = data.items[0]; 
         var _li = $(".carwash-wrap .list-module-pic li:first");
         $("img",_li).attr("src",item.logo);
           $(".tit",_li).html(item.name);
           $(".info",_li).html("地址："+item.address);   
           $(".notice",_li).html("关注："+item.attentionNumber);   
           if(item.totalPrivilegePrice!="暂无"){
               $(".price",_li).html("￥"+item.totalPrivilegePrice);
           }else{
             $(".price",_li).html(item.totalPrivilegePrice);
          }
           $(".distanceLabel",_li).html(item.distance); 
                _li.parent("a").attr('href','http://w2nw?'+getPath()+'shop.html?shopid='+item.id+'&busiServiceRelId='+item.busiServiceRelId); 
          }
      });
  }  
  function getNearbyShop(){   
    $.ajax({
          url: '/yangchebao-app-ws/ws/0.1/shop/business/page/v2?areaName='+paramJson.cityName+'&modelId='+paramJson.modelId+'&service=2&lon='+paramJson.lon+'&lat='+paramJson.lat+'&pageindex=0&pagesize=3&specialServiceId=17&osInfo='+paramJson.osInfo,
          type: 'get',  
          dataType: 'json',
          success: function(data) {   
			$("#nearby-wrap .list-module").html("");
			var items = data.items;
			$.each(items,function(i){
			    var item = items[i];
				if(item.totalPrivilegePrice!="暂无"){
					item.totalPrivilegePrice="￥"+item.totalPrivilegePrice;
				} 
				var _li = ' <li class="clearfix" shopid="'+item.id+'">'
						+'<div>'
						+'<h3><span class="tit">'+item.name+'</span><span class="distanceLabel">'+item.distance+'</span></h3> '
						+'<h2>打蜡<span class="price">'+item.totalPrivilegePrice+'</span></h2>'
						+'<p class="info">'+item.address+'</p> '
						+'</div>'
						+'</li>';
				$("#nearby-wrap .list-module").append(_li);
			});
          }
      });
  }   
$(document).ready(function(){    
    var bridge;
    index.init = function(userInfo,bri){  
		paramJson = userInfo;  
		bridge = bri; 
        var url = window.location.search;  
		if(url!=""){
        var paramsArr = (url.split("?")[1]).split("&"); 
        $.each(paramsArr,function(i){
          var item = paramsArr[i].split("=");
          paramJson[item[0]] = item[1];
        });  
        }		
        paramJson.cityName = decodeURI(paramJson.cityName); 
		$("#city").html(paramJson.cityName); 
		getCarwash(); 
		getNearbyShop(); 
	}; 
	$("header .right").click(function(){
       window.location.href = "http://w2nw?"+getPath()+"orderList.html";
	});
	$("header .left").click(function(){
       $(".vehicle-list").fadeIn();
	});  
    $.each($(".service-wrap .service"),function(){
    	var _a = $(this).parent("a");
    	if($(this).hasClass("service2")){
    		_a.attr("href","http://w2nw?"+getPath()+"shopList.html?service=3");
    	}else if($(this).hasClass("service3")){
    		_a.attr("href","http://w2nw?"+getPath()+"shopList.html?service=2");
    	}else if($(this).hasClass("service4")){
    		_a.attr("href","http://w2nw?"+getPath()+"shopList.html?service=4");
    	}else{
    		_a.attr("href","http://w2nw?"+getPath()+"shopList.html?service=1&subService=11");
    	}
    });
    $(".carwash-wrap .ui-tit").parent("a").attr("href","http://w2nw?"+getPath()+"shopList.html?service=1&subService=11");
	var getCityList = function(){
	$.ajax({
		url: '/yangchebao-app-ws/ws/0.1/shop/area/list/v2',
		dataType:'json',
		async:true,
		success: function(data){
			var sorterList = $('.vehicle-list .sorted-list'); 
			var htmlArray = []; 
			var servicecity = data.servicecity;
			var hotcity = data.hotcity;
			htmlArray.push('<h2>热门城市</h2><ul class="veh-info-list">');
			$.each(hotcity, function(i){  
				htmlArray.push('<li id="'+this.id+'" level="'+this.level+'" type="'+this.cityType+'">'+this.name+'</li>') ;  
			});
			htmlArray.push('</ul>')
			$.each(servicecity, function(key, value){
				htmlArray.push('<h2>'+key+'</h2><ul class="veh-info-list">'); 
				if (value.length > 0) {
					$.each(value,function(index,value){
						htmlArray.push('<li id="'+value.id+'" level="'+value.level+'" type="'+value.cityType+'">'+value.name+'</li>')
					})
				};
				htmlArray.push('</ul>')
			}); 
			sorterList.html(htmlArray.join(''));
		}
		});
	};
	getCityList();  
	$('.sorter li').on('touchend click',function(){
		var index = $(this).index();
		var $parents = $(this).parents('.sorter').siblings('.sorted-list');
		var $h2 = $('h2:contains('+$(this).text()+')');
		$(document).scrollTop($h2.position().top)
	});
	$('.sorted-list').on('click', 'li', function(){
		 var self = $(this); 
		 $(".vehicle-list").fadeOut();  
		 if($("#city").html()!=self.html()){   
			  if(bIsAndroid()){   
					window.AppJsParamsObj.saveCityInfo(self.attr("id"),self.html(), self.attr("level"), self.attr("type"));   	
			  }else{
					var json = {"cityName":$(this).html()};
					bridge.send(json, function(responseData) {
						log('JS got response', responseData)
					});
			  }    
			 /**if(self.attr("level")!=1){
			   window.location.href = "syb.html?cityName="+encodeURIComponent($(this).html());
			 }else{
			   window.location.href = "sya.html?cityName="+encodeURIComponent($(this).html());
			 } **/
			 getSdkUrl($(this).html());
		 } 
	});   
	$('.vehicle-list .close').on('click', function(){ 
		$(".vehicle-list").fadeOut(); 
	});   
	$("#nearby-wrap").on('click','li',function(){
	   var id = $(this).attr('shopid');
	   window.location.href = "http://w2nw?"+getPath()+"shop.html?shopid="+id;
	});
	function getSdkUrl(city){//获取sdk首页广告位 
		$.ajax({
		  url: '/yangchebao-app-ws/ws/0.1/advertise/location?modelId='+paramJson.modelId+'&cityName='+city+'&location=19&count=1&sdkChannelNo='+paramJson.partnerid+"&"+(new Date()).getTime(),
		  type: 'get', 
		  dataType: 'json',
		  success: function(data) {   
			window.location.href = data[0].entityUrl;
		  },error:function(xhr){} 
		});  
	}
});   

</script>
</body>
</html>