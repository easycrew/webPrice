<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script>  
<script type="text/javascript" src="../js/jquery.json-2.2.js"></script>  
<script src="../js/index.js"></script>
<title>选择车型</title>
</head> 
<style type="text/css">  
body{
	font-family:'华文细黑','HelveticaNeue-Light';
	font-weight:normal;
	font-style:normal;
	line-height:normal;
	font-size:62.5%;
	color:#1e1e1e;
}
body,html{
	height:100%;
}
a{
	text-decoration:none;
}
ul{
	list-style:none;
}
img{
	border:none;
}
*{
	margin:0;
	padding:0;
}
.h-overflow {
    height:100%;
	overflow:hidden;
}
.brand-wrap{
  position: relative;
  min-height: 100%;
}
.brand-wrap .word{
  height: 26px;
  line-height: 26px;
  color: #c2c2c6;
  font-size: 1.6em;
  padding: 0 23px;
  background-color: #f4f7f8;
}
.brand-wrap ul{
   border-top: 1px solid #d9d9e2;
   background-color: #fff;
}
.brand-wrap li{
  height: 58px;
  line-height: 58px;
  font-size: 1.8em;
  color: #3b3b3b;
  padding: 0 18px;
  border-bottom: 1px solid #d9d9e2;
}
.car-wrap{
  position: absolute;
  top: 0;
  left:65px;  
  right: 0;
  min-height: 100%; 
  background-color: #fff;  
  border-left: 1px solid #d9d9e2;   
}  
.car-overlay{
  background-color: rgba(0,0,0,0.4); 
  position: absolute;
  top: 0;
  left:0;  
  width: 100%;
  height: 100%;
}
.overlay-wrap{ 
  top: 23em; 
}
.modelCheckBtn{  
    margin-bottom: 0;
}
.modelCheckBtn .arrow{ 
    transform: rotate(135deg);  
    -ms-transform:rotate(135deg);   
    -moz-transform:rotate(135deg); 
    -webkit-transform:rotate(135deg);  
    -o-transform:rotate(135deg); 
} 
.close {
    cursor: pointer;
    display: inline-block;
    height: 28px;
    position: absolute;
    right: 10px;
    top: 10px;
    width: 28px;
    z-index: 10;
}
.close label {
    display: inline-block;
    margin-left: 10px;
}
.close label::before {
    border-right: 1px solid #fc5d3c;
    content: "";
    display: inline-block;
    height: 28px;
    transform: rotate(45deg);
	-ms-transform:rotate(45deg);   
    -moz-transform:rotate(45deg); 
    -webkit-transform:rotate(45deg);  
    -o-transform:rotate(45deg); 
    width: 1px;
}
.close label::after {
    border-left: 1px solid #fc5d3c;
    content: "";
    display: inline-block;
    height: 28px;
    transform: rotate(-45deg);
	-ms-transform:rotate(-45deg);   
    -moz-transform:rotate(-45deg); 
    -webkit-transform:rotate(-45deg);  
    -o-transform:rotate(-45deg); 
    width: 1px;
}
/**错误提示**/
.tasat-wrap{
   position: fixed;
   text-align: center;
   bottom: 50%;
   width: 100%; 
}
.tasat {
    background-color: #000;
    border-radius: 8px;
    color: #fff;
    display: inline-block;
    font-size: 14px;
    margin: 0 20px;
    opacity: 0.8;
    padding: 10px;
}

</style>
<body style="background-color:#f4f7f8;">   
  <section class="brand-wrap">
    <div class="brandList"> 
    </div>
    <div class="car-overlay" style="display:none;"></div>
    <article class="car-wrap" style="display:none;">   
       <span class="close"><label></label></span>
    </article> 
  </section>
  <div class="overlay-wrap"></div>
<div class="dialog" style="display:none;" id="dialog">
      <div>
        <h1>提示</h1>
        <p>您已经是养车宝用户，点击下一步继续。</p>
        <div class="btn-wrap">
            <div class="dialog-btn next">下一步</div>
        </div>
      </div>
</div>  
<div class="dialog" style="display:none;" id="dialog2">
      <div>
        <h1>提示</h1>
        <p>此手机号已绑定其他微信号，如需解绑，请联系客服01058377979。</p>
        <div class="btn-wrap">
            <div class="dialog-btn next">下一步</div>
        </div>
      </div>
</div>
<script type="text/javascript">
$(document).ready(function(){ 
    var paramJson = {}; 
	var url =window.location.search;  
    if(url!=undefined&&url!=""){
		var paramsArr = (url.split("?")[1]).split("&"); 
		$.each(paramsArr,function(i){
		 var item = paramsArr[i].split("=");
		 paramJson[item[0]] = item[1];
		});    
	}  
	index.init = function(userInfo){ 
	  paramJson.customerId = userInfo.customerId;   
	};
	getBrandMsg();  	
	$(".car-wrap").on('click','.close',function(){
	  $(".car-wrap").fadeOut();
	  $(".car-wrap").html('<span class="close"><label></label></span>');
	  $(".car-overlay").fadeOut();
	  //$('.brand-wrap').removeClass("h-overflow");
	}); 
	$(".brandList").on('click','li',function(){ 
	   var brandid = $(this).attr("brandid");
	   paramJson.brandid =brandid;
	   paramJson.brandName = $(this).html();
	   getCarList(brandid);
	   //$('.brand-wrap').addClass("h-overflow");
	   $(document).scrollTop(0); 
	   $(".car-overlay").fadeIn();
	   $(".car-wrap").fadeIn();  
	}); 
     $(".car-wrap").on('click','li',function(){   
           var modelName = $(this).html(); 
		   paramJson.modelId = $(this).attr("modelid");
		   paramJson.modelName = modelName;
           $(".carCheckBtn span").html(modelName);   
           modifyModel();  
      });     
      function getBrandMsg(){ 
          $.ajax({
              url: '/shopmanage-ws/ws/0.1/support/brand/list',
              type: 'get', 
              dataType: 'json',
              success: function(data) {  
                 $.each(data,function(k,v){
                    var _h1 = '<h1 class="word">'+k+'</h1>'; 
                    $(".brandList").append(_h1);
                    var _ul = $("<ul>");
                    var items = v;
                    $.each(items,function(i){
                    var item = items[i];
                    var _li = $("<li>").html(item.name).attr("brandid",item.id); 
                    _ul.append(_li); 
                    }); 
                    $(".brandList").append(_ul);
                 });  
              },error:function(xhr){  
			      var mes = eval('('+xhr.responseText+')'); 
			   alertTasat(mes[0].message);
              }
          });  
      }
      function getCarList(brandid){ 
          $.ajax({
              url: '/shopmanage-ws/ws/0.1/support/model/list?brandId='+brandid,
              type: 'get', 
              dataType: 'json',
              success: function(data) {    
                 $.each(data,function(i){
                    var item = data[i];
                    var _h1 = '<h1 class="word">'+item.name+'</h1>';  
                    $(".car-wrap").append(_h1);
                    var _ul = $("<ul>").attr("class","carList");
                    var models = item.models;
                    $.each(models,function(i){
                    var model = models[i];
                    var _li = $("<li>").html(model.name).attr("modelid",model.id); 
                    _ul.append(_li); 
                    }); 
                    $(".car-wrap").append(_ul);
                 });  
              },error:function(xhr){  
			      var mes = eval('('+xhr.responseText+')'); 
			   alertTasat(mes[0].message);
              }
          });  
      }   
	  var link = function(){
		window.location.href = "index.html?pageCode="+paramJson.pageCode;
	  };
      function modifyModel(){ 
          var postData = {}; 
          postData.modelId= paramJson.modelId;
          postData.customerId = paramJson.customerId;    
          $.ajax({  
              url: '/yangchebao-app-ws/ws/0.1/user/complete/addCarInfo',
              type: 'post', 
              data:$.toJSON(postData),
              dataType: 'json',
              async:'false',
              contentType:'application/json;charset=utf-8', 
              success: function(data) {    
                  alertTasat("保存车系成功");
				  window.AppJsParamsObj.saveModelInfo(paramJson.brandid,paramJson.brandName,paramJson.modelId,paramJson.modelName);     
				  setTimeout(link, 100); 
              },error:function(xhr){  
			      var mes = eval('('+xhr.responseText+')'); 
			      alertTasat(mes[0].message);
              }
          });  
      }   
}); 
</script>  
</body>
</html>