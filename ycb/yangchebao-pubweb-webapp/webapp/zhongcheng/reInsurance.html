<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,heihgt=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="format-detection" content="telephone=no" />
	<title>提取续保奖励</title>
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script> 
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js"></script>
	<link rel="stylesheet" href="css/main.css">
	<script src="js/commen.js"></script>
	<style> 
		article.cardInfo{ 
			margin-top: 1.5rem;
		}
		div.row{
			background-color: #fff;
			position: relative;
			padding: 1rem 0;
			border-bottom: 1px solid #D9D9E2;
		}
		div.row span{
			display: inline-block;
			float: left;
			font-size: 1.8rem;
			line-height: 3rem;
			padding: 0 1rem; 
			text-align: center;
		}
		div.row p{
			margin-left: 7.6rem;
			border-left: 1px solid #D9D9E2;
			padding-left: 1rem;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
		}
		div.row input{
			border: none;
			width: 100%;
			font-size: 1.8rem;
			line-height: 3rem;
			background-color: #fff;
		}
		div.sureBtn{
			text-align: center;
			color: #fff;
			background-color: #ff6138;
			margin: 2.5rem 1.5rem 0;
			font-size: 1.8rem; 
			line-height: 4.4rem;
			-webkit-border-radius: 8px;
			-moz-border-radius: 8px;
			border-radius: 8px; 
		}
		.info{
			font-size: 1.2rem;
			color: #A2A2A2;
			margin:1rem 1.5rem;
		}
		.link{
			font-size: 1.2rem;
			float: right;
			color: #6EAADE;
			margin: 1rem 1.5rem;
		}
		div.imgW,p.text{
			text-align: center;
		}
		div.imgW{
			margin: 4rem 0 2rem;
		}
		div.imgW img{
			width: 90px;
		}
		p.text{
			font-size: 1.5rem;
			color: #a2a2a2;
		}
		p.tip{
			display: none;
			color: #ff6138;
			font-size: 1.2rem;
			width: 220px;
			margin: 1rem auto 0;

		}
		input,textarea{
			-webkit-appearance:none;
			-moz-appearance: none;
			appearance: none;
		}
		input:focus{
			outline:none;
		}
		div.grayBtn{
		  background-color:#ccc;
		}
		div.dialog {
			background-color: rgba(0, 0, 0, 0.5);
			height: 100%;
			position: absolute;
			top: 0;
			width: 100%;
			z-index: 300;
		} 
		.dialog-content{
			background-color: #fff;
			border-radius: 8px;
			margin: 8rem 5% 0;
			position: fixed;
			width: 90%;
			z-index: 500; 
			padding-bottom: 1rem;
		}
		.dialog h1{
			font-weight: normal;
			font-size: 1.6rem;
			text-align: center;
			height: 3.5rem;
			line-height: 3.5rem;
			border-bottom:1px solid #FF6E47;
			position: relative;
		}
		.close {
			cursor: pointer;
			display: inline-block;
			height: 28px;
			position: absolute;
			right: 10px;
			top: 5px;
			width: 28px;
			z-index: 10;
		}  
		.close label {
			display: inline-block;
			margin-left: 10px;
		}
		.close label::before {
			border-right: 1px solid #fc5d3c;
			content: "";
			display: inline-block;
			height: 28px;
			transform: rotate(45deg); 
			-ms-transform:rotate(45deg);   
			-moz-transform:rotate(45deg); 
			-webkit-transform:rotate(45deg);  
			-o-transform:rotate(45deg); 
			width: 1px;
		}
		.close label::after {
			border-left: 1px solid #fc5d3c;
			content: "";
			display: inline-block;
			height: 28px;
			transform: rotate(-45deg); 
			-ms-transform:rotate(-45deg);   
			-moz-transform:rotate(-45deg); 
			-webkit-transform:rotate(-45deg);  
			-o-transform:rotate(-45deg);  
			width: 1px;
		}
		.dialog p{ 
			font-size: 1.6rem; 
			padding: 4.7rem 1.5rem;
		}
		.dialog-btn-wrap{
			margin: 0 1rem;
		}
		.dialog-btn-wrap a{
			display: block;
			height: 3.3rem;
			line-height: 3.3rem;
			font-size: 1.8rem;
			color:#fff;
			background-color: #FF6E47;
			text-align: center;
			border-radius: 3px;
			border:1px solid #FF6E47;
		}
		.two-btn>div{
			width:50%;
			float:left;
			box-sizing:border-box;
		}
		.two-btn>div:nth-child(1){
			padding-right:5px;
		}
		.two-btn>div:nth-child(2){
			padding-left:5px;
		}
		.two-btn>div:nth-child(1) a{
			background-color:#fff; 
			color:#FF6E47;
		} 
		.comment {
			background-color: #e2f0f6;
			border: 1px solid #6eaade;
			border-radius: 5px;
			color: #6eaade;
			font-size: 1.4em;
			list-style: decimal inside;
			margin: 40px 25px 64px;
			padding: 18px;
			position: relative;
		} 
		.comment li:last-child {
			background-color: #abcfef;
			border-radius: 12px;
			color: #fff;
			height: 25px;
			left: 10px;
			line-height: 25px;
			list-style: outside none none;
			position: absolute;
			text-align: center;
			top: -12px;
			width: 70px;
		}
		ol li{
		    list-style:decimal inside;
		}
	</style>
</head>
<body>
	<section> 
		<article class="cardInfo">
			<div class="row clearfix">
				<span>姓&nbsp;&nbsp;&nbsp;&nbsp;名</span>
				<p class="cardNum"><input name="name" type="text"></p>
			</div>
			<div class="row clearfix">
				<span>保单号</span>
				<p class="cardPwd"><input name="policyCode" type="text"></p>
			</div>
			<div class="row clearfix">
				<span>车架号</span>
				<p class="cardPwd"><input name="vin" type="text"></p>
			</div>
			<p class="info">请确保填写的信息与保单信息一致，否则将无法领取福利</p>
			<div class="sureBtn">确认</div>
			<!--a class="link" href="javascript:void(0);">提取续保保险金规则说明</a-->
		</article>  
		<ol class="comment">
			  <li>本账号绑定车辆在众诚保险进行续保时才可将续保奖励进行提现。</li>
			  <li>提取续保奖励时还将会获得养车宝余额奖励。</li>
			  <li>请填写真实有效的车主姓名，保单号，与车架号，且填写信息与保单信息必须一致，保单已经起保。</li>
			  <li>续保保单起保时间不得超过首次认证保单起保时间的24个月。</li>
			  <li>众诚保险请到众诚官网或线下实体购买，本页面仅为领取续保奖励页面。</li>
			  <li>说明</li>  
		</ol>
	</section>
	<div class="dialog" style="display:none;">
		<div class="dialog-content">
		   <h1>提取失败<span class="close closeDialog"><label></label></span></h1>
		   <p class="msg"></p>
		   <div class="dialog-btn-wrap one-btn"><a href="javascript:void(0);" class="closeDialog">确定</a></div>
		   <div class="dialog-btn-wrap two-btn call-wrap" style="display:none;"><div><a href="javascript:void(0);"  class="closeDialog">确定</a></div>
		             <div><a href="javascript:void(0);" class="phone">联系客服</a></div>
		   </div>	
           <div class="dialog-btn-wrap two-btn new-wrap" style="display:none;"><div><a href="javascript:void(0);"  class="closeDialog">关闭</a></div>
		             <div><a href="javascript:void(0);" class="toNew">新用户认证</a></div>
		   </div>			   
	   </div>
    </div> 
	<section id="sucHtml"></section>
</body>
<script class="text/javascript"> 
	var paramJson = {};
	$(function(){  
		// 获取参数 
		var url = window.location.search; 
	    if(url!=''){
	    	var paramsArr = (url.split("?")[1]).split("&");
		    $.each(paramsArr,function(i){
		        var item = paramsArr[i].split("=");
		        paramJson[item[0]] = item[1]
		    });
	    }   
		// 人保用户绑定
		$('div.sureBtn').unbind('click').bind('click',function(){
		    var nowTime = new Date().getTime();
			var clickTime = $(this).attr("ctime");
			if( clickTime != 'undefined' && (nowTime - clickTime < 5000)){ 
				return false;
			 }else{
				$(this).attr("ctime",nowTime); 
			 }
			insure(); 
		})
		$('input[name="vin"]').keyup(function(){
		   $(this).val($(this).val().toUpperCase());
		});  
		$(".dialog .closeDialog").click(function(){
			$(".dialog").hide();
		});
		$(".dialog .phone").click(function(){
		    $(".dialog").hide();
			window.location.href="tel:01058377979"; 
		});
		$(".dialog .toNew").click(function(){
		    $(".dialog").hide();
			newInsure(); 
		});
		
	});
	
	function insure(){
			var name=$.trim($('input[name="name"]').val());
			var policyCode=$.trim($('input[name="policyCode"]').val());
			var vin=$.trim($('input[name="vin"]').val());
			if(name==''){
				errorLog('请输入姓名');
				return false
			}
			if(name.length>14){
				errorLog('输入姓名过长');
				return false
			}
			if(policyCode==''){
				errorLog('请输入保单号');
				return false
			}
			if(vin==''){
				errorLog('请输入车架号');
				return false
			}
			var reg = /^[A-Z0-9]{17}$/;
			if(!(reg.test(vin))){
				errorLog('请输入正确的车架号');
				return false
			} 
			var postData={};
			postData.userInfoId = paramJson.userId;
			postData.realName=name;
			postData.policyCode = policyCode;
			postData.vin=vin;
			postData.comCode=1000;  
			$.ajax({          
				url:'/yangchebao-app-ws/ws/0.1/insure/renewalRewardExtraction',
				type:'post',
				dataType:'json',
				data:$.toJSON(postData),
				contentType:'application/json;charset=utf-8',
				success:function(data){   
					window.location.href="monthReport/success.html?renewalReward="+data.renewalReward+"&userType="+data.userType+"&discount="+data.discount;  
				},
				error:function(xhr){ 
					var error=eval('('+xhr.responseText+')');
					var msg = error[0].message; 
					if(msg.indexOf("保单与车架号不匹配")!=-1){
						$(".dialog .msg").html("输入的信息错误！请检查您输入的信息是否与保单一致，如无法解决，请致电客服。");
						$(".dialog .one-btn").hide();
						$(".dialog .new-wrap").hide();
						$(".dialog .call-wrap").show();
						$(".dialog").fadeIn();
					}else if(msg.indexOf("保单未起保")!=-1){
					    $(".dialog .msg").html("保单未起报！请在保单起保之后再申请领取保险金。");
						$(".dialog .one-btn").show();
						$(".dialog .two-btn").hide();
						$(".dialog").fadeIn();
					}else if(msg.indexOf("与上一保单起保日期相差24个月，请走新认证用户流程")!=-1){
					    $(".dialog .msg").html("与上一保单起保日期相差24个月，请走新认证用户流程。");
						$(".dialog .one-btn").hide();
						$(".dialog .call-wrap").hide();
						$(".dialog .new-wrap").show();
						$(".dialog").fadeIn();
					}else{
						$(".dialog .msg").html(msg);
						$(".dialog .one-btn").show();
						$(".dialog .two-btn").hide();
						$(".dialog").fadeIn();
					}
					 
				}
			});
	}
	function  newInsure(){
			var name=$.trim($('input[name="name"]').val());
			var policyCode=$.trim($('input[name="policyCode"]').val());
			var vin=$.trim($('input[name="vin"]').val()); 
			var postData={};
			postData.userInfoId = paramJson.userId;
			postData.realName=name;
			postData.policyCode = policyCode;
			postData.vin=vin;
			postData.comCode=1000;  
			$.ajax({          
				url:'/yangchebao-app-ws/ws/0.1/insure/identify',
				type:'post',
				dataType:'json',
				data:$.toJSON(postData),
				contentType:'application/json;charset=utf-8',
				success:function(data){ 
					if(data.resultCode==1){  
					    $(".cardInfo").hide();
					    $(".comment").hide();
						paramJson.discount = data.discount;
						paramJson.isGiveBox = data.isGiveBox;
					    $("#sucHtml").load("memberSuc.html");  
					}else{
						window.location.href="activeFail.html";
					}
				},
				error:function(xhr){
					var error=eval('('+xhr.responseText+')');
					errorLog(error[0].message)
				}
			})
	}
   
</script>
</html>