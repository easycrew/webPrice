<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes" />
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/> 
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script> 
    <script src="http://app.yangchebao.com.cn/group1/M00/00/9F/md50000000000000000000000000000.js"></script>
    <link href="date/mobiscroll.custom-2.13.2.min.css" rel="stylesheet" type="text/css" />
	<script src="date/mobiscroll.custom-2.13.2.min.js" type="text/javascript"></script>
	<script language="javascript" src="./js/jquery.json-2.2.js"></script> 
    <script src="js/commen.js"></script>
    <link rel="stylesheet" href="css/commen.css">
	<title>完善车辆信息</title>
	<style>
		*{
			margin: 0;
			padding: 0;
			list-style: none;
		}
		body{
			background-color: #f4f7f8;
			font-size: 62.5%;
			font-family: 'Hiragino Sans GB',Helvetica,Arial,sans-serif;
			color: #1e1e1e;
		}
		img{
			border: none;
			vertical-align: middle;
		}
		a{
			text-decoration: none;
			outline:none;
			blr:expression(this.onFocus=this.blur());
		}

		div.container{
			position: relative;
			min-width: 320px;
			max-width: 640px;
			margin: 0 auto;
		}
		header{
			padding-top: 0.8rem;
			padding-bottom: 0.8rem;
			background-color: #fff;
		}
		header nav ul{
			width: 95%;
			margin: auto;
			overflow: hidden;
		}
		header nav ul li{
			float: left;
		}
		header nav ul li img{
			width: 100%;
		}
		header nav ul li.carSafe_step1{
			width: 34.76%;
		}
		header nav ul li.carSafe_step2{
			width: 25.09%;
		}
		header nav ul li.carSafe_step3{
			width: 25.09%;
		}
		header nav ul li.carSafe_step4{
			width: 14.96%;
		}

		div.line{
			border-top: 1px solid #d9d9e2;
			background-color: #f4f7f8;
			height: 0.8rem;
		}
		article{
			background-color: #fff;
			padding: 1rem 1.2rem 0;
		}
		section.carNumbers article p{
			overflow: hidden;
		}
		section.carNumbers article p span.carNumber-title{
			float: left;
			font-size: 1rem;
		}
		span.carNumber-go{
			float: right;
			font-size: 0.9rem;
			color: #6eaade;
			cursor: pointer;
		}
		span.carNumber-go img{
			width: 1.2rem;
			position: relative;
			bottom: 0.1rem;
			margin-left: 0.2rem;
		}
		article input{
			-webkit-box-sizing:border-box;
			-moz-box-sizing:border-box;
			box-sizing:border-box;
			width: 100%;
			border: 1px solid #d9d9e2;
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px;
			margin-top: 0.3rem;
			padding: 0.6rem;
			font-size: 1rem;
			height: 2.4rem;
		}
		::-moz-placeholder{
			color: #999;
		}
		:-moz-placeholder{
			color: #999;
		}
		input:-ms-input-placeholder{
		    color: #999;
		}

		input::-webkit-input-placeholder{
		    color: #999;
		}
		span.firstDate-right{
			float: right;
			font-size: 0.9rem;
			color: #737575;
		}
		article.firstDate{
			padding-bottom: 2rem;
		}
		input#firstRegDate{
			background: url(img/time_icon.png) 0.6rem center no-repeat;
			background-size: 1.2rem 1.2rem;
			padding-left: 3rem;
		}
		div.next{
			border-top: 1px solid #DCDCE4;
			background-color: #f4f7f8;
			text-align: center;
			padding-top: 1rem;
			padding-bottom: 1rem;
		}
		p.nextBtn{
			margin: 0 0 3rem 0;
			-webkit-border-radius:8px;
			-moz-border-radius:8px;
			border-radius:8px;
			background:#ff6138;
			width: 92%;
			margin: 0 auto;
			color: #fff;
			font-size: 1.4rem;
			line-height: 3rem;
			cursor: pointer;
		}
		div.overLay{
			position: absolute;
			top:0;
			z-index: 100;
			background-color: #000;
			opacity: 0.6;
			filter:alpha(opacity=60);
			width: 100%;
			height: 100%;
		}
		div.number-over{
			position: absolute;
			top:0;
			z-index: 200;
		}
		div.NumberImg-wraper{
			margin-top: 100px;
			text-align: center;
		}
		div.NumberImg-wraper img{
			width: 90%;
		}
		p.NumberText-wraper{
			width: 90%;
			margin: 1.8rem auto 0;
			color: #fff;
			font-size: 1.2rem;
			font-weight: bold;
		}
		div.dwo{
			position: fixed!important;
		}
	</style>
</head>
<body>
	<div class="container">
		<header>
			<nav>
				<ul>
					<li class="carSafe_step1"><img src="img/carSafe_step1.png"></li>
					<li class="carSafe_step2"><img src="img/carSafe_stepGray2.png"></li>
					<li class="carSafe_step3"><img src="img/carSafe_stepGray3.png"></li>
					<li class="carSafe_step4"><img src="img/carSafe_stepGray4.png"></li>
				</ul>
			</nav>
		</header>
		<div class="line"></div>
		<section class="carNumbers">
			<article class='frameNumber'>
				<p>
					<span class="carNumber-title">车架号</span>
					<span class="carNumber-go frameNumber-go">去哪找<img src="img/details_icon.png"></span>
				</p>
				<input type="text" placeholder="车架号17位" name="vin" id="vin" maxlength='17'>
			</article>
			<article class='angineNumber'>
				<p>
					<span class="carNumber-title">发动机号</span>
					<span class="carNumber-go engineNumber-go">去哪找<img src="img/details_icon.png"></span>
				</p>
				<input type="text" placeholder="发动机号6-25位" name="engineNum" id="engineNum">
			</article>
			<article class='firstDate'>
				<p>
					<span class="carNumber-title">初登日期</span>
					<span class="firstDate-right">（新车未上牌请填购车日期）</span>
				</p>
				<input type="date" name="firstRegDate" id="firstRegDate">
			</article>
			<div class="next">
				<p class="nextBtn">下一步</p>
			</div>
		</section>
		<div class="frameNumber-over number-over" style="display:none;">
			<div class="NumberImg-wraper"><img src="img/frameNumber.png"></div>
			<p class="NumberText-wraper">车架号是用于识别车辆的代码，它位于行驶证的下方位置或汽车前挡风玻璃的左下角。</p>
		</div>
		<div class="engineNumber-over number-over" style="display:none;">
			<div class="NumberImg-wraper"><img src="img/engineNumber.png"></div>
		</div>
		<div class="overLay" style="display:none;"></div>
	</div>
</body>
<script type="text/javascript">
	$(function(){
		// 获取参数
		var url = window.location.search; 
	    var paramJson = {};
	    if(url!=''){
	    	var paramsArr = (url.split("?")[1]).split("&");
		    $.each(paramsArr,function(i){
		        var item = paramsArr[i].split("=");
		        paramJson[item[0]] = item[1]
		    });
	    };
		// 遮罩层自适应高度
		var bodyHeight=$('body').height();
		var windowHeight=window.screen.availHeight;
		if(bodyHeight>windowHeight){
			$('div.overLay').css('height',bodyHeight)
		}else{
			$('div.overLay').css('height',windowHeight)
		}

		$('span.frameNumber-go').unbind('click').bind('click',function(){
			window.scrollTo(0,0);
			$('div.overLay').show();
			$('div.frameNumber-over').show();
			$('div.overLay,div.frameNumber-over').bind('click',function(){
				$('div.overLay').hide();
				$('div.frameNumber-over').hide()
			})
		});
		$('span.engineNumber-go').unbind('click').bind('click',function(){
			window.scrollTo(0,0);
			$('div.overLay').show();
			$('div.engineNumber-over').show();
			$('div.overLay,div.engineNumber-over').bind('click',function(){
				$('div.overLay').hide();
				$('div.engineNumber-over').hide()
			})
		});
		var date = new Date();
		// var reNoteDate = function(){
	 //        var chooseTime = new Date();
	 //        var dates = [];
	 //        var datestr='';
	 //        var year=chooseTime.getFullYear();
	 //        var month=chooseTime.getMonth()+1;
	 //        if(month<10){
	 //        	month='0'+month
	 //        }
	 //        var day=chooseTime.getDate();
	 //        if(day<10){
	 //        	day='0'+day
	 //        }
	 //        dates.push(year);
	 //        dates.push(month);
	 //        dates.push(day);
	 //        datestr=dates.join('-');
	 //        return datestr
	 //    }
		var nowYear=date.getFullYear();
		$('input#firstRegDate').mobiscroll().date({
			theme:'bootstrap',
			preset:'date',
			display:'modal',
			mode:'scroller',
			lang:'zh',
			dateFormat:'yy-mm-dd',
			dateOrder:'yymmdd',
			endYear:nowYear
		});
		$("input#firstRegDate").bind('click',function(){
			var dwHeight=$('div.dw').outerHeight();
			$('div.dw').css({'top':'50%','margin-top':'-'+(dwHeight/2)+'px'});
			 $(window).off("scroll")
	    });
		// $('input#firstRegDate').val(reNoteDate);
		$('p.nextBtn').unbind('click').bind('click',function(){
			var vinVal=$('input[name="vin"]').val();
			var engineNumVal=$('input[name="engineNum"]').val();
			var firstRegDateVal=$('input[name="firstRegDate"]').val();
			if(vinVal==''){
				safeAlert(1,'请输入车架号','确定','');
				return false
			}
			if(vinVal.length!=17){
				safeAlert(1,'车架号为17位','确定','');
				return false
			}
			if(/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(vinVal)){
				safeAlert(1,'车架号只能为字母或数字','确定','');
				return false
			}

			if(engineNumVal==''){
				safeAlert(1,'请输入发动机号','确定','');
				return false
			}
			if(engineNumVal.length<6){
				safeAlert(1,'发动机号至少6位','确定','');
				return false
			}
			if(engineNumVal.length>25){
				safeAlert(1,'发动机号最多25位','确定','');
				return false
			}
			if(/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(engineNumVal)){
				safeAlert(1,'发动机号只能为字母或数字','确定','');
				return false
			}

			if(firstRegDateVal==''){
				safeAlert(1,'请选择初登日期','确定','');
				return false
			}
			var postData={};
			postData.customerId=paramJson.customerId;
			postData.provinceId=paramJson.provinceId;
			postData.cityId=paramJson.cityId;
			postData.vin=vinVal;
			postData.engineNum=engineNumVal;
			postData.firstRegDate=firstRegDateVal;
			$.ajax({
				url:'/yangchebao-app-ws/ws/0.1/insure/car/replace',
				type:'post',
				dataType:'json',
				data:$.toJSON(postData),
				async:false,
				contentType:'application/json;charset=utf-8',
				error:function(xhr){
					var error=eval('('+xhr.responseText+')');
					safeAlert(1,error[0].message,'确定','')
				}
			}).then(function(data){
				window.location.href="/yangchebao-pubweb/baoxian/dinner.html?customerId="+paramJson.customerId+'&userId='+paramJson.userId
			})
		})
	})
</script>
</html>