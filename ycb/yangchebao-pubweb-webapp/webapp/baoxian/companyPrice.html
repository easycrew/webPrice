<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes" />
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/> 
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script> 
    <script src="http://app.yangchebao.com.cn/group1/M00/00/9F/md50000000000000000000000000000.js"></script>
    <script language="javascript" src="./js/jquery.json-2.2.js"></script> 
    <script src="js/commen.js"></script>
    <link rel="stylesheet" href="css/commen.css">
	<title>查报价选投保公司</title>
	<style>
		*{
			margin: 0;
			padding: 0;
			list-style: none;
		}
		body{
			background-color: #f4f7f8;
			font-size: 62.5%;
			font-family: 'Hiragino Sans GB',Helvetica,Arial,sans-serif;
			color: #1e1e1e;
		}
		img{
			border: none;
			vertical-align: middle;
		}
		a{
			text-decoration: none;
			outline:none;
			blr:expression(this.onFocus=this.blur());
		}

		div.container{
			background-color: #fff;
			position: relative;
			min-width: 320px;
			max-width: 640px;
			margin: 0 auto;
		}
		header{
			padding-top: 0.8rem;
			margin-bottom: 1.1rem;
		}
		header nav ul{
			width: 95%;
			margin: auto;
			overflow: hidden;
		}
		header nav ul li{
			float: left;
		}
		header nav ul li img{
			width: 100%;
		}
		header nav ul li.carSafe_step1{
			width: 34.76%;
		}
		header nav ul li.carSafe_step2{
			width: 25.09%;
		}
		header nav ul li.carSafe_step3{
			width: 25.09%;
		}
		header nav ul li.carSafe_step4{
			width: 14.96%;
		}
		
		section{
			margin-top: 1rem;
			background-color: #f4f7f8;
		}
		article.article-top{
			border-top: 1px solid #DCDCE4;
		}
		article.article-top p.toIndex{
			text-align: right;
			padding: 0.5rem 1rem;
		}
		p.toIndex a{
			color: #6eaade;
			font-size: 1rem;
		}
		article.article-top p.tip{
			color: #fff;
			background-color: #ffbe00;
			text-align: center;
			line-height: 2.6rem;
			font-size: 1rem;
			margin: 0.4rem 0 1rem 0;
		}
		p.companyNum{
			color: #999;
			font-size: 1rem;
			text-align: center;
		}
		p.companyNum span#time{
			color: #ffbe00;
			font-size: 1.2rem;
		}
		ul.price-ul li.price-li{
			overflow: hidden;
			background-color: #fff;
			border-top: 1px solid #DCDCE4;
			border-bottom: 1px solid #DCDCE4;
			margin-top: 0.8rem;
		}
		p.price-li-left{
			float: left;
			color: #666;
			font-size: 1rem;
			line-height: 2.6rem;
			padding-left: 1rem;
		}
		p.price-li-left img{
			width: 2.9rem;
		}
		p.price-li-right{
			float: right;
			margin-right: 1rem;
			color: #fb4f2c;
			font-size: 1rem;
			cursor: pointer;
			line-height: 2.6rem;
		}
		p.price-li-right img.selectModelIcon{
			margin-left: 0.7rem;
			width: 0.5rem;
			margin-top: -0.2rem;
		}
		p.price-li-right img.downIcon{
			margin-left: 0.4rem;
			width: 0.8rem;
			margin-top: -0.2rem;
		}
		.priceLoading{
			color: #aaa!important;
			font-size: 0.8rem!important;
			cursor: default!important;
		}
		.noJian{
			color: #666!important;
		}
		div.btns{
			width: 90%;
			margin: 1rem auto 0;
		}
		div.btns span.btn{
			display: inline-block;
			background-color: #6eaade;
			width: 45%;
			color: #fff;
			font-size: 1.1rem;
			line-height: 2.2rem;
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px;
			text-align: center;
			cursor: pointer;
		}
		div.btns span.btnOne{
			margin-right: 4%;
		}

		div.failReasons{
			margin: 0 1rem 0 1rem;
		}
		ul.failReasons-ul{
			border-top: 1px solid #DCDCE4;
			border-bottom: 1px solid #DCDCE4;
		}
		ul.failReasons-ul li.failReasons-li{
			color: #999;
			font-size: 1rem;
			margin: 0.3rem 0;
			list-style-type: disc;
			list-style-position: inside;
		}
		p.editInsurance{
			padding-right: 0.8rem;
			line-height: 2.6rem;
			text-align: right;
		}
		p.editInsurance a{
			color: #6eaade;
			font-size: 1rem;
		}
	</style>
</head>
<body>
	<div class="container">
		<header>
			<nav>
				<ul>
					<li class="carSafe_step1"><img src="img/carSafe_step1.png"></li>
					<li class="carSafe_step2"><img src="img/carSafe_step2.png"></li>
					<li class="carSafe_step3"><img src="img/carSafe_step3.png"></li>
					<li class="carSafe_step4"><img src="img/carSafe_stepGray4.png"></li>
				</ul>
			</nav>
			<section>
				<article class="article-top">
					<p class="toIndex"><a href="http://w2l?closeActivity">返回首页</a></p>
					<p class="tip">支付价格以核保结果为准</p>
					<p class="companyNum">有 <span name="companyNum">0</span> 家保险公司正争先恐后地报价···<span id="time">30</span> 秒</p>
				</article>
				<article class="article-middle">
					<ul class="price-ul">
						<!-- <li class="price-li">
							<p class="price-li-left">中华联合车险</p>
							<p class="price-li-right"><span>￥35000.00</span><img src="img/selectModel_icon.png"></p>
						</li>
						<li class="price-li">
							<p class="price-li-left">中华联合车险</p>
							<p class="price-li-right"><span>￥35000.00</span><img src="img/selectModel_icon.png"></p>
						</li>
						<li class="price-li">
							<p class="price-li-left">阳光车险</p>
							<p class="price-li-right priceFail"><span class="noJian">报价失败</span><img src="img/selectModel_icon.png"></p>
							<div style="clear:both;"></div>
							<div class="failReasons" style="display:none;">
								<ul class="failReasons-ul">
									<li class="failReasons-li">新车购置价大于100万不予承保</li>
									<li class="failReasons-li">车龄8年（含）以内车辆方可投保自燃损失险</li>
									<li class="failReasons-li">司机负责险和乘客责任险必须同时投保</li>
								</ul>
								<p class="editInsurance"><a href="http://w2nw?http://10.23.31.151/yangchebao-pubweb/baoxian/dinner.html">修改险种</a></p>
							</div>
						</li>
						<li class="price-li">
							<p class="price-li-left">中华联合车险</p>
							<p class="price-li-right priceLoading">努力报价中···</p>
						</li>
						<li class="price-li">
							<p class="price-li-left">中华联合车险</p>
							<p class="price-li-right priceLoading">努力报价中···</p>
						</li>
						<li class="price-li">
							<p class="price-li-left">大地车险</p>
							<p class="price-li-right"><span class="noJian">￥35000.00</span><img src="img/selectModel_icon.png"></p>
						</li> -->
					</ul>
				</article>
				<div class="btns">
					<span class="btnOne btn">修改保障项目</span>
					<span class="btnTwo btn">重新报价</span>
				</div>
			</section>
		</header>
	</div>
</body>
<script type="text/javascript">
	$(function(){
		// 获取参数
		var url = window.location.search; 
	    var paramJson = {};
	    if(url!=''){
	    	var paramsArr = (url.split("?")[1]).split("&");
		    $.each(paramsArr,function(i){
		        var item = paramsArr[i].split("=");
		        paramJson[item[0]] = item[1]
		    });
	    };
		var waiter=30;
		function time(){
			if(waiter==0){
				clearInterval(autoTime);
				$('p.companyNum').html('<span style="color:#ff6138;"> '+safeCompanise.vehicleEnquirys.length+' </span>家公司报价完毕！');
				return false
			}
			if(waiter==30){
				// 循环获取公司报价
				$('ul.price-ul li.price-li').each(function(){
					var thisDataId=$(this).find('p.price-li-left').attr('data-id');
					var $thisLi=$(this);
					// <li class="price-li">
					// 	<p class="price-li-left">中华联合车险</p>
					// 	<p class="price-li-right"><span>￥35000.00</span><img src="img/selectModel_icon.png"></p>
					// </li>
					$.ajax({
						url:'/yangchebao-app-ws/ws/0.1/insure/latest?sqid='+thisDataId+'&customerId='+paramJson.customerId+'&'+new Date().getTime(),
						type:'get',
						dataType:'json',
						contentType:'application/json;charset=utf-8',
						success:function(data){
							if(data.code=="0"){
								$thisLi.find('p.price-li-right').removeClass('priceLoading').html('<span>￥'+data.totalCharge+'</span><img src="img/selectModel_icon.png" class="selectModelIcon">');
								// 查看报价详情
								$thisLi.find('p.price-li-right').unbind('click').bind('click',function(){
									window.location.href="/yangchebao-pubweb/baoxian/applySafe.html?sqid="+thisDataId+"&customerId="+paramJson.customerId+'&userId='+paramJson.userId
								})
							}else if(data.code=='1'){
								$thisLi.find('p.price-li-right').removeClass('priceLoading').addClass('priceFail').html('<span class="noJian">报价失败</span><img src="img/selectModel_icon.png" class="selectModelIcon">');
								var failStr='';
								if(data.msg=='报价超时' || !(data.msg)){
									data.msg='此保险公司未来得及参与报价'
								}
								failStr+='<div style="clear:both;"></div>'
										+'<div class="failReasons" style="display:none;">';
								if(data.msg=='此保险公司未来得及参与报价'){
									failStr+='<ul class="failReasons-ul" style="border-bottom:none!important;">'
											+'<li class="failReasons-li">'
											+data.msg
											+'</li>'
											+'</ul>'
											+'</div>';
								}else{
									failStr+='<ul class="failReasons-ul">'
											+'<li class="failReasons-li">'
											+data.msg
											+'</li>'
											+'</ul>'
											+'<p class="editInsurance"><a href="javascript:history.go(-1);">修改险种</a></p>'
											+'</div>'
								}
								$thisLi.append(failStr);
								// 查看失败详情
								$thisLi.find('p.priceFail').unbind('click').bind('click',function(){
									if($(this).find('img').attr('src')=='img/selectModel_icon.png'){
										$(this).find('img').attr('src','img/down_icon.png').removeClass('selectModelIcon downIcon').addClass('downIcon');
										$(this).parent().find('div.failReasons').show()
									}else{
										$(this).find('img').attr('src','img/selectModel_icon.png').removeClass('selectModelIcon downIcon').addClass('selectModelIcon');
										$(this).parent().find('div.failReasons').hide()
									}
								})
							}
						}
					})
				})
			}
			waiter--;
			$('span#time').html(waiter)
		}
		
		// 获取公司
		if(window.localStorage){
			var safeCompanise=getLocalStorage('safeCompanise');
			console.log(safeCompanise)
		}else{
			var safeCompanise=getCookie('safeCompanise');
		}
		
		var safeCompaniseStr='';
		safeCompanise.vehicleEnquirys.forEach(function(key,i){
			safeCompaniseStr+='<li class="price-li">'
							 +'<p class="price-li-left" data-id="'+key.sqid+'">'+key.name+'</p>'
							 +'<p class="price-li-right priceLoading">努力报价中···</p>'
							 +'</li>'
		});
		$('span[name="companyNum"]').html(safeCompanise.vehicleEnquirys.length);
		$('ul.price-ul').html(safeCompaniseStr);
		// $('ul.price-ul').append('<li class="price-li"><p class="price-li-left" data-id="6010209151040490292">打造车险</p><p class="price-li-right"><span>￥2050.0</span><img src="img/selectModel_icon.png"></p></li>');
		autoTime=setInterval(time,1000);
		// // 循环获取公司报价
		// $('ul.price-ul li.price-li').each(function(){
		// 	var thisDataId=$(this).find('p.price-li-left').attr('data-id');
		// 	var $thisLi=$(this);
		// 	// <li class="price-li">
		// 	// 	<p class="price-li-left">中华联合车险</p>
		// 	// 	<p class="price-li-right"><span>￥35000.00</span><img src="img/selectModel_icon.png"></p>
		// 	// </li>
		// 	$.ajax({
		// 		url:'/yangchebao-app-ws/ws/0.1/insure/latest?sqid='+thisDataId+'&customerId='+paramJson.customerId+'&'+new Date().getTime(),
		// 		type:'get',
		// 		dataType:'json',
		// 		contentType:'application/json;charset=utf-8',
		// 		success:function(data){
		// 			if(data.code=="0"){
		// 				$thisLi.find('p.price-li-right').removeClass('priceLoading').html('<span>￥'+data.totalCharge+'</span><img src="img/selectModel_icon.png">');
		// 				// 查看报价详情
		// 				$thisLi.find('p.price-li-right').unbind('click').bind('click',function(){
		// 					window.location.href="/yangchebao-pubweb/baoxian/applySafe.html?sqid="+thisDataId+"&customerId="+paramJson.customerId+'&userId='+paramJson.userId
		// 				})
		// 			}else if(data.code=='1'){
		// 				$thisLi.find('p.price-li-right').removeClass('priceLoading').addClass('priceFail').html('<span class="noJian">报价失败</span><img src="img/selectModel_icon.png">');
		// 				var failStr='';
		// 				if(data.msg=='报价超时' || !(data.msg)){
		// 					data.msg='此保险公司未来得及参与报价'
		// 				}
		// 				failStr+='<div style="clear:both;"></div>'
		// 						+'<div class="failReasons" style="display:none;">'
		// 						+'<ul class="failReasons-ul">'
		// 						+'<li class="failReasons-li">'
		// 						+data.msg
		// 						+'</li>'
		// 						+'</ul>';
		// 				if(data.msg='此保险公司未来得及参与报价'){
		// 					failStr+='</div>'
		// 				}else{
		// 					failStr+='<p class="editInsurance"><a href="javascript:history.go(-1);">修改险种</a></p>'
		// 							+'</div>'
		// 				}
		// 				$thisLi.append(failStr);
		// 				// 查看失败详情
		// 				$thisLi.find('p.priceFail').unbind('click').bind('click',function(){
		// 					if($(this).find('img').attr('src')=='img/selectModel_icon.png'){
		// 						$(this).find('img').attr('src','img/down_icon.png');
		// 						$(this).parent().find('div.failReasons').show()
		// 					}else{
		// 						$(this).find('img').attr('src','img/selectModel_icon.png');
		// 						$(this).parent().find('div.failReasons').hide()
		// 					}
		// 				})
		// 			}
		// 		}
		// 	})
		// });
		
		// 修改险种
		$('span.btnOne').unbind('click').bind('click',function(){
			// window.location.href="http://w2nw?http://10.23.31.151/yangchebao-pubweb/baoxian/dinner.html"
			window.history.go(-1)
		});
		// 重新报价
		$('span.btnTwo').unbind('click').bind('click',function(){
			location.reload()
		})
	})
</script>
</html>