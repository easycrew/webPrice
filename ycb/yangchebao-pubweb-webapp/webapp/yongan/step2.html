<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>获取盒子</title>  
    <script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script>
    <script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js "></script>
    <script src="js/md5.js "></script>
	
    <script type="text/javascript">
        $(function(){  
        try{
            var phoneWidth = parseInt(window.screen.width);
            var phoneHeight = parseInt(window.screen.height);
            var phoneScale = phoneWidth / 640;
            var ua = navigator.userAgent;

            if (/Android (\d+\.\d+)/.test(ua)) {
                var version = parseFloat(RegExp.$1);
                // andriod 2.3
                    $('[name="viewport"]').attr('content', 'width=640, initial-scale=' + phoneScale + ', minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi');
                if (version >= 2.3) {
                    // andriod 2.3以上
                } else {
                    $('[name="viewport"]').attr('content', 'width=640, initial-scale= 1.0, minimum-scale = 1.0, maximum-scale = 1.0, user-scalable=no, target-densitydpi=device-dpi');
                }
            // 其他系统
            } else {
                    $('[name="viewport"]').attr('content', 'width=640, initial-scale=' + phoneScale + ', minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi');
            }
        }catch(e){}
    });
    </script>
</head>
<style type="text/css">
    html, body {
        -webkit-text-size-adjust:none;
        background-color: #ffffff;
        height: 100%;
    }
    * {
        margin:0;
        padding:0;
        -webkit-tap-highlight-color:rgba(0,0,0,0);
    }
    body {
        color: #1e1e1e;
        overflow-x: hidden;
        font-family:"黑体", "微软雅黑";
        font-size: 24px;
        width: 640px;
        margin: 0 auto;
    }
    a,a:hover{
        text-decoration: none;
        outline: none;
    }
    img,button {
        border:none;
    }
    ul,ol{
        list-style: none;
    }
    .coke-wrapper{
        background-color: #10acca;
        height: 100%;
        -webkit-box-sizing:border-box;
        box-sizing:border-box;
    }
    .step-wrapper{
        background-color: #c9e7f1;
        background-image: -webkit-linear-gradient(rgba(195,224,234,.7) 1px, transparent 1px), linear-gradient(90deg, rgba(195,224,234,.7) 1px, transparent 1px);
        background-image: linear-gradient(rgba(195,224,234,.7) 1px, transparent 1px), linear-gradient(90deg, rgba(195,224,234,.7) 1px, transparent 1px);
        background-size: 8px 8px, 8px 8px;
        padding: 50px 28px 20px;
    }
    .step-tab{
        overflow: hidden;
        height: 93px;
    }
    .step-tab li{
        float: left;
        width: 152px;
        position: relative;
        margin:16px 0 0 20px;
        padding: 25px 8px 12px;
        height: 55px;
    }
    .step-tab li:before,
    .step-tab li:after{
        content: '';
        background-color: #5e56ce;
        display: block;
        -webkit-border-radius: 10px 10px 0 0;
        -moz-border-radius: 10px 10px 0 0;
        border-radius: 10px 10px 0 0;
        height: 85px;
        width: 100%;
        position: absolute;
        top: 8px;
        left: 0;
    }
    .step-tab li:before{
        -webkit-transform:rotate(-8deg);
        -moz-transform:rotate(-8deg);
        transform:rotate(-8deg);
        top: 10px;
        left: -6px;
    }
    .step-tab li:after{
        background-image: repeating-linear-gradient(125deg, transparent, transparent 2px, rgba(0,0,0,.05) 2px,transparent 4px, rgba(0,0,0,.05) 4px);
    }
    .step-tab li span{
        border-width: 1px 0;
        border-style: dashed;
        border-color: #453ead;
        color:#ffffff;
        font-size: 24px;
        position: relative;
        display: block;
        z-index: 1;
        text-align: center;
        height: 55px;
       /* line-height: 55px;*/
       line-height: 45px;
    }
    .step-tab li em{
        font-style: normal;
        border:2px #ffffff solid;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;   
        border-radius: 50%;
        width: 28px;
        height: 28px;
        line-height: 28px;
        display: inline-block;
    }
    /*.step-tab li.current{
        margin-top: 16px;
    }*/
    .step-tab li.current:before{
        background-color: #164c55;
    }
    .step-tab li.current:after{
        background-color: #10adca;
    }
    .step-tab li.current span{
        border:none;
    }
    .step-title{
        background-color: #10adca;
        background-image: repeating-linear-gradient(125deg, transparent, transparent 2px, rgba(0,0,0,.04) 2px,transparent 3px, rgba(0,0,0,.04) 3px,transparent 4px, rgba(0,0,0,.04) 4px);
        -webkit-border-radius: 15px 15px 0 0;
        -moz-border-radius: 15px 15px 0 0;
        border-radius: 15px 15px 0 0;
        color: #0b454f;
        font-size: 24px;
        padding: 19px 20px;
    } 
    .step-content-inner{
        border:2px #10acc9 solid;
        background-color: #ffffff;
        /*padding: 20px 20px 50px;*/
        padding: 60px 20px 80px;
    }    
    .step-content-inner > p{
        margin-bottom: 22px;
    }
    input{
        border:2px #fb451f solid;
        display: block;
        text-align: center;
        padding: 0 20px;
        width: 100%;
        -webkit-box-sizing:border-box;
        box-sizing:border-box;
        position: relative;
    } 
    .input-style2{
        border-width: 3px;
        border-color: #21b6d1;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;
        color: #003942;
        font-size: 26px;
        height: 74px;
        line-height: 74px;   
    }
    .btn{
        background-color: #e34145;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;   
        border-radius: 10px;
        color: #ffffff;
        font-size: 32px;
        font-weight: normal;
        text-align: center;
        display: inline-block;
        height: 74px;
        line-height: 74px;
        padding: 0 40px;
    }
    .verification-code input{
        display: inline-block;
        width: 325px;
        margin-right: 18px;
    }
    .verification-code .btn{
        background-color: #00abcb;
        font-size: 26px;
        padding: 0 31px;
    }
    .step-wrapper .sure{
        text-align: center;
        margin:30px 0 0;
        padding: 20px 0;
    }
    .step-wrapper .sure .btn{
        width: 240px;
    }
    .step-pop-up{
        background-color: #fff ;
        width: 528px;
        position: absolute;
        top: 50%;
        left: 50%;
        z-index: 310;
        margin: -150px 0 0 -264px;
        border-radius: 8px;

    }
    .step-pop-up .prompt{
        color:#000;
        padding-left:30px;
        height:52px;
        line-height:52px;
    }
    .step-pop-up-inner .contant{
        border-top:2px solid #10acc9;
        color: #163338;
        font-size:28px;    
        padding: 30px;
    }
    .step-pop-up-inner .btn-true{
        border-top:1px solid #d9d9d9;
        width:100%;
        height:60px;
        line-height:60px;
        text-align:center;
    }
    .step-pop-up-inner .btn-true2 a{
        width: 49.8%;
        border-right:1px solid #d9d9d9;
        display: inline-block;
        height:60px;
        line-height:60px;
        text-align:center;
        float: left;
    }
    .step-pop-up-inner .btn-true2 #y-true{border:none;}
    .step-pop-up-inner a{
        color:#5e696c;
    }
    .mark-layer{
        background-color: black;
        position: fixed;
        top: 0px;
        bottom: 0;
        opacity: 0.5;
        filter: alpha(opacity=50);
        z-index: 300;
        display: none;
        width: 100%;
        height: 100%;
    }
</style>
<body>   
<div class="coke-wrapper step-wrapper">
    <ul class="step-tab">
        <li><span><em>1</em>选择商家</span></li>
        <li class="current"><span><span><em>2</em>联系方式</span></span></li>
    </ul>
    <div class="step-content">
        <div class="step-title">请输入您的联系方式：</div>
        <div class="step-content-inner"> 
            <p><input type="text" placeholder="请输入手机号" class="input-style2" id="mobile"/></p>
            <p class="verification-code">
                <input type="text" placeholder="验证码" class="input-style2" id="mobileCode"/><a href="javascript:void(0);" class="btn" id="send">发送验证码</a></p>
            <p class="sure"><a href="javascript:void(0);" class="btn" id="submit">确定</a></p>
        </div>
    </div>  
    <div class="step-pop-up" style="display:none;">
        <span class="prompt">提示</span>
        <div class="step-pop-up-inner">
            <p class="contant">您已经是养车宝用户了，请点击下一步继续</p>
            <p class="btn-true"><a href="javascript:void(0);" class="" id="nextStepBtn">下一步</a></p>
        </div>
    </div>
</div>
<div class="mark-layer" style="display:none"></div>
<script type="text/javascript">
    var wait = 60;
    $(document).ready(function(){
        var url =window.location.href; 
        var paramsArr = (url.split("?")[1]).split("&");
        var paramJson = {};
        $.each(paramsArr,function(i){
            var item = paramsArr[i].split("=");
            paramJson[item[0]] = item[1];
        });  
        if(url.split("?").length==3){
            var paramsArr2 = (url.split("?")[2]).split("&"); 
            $.each(paramsArr2,function(i){
                var item = paramsArr2[i].split("=");
                paramJson[item[0]] = item[1];
            });  
        }   
       $("#send").click(function(){
            if($(this).hasClass("disabled")){
                return false;
            }
			if(paramJson.userInfoId!=undefined&&paramJson.userInfoId!=""){
				$(".step-pop-up").fadeIn();
                $(".mark-layer").fadeIn();  
				return false;
			 } 
            var mobile = $.trim($("#mobile").val()); 
            if (mobile == '') {
                alertTasat("请输入手机号码");
                return
            }
            var regu = /^[1][0-9]{10}$/;
            var re = new RegExp(regu);
            if (!re.test(mobile)) {
                alertTasat("请输入正确手机号码");
                return
            }   
            var ss = new Date().getTime();
			var sign = hex_md5(mobile+ycbkey+ss);  
            $.ajax({
	                url: '/yangchebao-uc/ws/0.1/registry/getcode?user='+mobile+'&timestamp='+ss+'&sign='+sign,
                    type: 'get', 
	                dataType: 'json',
                    success:function(data){  
						time();
						alertTasat("已成功向"+mobile+"发送验证码");
                       
                    },error:function(xhr){
                        var mes = eval('('+xhr.responseText+')'); 
                        var msg = mes[0].message;
						if(msg.indexOf("你的手机号已经在养车宝注册")>-1){
							$(".step-pop-up").fadeIn();
                            $(".mark-layer").fadeIn();  
						}else{
							alertTasat(msg);
						}
                        wait = 0; 
                        time();
                    } 
                });  
       }); 
	   function getYcbkey(){ 
	      var ycbkey = "";
          $.ajax({
              url: '/yangchebao-app-ws/ws/0.1/common/update/ycbkey',
              type: 'get', 
              dataType: 'json',
			  async:false,
              success: function(data) {
                 ycbkey = data.ycbkey;
              },error:function(xhr){  
              }
          }); 
          return ycbkey;		  
      } 
        $("#submit").click(function(){ 
		  getBox(false);
       });
       $("#nextStepBtn").click(function(){ 
          getBox(true); 	
       });
	   var getBox = function(registry){//registry 是否注册过 true注册
		 var postData = {};
		 postData.mobile = $.trim($("#mobile").val());
		 postData.businessInfoId = paramJson.businessInfoId;
		 postData.serviceId = paramJson.serviceId; 
		 postData.exchangeCode = paramJson.exchangeCode; 
		 if(!registry){
		    var code = $.trim($("#mobileCode").val());
			if (code == '') {
                alertTasat("请输入手机验证码");
                return
            }
			postData.code = code;
		 }  
		 $.ajax({
				url: '/yangchebao-app-ws/ws/0.1/biz/lecheng/free',
				type: 'post', 
				data:$.toJSON(postData),
				dataType: 'json',
				contentType:'application/json;charset=utf-8',
				success:function(data){
				   if(data.status=="1"){
					window.location.href = "success.html"; 
				   }else{
				    window.location.href = "reuse.html"; 
				   } 
				},error:function(xhr){
					var mes = eval('('+xhr.responseText+')'); 
					alertTasat(mes[0].message); 
				} 
			});  
	   }; 
       function time() {
            var o = $("#send");
            if (wait == 0) {
                o.removeClass("disabled");
                o.html("发送验证码"); 
                wait = 60;
            } else {
                o.addClass("disabled", true);
                o.html("还剩"+wait+"秒");
                wait--;
                setTimeout(function() {
                    time();//循环调用
                },
                1000)
            }
        } 
    }); 
</script>
</body>
</html>
