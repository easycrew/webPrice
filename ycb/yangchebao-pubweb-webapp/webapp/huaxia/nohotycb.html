<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,heihgt=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="format-detection" content="telephone=no" />
	<title>养车宝</title>
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js"></script> 
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js"></script>
	<script src="./js/commen.js"></script>
	<link rel="stylesheet" href="./css/main.css">
	<style>
		article{
			background-color: #fff;
			border-bottom: 1px solid #d9d9e2;
		}
		p.city{
			float: left;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
			width: 50%;
			border-right: 1px solid #d9d9e2;
			padding: 1.35rem 1rem 1.5rem 1.5rem;
		}
		p.car{
			float: right;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
			width: 50%;
			padding: 1.35rem 1rem 1.5rem 1.5rem;
		}
		span.cityName,span.carBrand{
			float: left;
			font-size: 1.5rem;
		}
		span.downArrow{
			float: right;
			position: relative;
			top: 6px;
		}
		span.downArrow::before,span.downArrow::after{
			position: absolute;
			left: -14px;
			width: 0;
			height: 0;
			font-size: 0px;
			content: '';
			border-left: 7px solid transparent;
			border-right: 7px solid transparent;
		}
		span.downArrow::before{
			top: 0;
			border-top: 7px solid #6eaade;
		}
		span.downArrow::after{
			top: -1px;
			border-top: 7px solid #fff;
		}

		article.bottom{
			padding: 1.5rem;
			margin-top: 0.8rem;
		}
		ul.service-ul li.serviceItem{
			float: left;
			width: 30%;
			text-align: center;
			color: #fff;
			font-size: 1.2rem;
			padding: 0.55rem 0 0.65rem;
			margin-bottom: 1rem;
			-webkit-border-radius: 4px;
			-moz-border-radius: 4px;
			border-radius: 4px;
		}
		.noServ{
			opacity: 0.3;
			filter: alpha(opacity=30);
		}
		ul.service-ul li.serviceItem img{
			width: 4.6rem;
		}
		li[data-code="4"]{
			background-color: #AE95FF;
		}
		li[data-code="5"]{
			background-color: #34CC89;
		}
		li[data-code="6"]{
			background-color: #EE8C00;
		}
		li[data-code="7"]{
			background-color: #FF8259;
		}
		li[data-code="2"]{
			background-color: #C46AB4;
		}
		li[data-code="3"]{
			background-color: #51AFFF;
		}
		ul.service-ul li:nth-child(2),ul.service-ul li:nth-child(5){
			margin: 0 5%;
		}
		li.carSafe{
			float: left;
			width: 100%;
			background-color: #FFC521;
			color: #fff;
			font-size: 1.8rem;
			text-align: center;
			-webkit-border-radius: 4px;
			-moz-border-radius: 4px;
			border-radius: 4px;
			padding: 0.7rem 0;
		}
		li.carSafe img{
			width: 4.6rem;
			margin-right: 1rem;
		}
		ul.service-ul li a{
			display: block;
			color: #fff;
		}
	</style>
</head>
<body>
	<article class="top">
		<div class="topW clearfix">
			<p class="city clearfix"><span class="cityName">北京</span><span class="downArrow"></span></p>
			<p class="car clearfix"><span class="carBrand">奥迪A6</span><span class="downArrow"></span></p>
		</div>
	</article>
	<article class="bottom">
		<ul class="service-ul clearfix">
		</ul>
	</article>
</body>
<script type="text/javascript">
	$(function(){
		// 获取参数
		var url = window.location.search; 
	    var paramJson = {};
	    if(url!=''){
	    	var paramsArr = (url.split("?")[1]).split("&");
		    $.each(paramsArr,function(i){
		        var item = paramsArr[i].split("=");
		        paramJson[item[0]] = item[1]
		    });
	    }
	    if(paramJson.companyNo){
	    	store.clear();
	    	store.set('customerId', paramJson.customerId);
			store.set('userInfoId',paramJson.userInfoId);
			store.set('companyNo', paramJson.companyNo);
			store.set('mobile', paramJson.mobile);
			store.set('lon', paramJson.lon);
			store.set('lat', paramJson.lat);
			store.set('areaName', decodeURI(decodeURI(paramJson.areaName)));
			store.set('bizType', paramJson.bizType);
			store.set('cityLevel', paramJson.cityLevel);
			if(paramJson.carInfoId){
				store.set('carInfoId', paramJson.carInfoId);
				store.set('modelId', paramJson.modelId);
				store.set('modelName', decodeURI(decodeURI(paramJson.modelName)));
			}
	    }
	    
	    var urlArr=[];
	    urlArr.push('customerId='+store.get('customerId'));
	    urlArr.push('userInfoId='+store.get('userInfoId'));
	    urlArr.push('companyNo='+store.get('companyNo'));
	    urlArr.push('mobile='+store.get('mobile'));
	    urlArr.push('lon='+store.get('lon'));
	    urlArr.push('lat='+store.get('lat'));
	    urlArr.push('areaName='+store.get('areaName'));
	    urlArr.push('bizType='+store.get('bizType'));
	    urlArr.push('cityLevel='+store.get('cityLevel'));
	    if(store.get('carInfoId')){
	    	urlArr.push('carInfoId='+store.get('carInfoId'))
	    }
	    if(store.get('modelId')){
	    	urlArr.push('modelId='+store.get('modelId'))
	    }
	    if(store.get('modelName')){
	    	urlArr.push('modelName='+store.get('modelName'))
	    }
	    url=urlArr.join('&');
		$('span.cityName').html(decodeURI(decodeURI(store.get('areaName'))));
		$('span.carBrand').html(decodeURI(decodeURI(store.get('modelName'))));
		// 编辑车系
		$('p.car').on('click',function(){
			store.set('isNearShopWash','0');
			store.set('isAllWash','0');
			window.location.href="brand.html"
		});
		// 编辑城市
		$('p.city').on('click',function(){
			store.set('isNearShopWash','0');
			store.set('isAllWash','0');
			window.location.href="city.html"
		});
		$.ajax({
			url:'/yangchebao-app-ws/ws/0.1/public/query/service/auth?companyNo='+store.get('companyNo')+'&areaName='+store.get('areaName'),
			type:'get',
			dataType:'json',
			contentType:'application/json;charset=utf-8',
			success:function(data){
				var itemStr='';
				data.forEach(function(key,i){
					if(key.code!=1){
						if(key.forwardUrl.indexOf('?')>-1){
							key.forwardUrl+='&'+url
						}else{
							key.forwardUrl+='?'+url
						} 
						if(key.code!=8){
							if(key.status == 1){         
								itemStr+='<li class="serviceItem" data-code="'+key.code+'"><a href="'+key.forwardUrl+'"><p class="itemIcon"><img src="'+key.logo+'"></p><p class="itemText">'+key.serviceName+'</p></a></li>'
							}else{
								itemStr+='<li class="serviceItem noServ" data-code="'+key.code+'"><a href="javascript:"><p class="itemIcon"><img src="'+key.logo+'"></p><p class="itemText">'+key.serviceName+'</p></a></li>'
							}
						}else{
							if(key.status == 1){         
								itemStr+='<li class="carSafe" data-code="'+key.code+'"><a href="'+key.forwardUrl+'"><p class="itemIcon"><img src="'+key.logo+'"></p><p class="itemText">'+key.serviceName+'</p></a></li>'
							}else{
								itemStr+='<li class="carSafe noServ" data-code="'+key.code+'"><a href="javascript:"><p class="itemIcon"><img src="'+key.logo+'"></p><p class="itemText">'+key.serviceName+'</p></a></li>'
							}
						}
					}
				});
				$('ul.service-ul').html(itemStr)
			}
		})
	})
</script>
</html>