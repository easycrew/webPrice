<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/> 
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script> 
    <script src="http://app.yangchebao.com.cn/group1/M00/00/9F/md50000000000000000000000000000.js"></script>
	<title>我的保险订单</title>
	<style>
		*{
			margin: 0;
			padding: 0;
			list-style: none;
		}
		body{
			background-color: #f4f7f8;
			font-size: 62.5%;
			font-family: 'Hiragino Sans GB',Helvetica,Arial,sans-serif;
			color: #1e1e1e;
		}
		img{
			border: none;
			vertical-align: middle;
		}
		a{
			text-decoration: none;
			outline:none;
			blr:expression(this.onFocus=this.blur());
		}

		div.container{
			position: relative;
			min-width: 320px;
			max-width: 640px;
			margin: 0 auto;
			background-color: #f4f7f8;
		}
		div.tab-detail{
			padding-bottom: 40px;
		}
		div.tab-title{
			margin-bottom: 0.8rem;
			background-color: #fff;
		}
		ul.tab-title-ul{
			overflow: hidden;
			border-bottom: 1px solid #DCDCE4;
		}
		ul.tab-title-ul li{
			float: left;
			width: 33.33%;
			text-align: center;
		}
		ul.tab-title-ul li p{
			width: 70%;
			margin: 0 auto;
			color: #c2c2c6;
			font-size: 1.1rem;
			line-height: 3rem;
			cursor: pointer;
		}
		.selectOrder{
			color: #f55d5d!important;
			border-bottom: 2px solid #FC643D;
			cursor: default!important;
		}
		article.tab-detail-article{
			background-color: #fff;
			margin-bottom: 0.8rem;
		}
		div.orderSqid{
			color: #1e1e1e;
			font-size: 1rem;
			padding: 1.2rem 1rem 0;
		}
		div.orderTop{
			overflow: hidden;
			padding: 0.2rem 1rem 1rem;
			border-bottom: 1px solid #DCDCE4;
		}
		div.orderTop p.orderTop-left{
			float: left;
			color: #1e1e1e;
			font-size: 1rem;
		}
		div.orderTop span.orderTop-right{
			float: right;
			color: #f55d5d;
			font-size: 1rem;
		}
		ul.tab-detail-ul{
			padding: 0 1rem;
			border-bottom: 1px solid #DCDCE4;
		}
		ul.tab-detail-ul li{
			overflow: hidden;
			line-height: 2.6rem;
			border-bottom: 1px solid #E8E8EE;
		}
		ul.tab-detail-ul li:last-child{
			border-bottom: none!important;
		}
		ul.tab-detail-ul li p{
			float: left;
			color: #c2c2c6;
			font-size: 1rem;
		}
		ul.tab-detail-ul li span{
			float: right;
			color: #1e1e1e;
			font-size: 1rem;
		}
		div.orderBottom{
			overflow: hidden;
			padding: 0.6rem 0.3rem 0.8rem 1rem;
			border-bottom: 1px solid #DCDCE4;
		}
		div.orderBottom p.orderBottom-left{
			float: left;
			font-size: 0.9rem;
			color: #1e1e1e;
			line-height: 2rem;
		}
		div.orderBottom p.orderBottom-right{
			float: right;
		}
		span.checkOrderBtn{
			display: inline-block;
			border: 1px solid #6eaade;
			color: #6eaade;
			font-size: 0.9rem;
			padding: 0.3rem 0.2rem;
			cursor: pointer;
			-webkit-border-radius: 4px;
			-moz-border-radius: 4px;
			border-radius: 4px;
		}
		span.chargeBtn{
			display: inline-block;
			border: 1px solid #6eaade;
			background-color: #6eaade;
			color: #fff;
			font-size: 0.9rem;
			padding: 0.3rem 0.2rem;
			cursor: pointer;
			-webkit-border-radius: 4px;
			-moz-border-radius: 4px;
			border-radius: 4px;
			margin-left: 0.3rem;
		}
		div.toIndex{
			position: fixed;
			width: 100%;
			bottom: 0;
			text-align: center;
			background-color: #f55d5d;
			/*border-top: 1px solid #d9d9e2;*/
			padding: 0.5rem 0;
			color: #fff;
			font-size: 1rem;
			display: none;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="tab-title">
			<ul class="tab-title-ul">
				<li><p class="allOrder selectOrder">全部</p></li>
				<li><p class="needPay">待支付</p></li>
				<li><p class="sucPay">交易成功</p></li>
			</ul>
		</div>
		<div class="tab-detail">
			<!-- <article class="tab-detail-article">
				<div class="orderTop">
					<p class="orderTop-left">投保日期：<span>2015年05月13日</span></p>
					<span class="orderTop-right">待支付</span>
				</div>
				<ul class="tab-detail-ul">
					<li>
						<p>车牌号码</p><span class="carCard">粤A 12345</span>
					</li>
					<li>
						<p>车主姓名</p><span class="carHolder">王小花</span>
					</li>
					<li>
						<p>保险公司</p><span class="safeCompany">天安保险</span>
					</li>
					<li>
						<p>保费合计</p><span class="sumPrize">3600.00元</span>
					</li>
				</ul>
				<div class="orderBottom">
					<p class="orderBottom-left">订单号：<span class="orderNumber">465454645</span></p>
					<p class="orderBottom-right"><span class="checkOrderBtn">查看投保单</span><span class="chargeBtn">立即支付</span></p>
				</div>
			</article>
			<article class="tab-detail-article">
				<div class="orderTop">
					<p class="orderTop-left">投保日期：<span>2015年05月13日</span></p>
					<span class="orderTop-right">交易成功</span>
				</div>
				<ul class="tab-detail-ul">
					<li>
						<p>车牌号码</p><span class="carCard">粤A 12345</span>
					</li>
					<li>
						<p>车主姓名</p><span class="carHolder">王小花</span>
					</li>
					<li>
						<p>保险公司</p><span class="safeCompany">天安保险</span>
					</li>
					<li>
						<p>保费合计</p><span class="sumPrize">3600.00元</span>
					</li>
				</ul>
				<div class="orderBottom">
					<p class="orderBottom-left">订单号：<span class="orderNumber">465454645</span></p>
					<p class="orderBottom-right"><span class="checkOrderBtn">查看投保单</span></p>
				</div>
			</article> -->
		</div>
	</div>
	<div class="toIndex">再次购买</div>
</body>
<script type="text/javascript">
	$(function(){
		// 获取参数
		var url = window.location.search; 
	    var paramJson = {};
	    if(url!=''){
	    	var paramsArr = (url.split("?")[1]).split("&");
		    $.each(paramsArr,function(i){
		        var item = paramsArr[i].split("=");
		        paramJson[item[0]] = item[1]
		    });
	    }
	    $('div.toIndex').show();
	    // 查看服务介绍
	    if(paramJson.userInfoId){
			paramJson.userId=paramJson.userInfoId
		}
		$('div.toIndex').on('click',function(){ 
		    var add = "";
			if(paramJson.companyNo!=undefined){
			add = "&companyNo="+paramJson.companyNo;
			}
			window.location.href="carInfo.html?userInfoId="+paramJson.userInfoId+'&customerId='+paramJson.customerId+add;
		});
	    // 获取订单
		var getSafeOrder=function(type,pageIndex){
			$.ajax({
				url:'/yangchebao-app-ws/ws/0.1/insure/orderpage?customerId='+paramJson.customerId+'&pagesize=10&pageindex='+pageIndex+'&type='+type+'&'+new Date().getTime(),
				type:'get',
				dataType:'json',
				contentType:'application/json;charset=utf-8',
				success:function(data){
					var getSafeOrderStr='';
					var safeOrderItems=data.items;
					if(safeOrderItems!=''){
						safeOrderItems.forEach(function(key,i){
							if(!(key.plateNum)){
								key.plateNum=''
							}
							console.log(key.createDate);
							if(!(key.createDate)){
								key.createDate=''
							}else{
								key.createDate=key.createDate.split(' ')[0];
								var createDateArr=key.createDate.split('-');
								key.createDate=createDateArr[0]+'年'+createDateArr[1]+'月'+createDateArr[2]+'日';
							}
							
							getSafeOrderStr+='<article class="tab-detail-article">'
											+'<div class="orderSqid">投保单号：<span class="orderNumber">'+key.sqid+'</span></div>'
											+'<div class="orderTop">'
											+'<p class="orderTop-left">投保日期：<span>'+key.createDate+'</span></p>'
											+'<span class="orderTop-right">'+key.statusName+'</span>'
											+'</div>'
											+'<ul class="tab-detail-ul">'
											+'<li><p>车牌号码</p><span class="carCard">'+key.plateNum+'</span></li>'
											+'<li><p>车主姓名</p><span class="carHolder">'+key.ownerName+'</span></li>'
											+'<li><p>保险公司</p><span class="safeCompany">'+key.prvName+'</span></li>'
											+'<li><p>保费合计</p><span class="sumPrize">'+key.totalCharge+'元</span></li>'
											+'</ul>'
											+'<div class="orderBottom">'
											// +'<p class="orderBottom-left"></p>'
							if(key.appcode=='ycbqnb'){
								if(key.status!='27'){
									getSafeOrderStr+='<p class="orderBottom-right"><span class="checkOrderBtn" data-id="'+key.sqid+'" data-status="'+key.status+'" data-orderStatus="'+key.orderStatus+'" data-channel="'+key.appcode+'">查看投保单</span>'
								}else{
									getSafeOrderStr+='<p class="orderBottom-right">'
								}
								if(key.orderStatus=='0'){
									getSafeOrderStr+='<span class="chargeBtn" data-payurl="'+key.payUrl+'">立即支付</span></p>'
													+'</div></article>'
								}else{
									getSafeOrderStr+='</p></div></article>'
								}
							}else if(key.appcode=='ycbybx'){
								getSafeOrderStr+='<p class="orderBottom-right"><span class="checkOrderBtn" data-id="'+key.sqid+'" data-status="'+key.status+'" data-orderStatus="'+key.orderStatus+'" data-channel="'+key.appcode+'">查看投保单</span>'
								if(key.orderStatus=='0'){
									if(key.status=='2' || key.status=='1'){
										getSafeOrderStr+='</p></div></article>'
									}else{
										getSafeOrderStr+='<span class="chargeBtn" data-payurl="'+key.payUrl+'">立即支付</span></p>'
													+'</div></article>'
									}
								}else{
									getSafeOrderStr+='</p></div></article>'
								}
							}
							
						});
						if(data.totalCount>($('div.orderSqid').length+10)){
							getSafeOrderStr+='<p style="text-align:center;color:#999;font-size:0.9rem;line-height:2rem;cursor:pointer;" class="moreOrdersWraper" id="moreOrders">点击查看更多</p>'
						}
					}else{
						getSafeOrderStr+='<p style="font-size:1rem;line-height:1.6rem;text-align:center;color:#a2a2a2;padding-top:4rem;">您暂时没有符合条件的保险订单</p>'
					}
					$('p.moreOrdersWraper').remove();
					$('div.tab-detail').append(getSafeOrderStr);
					$('p#moreOrders').unbind('click').bind('click',function(){
						getSafeOrder(type,pageIndex+1)
					});
					$('span.checkOrderBtn').unbind('click').bind('click',function(){
						var thisDataId=$(this).attr('data-id');
						var thisDataStatus=$(this).attr('data-status');
						var thisDataOrderStatus=$(this).attr('data-orderStatus');
						var thisDataAppcode=$(this).attr('data-channel');
						window.location.href='orderDetail.html?sqid='+thisDataId+'&isMySafe=1&customerId='+paramJson.customerId+'&userId='+paramJson.userId+'&status='+thisDataStatus+'&orderStatus='+thisDataOrderStatus+'&appcode='+thisDataAppcode
					});
					$('span.chargeBtn').unbind('click').bind('click',function(){
						var thisDataPayUrl=$(this).attr('data-payurl');
						window.location.href=thisDataPayUrl
					})
				},
				error:function(xhr){
					var error=eval('('+xhr.responseText+')');
					alert(error[0].message)
				}
			})
		};
		getSafeOrder(0,0);
	    // tab切换
		$('ul.tab-title-ul li p').unbind('click').bind('click',function(){
			$(this).addClass('selectOrder').parent().siblings().find('p').removeClass('selectOrder');
			if($(this).hasClass('allOrder')){
				$('div.tab-detail').html('');
				getSafeOrder(0,0)
			}else if($(this).hasClass('needPay')){
				$('div.tab-detail').html('');
				getSafeOrder(2,0)
			}else if($(this).hasClass('sucPay')){
				$('div.tab-detail').html('');
				getSafeOrder(1,0)
			}
		})
	})
</script>
<script>
//共用统计
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c8ab281430a0250a8afa2b494f8af641";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
//购买车险页面
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?00ad05b0a1d640bab80cae51a605d641";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

</script> 
</html>