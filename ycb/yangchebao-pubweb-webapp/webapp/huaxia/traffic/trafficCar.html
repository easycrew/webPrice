<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>  
<script type="text/javascript" src="../../js/jquery.json-2.2.js"></script> 
<script type="text/javascript" src="../oilCard/js/index.js"></script> 
<link rel="stylesheet" href="css/index.css">
<title>违章查询</title>
</head> 
<style type="text/css">  
.trafficCar-wrap{ 
  background-color:#fff;
}
.trafficCar-wrap h1{ 
  font-size: 1.3rem;
  font-weight: normal;
  padding:2.5rem 1.5rem 1.5rem;
}
.formWrap{
  padding:0 1.5rem 3rem;
  border-bottom:1px solid #D9D9E2;
}
.number-first{
  height: 40px;
  line-height: 40px;
  display: inline-block;
  width: 72px;
  color: #979797;
  font-size: 1.5em;
  text-align: center;
  border: 1px solid #d9d9e2;
  border-radius: 3px;
  position: absolute;
  top: 0;
  left: 0;
  background-color: #fff;
} 
.input-wrap{ 
    background-color: #fff; 
    border: none; 
    display: block;
    font-size: 1.5em;
    height: 40px;
    line-height: 40px; 
    border: 1px solid #d9d9e2;
    border-radius: 3px;
    padding-left: 10px;
}
.input-wrap input{  
    border: none; 
    width: 100%;
    background-color: #fff;
    font-size: 1em;
}
.button-wrap{
   background-color:#F4F7F8;
   padding: 25px 16px;
} 
.province-wrap{
  background-color:rgba(0,0,0,0.6);
  padding-top: 50px;
  position: absolute;
  top: 0;  
  width: 100%;
  min-height: 100%;
} 
.province-wrap span{
  width: 50px;
  height: 50px;
  text-align: center;
  line-height: 50px;
  display: inline-block;
  font-size: 1.8em;
  border: 1px solid #fff;
  margin: 0 0 15px 15px;
  color: #fff;
  border-radius: 5px; 
  cursor: pointer;
} 
.down-arrow {
    border-bottom: 1px solid #ccc;
    border-right: 1px solid #ccc;
    display: inline-block;
    height: 8px;
    margin:-2px 0 0 5px;
    transform: rotate(45deg) ;
    -ms-transform: rotate(45deg);
    -moz-transform: rotate(45deg) ;
    -webkit-transform: rotate(45deg) ;
    -o-transform: rotate(45deg);
    width: 8px;
}
.number-first strong{
	font-weight:normal;
} 
input,textarea{
	-webkit-appearance:none;
	-moz-appearance: none;
    appearance: none;
}
input:focus{
	outline:none;
}
</style>
<body style="background-color:#f4f7f8;">  
  <!--section class="trafficCar-wrap" style="display:none;"-->
  <section class="trafficCar-wrap">
    <article class="first-wrap">
    <h1>请填写并确认你的车牌号码</h1>
    <ul class="formWrap">
    <li style="position:relative;padding-left: 86px;">
     <span class="number-first"><strong>京</strong><label class="down-arrow"></label></span>
     <div class="input-wrap"><input type="text" placeholder="填入车牌号" id="plateNumber"></div>
    </li> 
    </ul> 
    <div class="button-wrap"><div id="submit" class="button">确认</div></div>
    </article>    
    <article class="second-wrap" style="display:none;">
    <h1>还需要填写以下信息</h1>
    <ul class="formWrap">
    <li style="display:none; padding: 0;" class="machineNumber-li"><div class="input-wrap"><input type="text" id="machineNumber" placeholder="请输入发动机号"></div>
    </li> 
    <li style="display:none; padding: 0;" class="vinNumber-li"><div class="input-wrap"><input type="text" id="vinNumber" placeholder="请输入车架号"></div>
    </li>
    </ul>  
     <div class="button-wrap"><div id="next" class="button">确认</div></div>
    </article> 
  </section>
  <section class="province-wrap" style="display:none;"> 
    <div class="close"><label></label></div>
    <span>京</span><span>沪</span><span>粤</span><span>苏</span><span>浙</span><span>鲁</span>
    <span>晋</span><span>冀</span><span>豫</span><span>川</span><span>渝</span><span>辽</span>
    <span>吉</span><span>黑</span><span>皖</span><span>鄂</span><span>湘</span><span>赣</span>
    <span>闽</span><span>陕</span><span>甘</span><span>宁</span><span>蒙</span><span>津</span>
    <span>贵</span><span>云</span><span>桂</span><span>琼</span><span>青</span><span>新</span>
    <span>藏</span>
  </section>         
<script type="text/javascript">
   $(document).ready(function(){
      var url =window.location.search;   
      var paramJson = {};  
      if(url!=undefined&&url!=""){
        var paramsArr = (url.split("?")[1]).split("&"); 
        $.each(paramsArr,function(i){
         var item = paramsArr[i].split("=");
         paramJson[item[0]] = item[1];
        });    
      }
	  var plateNumber = "";
      $("#submit").click(function(){
        plateNumber = $.trim($("#plateNumber").val());
        if(plateNumber==""){
          alertTasat("请输入车牌号");
          return;
        } 
        var reg = /^[A-Z0-9]{6,7}$/; 
        if(!reg.test(plateNumber)){
          alertTasat("请输入正确的车牌号");
          return;
        }
        plateNumber = $(".number-first strong").html()+plateNumber; 
        getTrafficInfo(plateNumber);
      }); 
      $("#plateNumber").keyup(function(){
        $(this).val($(this).val().toUpperCase());
      }); 
      $("#machineNumber").keyup(function(){
        $(this).val($(this).val().toUpperCase());
      });
       $("#vinNumber").keyup(function(){
        $(this).val($(this).val().toUpperCase());
      });
      $("#next").click(function(){
           if($(".machineNumber-li").css('display')!="none"){
              var machineNumber = $.trim($("#machineNumber").val());
              if(machineNumber==""){
                alertTasat("请输入发动机号");
                return;
              }
               var mreg = /^[A-Z0-9]{1,15}$/; 
              if(!mreg.test(machineNumber)){
                alertTasat("请输入正确的发动机号");
                return;
              }   
           }
          if($(".vinNumber-li").css('display')!="none"){
              var vinNumber = $.trim($("#vinNumber").val());
              if(vinNumber==""){
                alertTasat("请输入车架号");
                return;
              } 
              var vreg = /^[A-Z0-9]{17}$/; 
              if(!vreg.test(vinNumber)){
                alertTasat("请输入正确的车架号");
                return;
              }    
           }  
           window.location.href = "trafficList.html"+window.location.search+"&plateNumber="+plateNumber+"&engineNumber="+machineNumber+"&vinNumber="+vinNumber;
      });  
      $(".close").click(function(){
          $(".province-wrap").fadeOut();
      });       
      $(".number-first").click(function(){
          $(".province-wrap").fadeIn();
      });  
      $(".province-wrap span").click(function(){
          $(".province-wrap").fadeOut();
          $(".number-first strong").html($(this).html());
      }); 
      function getTrafficInfo(plateNumber){  
          $.ajax({
              url: '/yangchebao-pubinfo-ws/ws/0.1/trafficInfo/getInfoByCarNumber?carNumber='+plateNumber,
              type: 'get', 
              dataType: 'json',
              success: function(data) {   
                 $(".first-wrap").hide();
                 $(".second-wrap").show();
                 if(data.engine=="1"){  //engine  int 1需要发动机号 0 不需要
                    $(".machineNumber-li").show();
                 }
                 if(data.frame=="1"){  //frame  int 1 需要车架号 0 不需要
                    $(".vinNumber-li").show();
                 }
              },error:function(xhr){
                var mes = eval('('+xhr.responseText+')'); 
                 alertTasat(mes[0].message);
              }
          });  
      }       
	  function getCarinfo(plateNumber){  
	      $("#plateNumber").val("");
          $.ajax({
              url: '/yangchebao-app-ws/ws/0.1/user/carinfo/maincar?userId='+paramJson.userInfoId+"&"+(new Date()).getTime(),
              type: 'get', 
              dataType: 'json',
              success: function(data) {    
				var carNumber = data.plateNumber||""; 
				if(carNumber!=""){
				  var reg=/[\u4E00-\u9FA5]/g; 
				  $(".number-first strong").html(carNumber.match(reg)[0]);
				  carNumber = carNumber.replace(reg,'');   
				}  
				$("#plateNumber").val(carNumber);
				if(data.machineNumber!=""&&data.machineNumber!="undefined"){
					$("#machineNumber").val(data.machineNumber);
				}else{
					$("#machineNumber").val("");
				}
				if(data.vinNumber!=""&&data.vinNumber!="undefined"){
					$("#vinNumber").val(data.vinNumber);
				}else{
					$("#vinNumber").val("");
				}
              },error:function(xhr){
                var mes = eval('('+xhr.responseText+')'); 
                 alertTasat(mes[0].message);
              }
          });  
      }   
	  getCarinfo();
   });
</script>  
</body>
</html>