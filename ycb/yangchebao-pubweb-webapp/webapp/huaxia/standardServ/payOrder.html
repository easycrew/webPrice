<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,heihgt=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="format-detection" content="telephone=no" />
	<title>订单确认</title>
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script> 
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js"></script>
	<link rel="stylesheet" href="../css/main.css">
	<script src="../js/commen.js"></script>
	<style>
		article{
			background-color: #fff;
		}
		div.servPayInfo{
			background-color: #FFA600;
			padding: 1.5rem;
		}
		div.servPayInfo p{
			color: #fff;
		}
		div.servPayInfo p:nth-of-type(1){
			font-size: 1.6rem;
		}
		div.servPayInfo p:nth-of-type(2){
			font-size: 1.4rem;
		}
		div.servPayInfo p:nth-of-type(3){
			font-size: 1.8rem;
		}
		div.topRow{
			padding: 0.6rem 0;
			border-bottom: 1px solid #D9D9E2;
		}
		p.topRow-left{
			float: left;
			display: inline-block;
			padding: 0 2.2rem;
		}
		p.topRow-left img{
			width: 1.7rem;
		}
		div.topRow-right{
			margin-left: 6rem;
			padding: 1.7rem 1.5rem 1.3rem;
			border-left: 1px solid #D9D9E2;
		}
		div.topRow-right p{
			font-size: 1.4rem;
		}

		article.middle{
			margin-top: 0.8rem;
			margin-bottom: 6.5rem;
		}
		div.payStyleTitle{
			padding: 1rem;
			border-bottom: 1px solid #D9D9E2;
		}
		div.payStyleTitle p{
			font-size: 1.5rem;
			border-left: 2px solid #f55d5d;
			padding-left: 0.5rem;
		}
		div.payStyleRow{
			padding: 0.5rem 0;
			border-bottom: 1px solid #D9D9E2;
		}
		p.payStyleLeft{
			float: left;
			display: inline-block;
			line-height: 2rem;
		}
		p.payStyleLeft img[alt="支付宝"]{
			width: 5.8rem;
			margin: 2.1rem;
		}
		div.payStyleRight{
			margin-left: 5.4rem;
			line-height: 2rem;
		}
		div.payStyleRight span{
			display: inline-block;
			padding: 1.9rem 0rem 1.9rem 1.2rem;
			border-left: 1px solid #D9D9E2;
			color: #a2a2a2;
			font-size: 1.2rem;
		}
		div.payStyleRight p img{
			width: 2.2rem;
		}
		div.payStyleRight p{
			float: right;
			margin-right: 1.5rem;
			padding: 1.9rem 0rem 1.9rem 0rem;
		}
		article.bottom{
			position: fixed;
			width: 100%;
			bottom: 0;
			border-top: 1px solid #D9D9E2;
			display: none;
		}
		article.bottom p.bottom-left{
			float: left;
			width: 50%;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
			text-align: center;
			font-size: 1.8rem;
			color: #f55d5d;
			padding: 1.6rem 0;
		}
		article.bottom p.payBtn{
			float: left;
			width: 50%;
			background-color: #f55d5d;
			color: #fff;
			font-size: 1.8rem;
			text-align: center;
			padding: 1.6rem 0;
		}
	</style>
</head>
<body>
	<section>
		<article class="top">
			<div class="servPayInfo">
				<p class="firstServ"></p>
				<p class="lastServ"></p>
				<p class="servPrice"></p>
			</div>
			<div class="topRow clearfix">
				<p class="topRow-left"><img src="./img/contact_icon.png"></p>
				<div class="topRow-right">
					<p class="shopName"></p>
					<p class="address"></p>
				</div>
			</div>
			<div class="topRow clearfix">
				<p class="topRow-left"><img src="./img/location_icon.png"></p>
				<div class="topRow-right">
					<p class="nickName"></p>
					<p class="mobile"></p>
				</div>
			</div>
		</article>
		<article class="middle">
			<div class="payStyleTitle">
				<p>支付方式</p>
			</div>
			<div class="payStyleDetail">
				<div class="payStyleRow" data-id="3">
					<p class="payStyleLeft"><img src="./img/zfb_icon.png" alt="支付宝"></p>
					<div class="payStyleRight">
						<span>需要拥有支付宝账号</span>
						<p><img src="./img/payUnchecked_icon.png" class="isPay"></p>
					</div>
				</div>
			</div>
		</article>
		<article class="bottom clearfix">
			<p class="bottom-left"></p>
			<p class="payBtn">立即支付</p>
		</article>
	</section>
</body>
<script type="text/javascript">
	$(function(){
		// 获取参数
		var url = window.location.search; 
	    var paramJson = {};
	    if(url!=''){
	    	var paramsArr = (url.split("?")[1]).split("&");
		    $.each(paramsArr,function(i){
		        var item = paramsArr[i].split("=");
		        paramJson[item[0]] = item[1]
		    });
	    }
	    $('article.bottom').show();
		// 获取支付信息
		var postData={};
		postData.userInfoId=store.get('userInfoId');
		postData.sourceId=paramJson.sourceId;
		postData.itemType=0;
		postData.isStandard=1;
		$.ajax({
			url:'/yangchebao-app-ws/ws/0.1/orderservice/reserve',
			type:'post',
			data:$.toJSON(postData),
			dataType:'json',
			async:false,
			contentType:'application/json;charset=utf-8',
			success:function(data){
				$('p.firstServ').html(data.serviceName);
				$('p.lastServ').html(data.extraName);
				$('p.shopName').html(data.businessName);
				$('p.address').html(data.businessAddress);
				$('p.nickName').html(data.nickName);
				$('p.mobile').html(data.mobile);
				$('p.bottom-left,p.servPrice').html('￥'+data.reservePrice);

				// 图片垂直居中
				$('p.topRow-left').each(function(){
					var rowH=$(this).next('div.topRow-right').outerHeight();
					$(this).css('line-height',rowH+'px')
				});
			}
		});
		var isPay=0;
		$('img.isPay').on('click',function(){
			if($(this).attr('src') == './img/payUnchecked_icon.png'){
				isPay=1;
				$(this).attr('src','./img/payChecked_icon.png')
			}else{
				isPay=0;
				$(this).attr('src','./img/payUnchecked_icon.png')
			}
		});
		// 支付
		var _postData={};
		_postData.cooperateCompanyNo=store.get('companyNo');
		_postData.customerId=store.get('customerId');
		_postData.sourceId=paramJson.sourceId;
		_postData.itemType=0;
		_postData.isStandard=1;
		_postData.payChannelKey='alipay.wap.wallet';
		$('p.payBtn').on('click',function(){
			if(isPay==0){
				errorLog('请选择支付方式');
				return false
			}
			$.ajax({
				url:'/yangchebao-app-ws/ws/0.1/orderservice/placeorder',
				type:'post',
				dataType:'json',
				data:$.toJSON(_postData),
				contentType:'application/json;charset=utf-8',
				success:function(data){
					window.location.href=data.payUrl
				}
			})
		})
	})
</script>
</html>