<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,heihgt=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="format-detection" content="telephone=no" />
	<title>城市列表</title>
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script> 
	<script src="./js/commen.js"></script>
	<link rel="stylesheet" href="./css/main.css">
	<style>
		/*选择城市*/
		div.selectCity{
			position: absolute;
			top: 0;
			width: 100%;
			z-index: 100;
		}
		div.allCitys-wraper{
			position: relative;
		}
		article.allCitys{
			background-color: #fff;
		}
		ul.allCitys-ul li{
			/*border-bottom: 1px solid #bcbebd;*/
		}
		div.allCitys-letter{
			background-color: #F2F3F4;
			border-bottom: 1px solid #bcbebd;
			border-top: 1px solid #bcbebd;
			color: #c2c2c6;
			font-size: 1.8rem;
			line-height: 3.2rem;
			padding: 0 1.8rem;
		}
		div.allCitys-detail p{
			margin-left: 3rem;
			font-size: 1.6rem;
			line-height: 4.8rem;
			border-bottom: 1px solid #bcbebd;
			cursor: pointer;
		}
		.beBorder{
			border-bottom: none!important;
		}
		.searchCity{
			position: relative;
			margin-top: 0rem;
			padding: 0.8rem 1rem 0.8rem 0.8rem;
			background-color: #fff;
		}
		#searchCity{
			width: 70%;
			border-top-left-radius: 8px;
			border-bottom-left-radius: 8px;
			background: #f2f3f4 url(http://app.yangchebao.com.cn/group1/M00/02/72/ChoCK1Zf9AuAVjxLAAAESSohc_Q214.png) 1.2rem center no-repeat;
			background-size: 2rem;
			color: #a2a2a2;
			padding: 10px 0.6rem 10px 4rem;
			border: none;
			font-size: 1.6rem;
			line-height: 20px;
			-moz-box-sizing: border-box;
			-webkit-box-sizing: border-box;
			box-sizing: border-box;
			float: left;
		}
		span.searchBtn{
			width: 28%;
			color: #f55d5d;
			font-size: 1.6rem;
			display: inline-block;
			text-align: center;
			padding: 5px 0;
			line-height: 28px;
			background-color: #fff;
			border: 1px solid #f55d5d;
			border-top-right-radius: 8px;
			border-bottom-right-radius: 8px;
		}
	</style>
</head>
<body>
	<div class="selectCity">
		<div class="searchCity">
			<p class="searchWraper"><input type="text" name="searchCity" id="searchCity" placeholder="搜索" /><span class="searchBtn">搜索</span></p>
		</div>
		<div class="selectCity-main" style="position:relative;">
			<div class="allCitys-wraper">
				<article class="allCitys">
					<ul class="allCitys-ul">
						<!-- <li>
							<div class="allCitys-letter" id="A">A</div>
							<div class="allCitys-detail">
								<p>阿拉善盟</p>
								<p>鞍山市</p>
								<p>安庆市</p>
								<p class="city-last">安阳市</p>
							</div>
						</li> -->
					</ul>
				</article>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	$(function(){
		$.ajax({
			url:'/yangchebao-app-ws/ws/0.1/public/service/auth/citylist?companyNo='+store.get('companyNo')+'&bizType='+store.get('bizType'),
			type:'get',
			dataType:'json',
			contentType:'application/json;charset=utf-8',
			success:function(data){
				var cityStr='';
				$.each(data.servicecity,function(key,val){
					cityStr+='<li>'
							+'<div class="allCitys-letter" id="'+key+'">'+key+'</div>'
							+'<div class="allCitys-detail">';
					val.forEach(function(valKey,i){
						cityStr+='<p cityLevel="'+valKey.cityLevel+'" lon="'+valKey.lon+'" lat="'+valKey.lat+'">'+valKey.areaName+'</p>'
					});
					cityStr+='</div></li>'
				});
				$('ul.allCitys-ul').html(cityStr);
				$('div.selectCity-main div.allCitys-detail').each(function(){
					$(this).find('p:last').removeClass('beBorder').addClass('beBorder')
				});
				// 模糊搜索
				var letterFlag=false;
				$('span.searchBtn').unbind('click').bind('click',function(){
					var searchVal=$.trim($('#searchCity').val());
					var letter=(searchVal.substring(0,1)).toUpperCase();
					var allLettters='ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
					    letterFlag=false;
					allLettters.forEach(function(key,i){
						if(letter==key){
							if($('div.selectCity-main div#'+letter).length>0){
								letterFlag=true
							}
							$('div.selectCity-main div#'+letter).parent('li').show();
							$('div.selectCity-main div#'+letter).parent('li').find('div').show();
							$('div.selectCity-main div#'+letter).parent('li').find('p').show();
							$('div.selectCity-main div#'+letter).parent('li').siblings().hide();
							return false
						}
					});
					if(searchVal==''){
						$('div.selectCity-main ul li').show();
						$('div.selectCity-main div.allCitys-detail p').show();
						$('div.selectCity-main div.allCitys-letter').show();
						$('div.selectCity-main div.allCitys-detail').each(function(){
							$(this).find('p:last').removeClass('beBorder').addClass('beBorder')
						})
					}else if(!letterFlag){
						$('div.selectCity-main div.allCitys-detail p').each(function(){
							var $pThis=$(this);
							var pCityName=$(this).html();
							if(pCityName.indexOf(searchVal)>-1){
								$('div.selectCity-main div.allCitys-letter').hide();
								$pThis.show();
								$pThis.parents().show();
								$pThis.removeClass('beBorder')
							}else{
								$pThis.hide();
								$pThis.parents('li').find('div.allCitys-letter').hide()
							}
						})
					}
				});
				// 选择城市
				$('div.allCitys-detail p').on('click',function(){
					store.set('areaName', $(this).html());
					store.set('cityLevel', $(this).attr('cityLevel'));
					store.set('lon', $(this).attr('lon'));
					store.set('lat', $(this).attr('lat'));
					if(store.get('isAllWash') != 1){
						if(store.get('bizType') != 0){
							window.location.href='standardServ/selectServAttribute.html'
						}else{
							if($(this).attr('cityLevel') == 1){
								window.location.href='hotycb.html'
							}else{
								window.location.href='nohotycb.html'
							}
						}
					}else{
						if($(this).attr('cityLevel') == 1){
							window.location.href='standardServ/selectServAttribute.html'
						}else{
							store.set('isAllWash','0');
							window.location.href='nohotycb.html'
						}
					}
					
				})
			}
		})
	})
</script>
</html>