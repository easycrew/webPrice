<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,inital-scale=1.0,maxinum-scale=1.0,mininum-scale=1.0,user-scalble=no" />
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/> 
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script> 
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js "></script>
    <script src="http://app.yangchebao.com.cn/group1/M00/00/9F/md50000000000000000000000000000.js"></script>

	<title>活动说明</title>
	<style>
		*{
			margin: 0;
			padding: 0;
			list-style: none;
		}
		body{
			background-color: #f4f7f8;
			font-size: 62.5%;
			font-family: 'Hiragino Sans GB',Helvetica,Arial,sans-serif;
			color: #1e1e1e;
		}
		img{
			border: none;
			vertical-align: middle;
		}
		a{
			text-decoration: none;
			outline:none;
			blr:expression(this.onFocus=this.blur());
		}

		div.container{
			position: relative;
			min-width: 320px;
			max-width: 640px;
			margin: 0 auto;
		}

		section{
			background-color: #F2F3F4;
		}
		article{
			background-color: #fff;
		}
		article.article-middle{
			padding: 0 1.2rem;
			/*border-bottom: 1px solid #DCDCE4;*/
		}
		article.article-charge{
			overflow: hidden;
			padding: 1.5rem;
		}
		article.article-charge p.chargeBtn{
			width:90%;
			line-height: 5.0rem;
			color: #fff;
			font-size: 2.4rem;
			text-align: center;
			background-color: #a30000;
			padding: 0 1.8rem;
			cursor: pointer;
			border-radius: 8px;
		}
		/*ybs*/
		.head-succ-err{
			background:url('img/bg-header.jpg') no-repeat 0 0;
			position: relative;
			overflow: hidden;
			height: 249px;
		}
		.winning{
		    padding: 40px 0;
		}
		.input-wrap{
		    position: relative;
		    margin-bottom: 50px;
		}
		.input-wrap input{
			  border: 1px #d9d9e2 solid;
			  display: block;
			  font-size:1.4rem;
			  padding: 0 20px;
			  width: 100%;
			  -webkit-box-sizing: border-box;
			  box-sizing: border-box;
			  position: relative;
			  height:60px;
			  line-height:60px;
			  border-radius: 5px;
		}
		.winning h2, .winning span{
			font-size:1.8rem;
		}
		.rda{}
		.carCheckBtn{
			  font-size: 1.5em;
			  height: 60px;
			  line-height: 60px;
			  border: 1px solid #d9d9e2;
			  background-color: #fff;
			  padding: 0 10px;
			  cursor: pointer;
			  background:url(img/down_icon2.png) no-repeat center right;padding-right:10px;
		}

		.brand-wrap {
		    min-height: 100%;
		    position: relative;
		}
		.brand-wrap .word {
		    background-color: #f4f7f8;
		    color: #c2c2c6;
		    font-size: 1.6em;
		    height: 26px;
		    line-height: 26px;
		    padding: 0 23px;
		}
		.brand-wrap ul {
		    background-color: #fff;
		    border-top: 1px solid #d9d9e2;
		}
		.brand-wrap li {
		    border-bottom: 1px solid #d9d9e2;
		    color: #3b3b3b;
		    font-size: 2.6em;
		    height: 70px;
		    line-height: 70px;
		    padding: 0 18px;
		}
		.tasat-wrap {
		    bottom: 50%;
		    position: fixed;
		    text-align: center;
		    width: 100%;
		}
		.tasat {
		    background-color: #000;
		    border-radius: 8px;
		    color: #fff;
		    display: inline-block;
		    font-size: 3.0em;
		    margin: 0 20px;
		    opacity: 0.8;
		    padding: 1.8em 2.8em;
		}
	</style>
</head>
<body>
	<div class="container">
		<section class="regist-wrap">
			<article class="article-top">
				<div class="head-succ-err"></div>
			</article>
			<article class="article-middle">
			    <div class="winning">
			        <h2><span>姓名</span></h2>
			        <div class="input-wrap"><input type="text" class="input-style1" id="username" placeholder="请填写您的真实姓名"/></div>
			        <h2>车辆型号</h2>
			        <span class="cartype"></span> 
			        <div class="input-wrap carCheckBtn" style="margin-top:10px"><span class="input-style1 rda">请选择型号</span></div>
			    </div>
			</article>
			<article class="article-charge">
				<p class="chargeBtn">立即报名</p>
			</article>
		</section>
		<section class="brand-wrap"  style="display:none;">
		    <div class="brandList"></div>
		    <div class="car-overlay" style="display:none;"></div>
		    <article class="car-wrap" style="display:none;">   
		       <span class="close"><label></label></span>
		    </article> 
		</section>
		  <div class="overlay-wrap"></div>
	</div>
	<script type="text/javascript">
		$(document).ready(function(){  
        	    try{
		        var phoneWidth = parseInt(window.screen.width);
		        var phoneHeight = parseInt(window.screen.height); 
		        var phoneScale = phoneWidth / 640;
		        var ua = navigator.userAgent;
		        var sUserAgent = ua.toLowerCase(); 
		        var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
		        var bIsIphone = sUserAgent.match(/iphone/i) == "iphone";
		        var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os"; 
		        if (/Android (\d+\.\d+)/.test(ua)) {
		            var version = parseFloat(RegExp.$1);
		            // andriod 2.3
		                $('[name="viewport"]').attr('content', 'width=640, initial-scale=' + phoneScale + ', minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi');
		            if (version >= 2.3) {
		                // andriod 2.3以上
		            } else {
		                $('[name="viewport"]').attr('content', 'width=640, initial-scale= 1.0, minimum-scale = 1.0, maximum-scale = 1.0, user-scalable=no, target-densitydpi=device-dpi');
		            }
		        // 其他系统
		        } else if(bIsIpad || bIsIphoneOs || bIsIphone){   
		            var otherW = phoneWidth*2;
		            $(".content-wrap").css({
		                'width':otherW,
		                'min-width':otherW,
		                'min-width':otherW,
		                'margin-left': -phoneWidth
		            });
		            $('[name="viewport"]').attr('content', 'width='+otherW+', initial-scale= 0.5, minimum-scale = 0.5, maximum-scale = 0.5, user-scalable=no, target-densitydpi=device-dpi'); 
		        }else{
		             $('[name="viewport"]').attr('content', 'width=640, initial-scale= 0.5, minimum-scale = 0.5, maximum-scale = 0.5, user-scalable=no, target-densitydpi=device-dpi');
		        }
		       }catch(e){}


		      var url =window.location.search;  
		      var paramJson = {};
		      if(url!=undefined&&url!=""){
		        var paramsArr = (url.split("?")[1]).split("&"); 
		        $.each(paramsArr,function(i){
		         var item = paramsArr[i].split("=");
		         paramJson[item[0]] = item[1];
		        });    
		      }    

		      $(".carCheckBtn").click(function(){
		         $(".regist-wrap").fadeOut();
		         $(".brand-wrap").fadeIn();
		      }); 

		      $(".brandList").on('click','li',function(){ 
		         $(".regist-wrap").fadeIn();
		         $(".brand-wrap").fadeIn();
		     	 $('.rda').html($(this).html())
		     	 $(document).scrollTop(0);
		     	 $('.brand-wrap').fadeOut();
		      });   

		      $(".chargeBtn").click(function(){  
				      customerId = paramJson.customerId
			          var name = $.trim($("#username").val());
			          if(name==""){
			             alertTasat("请输入姓名");
			             return false;
			          }  
			          //if(paramJson.modelId==undefined||paramJson.modelId==""){
			          if($('.rda').html() == '请选择型号'){
			            alertTasat("请选择型号"); 
			            return false;
			          }
			          var editFlag = editUserInfo();// 完善用户信息 
					  if(editFlag){
						  weifeng();//录入用户接口
						  getCarList2(customerId); 
					  }

		        });

		        function weifeng(){
	                  var postData = {};
	                  postData.userInfoId = paramJson.userId;
	                  postData.channelId = 2;
			          $.ajax({  
			              url: '/yangchebao-app-ws/ws/0.1/marketactive/zhengzhouExhibition',
			              type: 'post', 
			              data:$.toJSON(postData),
			              dataType: 'json',
			              async:false,
			              contentType:'application/json;charset=utf-8', 
			              success: function(data) {    
			                 
			              },error:function(xhr){  
			              }
			          }); 
		      	}	  
		      	function editUserInfo(){ 
				  var flag = false;
		      	  var postData = {};
		      	  postData.customerId = paramJson.customerId;
		      	  postData.nicName = $.trim($('#username').val());
		          $.ajax({  
		              url: '/yangchebao-app-ws/ws/0.1/user/complete/userinfo',
		              type: 'post', 
		              data:$.toJSON(postData),
		              dataType: 'json',
		              async:false,
		              contentType:'application/json;charset=utf-8', 
		              success: function(data) {    
		                  flag = true;
		              },error:function(xhr){  
		              	 var mes = eval('('+xhr.responseText+')'); 
		              	 if(mes[0].message == '不能超过10位'){
		              	 	alertTasat('姓名不能超过10位');
		              	 	return false;
		              	 };
		              	 if(mes[0].message == '不能包含特殊字符，请输入汉字、字母或数字'){
		              	 	alertTasat('姓名不能包含特殊字符，请输入汉字、字母或数字');
		              	 	return false;
		              	 };
		              	 if(mes[0].message == '该用户昵称已存在'){
		              	 	alertTasat('此姓名已被占用');
		              	 	return false;
		              	 }; 
						 if(mes[0].message == ' '){
		              	 	alertTasat('姓名不能为空格');
		              	 	return false;
		              	 };
		              }
		          });  
				  return flag;
		      	}	       
		      	function carstyle(styleid,carInfoId){
	                  var postData = {};
	                  postData.styleId = styleid;
	                  postData.carInfoId = carInfoId;
	                  postData.customerId = paramJson.customerId;
			          $.ajax({  
			              url: '/yangchebao-app-ws/ws/0.1/user/complete/editCarInfo',
			              type: 'post', 
			              data:$.toJSON(postData),
			              dataType: 'json',
			              async:false,
			              contentType:'application/json;charset=utf-8', 
			              success: function(data) {    
			                 window.location.href = "success.html"; 
			              },error:function(xhr){  
			              	 window.location.href = "error.html"; 
			              }
			          }); 
		      	}	

		   		function getBrandMsg(modelId){ 
		          $.ajax({
		              url: '/yangchebao-app-ws/ws/0.1/support/style/list?modelId='+modelId,
		              type: 'get', 
		              dataType: 'json',
		              success: function(data) { 
		                  var _ul = $("<ul>");
		                 $.each(data,function(k){ 
		                    var item = data[k]; 
		                    var _li = $("<li>").html(item.name)
		                    _ul.append(_li);  
		                 });  
		                 $(".brandList").append(_ul);
		              },error:function(xhr){  
		              }
		          });  
		        }

		        customerId = paramJson.customerId
		        getCarList1(customerId);
		        function getCarList1(customerId){ 
		          $.ajax({
		              url: '/yangchebao-app-ws/ws/0.1/user/carinfo/maincar?customerId='+customerId,
		              type: 'get', 
		              dataType: 'json',
		              success: function(data) { 
		              	 $('.cartype').html(data.brandName+'-'+data.modelName);
		              	 getBrandMsg(data.modelId);
		              },error:function(xhr){  
		              }
		          });  
		        } 
		        function getCarList2(customerId){ 
		          $.ajax({
		              url: '/yangchebao-app-ws/ws/0.1/user/carinfo/maincar?customerId='+customerId,
		              type: 'get', 
		              dataType: 'json',
		              success: function(data) { 
		              	 $('.cartype').html(data.brandName+'-'+data.modelName);
		              	 carstyle(data.styleId,data.carInfoId)
		              },error:function(xhr){  
		              }
		          });  
		        } 

			    function alertTasat(msg){
					var _html = $("<div>").addClass("tasat-wrap")
					var _span = $("<span>").addClass("tasat").html(msg);
					$("body").append(_html.append(_span));
					_html.fadeIn();
					window.setTimeout(function(){
						_html.fadeOut(function(){
							_html.remove();
						});
					}, 1500);   
				} 
		});   
</script> 
</body>
</html>