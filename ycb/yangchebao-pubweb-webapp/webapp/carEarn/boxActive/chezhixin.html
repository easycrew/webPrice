<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/> 
<script  type="text/javascript" src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js"></script> 
<script type="text/javascript" src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js"></script>
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/md50000000000000000000000000000.js"></script>
<script src="../js/commen.js"></script> 
<title>用车挣钱</title>
<style type="text/css">
html{
  font-size:62.5%; 
}
body{
  font-family:'华文细黑','HelveticaNeue-Light';
  font-weight:normal;
  font-style:normal;
  line-height:normal; 
  background-color: #f4f7f8;
}
body,html{
  height:100%;
}
img{
  border:none;
}
*{
  margin:0;
  padding:0;
} 
section{
  max-width: 640px;
  margin: 0 auto;
  min-height: 100%;
  position: relative;
} 
header img{
  width: 100%; 
  display: block;
}   
.error{
  color: red; 
  font-size: 1.6em; 
  margin-bottom: 0.5em;
  display:none;
    text-align:center;
} 
.ui-tit::before {
    background-color: #fb451f;
    content: "";
    display: inline-block;
    height: 1.25em;
    margin-right: 0.313em;
    vertical-align: middle;
    width: 2px;
}
.ui-tit {
    color: #1e1e1e;
    font-size: 1.5em;
    font-weight: normal;
    margin: 0;
    padding: 0.67em;
}
article{
  background-color: #fff;
  padding: 0 3rem 1.9rem;
}
.text{
  font-size: 1.3rem;
  padding: 1.2rem 0;
}
.input-wrap{
  border: 1px solid #c2c2c6;
  display: -webkit-box;
  display: box;
}
input{
  width: 100%;
  border: none;
  height: 3.8rem;
  line-height: 3.8rem;
  padding:0 1em;
  box-sizing: border-box;
  font-size: 1.5rem;
  -webkit-box-flex:1;
  box-flex:1;
  display:block;
}
.btn-wraper{  
  padding:2rem 0 5rem; 
    width:100%;
} 
.btn{
    background-color: #fb451f;  
    font-size: 1.8rem;
    height:4rem;
    line-height:4rem;
  color:#fff;
  text-align:center; 
    cursor: pointer; 
    margin: 0 1rem; 
}
.tasat-wrap{
   position: fixed;
   text-align: center;
   bottom: 50%;
   width: 100%; 
}
.tasat {
    background-color: #000;
    border-radius: 8px;
    color: #fff;
    display: inline-block;
    font-size: 14px;
    margin: 0 20px;
    opacity: 0.8;
    padding: 10px;
}
.loading-wrap{
   position: fixed;
   top:0;
   bottom:0;
   width:100%;
   background-color: rgba(0, 0, 0, 0.5);  
   z-index:100; 
   display:none; 
}
.loading-wrap  p{  
    border-radius: 5px;
    line-height: 22px;
    padding: 20px 15px; 
    color:#fff;
    font-size:14px;
    background-color: rgba(0, 0, 0, 0.8);
    display:inline-block;
    min-width:90px;
    position:absolute;
    top:50%;
    left:50%;
    text-align:center;
    margin:-20px 0 0 -105px;
}
/**弹框**/
.dialog{
  position: fixed;
  width: 100%;
  height: 100%; 
  background-color: rgba(0,0,0,0.4);
  top:0;
  bottom: 0;
  z-index:100;
}
.dialog>div{ 
  margin: 100px 10px 0;
  background-color: #fff; 
  height: auto;
  overflow: auto;
}
.dialog h1{
  height: 33px;
  text-align: center;
  border-bottom: 1px solid #fb451f;
  font-size: 17px;
  line-height: 33px; 
  color: #fb451f;
  font-weight: normal;
} 
.dialog p{
  padding: 20px;  
  font-size: 16px;
  line-height: 150%; 
  color: #lelele;
  font-weight: normal;
}
.dialog .dialog-btn{
  font-size: 16px;
  color: #fff;
  background-color: #fb451f;
  display: block;
  height: 34px;
  line-height: 34px;
  text-align: center;
  cursor: pointer;
}
.dialog .right{
  margin: 0 27px 17px 9px;
  background-color: #c2c2c6;
}
.dialog .center{
  font-size: 16px;
  color: #fff;
  background-color: #fb451f;
  display: inline-block;
  height: 34px;
  line-height: 34px;
  text-align: center;
  cursor: pointer;
  width: 50%;
  margin: 0 auto 10px;
}
.input-wrap .scan-btn{
    display: inline-block; 
    cursor: pointer;
    width:5.2rem;
    height: 30px;
    padding:0 13px 0 0;
	margin:8px 0 0;
    vertical-align: middle;
	border-left:1px solid #A2A2A2; 
    background-image:url("http://app.yangchebao.com.cn/group1/M00/02/EC/ChoCK1aCArWADSFrAAAB1aBrUZ8604.png");
    background-repeat: no-repeat;
    background-size:2.5rem auto;
    background-position: center center;
}
</style>
<body>
  <section class="main-wraper">
  <header><img src="http://app.yangchebao.com.cn/group1/M00/02/50/ChoCK1ZWw0yAcEBRAACBJ1N-Mnk162.png"/></header>
    <h1 class="ui-tit"><span>输入盒子信息领补贴</span></h1>
    <article>
      <p class="text">车之芯IMEI:</p>
      <div class="input-wrap"><input type="text" id="imei">
	  <span class="scan-btn" style="display:none;"></span>
	  </div>
      <p class="text">车之芯CODE:</p>
      <div class="input-wrap"><input type="text" id="code"></div>
    </article>
     <!-- <div class="input-wrap"><div><input id="consumerCode" placeholder="请输入兑换码"></div>
      <p class="error" id="error"></p>
     </div> -->
     <div class="btn-wraper"><div class="btn" id="submit">确定</div></div>  
  </section> 
  <div class="loading-wrap"><p>绑定时间较长，请耐心等待...</p></div>
      <div class="dialog" id="hasPayMoney" style="display:none;">
        <div>
          <h1>提示</h1>
           <p>1.您的盒子已经激活！<br />
             2.您还可以获得养车宝补贴，只需缴纳899元设备押金激活补贴，激活后开车满100公里返现1元，不开车（0:00-24:00）累积两天返现1元，账户现金余额可累积使用，可在养车宝平台上购买本商家的任意服务。生成补贴后七天失效，要主动及时领取哟！</p>
          <div class="btn-wrap" style="text-align:center;">
              <div class="dialog-btn left center">关闭</div> 
          </div>
        </div>
      </div> 
      <div class="dialog" id="notPayMoney" style="display:none;">
        <div>
          <h1>提示</h1>
          <p>您的盒子已激活，即日起开车满100公里返现1元，不开车（0:00-24:00）累积两天返现1元，账户现金余额可累积使用，可在养车宝平台上购买商家的任意服务。生成补贴后七天失效，要主动及时领取哟！</p>
          <div class="btn-wrap" style="text-align:center;">
              <span class="dialog-btn center">确定</span>
          </div>
        </div>
      </div> 

   <script type="text/javascript">
		var index = {};
       var paramJson = {}; 
		function passParamsFromApp2Web(info){   
				index.init(info);
		} 
		function connectWebViewJavascriptBridge(callback) {
			if (window.WebViewJavascriptBridge) {
				callback(WebViewJavascriptBridge)
			} else {
				document.addEventListener('WebViewJavascriptBridgeReady', function() {
					callback(WebViewJavascriptBridge)
				}, false)
			}
		}
		connectWebViewJavascriptBridge(function(bridge) {
			document.documentElement.style.webkitTouchCallout='none';
			bridge.init(function(message, responseCallback) {   
				if(message instanceof Object){  
					if(typeof index.init === 'function') {   
						responseCallback(index.init.apply(this,[message,bridge]));
					} 
				}else if(message=="pullUpRefresh"){
					 typeof index[message] == 'function' && responseCallback(index.pullUpRefresh.apply(this));  
				}else{
					 responseCallback(setCallCountFromClient.apply(this,[message]));
				}
			}) 
		 
		});
		index.init= function(info){ 
           paramJson  = info; 
		   var version = info.version;
		   if(version!=undefined&&(parseFloat(version)>3.9||parseFloat(version)==3.9)){ 
			$(".scan-btn").show(); 
		   }
           if(info.barCode!=undefined){
              $("#imei").val(info.barCode);
           }
		};

        function setScanResult(r){ 
          $("#imei").val(r);
        }
     
        $(document).ready(function(){
            
				//扫描条形码
            $('.scan-btn').click(function(){    
				window.location.href="http://w2l/?presentType=1&needLogin=0&androidName=15&iosName=ScanBarcodeController&isScanBarcode=1";  
            });
            var customerId = paramJson.customerId;
            var carInfoId = "";         
            var checkCodeImei = function(){ 
                var code = $.trim($('#code').val());
                var imei = $.trim( $("#imei").val());
                if(imei==""){
                  alertTasat("请输入盒子设备上的IMEI码"); 
                  return false;
                }
                if(code==""){
                  alertTasat("请输入CODE码"); 
                  return false;
                }
                var postData = {
                    customerId:customerId,
                    obdcode: code,
                    obdimei: imei, 
                    sign: hex_md5(customerId+code+imei),
                }  
                postData.source = 2;//1.乐乘；2.车之芯；空则默认为1 
                $(".loading-wrap").show();
                $.ajax({
                    url:'/yangchebao-app-ws/ws/0.1/user/obd/active',
                    type:'post',
                    data: JSON.stringify(postData),
                    contentType:'application/json',
                    success:function(data){ 
                       getPageUrl();
                       $(".loading-wrap").hide();
                       if(data.status=='1'){
                         $("div#notPayMoney").fadeIn();
                       }else if(data.status=='2'){
                        $("div#hasPayMoney").fadeIn();
                       }else{
                         alert('other')
                       }
                        // 1: 用户已开通车挣补贴  
                        // 2: 用户有绑定盒子IMEI，但是没有开通补贴
                        // 3: 用户没有绑定过盒子IMEI
                    },
                    error:function(xhr){
                        $(".loading-wrap").hide();
                        var errormsg = eval("(" + xhr.responseText + ")"); 
                        var msg = errormsg[0].message;
                        if(msg.indexOf('"code":"400"')!=-1){
                          var arr = eval("(" +  msg + ")");
                          msg = arr[0].message;
                        }
                        alertTasat(msg)
                        
                    }
                })
            }
           
            $('#submit').click(function(event){
                checkCodeImei();
                event.preventDefault();
            });
            $('.empty-btn').on('touchend',function(){
                $(this).siblings('input').val('');
            });  
			$(".dialog .center,.dialog .left").unbind('click').bind('click',function(){ 
			    $(".dialog").fadeOut();
				window.location.href = "http://w2nw?http://"+urlIp()+"/yangchebao-pubweb/carEarn/boxBt.html";
			});   
        }); 
    function alertTasat(msg){
        var _html = $("<div>").addClass("tasat-wrap")
        var _span = $("<span>").addClass("tasat").html(msg);
        $("body").append(_html.append(_span));
        _html.fadeIn();
        window.setTimeout(function(){
            _html.fadeOut(function(){
                _html.remove();
            });
        }, 1500);   
    }
    </script> 
</body>
</html>