<!DOCTYPE html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/> 
<meta name="robots" content="noarchive"/>
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script> 
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/md50000000000000000000000000000.js"></script>
<script src="../js/commen.js"></script> 
<title>盒子激活</title>
</head>
<style type="text/css">
*{
    margin:0;
    padding:0;
    text-shadow:none;
}
html {
    font-size: 62.5%;
    height: 100%;
    -webkit-tap-highlight-color: transparent;
}
body{
    background-color: #ebebeb;
    font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
    font-size:1.6rem;
    color:#39434e;
    height: 100%;
}
ul{
    list-style:none;
}
a{
    color: #fb451f;
    text-decoration: none;
}
img{
    border:none;
}
.clearfix {
  *zoom: 1;
}
.clearfix:before,
.clearfix:after {
  display: table;
  line-height: 0;
  content: "";
}
.clearfix:after {
  clear: both;
}
.btn{
    background-color: #fb451f;
    color: #ffffff;
    font-size: 1.8rem;
    display: block;
    text-align: center;
    height: 4.5rem;
    line-height: 4.5rem;
    padding: 0 1.5rem;
    margin: 0 1.2rem;
}
.btn:hover{
    text-decoration: none;
}
/*绑定步骤*/
.bind-step{
    padding: 2.8rem 0;
}
.bind-step ul{
    display: -webkit-box;
    display: box;
}
.bind-step li{
    -webkit-box-flex:1;
    box-flex:1;
    text-align: center;
    width: 100%;
    position: relative;
}
.bind-step li:before,
.bind-step li:after{
    content: '';
    background-color: #dfdfdf;
    height: .3rem;
    position: absolute;
    top: 1.5rem;
    z-index: 0;
}
.bind-step li:before{
    width: 100%;
    left: -50%;
}
.bind-step li:last-child:after{
    width: 50%;
    right: 0;
}
.bind-step li > span{
    background-color: #dfdfdf;
    color: #aaaaaa;
    display: inline-block;
    font-weight: bold;
    width: 3.2rem;
    height: 3.2rem;
    line-height: 3.2rem;
    -webkit-border-radius:50%;
    border-radius:50%;
    position: relative;
    z-index: 1
}
.bind-step li > p{
    color: #888888;
    font-size: 1.5rem;
    margin-top: .8rem;
}
.bind-step li.current > span,
.bind-step li.finish > span{
    background-color: #fb451f;
    color: #ffffff;
}
.bind-step li.current:before,
.bind-step li.finish:before{
    background-color: #fb451f;
}
.bind-step li.current > p,
.bind-step li.finish > p{
    color: #484848;
}
.bind-step li.finish > span{
    background: #fb451f url('http://app.yangchebao.com.cn/group1/M00/0B/41/ChUBl1WKitOADAyeAAAIfkNKVyI963.png') no-repeat scroll 0.7rem center;
    background-size: auto 2rem;
    color: #fb451f;
    font-size: 0rem;
}
/*表单*/
.form-wrap{
    border-bottom:1px #eaeaea solid;
    margin-bottom: 1.2rem;
}
.form-wrap li{
    background-color: #ffffff;
    display: -webkit-box;
    display: box;
    border-top:1px #eaeaea solid;
    padding-left: 1.8rem;
}
.form-wrap li input{
    border:none;
    color:#39434e;
    font-size: 1.5rem;
    padding:1.5rem 0;
    height: 2.2rem;
    line-height: 2.2rem;
    -webkit-box-flex:1;
    box-flex:1;
    display: block;
    width: 100%;
}
.form-wrap li input:focus{
    outline: none;
}
.form-wrap li input:focus + .empty-btn{
    display: inline-block;
}
.form-wrap li .empty-btn{
    background: transparent url('http://app.yangchebao.com.cn/group1/M00/0B/41/ChUBl1WKitOADAyeAAAIfkNKVyI963.png') no-repeat scroll -2.7rem center;
    background-size: auto 2rem;
    cursor: pointer;
    display: none;
    width:2.1rem;
    height: 2rem;
    margin: 1.7rem 1.8rem 0 0;
    vertical-align: middle;
}
.form-wrap li .scan-btn{
    display: inline-block; 
    cursor: pointer;
    width:5.2rem;
    height: 30px;
    padding:0 13px 0 0;
	margin:13px 0 0;
    vertical-align: middle;
	border-left:1px solid #A2A2A2; 
    background-image:url("http://app.yangchebao.com.cn/group1/M00/02/EC/ChoCK1aCArWADSFrAAAB1aBrUZ8604.png");
    background-repeat: no-repeat;
    background-size:2.5rem auto;
    background-position: center center;
}
.form-wrap li .btn-code{
    background-color: #f07950;
    color: #ffffff;
    cursor: pointer;
    display: inline-block;
    height: 5.4rem;
    line-height: 5.4rem;
    vertical-align: top;
    padding: 0 2.5rem;
}
.form-wrap li .disable {
    background-color: #dfdfdf; 
    color: #c0c0c0;
} 
/*绑定*/
.bind-wrap .form-wrap{
    margin-bottom: 2.4rem;
}
.bind-wrap  figure{
    text-align: center;
    margin-bottom: 2rem;
}
.bind-wrap  figure img{
    max-width: 100%;
}   
.tasat-wrap{
   position: fixed;
   text-align: center;
   bottom: 50%;
   width: 100%; 
}
.tasat {
    background-color: #000;
    border-radius: 8px;
    color: #fff;
    display: inline-block;
    font-size: 14px;
    margin: 0 20px;
    opacity: 0.8;
    padding: 10px;
}
.loading-wrap{
   position: fixed;
   top:0;
   bottom:0;
   width:100%;
   background-color: rgba(0, 0, 0, 0.5);  
   z-index:100; 
   display:none; 
}
.loading-wrap  p{  
    border-radius: 5px;
    line-height: 22px;
    padding: 20px 15px; 
    color:#fff;
    font-size:14px;
    background-color: rgba(0, 0, 0, 0.8);
    display:inline-block;
    min-width:90px;
    position:absolute;
    top:50%;
    left:50%;
    text-align:center;
    margin:-20px 0 0 -105px;
}
/**弹框**/
.dialog{
  position: fixed;
  width: 100%;
  height: 100%; 
  background-color: rgba(0,0,0,0.4);
  top:0;
  bottom: 0;
  z-index:100;
}
.dialog>div{ 
  margin: 100px 10px 0;
  background-color: #fff; 
  height: auto;
  overflow: auto;
}
.dialog h1{
  height: 33px;
  text-align: center;
  border-bottom: 1px solid #fb451f;
  font-size: 17px;
  line-height: 33px; 
  color: #fb451f;
  font-weight: normal;
} 
.dialog p{
  padding: 20px;  
  font-size: 16px;
  line-height: 150%; 
  color: #lelele;
  font-weight: normal;
}
.dialog .dialog-btn{
  font-size: 16px;
  color: #fff;
  background-color: #fb451f;
  display: block;
  height: 34px;
  line-height: 34px;
  text-align: center;
  cursor: pointer;
}
.dialog .right{
  margin: 0 27px 17px 9px;
  background-color: #c2c2c6;
}
.dialog .center{
  font-size: 16px;
  color: #fff;
  background-color: #fb451f;
  display: inline-block;
  height: 34px;
  line-height: 34px;
  text-align: center;
  cursor: pointer;
  width: 50%;
  margin: 0 auto 10px;
}
</style>
<body>
    <section class="bind-flow-wrap"> 
        <nav class="bind-step">
            <ul>
                <li class="finish">
                    <span>1</span>
                    <p>选定车型</p>
                </li>
                <li class="current">
                    <span>2</span>
                    <p>绑定</p>
                </li> 
                <li>
                    <span>3</span>
                    <p>插入设备</p>
                </li>
            </ul>
        </nav>
        
        <!--绑定-->
        <div class="section bind-wrap">
            <ul class="form-wrap">
                <li>
                    <input type="text" maxlength='15' placeholder="乐乘盒子设备上的IMEI码" id="imei" /> 
                    <span class="scan-btn" style="display:none;"></span>
                </li>
                <li>
                    <input type="text" maxlength='4' placeholder="CODE码（ 包装上的4位数字 ）" id="code" />
                    <!--span class="empty-btn"></span-->
                </li>
            </ul>
            <a href="#" class="btn" data-next="2">下一步</a>
            <figure>
                <img src="http://app.yangchebao.com.cn/group1/M00/0B/41/ChUBl1WKi_eAPylFAAA6uF5bDvU297.png"/>
            </figure> 
        </div> 
    </section>
    <div class="loading-wrap"><p>绑定时间较长，请耐心等待...</p></div>
    <div class="dialog" id="hasPayMoney" style="display:none;">
      <div>
        <h1>提示</h1>
         <p>您的盒子已经激活！<br /> 
            </p>
        <div class="btn-wrap" style="text-align:center;">
            <div class="dialog-btn center">关闭</div>
            <!-- <div><div class="dialog-btn right">参与活动</div></div> -->
        </div>
      </div>
    </div> 
    <div class="dialog" id="notPayMoney" style="display:none;">
      <div>
        <h1>提示</h1>
        <p>您的盒子已激活，即日起开车满100公里返现1元，不开车（0:00-24:00）累积两天返现1元，账户现金余额可累积使用，可在养车宝平台上购买商家的任意服务。生成补贴后七天失效，要主动及时领取哟！</p>
        <div class="btn-wrap" style="text-align:center;">
            <span class="dialog-btn center">确定</span>
        </div>
      </div>
    </div> 
    <script type="text/javascript">
	    var index = {};
		function passParamsFromApp2Web(info){   
				index.init(info);
		} 
		function connectWebViewJavascriptBridge(callback) {
			if (window.WebViewJavascriptBridge) {
				callback(WebViewJavascriptBridge)
			} else {
				document.addEventListener('WebViewJavascriptBridgeReady', function() {
					callback(WebViewJavascriptBridge)
				}, false)
			}
		}
		connectWebViewJavascriptBridge(function(bridge) {
			document.documentElement.style.webkitTouchCallout='none';
			bridge.init(function(message, responseCallback) {   
				if(message instanceof Object){  
					if(typeof index.init === 'function') {   
						responseCallback(index.init.apply(this,[message,bridge]));
					} 
				}else if(message=="pullUpRefresh"){
					 typeof index[message] == 'function' && responseCallback(index.pullUpRefresh.apply(this));  
				}else{
					 responseCallback(setCallCountFromClient.apply(this,[message]));
				}
			}) 
		 
		});
		index.init= function(info){  
		   var version = info.version;
		   if(version!=undefined&&(parseFloat(version)>3.9||parseFloat(version)==3.9)){ 
			$(".scan-btn").show(); 
		   }
           if(info.barCode!=undefined){
            $("#imei").val(info.barCode);
          }
		};
        function setScanResult(r){ 
          $("#imei").val(r);
        }
        $(document).ready(function(){
            var url =window.location.search;    
            var paramsArr = (url.split("?")[1]).split("&");
            var paramJson = {}; 
            $.each(paramsArr,function(i){
                var item = paramsArr[i].split("=");
                paramJson[item[0]] = item[1];
            });   
            var customerId = paramJson.customerId;
            var carInfoId = "";         
            var checkCodeImei = function(){ 
                var code = $.trim($('#code').val());
                var imei = $.trim( $("#imei").val());
                if(imei==""){
                  alertTasat("请输入乐乘盒子设备上的IMEI码"); 
                  return false;
                }
                if(code==""){
                  alertTasat("请输入CODE码"); 
                  return false;
                }
                var postData = {
                    customerId:customerId,
                    obdcode: code,
                    obdimei: imei, 
                    sign: hex_md5(customerId+code+imei),
                }  
                $(".loading-wrap").show();
                $.ajax({
                    url:'/yangchebao-app-ws/ws/0.1/user/obd/active',
                    type:'post',
                    data: JSON.stringify(postData),
                    contentType:'application/json',
                    success:function(data){  
                       $(".loading-wrap").hide();
                       if(data.status=='1'){
                         $("div#notPayMoney").fadeIn();
                       }else if(data.status=='2'){
                        $("div#hasPayMoney").fadeIn();
                       }else{
                         alert('other')
                       }
                    },
                    error:function(xhr){ 
                        var errormsg = eval("(" + xhr.responseText + ")"); 
                        var msg = errormsg[0].message;
                        if(msg.indexOf('"code":"400"')!=-1){
                          var arr = eval("(" +  msg + ")");
                          msg = arr[0].message;
                        }
						paramJson.cityName=decodeURIComponent(paramJson.cityName); 
                        if(paramJson.cityName=="天津"&&(msg=="设备信息不存在!"||msg.indexOf("尚未开通APP")!=-1)){
						    postData.source = 2;//1.乐乘；2.车之芯；空则默认为1  
							$.ajax({
								url:'/yangchebao-app-ws/ws/0.1/user/obd/active',
								type:'post',
								data: JSON.stringify(postData),
								contentType:'application/json',
								success:function(data){   
								   $(".loading-wrap").hide();
								   if(data.status=='1'){
									 $("div#notPayMoney").fadeIn();
								   }else if(data.status=='2'){
									$("div#hasPayMoney").fadeIn();
								   }else{
									 alert('other')
								   } 							   
								},
								error:function(xhr){
									$(".loading-wrap").hide();
									var errormsg = eval("(" + xhr.responseText + ")"); 
									var msg = errormsg[0].message;
									if(msg.indexOf('"code":"400"')!=-1){
									  var arr = eval("(" +  msg + ")");
									  msg = arr[0].message;
									}
									alertTasat(msg)
									
								}
							});  
						}else{
						  $(".loading-wrap").hide();
                          alertTasat(msg);
						}
                        
                    }
                })
            }
            $('a.btn').click(function(event){
                checkCodeImei();
                event.preventDefault();
            });
            $('.empty-btn').on('touchend',function(){
                $(this).siblings('input').val('');
            });   
			//扫描条形码
            $('.scan-btn').click(function(){    
				window.location.href="http://w2l/?presentType=1&needLogin=0&androidName=15&iosName=ScanBarcodeController&isScanBarcode=1";  
            });
			$(".dialog .left,.dialog .center").unbind('click').bind('click',function(){ 
				 $(".dialog").fadeOut();
				 window.location.href = "step3.html";
			});  
        }); 
    function alertTasat(msg){
        var _html = $("<div>").addClass("tasat-wrap")
        var _span = $("<span>").addClass("tasat").html(msg);
        $("body").append(_html.append(_span));
        _html.fadeIn();
        window.setTimeout(function(){
            _html.fadeOut(function(){
                _html.remove();
            });
        }, 1500);   
    }
    </script> 
     
</body>

</html>
</body> 
</html>