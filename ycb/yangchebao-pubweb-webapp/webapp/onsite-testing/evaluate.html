<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
	<title>第三方检测</title>
	<script language="javascript" src="./js/jquery-1.10.1.min.js"></script> 
	<script language="javascript" src="./js/jquery.json-2.2.js"></script> 
	<link href="date/mobiscroll.custom-2.13.2.min.css" rel="stylesheet" type="text/css" />
	<script src="date/mobiscroll.custom-2.13.2.min.js" type="text/javascript"></script>
	<style>
		body{
			font-family:'华文细黑','HelveticaNeue-Light';
			font-weight:normal;
			font-style:normal;
			line-height:normal;
			font-size:62.5%;
			color:#1e1e1e;
			padding-bottom: 3em;
			-webkit-box-sizing:border-box;
			box-sizing:border-box;
		}
		body,html{
			min-height:100%;
		}
		*{
			margin:0;
			padding:0;
		}
		a,a:hover{
		    text-decoration: none;
		    outline: none;
		}
		img,button {
		    border:none;
		}
		ul{
			list-style: none;
		}

		div.container{
			margin:0 auto;
		    position:relative;
		    max-width: 640px;
		}
		div.evaluate-con{
		    /*position: absolute; 
		    left: 50%;
		    top:0;
		    bottom: 60px;
		    margin-left: -320px;
		    overflow-x: hidden;*/
		    padding: 0 2em;
		}
		p.evaluate-title,p.otherSuggest-title{
			font-size: 1.6em;
			color: #8ABBE5;
			margin: 1em 0 0.5em 0;
		}
		/*div.evaluate-con-detail{
			border: 1px solid #DFDFE7;
		}*/
		span.evaluate-text{
			font-size: 1.7em;
			color: #333;
		}
		div.evaluate-con img{
			width: 2.2em;
			height: 2.2em;
			vertical-align: bottom;
		}
		ul.evaluate-con-ul>li{
			overflow: hidden;
			padding: 1em;
		}
		li.dentisfy{
			/*border-bottom: 1px solid #DFDFE7;*/
			border-top: 1px solid #DFDFE7;
			border-left: 1px solid #DFDFE7;
			border-right: 1px solid #DFDFE7;
			cursor: pointer;
		}
		ul.evaluate-con-ul>li span.evaluate-text{
			float: left;
		}
		ul.evaluate-con-ul>li span.evaluate-img{
			float: right;
		}
		li.undentisfy{
			border-bottom: 1px solid #DFDFE7;
			border-top: 1px solid #DFDFE7;
			border-left: 1px solid #DFDFE7;
			border-right: 1px solid #DFDFE7;
		}
		p.undentisfy-top{
			overflow: hidden;
			cursor: pointer;
		}
		textarea{
			width:98%;
			padding: 0.3em 0.7%;
			border: 1px solid #FF825F;
			font-size: 1.6em;
		}
		div.undentisfy-reson{
			margin-top: 1.5em;
			border-top: 1px solid #DFDFE7;
		}
		ul.undentisfy-ul{
			padding: 0.6em 1em;
		}
		ul.undentisfy-ul li{
			padding: 0.5em 0;
		}
		ul.undentisfy-ul li img{
			width: 1.3em;
			height: 1.3em;
			margin-right: 0.3em;
			vertical-align: middle;
		}
		ul.undentisfy-ul li span{
			font-size: 1.4em;
			color: #333;
			cursor: pointer;
		}
		span.someCheck{
			color: #B9B9B9;
			font-size: 0.8em;
		}
		div.submit{
			margin-top:4em;
		}
		div.submit p.submitBtn{
			width: 96%;
			font-size: 2.2em;
			color: #fff;
			padding: 0.3em 0;
			background-color: #FF825F;
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px;
			text-align: center;
			margin: auto;
			cursor: pointer;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="evaluate-con">
			<p class="evaluate-title">您对这次上门检测的评价</p>
			<div class="evaluate-con-detail">
				<ul class="evaluate-con-ul">
					<li class="dentisfy" id="1">
						<span class="evaluate-text">我很满意</span>
						<span class='evaluate-img'><img src="images/testEvaluate/unchecked-gray.png"></span>
					</li>
					<li class="undentisfy" id="2">
						<p class="undentisfy-top">
							<span class="evaluate-text">不满意，建议提升服务<span class="someCheck">（多选）</span></span>
							<span class="evaluate-img"><img src="images/testEvaluate/unchecked-gray.png"></span>
						</p>
						<div class="undentisfy-reson" style="display:none;">
							<ul class="undentisfy-ul">
								<li id="3"><span><img src="images/testEvaluate/unchecked_box.png"></span><span>服务态度</span></li>
								<li id="4"><span><img src="images/testEvaluate/unchecked_box.png"></span><span>检测项目</span></li>
								<li id="5"><span><img src="images/testEvaluate/unchecked_box.png"></span><span>小故障排除</span></li>
							</ul>
						</div>
					</li>
				</ul>
			</div>
			<div class="otherSuggest">
				<p class="otherSuggest-title">其他建议</p>
				<p class="otherError" style="color:#f00;font-size:1.3em;margin-bottom:0.3em;display:none;"></p>
				<textarea name="otherSuggest" id="otherSuggest" cols="30" rows="10" placeholder="写点评价吧，您的评价将指明养车宝的未来之路！同时可以获得30元的洗车代金券哦！"></textarea>
			</div>
			<div class="submit">
				<p class="submitBtn">提交</p>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	$(function(){
		 var paramJson={};
	     var url = window.location.search; 
	     var paramsArr = (url.split("?")[1]).split("&"); 
	     $.each(paramsArr,function(i){
	       var item = paramsArr[i].split("=");
	           paramJson[item[0]] = item[1]
	     }); 
		$('li.dentisfy').unbind('click').bind('click',function(){
			$(this).css('border','1px solid #FF825F');
			$(this).attr('checked','checked');
			$('li.undentisfy').removeAttr('checked');
			$('ul.undentisfy-ul li').removeAttr('checked');
			$('ul.undentisfy-ul li img').attr('src','images/testEvaluate/unchecked_box.png');
			$('li.undentisfy').css('border-top','none');
			$('li.undentisfy').css('border-left','1px solid #DFDFE7');
			$('li.undentisfy').css('border-right','1px solid #DFDFE7');
			$('li.undentisfy').css('border-bottom','1px solid #DFDFE7');
			$(this).find('img').attr('src','images/testEvaluate/checked_red.png');
			if(!$('div.undentisfy-reson').is(':hidden')){
				$('p.undentisfy-top img').attr('src','images/testEvaluate/unchecked-gray.png');
				$('div.undentisfy-reson').hide()
			}
		});
		$('li.undentisfy p.undentisfy-top').unbind('click').bind('click',function(){
			$('li.dentisfy').find('img').attr('src','images/testEvaluate/unchecked-gray.png');
			$('li.undentisfy').css('border','1px solid #FF825F').attr('checked','checked');
			$('li.dentisfy').removeAttr('checked');
			$('li.dentisfy').css('border-top','1px solid #DFDFE7');
			$('li.dentisfy').css('border-left','1px solid #DFDFE7');
			$('li.dentisfy').css('border-right','1px solid #DFDFE7');
			$('li.dentisfy').css('border-bottom','none');
			$('div.undentisfy-reson').show();
			$(this).find('span.evaluate-img img').attr('src','images/testEvaluate/check_disabled.png')
		});
		$('li.undentisfy').on('click','ul.undentisfy-ul li span',function(){
			var isChecked=$(this).parent().attr('checked');
			if(isChecked=='checked'){
				$(this).parent().removeAttr('checked');
				$(this).parent().find('img').attr('src','images/testEvaluate/unchecked_box.png')
			}else{
				$(this).parent().attr('checked','checked');
				$(this).parent().find('img').attr('src','images/testEvaluate/checked_box.png')
			}
			
		});
		$('p.submitBtn').unbind('click').bind('click',function(){
			if(!($('li.dentisfy').attr('checked')=='checked'||($('li.undentisfy').attr('checked')=='checked' && $('ul.undentisfy-ul li[checked="checked"]').length>0))){
				return false
			}
			if($.trim($('textarea').val()).length>200){
				$('p.otherError').html('其他建议最多200字').show();
				$('textarea').focus(function(){
					$('p.otherError').hide()
				});
				return false
			}
			var postData={};
			postData.customerId=paramJson.customerId;
			postData.workOrderId=paramJson.workOrderId;
			postData.evaluateText=$('textarea#otherSuggest').val();
			var evaluateItem={};
			if($('li.dentisfy').attr('checked')=='checked'){
				evaluateItem.evaluateItemFirstId='1'
			}else if($('li.undentisfy').attr('checked')=='checked'){
				evaluateItem.evaluateItemFirstId='2';
				var evaluateItemIds=[];
				$('ul.undentisfy-ul li').each(function(){
					if($(this).attr('checked')=='checked'){
						evaluateItemIds.push($(this).attr('id'))
					}
				});
				evaluateItem.evaluateItemIds=evaluateItemIds
			}
			postData.evaluateItem=evaluateItem;
			$.ajax({
				type:'post',
				url:'/yangchebao-weixin-ws/ws/0.1/weixinV2/evaluate',
				async: false,
				data:$.toJSON(postData),
				contentType:'application/json;charset=utf-8',
				success:function(){
					window.history.back()
				},error:function(xhr){
	                var error=eval('('+xhr.responseText+')');
	                alert(error[0].message)
	            }
			})
		})
	})
</script>
</html>