<!Doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <title>上门检测报告单</title> 
    <script language="javascript" src="./js/jquery-1.10.1.min.js"></script>
</head>
<style type="text/css"> 
*{
    margin: 0;
    padding: 0;
    list-style: none;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
}
html,body{
    min-height: 100%;
}
body{
    background-color: #f4f7f8;
    font-family:"黑体", "微软雅黑";
    color: #1e1e1e;
    font-size: 12px;
}
img{
    width: 100%;
    border: none;
    vertical-align: middle;
}

a,a:hover{
    text-decoration: none;
    outline: none;
}


.main {
    margin:0 auto;
    position:relative;
    width:100%;
    height:100%;
}

/*检测报告*/
.examining-report{
    background-color: #ffffff;
}
.examining-report .content-wrap{
    bottom: 0;
}
.user-info{
    border-width:40px;
    -moz-border-image:url('./images/border.png') 40 40 round;
    -webkit-border-image:url('./images/border.png') 40 40 round;
    border-image:url('./images/border.png') 40 40 round;
    text-align: center;
    font-size: 24px;
     -moz-box-sizing:border-box;
    -webkit-box-sizing:border-box;
    box-sizing:border-box;   
}
.user-info h1{
    color:#f15a24;
    font-size: 54px;
    margin-bottom: 28px;
}
.user-info .avatar{
/*    border:2px #bdccd4 solid;
    -moz-border-radius: 50%;
    -webkit-border-radius: 50%;
    border-radius: 50%;*/
    display: inline-block;
    width: 144px;
    height: 144px;
    margin-bottom: 20px;
}
.user-info .avatar img{
    max-width: 100%;
    height: 100%;
}
.user-info .user-name{
    color: #000000;
    margin-bottom: 12px;
}
.user-info .score{
    color: #f00;
    font-size: 48px;
    margin: 40px 0 35px;
}
.user-info .score strong{
    color: #f15a24;
    margin-left: 20px;
}
.user-info .p-count{
    color: #000000;
    margin-bottom: 43px;
}
.user-info .p-count strong{
    color: #f15a24; 
}
.user-info .p-count > span{
    margin-right: 10px;
}
.user-info .signature{
    background-color: #edf9fe;
    border:1px #07c3fd solid;
    color: #000000;
    font-size: 36px;
    line-height: 56px;
    padding: 26px 20px;
    margin-bottom: 50px;
}
.problem-wrap{
    padding: 60px 30px 0 40px;
    height: 100%;
    -moz-box-sizing:border-box;
    -webkit-box-sizing:border-box;
    box-sizing:border-box;
}
.problem-wrap .problem-list{
    margin-bottom: 90px;
}
.problem-wrap h2{
    background: transparent url('./images/dotted.png') repeat-x scroll 0 center;
    color: #f15a24;
    font-weight: normal;
    font-size: 36px;
    margin-bottom: 30px;
}
.problem-wrap h2 span{
    display: inline-block;
    background-color: #ffffff;
    padding-right: 16px;
}
.problem-wrap .tips{
    font-size: 30px;
    line-height: 40px;
    margin-bottom: 35px;
}
.problem-wrap .problem-module{
    padding-right: 25px;
    position: relative;
    margin-bottom: 44px;
}
.problem-wrap .problem-module .num{
    border:1px #07c3fd solid;
    background-color: #edf9fe;
    width: 70px;
    height: 70px;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    border-radius: 50%;
    color: #07c3fd;
    font-size: 60px;
    font-weight: bold;
    position: absolute;
    right: 5px;
    top: -30px;
    text-align: center;
}
.problem-wrap table{
    border:1px #75bbf6 solid;
    color:#534741;
    font-size: 24px;
    border-collapse: collapse;
    width: 100%;
}
.problem-wrap table caption{
    background-color: #edf9fe;
    border:1px #75bbf6 solid;
    border-bottom:none;
    padding: 16px;
    text-align: left;
    font-size: 30px;
}
.problem-wrap table td,
.problem-wrap table th{
    border:1px #75bbf6 solid;
    padding: 18px 12px;
}
.problem-wrap table td{
    padding: 18px 25px;
}
.problem-wrap table th{
    font-weight: normal;
}
 /**微信**/ 
#sharecover {
    background-color: rgba(0, 0, 0, 0.5);
    bottom: 0; 
    height: 100%;
    left: 0;
    position: fixed;
    right: 0;
    text-align: left;
    top: 0;
    width: 100%;
    z-index:9;
}
#sharecover img{
    width:100%;
} 




div.nextTest{
    padding: 0.5em 0;
    border-bottom: 2px solid #EDEDF1;
    margin: 0 1em;
    text-align: left;
    overflow: hidden;
}
div.nextTest p{
    float: left;
}
div.nextTest a{
    float: right;
    color: #6EAADE;
}
h1.testListTitle{
    font-size: 2em;
    color: #FF825F;
    text-align: center;
    margin: 0.6em 0 1em 0;
}
div.basicTestResult{
    overflow: hidden;
    padding: 0 10%;
    text-align: left;
}
p.testPerson{
    margin-right: 1em;
}
div.basicTestResult p.testPerson,div.basicTestResult div.testResult{
    float: left;
}
div.carComment{
    margin: 1.5em 1em 0;
    border: 1px solid #DCDBE3;
}
div.carComment div.carComment-top{
    border: 1px solid #DCDBE3;
    background-color: #FEF9E3;
    -webkit-border-radius:5px;
    -moz-border-radius:5px;
    border-radius:5px;
    text-align: center;
}
p.carComment-top-one{
    font-size: 1.6em;
    color: #FB451F;
    padding: 0.5em 0 0.5em 0;
}
p.carComment-top-two{
    color: #333;
    font-size: 1.2em;
    padding-bottom: 0.8em;
    padding-top: 0.8em;
}
div.carComment-bottom{
    padding: 1em 0.6em;
    background-color: #FFFDF4;
}
div.carComment-bottom p.p-perQ{
    text-align: left;
}
div.carComment-bottom p.p-perQ span{
    display: inline-block;
    margin-right: 0.5em;
    color: #333;
    padding-bottom: 0.2em;
}
div.carComment-bottom p.p-perQ span span{
    margin-right: 0;
}
p.testBtn span{
    display: inline-block;
    padding: 0.3em 0;
    width: 42%;
    color: #fff;
    font-size: 1.2em;
    background-color: #6EAADE;
    -webkit-border-radius: 6px;
    -moz-border-radius: 6px;
    border-radius: 6px;
    margin-top: 1.8em;
    cursor: pointer;
}
p.testBtn span.test-pingjiaBtn{
    margin-left:6%;
    background-color: #FF825F;
}
div.problem-title-wraper{
    position: relative;
    margin: 6em 2em 0;
    text-align: center;
}
div.problem-title-wraper ul{
    overflow: hidden;
    border-top: 1px solid #71ACDF;
    border-right: 1px solid #71ACDF;
    color: #A2A2A2;
    font-size: 1.6em;
    font-family: 'microsoft yahei';
    list-style: none;
}
div.problem-title-wraper ul li.now{
    float: left;
    width:33.333%;
}
div.problem-title-wraper ul li.now a{
    display: block;
    font-size: 1.5em;
    color: #A2A2A2;
    border-bottom: 1px solid #71ACDF;
    border-left: 1px solid #71ACDF;
    padding: 0.4em 0;
}
li.Qcurrent{
    width: 33.5%;
    position: absolute;
    z-index: 100;
    background-color: #fff;
}
li.Qcurrent a{
    display: block;
    font-size: 1.5em;
    color: #A2A2A2;
    padding: 0.8em 0 0.4em;
    border: 1px solid #FF825F;
    -webkit-border-top-left-radius:0.5em;
    -moz-border-top-left-radius:0.5em;
    border-top-left-radius:0.5em;
    -webkit-border-top-right-radius:0.5em;
    -moz-border-top-right-radius:0.5em;
    border-top-right-radius:0.5em;
}
div.isEvaluate{
    margin-top: 1.5em;
    font-size: 1.2em;
    text-align: center;
    color: #333;
}
div.isEvaluate span{
    font-size: 1em;
    color: #6EAADE;
}
.problem-module th{
	color:#6EAADE;
}
.showSolution{
	text-align:center;
	color:#6EAADE;
	font-size:1.23em;
}
.dialog{
  position: fixed;
  width: 100%;
  height: 100%; 
  background-color: rgba(0,0,0,0.4);
  top:0;
  bottom: 0;
  z-index:100;
}
.dialog>div{ 
  margin: 100px 32px 0;
  background-color: #F4F7F8; 
  height: auto;
  overflow: auto;
  position:relative;
}
.dialog h1{
  height: 68px; 
  border-bottom: 2px solid #fb451f;
  font-size: 30px;
  line-height: 68px; 
  color: #1E1E1E;
  font-weight: normal;
  padding:0 20px;
} 
.dialog p{
  padding: 20px;  
  font-size: 24px;
  line-height: 150%;
  color:#1E1E1E;
  font-weight: normal;
}
.dialog .btn-wrap>div{
  width: 50%;
  float: left;
}
.dialog .dialog-btn{
  font-size: 36px;
  color: #fff;
  background-color: #fb451f;
  display: block;
  height: 56px;
  line-height: 56px;
  text-align: center;
  cursor: pointer;
  margin:0 170px 20px;
}
.dialog .left{
  margin: 0 9px 17px 27px;
}
.dialog .right{
  margin: 0 27px 17px 9px;
  background-color: #c2c2c6;
}
.dialog ul li{
	background-color:#fff;
	margin-bottom:20px;
	border-bottom:1px solid #D9D9E2;
}
.close {
    cursor: pointer;
    display: inline-block;
    height: 40px;
    position: absolute;
    right: 10px;
    top: 15px;
    width: 40px;
    z-index: 10;
}
.close label {
    display: inline-block;
    margin-left: 10px;
}
.close label::before {
    border-right: 2px solid #fc5d3c;
    content: "";
    display: inline-block;
    height: 40px;
    transform: rotate(45deg);
    -ms-transform:rotate(45deg);   
    -moz-transform:rotate(45deg); 
    -webkit-transform:rotate(45deg);  
    -o-transform:rotate(45deg); 
    width: 1px;
}
.close label::after {
    border-left: 2px solid #fc5d3c;
    content: "";
    display: inline-block;
    height: 40px;
    transform: rotate(-45deg);
    -ms-transform:rotate(-45deg);   
    -moz-transform:rotate(-45deg); 
    -webkit-transform:rotate(-45deg);  
    -o-transform:rotate(-45deg); 
    width: 1px;
}
.y-btn{
    background-color: #34cc89;
    border-radius: 6px;
    color: #fff;
    cursor: pointer;
    display:block;
    font-size: 36px;
    margin-top: 1.8em;
    padding: 0.3em 0; 
	text-align:center;
	margin:44px 6% 0;
}
.desc{
   font-size:24px;
   margin:20px;
   text-align:center;
   color:#1E1E1E;
}
.blue{
	color:#A2D1F0;
}
.org{
    color:#FB5F2F;
}
</style>
<body>  
<!-- 检测申请中！-->
    <div class="main examining-report"> 
            <div class="content-wrap">
                <div class="user-info">    
                    <div class="nextTest"><p>下次检测时间：<span class="nextTestTime">2015.03.15</span></p></div> 
                    <h1 class="testListTitle">上门检测报告单</h1>
                    <div class="basicTestResult">
                        <p class="testPerson"><img src="images/testPerson.jpg" id="person" height="148px" width="148px"></p>
                        <div class="testResult">
                            <p>检测得分：<span class="score"></span></p>
                            <p>检测车主：<span class="carHolder">疯狂的橙子</span></p>
                            <p>检测时间：<span class="testTime"></span></p>
                        </div>
                    </div>
                    <div class="carComment">
                        <div class="carComment-top">
                            <!-- <p class="carComment-top-one">车况严重</p> -->
                            <p class="carComment-top-two">你的车车上路也太危险了吧！</p>
                        </div>
                        <div class="carComment-bottom">
                            <p class="p-count">本次检测共检查出<span id="totalNumQ">6</span>个问题</p>
                            <p class="p-perQ">
                                <span>常规类：<span id="routineNumQ">0</span>个</span>
                                <span>安全类：<span id="safeNumQ">2</span>个</span>
                                <span>寿命类：<span id="lifeNumQ">2</span>个</span>
                                <span>舒适度类：<span id="comfortNumQ">2</span>个</span>
                                <span>美观类：<span id="maintainNumQ">2</span>个</span>
                            </p>
                        </div>
                    </div>
                    <div class="isEvaluate"></div>
                    <a href="javascript:void(0);" class="download-btn"><div class="changeBtn y-btn">下载养车宝APP</div></a>
                </div>   
            </div>   
    </div> 
    <div id="sharecover" style="display: none;">
        <img src="http://app.yangchebao.com.cn/group1/M00/05/00/ChUBl1SOrkCAV_1UAABSgg_DsAY434.png">
    </div>
	<div class="dialog" style="display:none;">
		  <div>
			<h1>解决方案推荐</h1>
			<span class="close"><label></label></span>
			<ul>
				<!-- <li>
					<p>划痕小的时候，划痕小的时候，划痕小的时候，划痕小的时候，划痕小的时候，划痕小的。</p>
					<a class="dialog-btn">打蜡</a> 
				</li> --> 
			</ul>
		  </div>
	</div>  
<script language="javascript" src="./js/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script language="javascript"> 
$(function(){  
    var paramJson={};
     var url = window.location.search; 
     var paramsArr = (url.split("?")[1]).split("&"); 
     $.each(paramsArr,function(i){
       var item = paramsArr[i].split("*");
           paramJson[item[0]] = item[1]
     }); 

    //download app
    $(".download-btn").unbind("click").bind("click",function() {
        var ua = navigator.userAgent.toLowerCase();
        if(ua.match(/MicroMessenger/i)=="micromessenger") {
            window.location.href = "http://a.app.qq.com/o/simple.jsp?pkgname=com.carsmart.emaintain"; 
        }else{
            var sUserAgent = navigator.userAgent.toLowerCase(); 
            var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
            var bIsIphone = sUserAgent.match(/iphone/i) == "iphone";
            var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
            var bIsAndroid = sUserAgent.match(/android/i) == "android"; 
            if(bIsIpad || bIsIphone || bIsIphoneOs){
                window.location.href = "https://itunes.apple.com/us/app/yang-che-bao/id736543893"; 
            }else{
                window.location.href = 'http://yangchebao.com.cn/website-ws/ws/0.1/app/download';
            }
        }
    });

    try{
        var phoneWidth = parseInt(window.screen.width);
        var phoneHeight = parseInt(window.screen.height);
        var phoneScale = phoneWidth / 640;
        var ua = navigator.userAgent; 
        if (/Android (\d+\.\d+)/.test(ua)) {
            var version = parseFloat(RegExp.$1);
            // andriod 2.3
                $('[name="viewport"]').attr('content', 'width=640, initial-scale=' + phoneScale + ', minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi');
            if (version >= 2.3) {
                // andriod 2.3以上
            } else {
                $('[name="viewport"]').attr('content', 'width=640, initial-scale= 1.0, minimum-scale = 1.0, maximum-scale = 1.0, user-scalable=no, target-densitydpi=device-dpi');
            }
        // 其他系统
        } else {
            $('[name="viewport"]').attr('content', 'width=640, initial-scale= 0.5, minimum-scale = 0.5, maximum-scale = 0.5, user-scalable=no, target-densitydpi=device-dpi');
        }
    }catch(e){} 
   
    getResult(); 
    $('div.problem-title-wraper ul li.now').unbind('click').bind('click',function(){
        var thisId=$(this).attr('id');
        $(this).next().show().siblings('li.Qcurrent').hide();
        $('div.problem-detail-wraper div#'+thisId).show().siblings('div').hide()
    });
	$(".problem-module").on("click",".showSolution",function(){
        var service = $(this).parent("tr").data("service");
        if(service.length>1){
            var str = "";
            $.each(service,function(i){
               var item = service[i];
               var desc = item.serviceDesc;
               if(desc==undefined||desc==""){
               desc = item.serviceName;
               }
               str+='<li><p>'+desc+'</p>'
                    +'<a class="dialog-btn" href="http://w2l/?presentType=1&needLogin=0&androidName=5&iosName=ShopListViewController&service='+item.firstServiceId+'&subService='+item.serviceId+'">'+service[i].serviceName+'</a>'
                    +'</li>';
            });
            $(".dialog ul").html(str);
            $(".dialog").show();
        }else{
            window.location.href = "http://w2l/?presentType=1&needLogin=0&androidName=5&iosName=ShopListViewController&service="+service[0].firstServiceId+"&subService="+service[0].serviceId;
        }
        
    });
	$(".dialog .close").click(function(){
		$(".dialog").hide();
	});
    function getResult(){  
         $.ajax({
            url: '/yangchebao-weixin-ws/ws/0.1/weixinV2/getTestingResultV2?channelId=5&id='+paramJson.workOrderId+'&'+parseInt(Math.random()*100000),
        type: 'get',
            async: false,
            dataType: 'json',
            success: function(data) { 
               // document.title = "豪夺"+data.score+"分，我的养车宝免费车辆检测成绩单！";
               data.score = data.score||100;
                paramJson.score = data.score;
				        // workOrderId=data.workOrderId;
				        $("#person").attr("src",data.headImgUrl);
                if(data.score<=59){
                    $("p.carComment-top-two").html("你的车车上路也太危险了吧！"); 
                }else if(data.score<=69){
                    $("p.carComment-top-two").html("你确定不是这车的后妈吧！"); 
                }else if(data.score<=79){
                    $("p.carComment-top-two").html("主人求求你多爱我一点！"); 
                }else if(data.score<=89){
                    $("p.carComment-top-two").html("加油哦，养车达人就差一步啦！"); 
                }else{
                    $("p.carComment-top-two").html("原来我就是传说中的养车达人"); 
                }
                if(new Date()>new Date(data.nextInspectionTime.replace(/-/g, "/"))){
                    $("span.nextTestTime").parent().html('距离您上次检测都好久啦！')
                }else{
                    $("span.nextTestTime").html(data.nextInspectionTime)
                }
                $("span.score").html(data.score+"分");  
                $("span.testTime").html(data.time);
                $("span.carHolder").html(data.realName);
                $("#totalNumQ").html(data.needDealIssues.needDealRoutineIssuesList.length+data.needDealIssues.needDealSafeIssuesList.length+data.needDealIssues.needDealLifeIssuesList.length+data.needDealIssues.needDealComfortIssuesList.length+data.needDealIssues.needDealBeauIssuesList.length);
                $("#routineNumQ").html(data.needDealIssues.needDealRoutineIssuesList.length);
                $("#safeNumQ").html(data.needDealIssues.needDealSafeIssuesList.length);
                $("#lifeNumQ").html(data.needDealIssues.needDealLifeIssuesList.length);
                $("#comfortNumQ").html(data.needDealIssues.needDealComfortIssuesList.length);   
                $("#maintainNumQ").html(data.needDealIssues.needDealBeauIssuesList.length); 
                if(data.isGetVoucher=='yes'){
                    $('div.isEvaluate').html('已评价！30元代金券已放入<span>养车宝个人中心</span>');
                    $('span.test-pingjiaBtn').hide();
                }
	
                $("#needDealRoutineIssuesList .tips").html(data.routineIssuesDescription);
                $("#needDealSafeIssuesList .tips").html(data.safeIssuesDescription);
                $("#needDealLifeIssuesList .tips").html(data.lifeIssuesDescription);
                $("#needDealComfortIssuesList .tips").html(data.comfortIssuesDescription);  
                $("#needDealBeauIssuesList .tips").html(data.beauIssuesDescription); 
                XIssues("needDealRoutineIssues",data.needDealIssues.needDealRoutineIssuesList);
                XIssues("needDealSafeIssues",data.needDealIssues.needDealSafeIssuesList);
                XIssues("needDealLifeIssues",data.needDealIssues.needDealLifeIssuesList);
                XIssues("needDealComfortIssues",data.needDealIssues.needDealComfortIssuesList);
                XIssues("needDealBeauIssues",data.needDealIssues.needDealBeauIssuesList);
                XIssues("noNeedDealRoutineIssues",data.noNeedDealIssues.noNeedDealRoutineIssuesList);
                XIssues("noNeedDealSafeIssues",data.noNeedDealIssues.noNeedDealSafeIssuesList);
                XIssues("noNeedDealLifeIssues",data.noNeedDealIssues.noNeedDealLifeIssuesList);
                XIssues("noNeedDealComfortIssues",data.noNeedDealIssues.noNeedDealComfortIssuesList);
                XIssues("noNeedDealBeauIssues",data.noNeedDealIssues.noNeedDealBeauIssuesList); 
                $(".apply-btn").attr("href",data.getTestUrl);
            },
            error:function(xhr){
                var msg =eval('('+xhr.responseText+')');
                alert(msg[0].message)
            }
        }); 
        }
 
        function XIssues(issuesName,items){ 
            var _wrap = $("#"+issuesName+"List"); 
            if(items!=undefined&&items.length!=0){ 
                 _wrap.show(); 
                $.each(items,function(i){
                     var item = items[i]; 
                     if(item.solution==''||item.solution==undefined||item.solution==null){
                        item.solution='无'
                     }
                    
                     var _module = $("<div>").addClass("problem-module");
                     var _num = $("<span>").addClass("num").html(i+1);
                     var _table = $("<table>");
                     var str ='<caption>'+ item.itemName +'</caption>'
                            +'<tr>'
                            +'<th>问题</th>'
                            +'<td>'+ item.description +'</td>'
                            +'</tr>'
                            +'<tr>'
                            +'<th>建议</th>'
                            +'<td>'+ item.solution +'</td>'
                            +'</tr>';
                    _table.append(str);
                    
                     if(item.isHaveService=="yes"){
                       var _service = $("<tr>").html('<td colspan="2" class="showSolution">查看解决方案 ></td>').data("service",item.service);
                       _table.append(_service);
                     }      
                     _module.append(_num).append(_table);
                    // var str = '<div class="problem-module">'
                    //         +'<span class="num">'+(i+1)+'</span>'
                    //         +'<table>'
                    //         +'<caption>'+ item.itemName +'</caption>'
                    //         +'<tr>'
                    //         +'<th>问题</th>'
                    //         +'<td>'+ item.description +'</td>'
                    //         +'</tr>'
                    //         +'<tr>'
                    //         +'<th>建议</th>'
                    //         +'<td>'+ item.solution +'</td>'
                    //         +'</tr>'
                    //         +'</table>'
                    //         +'</div>';
                    _wrap.append(_module); 
                });   
            } 
        } 
        
}) ;
</script>
</body>
</html> 
