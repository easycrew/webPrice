<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" /> 
	<meta name="format-detection" content="telephone=no" />
    <script src="../js/jquery-1.9.1.min.js"></script>
    <script src="../js/jquery.json-2.2.js"></script>  
	<link type="text/css" href="css/base.css" rel="stylesheet"/>
    <title>理赔单详情</title>
</head>
<style type="text/css"> 
.shop-wrap{
    border-bottom: 1px solid #D9D9E2;
    background-color: #fff;
    margin-bottom: 1rem; 
    padding: 1.5rem; 
    height: auto;
    overflow: auto;
} 
.shop-wrap h3 {
    font-size: 1.6rem; 
    font-weight: normal;
    margin-bottom: 0.8rem; 
} 
.shop-wrap .info {
    color: #323232;
    font-size: 1.2rem;
    line-height: 150%;
    margin: 0;
} 
.shop-wrap .pic {
    float: left;
    height: auto; 
    width: 8em;
}
.shop-wrap .pic img {
    display: block; 
    width: 100%;
} 
.shop-wrap .pic + div {
    margin-left: 9.2em;
}
.distance{
    background-color: #fb451f;
    color: #fff;
    display: inline-block;
    float: right;
    font-size: 1.2rem;
    height: 1.1em;
    line-height: 1.1em;
    margin-right: -1.3em;
    padding: 0 0.5em 0 0.3em;
}
footer{
    position: fixed;
    width: 100%;
    bottom:0;
    background-color: #fff; 
} 
.btn-wrap a{
    font-size: 1.6rem;
    height: 3.8rem;
    line-height: 3.8rem;
    display: block;
    width: 50%;
    float: left;
    text-align: center;
}
.btn-wrap .left{
    color: #FB451F;
}
.btn-wrap .right{
    color: #fff;
    background-color: #FB451F;
} 
.totalPrice{
    height: 4rem;
    line-height: 4rem;
    font-size: 1.2rem;
    text-align: right;
    padding: 0 1.5rem;
    border-bottom: 1px solid #D9D9E2;
    background-color: #fff;
}
.totalPrice span{ 
    font-size: 1.8rem;
    color: #FF6138;
    display: inline-block;
    vertical-align: middle;
    margin-left: 1rem; 
}
.detail-li{
    font-size: 1.5rem;
    height: 4rem;
    line-height: 4rem;
    padding-left: 11rem;
    background-color: #fff;
    border-bottom: 1px solid #D9D9E2;
    position: relative;
}
.detail-li label{
    display: block;
    float: left;
    margin-left: -11rem;
    padding-left: 1.5rem; 
    position: relative;

}
.detail-li label span{
    color: #FF6138;
    position: absolute; 
    top: -3px;
}
.phone{
    display: block;
    position: absolute;
    width: 5.7rem;
    height: 4rem;
    background-image: url("images/phone.png");
    background-position: center center;
    background-repeat: no-repeat;
    background-size: 2.2rem auto; 
    right: 0;
    border-left: 1px solid #D9D9E2;
    top: 0;
}

/*.overlay-wrap{
    position: fixed;
    top: 0;
    bottom: 0;
    width: 100%;
    background-color: 
}*/
</style>
<body>  
<input type="hidden" name="cache" value="1"/>
<div class="detail-li"><label>客户手机号</label><p class="userMobile"></p>
<a class="phone userCall" href="javascript:void(0);"></a></div>
<div class="detail-li" style="margin-bottom:1rem;"><label>客户姓名</label><p class="userName"></p></div>
<div class="detail-li"><label>理赔维修厂</label>
<a class="phone businessMobile" href="javascript:void(0);"></a></div>
<article class="shop-wrap"> 
    <div class="pic">
        <img src=""/>
    </div>
    <div>
    <h3><span class="tit"><!-- 车龙汽车装饰望京总店 --></span><span class="distance"></span></h3>
        <p class="info"><!-- 地址：朝阳区 --></p>
    </div> 
</article> 
<div class="detail-li"><label>维修零件费<span>*</span></label><p class="partsPrice"><!-- 908.00元 --></p></div>
<div class="detail-li"><label>维修工时费<span>*</span></label><p class="workPrice"><!-- 600.00元 --></p></div>
<p class="totalPrice">合计<span class="sumPrice"><!-- ¥ 1508.00 --></span></p>
<footer class="btn-wrap" style="display:none;">
        <a class="left deleteBtn" href="javascript:void(0);">删除</a> 
        <a class="right updateBtn" href="javascript:void(0);">修改</a>
</footer>
<div class="dialog delete-dialog" style="display:none;"> 
    <div class="dialog-content">
       <h1>删除理赔单<span class="close"><label></label></span></h1>
       <p>确认删除理赔单？</p>
       <div class="dialog-btn-wrap"><a href="javascript:void(0);">确定</a></div>  
   </div>
</div> 
<div class="dialog phone-dialog" style="display:none;"> 
    <div class="dialog-content">
       <h1>提示<span class="close"><label></label></span></h1>
       <p>商家太懒没留电话，请拨打客服电话<br> <a href="tel:400-607-1222">400-607-1222</a></p>
       <div class="dialog-btn-wrap"><a href="javascript:void(0);">确定</a></div>  
   </div>
 </div> 
<script type="text/javascript">
  /** function getBasePageInfos(){
	  window.shareInfos.getBasePageInfos({"isForceRefrsh":"1"}); 
   }**/
   $(document).ready(function(){  
        var url =window.location.search;   
        var paramJson = {};
        if(url!=undefined&&url!=""){
        var paramsArr = (url.split("?")[1]).split("&"); 
        $.each(paramsArr,function(i){
         var item = paramsArr[i].split("=");
         paramJson[item[0]] = item[1];
        });    
        }
        $(".deleteBtn").click(function(){
            $(".delete-dialog").fadeIn();
        }); 
        $(".updateBtn").click(function(){
            window.location.href = "orderShop.html"+window.location.search+"&page=order";
        }); 
        $(".delete-dialog a").click(function(){
            $(".delete-dialog").fadeOut();
            updateFun("4");
        });
		$('.dialog').click(function(e){
          if($(e.target).closest('.dialog-content').length==0){
            $('.dialog').hide(); 
          }
        });
		$('.close').click(function(e){ 
            $(this).parents('.dialog').hide();  
        });
		$(".businessMobile").click(function(){
		    if($(this).hasClass("null-phone")){
			 $(".phone-dialog").fadeIn();
			}
		}); 
		$(".phone-dialog a").click(function(){
			$(".phone-dialog").hide();
		});
        paramJson.operatorType = 1;
        getDetail(); 
       function getDetail(){    
            $.ajax({
                url: "/yangchebao-app-ws/ws/0.1/claims/order/detail?operatorType="+paramJson.operatorType+"&customerId="+paramJson.customerId+"&osInfo="+paramJson.osInfo+"&lon="+paramJson.lon+"&lat="+paramJson.lat+"&orderNumber="+paramJson.orderNumber,
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                type: "get",
                success: function(data) {
                    $(".userMobile").html(data.userMobile);
                    $(".userCall").attr("href","tel:"+data.userMobile);
                    $(".userName").html(data.userName); 
                    if(data.businessMobile!=undefined&&data.businessMobile!=""){
						$(".businessMobile").attr("href","tel:"+data.businessMobile);
					}else{
						$(".businessMobile").attr("href","javascript:void(0)").addClass("null-phone");
					} 
                    $(".shop-wrap img").attr("src",data.businessLogo);
                    $(".shop-wrap .tit").html(data.businessRegName);
                    $(".shop-wrap .distance").html(data.distance);
                    $(".shop-wrap .info").html("地址："+data.address);
                    $(".partsPrice").html(data.partsPrice+"元");
                    $(".workPrice").html(data.workPrice+"元");
                    $(".sumPrice").html("¥"+data.sumPrice); 
                    paramJson.claimsOrderId = data.claimsOrderId;
					if(data.status=="1"){
						$(".btn-wrap").show();
					}
                },error: function(xhr) {
                       var mes = eval('('+xhr.responseText+')'); 
                       alert(mes[0].message);
                }
            });
        }
       function updateFun(status){   
         var postData = {};
        postData.claimsOrderId  = paramJson.claimsOrderId;
        postData.operatorType = paramJson.operatorType; // 1.理赔员；2.普通用户；
        postData.orderNumber = paramJson.orderNumber;
        postData.customerId = paramJson.customerId
        postData.status = status; // 2.确认；4.删除； 
          $.ajax({  
              url: '/yangchebao-app-ws/ws/0.1/claims/update/status',
              type: 'post', 
              data:$.toJSON(postData),
              dataType: 'json',
              contentType:'application/json;charset=utf-8', 
              success: function(data) {    
                window.location.href="orderList.html"+window.location.search;
              },error:function(xhr){  
                 var errormsg = eval("(" + xhr.responseText + ")");
                 alert(errormsg[0].message);
              }
          });   
       }
    });
</script>
</body>
</html>