<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta name="format-detection" content="telephone=no" />
		<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script> 
		<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js"></script>
		<title>一元洗车</title>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
				list-style: none;
				-webkit-tap-highlight-color: rgba(0,0,0,0);
			}
			html,body{
				min-height: 100%;
			}
			html{
				/*写在html中才会生效*/
				font-size: 62.5%;      
			}
			body{
				background-color: #f4f7f8;
				font-family: 'STHeitiSC-Light',Helvetica,Arial,sans-serif;
				color: #1e1e1e;
			}
			img{
				width: 100%;
				border: none;
				vertical-align: middle;
			}
			a, input{
				text-decoration: none;
				outline: none;
				blr: expression(this.onFocus=this.blur);
			}
			.clearfix::before,.clearfix::after{
				display: block;
				content: '';
				font-size: 0px;
			}
			.clearfix::after{
				clear: both;
			}

			.form {
				background: #1983F3;
				padding-top: 5px;
				padding-bottom: 20px;
			}

			.row {
				background: #0E58A6;
			    border-radius: 5px;
				-webkit-border-radius: 5px;
				-moz-border-radius: 5px;
			    margin-bottom: 8px;
			    line-height: 30px;
			    height: 30px;
			    padding: 5px;
			}

			.btn {
				width: 100%;
				height: 40px;
				line-height: 40px;
				background: #F8ED04;
				color: #0E58A6;
				text-align: center;
				font-size: 2rem;
				font-weight: bold;
				border-radius: 5px;
				-webkit-border-radius: 5px;
				-moz-border-radius: 5px;
			}

			.row input {
				height: 100%;
				width: 100%;
				font-size: 1.6rem;
				box-sizing: border-box;
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
				border:none;
				background: #0E58A6;
				color: #fff;
			}

			div.errorLog{
				position: fixed;
				top: 0;
				z-index: 500;
				height: 100%;
				width: 100%;
				background-color: rgba(0,0,0,0);
				text-align: center;
			}
			div.errorLog p{
				position: relative;
				display: inline-block;
				margin: 10rem auto;
				background-color: rgba(0,0,0,0.5);
				font-size: 1.6rem;
				color: #fff;
				text-align: center;
				padding: 0.6rem 1rem;
				border-radius: 8px;
			}

			.content p:last-of-type, .form {
				padding: 8px 28px;
				background: #1983F3;
			}


		</style>
	</head>
<body>
	<div class="content">
		<p><img src="http://app.yangchebao.com.cn/group1/M00/06/B7/ChoCK1djybKAJge6AAIep7YLaMI792.png" width="100%"></p>
		<div class="form">
			<div class="row">
				<input type="text" name="carnumber" class="carnumber" />
			</div>
			<div class="btn">立即使用</div>
		</div>
		<p><img src="http://app.yangchebao.com.cn/group1/M00/06/B7/ChoCK1djycKAVbxjAAC1NLOR3vc272.png" width="100%"/></p>
	</div>
</body>
<script type="text/javascript">
	//强制登录
	var index = {};
	var paramJson = {};
	function passParamsFromApp2Web(info){   
		index.init(info);
	} 
	function connectWebViewJavascriptBridge(callback) {
		if (window.WebViewJavascriptBridge) {
			callback(WebViewJavascriptBridge)
		} else {
			document.addEventListener('WebViewJavascriptBridgeReady', function() {
				callback(WebViewJavascriptBridge)
			}, false)
		}
	}
	connectWebViewJavascriptBridge(function(bridge) {
		document.documentElement.style.webkitTouchCallout='none';
		bridge.init(function(message, responseCallback) {   
			if(message instanceof Object){  
				if(typeof index.init === 'function') {   
					responseCallback(index.init.apply(this,[message,bridge]));
				} 
			}else if(message=="pullUpRefresh"){
				 typeof index[message] == 'function' && responseCallback(index.pullUpRefresh.apply(this));  
			}else{
				 responseCallback(setCallCountFromClient.apply(this,[message]));
			}
		}) 
	 
	});
	index.init= function(info){  
	  paramJson = info;
	};

	$(function(){
        // 获取参数
		var url = window.location.search; 
	    

	    if(url!=''){
	    	var paramsArr = (url.split("?")[1]).split("&");
		    $.each(paramsArr,function(i){
		        var item = paramsArr[i].split("=");
		        paramJson[item[0]] = item[1]
		    });
	    }

	    //立即使用
	    $(".btn").unbind("click").bind("click",function(){

	    	//防止连续点击
	    	$(this).unbind("click");
	    	setTimeout(function(){
	    		$(".btn").unbind("click").bind("click",function(){
	    			btnClick();
	    		});
	    	},2000);

	    	btnClick();

	    });

	});

	//错误弹出框
	var errorLog=function(msg){
		$('div.errorLog').remove();
		var errorStr='';
		errorStr+='<div class="errorLog" style="display:none;"><p></p></div>'
		$('body').append(errorStr);
		$('div.errorLog p').html(msg);
		$('div.errorLog').fadeIn();
		var errorHeight=$('div.errorLog p').outerHeight();
		$('div.errorLog p').css({'top':'50%','margin-top':'-'+errorHeight/2+'px'});
		$('div.errorLog').unbind('click').bind('click',function(){
			$('div.errorLog').fadeOut()
		});
		setTimeout(function(){
			$('div.errorLog').fadeOut()
		},3000)
	};

	var btnClick = function(){
		if(paramJson.customerId=='' || paramJson.customerId==null || paramJson.customerId=='null' || paramJson.customerId==undefined){
				window.location.href = "http://w2l?presentType=2&androidName=8&iosName=LoginViewController";  
			} else {

				var carnumber = $("input[name='carnumber']").val();
		    	if($.trim(carnumber) == '') {
		    		errorLog("请输入您的车牌号码");
		    		return false;
		    	}

		    	var reg=/^[\u4e00-\u9fa5][a-zA-Z0-9]{6}$/;
				if(!reg.test(carnumber)){
					errorLog("请输入正确格式的车牌号码");
		    		return false;
				}

		    	$.ajax({
		    		url:'/yangchebao-app-ws/ws/0.1/washActivity/getActivityBasicInfo?userInfoId='+paramJson.userId+'&plateNumber='+carnumber,
		    		type:'GET',
		    		async:false,
					// data: $.toJSON(postData),
					contentType:'application/json;charset=utf-8',
					success:function(data) {
						if(data.statusCode == '200') {
							window.location.href="http://w2l/?presentType=1&needLogin=1&androidName=6&iosName=ShopListViewController&service=1&subService=13925";
						} else {
							errorLog(data.msg);
						}
						
					},
					error:function(xhr) {
						var mes = eval('('+xhr.responseText+')');
						errorLog(mes[0].message);
					}
		    	})
	    		
	    	}
	}

</script>
</html>