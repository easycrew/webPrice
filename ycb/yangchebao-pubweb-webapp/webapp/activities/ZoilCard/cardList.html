<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="format-detection" content="telephone=no" />
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js"></script>
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js"></script>
<script type="text/javascript" src="js/index.js"></script> 
<link type="text/css" href="css/index.css" rel="stylesheet"/>
<title>加油卡列表</title>
</head>
<style type="text/css">   
 .cardList li{
    display: table;
    border-bottom: 1px solid #D9D9E2; 
    margin-top: 1rem;
    padding: 1.5rem 0rem 1.5rem 1rem;
    width: 100%;
    background-color: #fff;
    box-sizing:border-box;
 }
  .cardList li p{ 
    font-size: 1.5rem; 
    line-height: 150%; 
 }
  .cardList li div{
    display: table-cell;
  }
  .cardList li .right{
     width: 4.8rem;
     text-align: center;
     vertical-align: middle;
     border-left: 1px solid #D9D9E2; 
  } 
  .cardList img{
     width: 1.6rem;
  }
   .cardList .checked{
      border-left: 5px solid #f55d5d;
   }
   footer{
     position: fixed;
     bottom: 0;
     width: 100%;
   }
   footer.button{
    background-color: #fff;
    border-radius: 0;
    height: 5rem;
    line-height: 5rem;
    color: #f55d5d;
    border-top: 1px solid #D9D9E2;
   }
   a,img,button,input,textarea,ul,li{
	-webkit-tap-highlight-color:rgba(255,255,255,0);
   }
</style>
<body>  
  <ul class="cardList">
    <!-- <li class="checked">
        <div>
          <p>加油卡类型:中石油</p>
          <p>用户名:＊立</p>
          <p>加油卡卡号:1000 1184 6788 6544 411</p>
        </div>
        <div class="right">
           <img src="css/images/delete.png">
        </div>
    </li>    -->
  </ul>  
  <p class="tip">点击查看更多</p> 
  <footer class="button addBtn">
     + 添加加油卡
  </footer>
  <div class="null-wrap">
    <img src="css/images/null.png"/>
    <p>您还没有油卡哦～</p>
    <a href="javascript:void(0);" class="addBtn button">+ 添加油卡</a>
  </div> 
  <div class="dialog deleteDialog">
      <div class="dialog-content">
        <p class="info" style="text-align:center;">是否删除此加油卡？</p>
        <div class="btn-wrap two-btn">
          <p><a href="javascript:void(0)" class="button white-btn cancel">取消</a></p>
          <p><a href="javascript:void(0)" class="button sure">确定</a></p>
        </div>
      </div>
   </div>
<script type="text/javascript">
var paramJson = {};
var pageindex = 0;
$(document).ready(function(){   
    var url =window.location.search;   
    if(url!=undefined&&url!=""){
    var paramsArr = (url.split("?")[1]).split("&"); 
    $.each(paramsArr,function(i){
     var item = paramsArr[i].split("=");
     paramJson[item[0]] = item[1];
    });    
    }   
  $(".tip").click(function(){
        getList();
  }); 
  $(".cardList").on("click",".left",function(){
    $(".cardList li").removeClass("checked");
	var _li = $(this).parent("li");
    _li.addClass("checked");
    mark(_li.attr("cardnum"));
  }); 
  var delNum = "" ;
  $(".cardList").on("click",".right",function(){
    delNum = $(this).parent("li").attr("cardnum");
    $(".deleteDialog").fadeIn(); 
  }); 
  $(".deleteDialog .cancel").click(function(){
      $(".deleteDialog").fadeOut();
  });
  $(".deleteDialog .sure").click(function(){
      $(".deleteDialog").fadeOut();
      unBind(delNum);
  });
  $(".addBtn").click(function(){
    window.location.href = "addCard.html"+window.location.search;
  });
   $(".addBtn").click(function(){
    window.location.href = "addCard.html"+window.location.search;
  });
  getList();  
});
function getList(){
    $.ajax({
        url: "/yangchebao-app-ws/ws/0.1/oilcard/card/list?userInfoId="+paramJson.userInfoId+'&pagesize=10&pageindex='+pageindex+"&"+(new Date()).getTime(),
        contentType: "application/json;charset=utf-8",
        dataType: "json",
        type: "get",
        success: function(data) {
          if(data.totalCount>0){ 
              $("footer").show();
              if((data.page+1)<data.totalPages){
                $(".tip").show();
              } else{
                $(".tip").hide();
              } 
              pageindex++;    
              var items = data.items; 
              $.each(items,function(i){
                var item  = items[i]; 
                    var className="";
                    if(item.mainCardStatus==1){
                      className="checked";
                    } 
                    var _li = '<li class="'+className+'" cardnum="'+item.cardNo+'">'
                            +'<div class="left">'
                            +'<p>加油卡类型:'+item.cardTypeDesc+'</p>'
                            +'<p>用户名:'+item.cardOwner+'</p>'
                            +'<p>加油卡卡号:'+item.cardNo+'</p>'
                            +'</div>'
                            +'<div class="right">'
                            +'<img src="css/images/delete.png">'
                            +'</div>'
                            +'</li>';
                    $(".cardList").append(_li);
                  });
                }else{
                    $(".null-wrap").show();
                    $("footer").hide();
                }
        },error: function(xhr) {
         var mes = eval('('+xhr.responseText+')'); 
         alertTasat(mes[0].message);
    }
    });
}
function unBind(cardNo){  
      var postData = {};
      postData.userInfoId =paramJson.userInfoId ;
      postData.cardNo=cardNo;  
       $.ajax({
            url: '/yangchebao-app-ws/ws/0.1/oilcard/card/unbind',
            type: 'post',
            async: false,
            data:$.toJSON(postData),
            dataType: 'json',
            contentType:'application/json;charset=utf-8',
            success:function(data){  
            },error:function(xhr){ 
                if(xhr.status==200){
                  $(".cardList").html("");
                  pageindex = 0;
                  getList();
                }else{
                  var mes = eval('('+xhr.responseText+')'); 
                  alertTasat(mes[0].message);
                }
            } 
        }); 
} 
function mark(cardNo){
      var postData = {};
      postData.userInfoId =paramJson.userInfoId ;
      postData.cardNo=cardNo;  
       $.ajax({
            url: '/yangchebao-app-ws/ws/0.1/oilcard/card/mark',
            type: 'post',
            async: false,
            data:$.toJSON(postData),
            dataType: 'json',
            contentType:'application/json;charset=utf-8',
            success:function(data){

            },error:function(xhr){ 
                if(xhr.status==200){
                   window.location.href="index.html"+window.location.search;
                }else{
                  var mes = eval('('+xhr.responseText+')'); 
                  alertTasat(mes[0].message);
                }
            } 
        }); 
} 
</script>
</body>
</html>