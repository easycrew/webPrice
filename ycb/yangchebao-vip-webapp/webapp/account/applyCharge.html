<style>
	#Wraper_apply_onlineCharge h2{
		background-color:#3586f5;
		color:#fff;
		padding: 5px 15px;
	}
	#Wraper_apply_onlineCharge h2 span{
		color:#fff!important;
		font-size:14px!important;
		padding-left: 40px;
	}
	#Wraper_apply_onlineCharge div.basicInfo div{
		line-height: 30px;
	}
	a{
		text-decoration:none;
	}
	a:hover{
		text-decoration:none;
	}
	div.basicInfo,div.checkResult{
		border:1px solid #ccc;
	}
	div.wraper{
		padding:10px 2%;
	}
	div.checkResult{
		margin-bottom: 20px;
	}
	div.result1,div.result2,div.result3{
		text-align: center;
		margin: 26px 0;
		font-size: 1.3em;
	}
	span.reApply{
		color: #fff;
		background-color: #2283c5;
		display: inline-block;
		width: 11%;
		height: 48px;
		line-height: 48px;
		font-size: 1.2em;
		cursor: pointer;
	}
	i.icon-sort-down{
		display: none;
	}
	div.notonline{
		display: none;
		border: 1px solid #ccc;
	}
	div.notonline div.wraper{
		text-align: center;
	}
</style>
<div class="urlContentWraper" id="Wraper_apply_onlineCharge">
	<div class="ui-info-layout notonline">
	    <div>
			<h2>提示</h2>
			<div class="wraper">
				<p style="font-size:2.8em;color:#555;">您已经支持在线支付，无需再次申请！</p>
	        	<p style="margin-top:30px;">如有疑问，请拨打客服电话01058377979。</p>
			</div>
	    </div>
	</div>
    <div class="ui-info-layout online">
	    <div class="checkResult" style="display:none;">
        	<h2>申请结果<span>确定提交合同后，我们会尽快审核，审核通过后，我们会开通您在养车宝APP的在线支付功能。</span></h2>
        	<div class="wraper">
	        	<div class="result1"  style="display:none;">
		        	<p style="font-size:2.8em;color:#555;">申请审核中，我们会在一个工作日内完成审核！</p>
		        	<p style="margin-top:30px;">如有疑问，请拨打客服电话01058377979。</p>
	        	</div>
	        	<div class="result2"  style="display:none;">
		        	<p style="font-size:2.8em;color:#555;">申请已通过！</p>
		        	<p style="margin-top:30px;">您的店铺已开通在线支付功能，客户可在线购买店铺服务！</p>
		        	<p>如有疑问，请拨打客服电话01058377979。</p>
	        	</div>
	        	<div class="result3"  style="display:none;">
		        	<p style="font-size:2.8em;color:#555;">申请被驳回！</p>
		        	<p class="rejectReason" style="margin-top:30px;"></p>
		        	<p><span class="reApply">再次提交申请</span></p>
		        	<p>如有疑问，请拨打客服电话01058377979。</p>
	        	</div>
	        </div>
        </div>
        <div class="basicInfo">
        	<h2>合同基本信息<span>确定提交合同后，我们会尽快审核，审核通过后，我们会开通您在养车宝APP的在线支付功能。</span></h2>
        	<div class="wraper">
	        	<div id="contractInfo" class="ui-form">
				    <div class="grid-layout-main jrad-form">
					    <input type="hidden" name="businessContractId">
					    <input name="shroffAccountId" type="hidden">
					    <div class="grid-row-fluid">
							<label class="span3 grid-layout-label">
								<span class="ui-form-required">*</span>收款账号信息：
							</label>
							<div class="span1 grid-layout-content fluid-wrap">
								<div class="installAccount"><a href="javascript:">设置</a></div>
							</div>
							<div class="span10 grid-layout-content fluid-wrap accountInfo"></div>
						</div>
					    <div class="grid-row-fluid">
							<label class="span3 grid-layout-label">
								公司注册名称：
							</label>
							<div class="span8 grid-layout-content fluid-wrap">
								<div data-name="businessName"></div>
							</div>
							<label class="span3 grid-layout-label contract">
								合同类型：
							</label>
							<div class="span6 grid-layout-content fluid-wrap">
								<div data-name="contractTypeName">在线支付合同</div>
							</div>
						</div>
						<div class="grid-row-fluid">
							<label class="span3 grid-layout-label">
								店铺名称：
							</label>
							<div class="span8 grid-layout-content fluid-wrap">
								<div data-name="businessRegName"></div>
							</div>
							<label class="span3 grid-layout-label contract">
								佣金：
							</label>
							<div class="span6 grid-layout-content fluid-wrap">
								<div data-name="commissionRate">10%</div>
							</div>
						</div>
						<div class="grid-row-fluid">
							<label class="span3 grid-layout-label">
								店铺地址：
							</label>
							<div class="span8 grid-layout-content fluid-wrap">
								<div data-name="address"></div>
							</div>
							<label class="span3 grid-layout-label contract">
								账期：
							</label>
							<div class="span6 grid-layout-content fluid-wrap">
								<div data-name="paymentPeriodName">可随时提现</div>
							</div>
						</div>
						<div class="grid-row-fluid">
							<label class="span3 grid-layout-label">
								联系电话：
							</label>
							<div class="span8 grid-layout-content fluid-wrap">
								<div data-name="mobile"></div>
							</div>
							<label class="span3 grid-layout-label contract">
								申请年限：
							</label>
							<div class="span6 grid-layout-content fluid-wrap contract">
								<div data-name="expirationYears">1年</div>
							</div>
						</div>
						<div class="grid-row-fluid">
							<label class="span2 grid-layout-label">
							</label>
							<p class="ui-note">说明：“联系电话”将用于接收订单短信提醒，如需修改以上信息，请先到“我的店铺”修改。</p>
						</div>
						<div class="grid-row-fluid">
							<label class="span2 grid-layout-label"></label>
							<div class="span19 grid-layout-content fluid-wrap">
								<div style="height:500px;overflow:auto;border: 1px solid #d5d5d5;" data-name="contractAgreement">  
								</div>
							</div>
						</div>
						<div class="grid-row-fluid"> 
							<label class="span2 grid-layout-label"></label>
							<div class="span13 grid-layout-content fluid-wrap">
								<div data-name="agree" class="jrad-checkbox-container"></div>
							</div>
						</div>
				    </div>
			    </div>
			    <div>
					<button class="btn btn-big btn-primary disabled" id="saveContractInfo"> 提交 </button> 
				</div>
	        </div>
        </div>
    </div>
    <div id="Form_bank_account" class="grid-layout ui-form" style="display:none;">
	    <div class="grid-layout-main jrad-form">
	        <input name="shroffAccountId" type="hidden">  
	        <div class="grid-row-fluid">
	            <label class="span4 grid-layout-label">
	                <span class="ui-form-required">*</span>
					省：
	            </label>
	            <div class="span8 grid-layout-content fluid-wrap">
	                <div data-name="provinceId" class="jrad-select-container">
	                </div>
	            </div>
	            <label class="span3 grid-layout-label">
	                <span class="ui-form-required">*</span>
					市：
	            </label>
	            <div class="span8 grid-layout-content fluid-wrap">
	                <div data-name="areaCodeId" class="jrad-select-container">
	                </div>
	            </div> 
	        </div>
			<div class="grid-row-fluid"> 
				 <label class="span4 grid-layout-label">
	                <span class="ui-form-required">*</span>
					银行：
	            </label>
	            <div class="span8 grid-layout-content fluid-wrap">
	                <div data-name="bankId" class="jrad-autocomplete-container">
	                </div>
	            </div> 
				<label class="span3 grid-layout-label">
	                <span class="ui-form-required">*</span>
					开户分行：
	            </label>
	            <div class="span8 grid-layout-content fluid-wrap">
	                <div data-name="bankBranch" class="jrad-input-container">
	                </div>
	            </div>
			</div>
			<div class="grid-row-fluid"> 
	            <label class="span4 grid-layout-label">
				   <span class="ui-form-required">*</span>
	                账号：
	            </label>
	            <div class="span8 grid-layout-content fluid-wrap">
	                <div data-name="bankAccount" class="jrad-input-container bankAccount" id="bankAccount">
	                </div>
	            </div>
	        </div>
			<div class="grid-row-fluid"> 
	            <label class="span4 grid-layout-label">
				   <span class="ui-form-required">*</span>
	                重复账号：
	            </label>
	            <div class="span8 grid-layout-content fluid-wrap">
	                <div data-name="bankAccountAgain" class="jrad-input-container bankAccount" id="bankAccountAgain">
	                </div>
	            </div>
	        </div>
			<div class="grid-row-fluid"> 
	            <label class="span4 grid-layout-label">
				   <span class="ui-form-required">*</span>
	                户主姓名：
	            </label>
	            <div class="span8 grid-layout-content fluid-wrap">
	                <div data-name="accountHolder" class="jrad-input-container">
	                </div>
	            </div>
	        </div> 
	    </div>
	    <div class="jrad-buttons-container ui-buttons-container">
	        <button class="jrad-btn-primary btn btn-small btn-primary">
	            确定
	        </button>
	        <button class="jrad-btn-normal btn btn-small btn-default">
	            取消
	        </button>
	    </div>
	</div>
</div>
<script type="text/javascript">
$(function(){
	var wraper=$('#Wraper_apply_onlineCharge');
	var jRad = {params:{},validators:{}};  
    jRad.params['agree'] = {
        data: [{id:'0',name:'同意'}],
        onclick:function(){
        	var scrollTop;
			var arr = $("div[data-name='agree']").checkbox('val'); 
			if(arr.length==0){
				$("#saveContractInfo").addClass("disabled");
				$('#saveContractInfo',wraper).unbind('click')
			}else{
				$("#saveContractInfo").removeClass("disabled");
				$('#saveContractInfo',wraper).unbind('click').bind('click',function(){
					$('body,html').animate({scrollTop:0},500);
					saveContractInfo();
				})
			}
		}
    }; 
    var fields_params = {}; 
    var json = {};

    $('#contractInfo').form({
		layout: 'grid',
		fields: jRad.params, 
		autobinding: false,  
		preSubmit: function() {},
		success: function() {},
		//提交成功后回调函数
		error: function(xhr) {} //提交失败后回调函数
	});
	
	var initAccountInfo = function(){ 
		$.jRadGet({url:'/vip-ws/ws/0.1/shroffAccount/getAccountInfo?shopAccountId='+carsmart_config.shopId,
					async:false,
					success:function(data){
						json = data;
						var bankId = {'id':json.bankId,"name":json.bankName};
						json.bankId = bankId;
						if(json){
							$('#contractInfo input[name="shroffAccountId"]',wraper).val(data.shroffAccountId);
							$("div.accountInfo").html(json.areaCodeName+" &nbsp;&nbsp;&nbsp;&nbsp;"+json.bankName+json.bankBranch+" &nbsp;&nbsp;&nbsp;&nbsp;"+json.bankAccount+" &nbsp;&nbsp;&nbsp;&nbsp;"+json.accountHolder);
						} 
					} 
		}); 
	};
	var initContractInfo = function(){
		$.jRadGet({
			url:'/vip-ws/ws/0.1/businessContractBack/getBusinessContract?shopAccountId='+carsmart_config.shopId,
			async:false,
			success:function(data){
				$('#contractInfo input[name="shroffAccountId"]',wraper).val(data.shroffAccountId);
				$('#contractInfo input[name="businessContractId"]',wraper).val(data.businessContractId);
				$("div.accountInfo").html(data.areaCodeName+" &nbsp;&nbsp;&nbsp;&nbsp;"+data.bankName+data.bankBranch+" &nbsp;&nbsp;&nbsp;&nbsp;"+data.bankAccount+" &nbsp;&nbsp;&nbsp;&nbsp;"+data.accountHolder);
				$('div[data-name="businessName"]',wraper).html(data.businessName);
				$('div[data-name="businessRegName"]',wraper).html(data.businessRegName);
				$('div[data-name="address"]',wraper).html(data.address);
				$('div[data-name="mobile"]',wraper).html(data.mobile);
				$('div[data-name="contractAgreement"]',wraper).html(data.contractAgreement);
				$('div.basicInfo h2 span').show();
				if(!(data.hasContract==0 && data.onlinePayStatus==1)){
					if(data.hasContract == 1){
						$('div[data-name="contractTypeName"]',wraper).html(data.contractTypeName);
						$('div[data-name="commissionRate"]',wraper).html(data.commissionRate);
						$('div[data-name="paymentPeriodName"]',wraper).html(data.paymentPeriodName);
						$('div[data-name="expirationYears"]',wraper).html(data.expirationYears+'年');
						$('#saveContractInfo').hide();
						$('div.installAccount').parent().hide();
						$('div[data-name="agree"]',wraper).checkbox('val','0');
						$('div[data-name="agree"]').checkbox('readonly',true);
						$('div.basicInfo h2 span').hide();
						if(data.auditStatus == 1){
							$('div.checkResult',wraper).show();
							$('div.result2,div.result3',wraper).hide();
							$('div.checkResult .result1',wraper).show()
						}else if(data.auditStatus == 2){
							$('div.checkResult',wraper).show();
							$('div.result1,div.result3',wraper).hide();
							$('div.checkResult .result2',wraper).show()
						}else if(data.auditStatus == 3){
							$('div.checkResult',wraper).show();
							$('div.result2,div.result1',wraper).hide();
							$('div.checkResult .result3',wraper).show();
							$('p.rejectReason',wraper).html('驳回原因：'+data.remark);
							$('span.reApply',wraper).click(function(){
								$('div[data-name="agree"]',wraper).checkbox('readonly',false);
								initContractInfo();
								$('div.checkResult',wraper).hide();
								$('#saveContractInfo',wraper).show();
								$('div.installAccount',wraper).parent().show();
								$('div[data-name="agree"]',wraper).checkbox('val','');
								$('div[data-name="agree"]').checkbox('readonly',false);
								$('div.basicInfo h2 span').show()
							})
						}
					}
				}else{
					$('div.online').hide();
					$('div.notonline').show();
				}
				
			}
		})
	};
	// $.jRadGet({
	// 	url:'/vip-ws/ws/0.1/business/getBusinessLevel?businessInfoId='+carsmart_config.businessInfoId,
	// 	success:function(data){
	// 		if(data.isCooperation == 2){
	// 			$('div.online').show();
	// 			$('div.notonline').hide();
	// 		}else{
	// 			$('div.online').hide();
	// 			$('div.notonline').show();
	// 		}
	// 	}
	// });
	initAccountInfo();
	initContractInfo();
	fields_params['provinceId'] = {
		urlData:{
			url:'/vip-ws/ws/0.1/area/provinceAll' 
		},
		unshiftData: {id:'',name:'请选择'},
		onchange: function(){
			var provinceCode = $('#Form_bank_account div[data-name=provinceId]').select('val');
			if(provinceCode==''){
				$('#Form_bank_account div[data-name=areaCodeId]').select({
															urlData:{url:''},
															data:[{id:'',name:'请选择'}]});
			}else{
				$('#Form_bank_account div[data-name=areaCodeId]').select({
				urlData:{
					url: '/vip-ws/ws/0.1/area/municipalities?provinceId=' + provinceCode 
				},
				unshiftData: {id:'',name:'请选择'}
				});
			}
			$('#Form_bank_account div[data-name=areaCodeId]').select('val','');
		}
	};
	fields_params['areaCodeId'] = {
		data: [{id:'',name:'请选择'}]
	};
	fields_params['bankId'] = { 
		url:'/vip-ws/ws/0.1/bank/getBankList', 
		queryParam:'name',
		fl: 'name',
        displayField:'name',
        valueField:'id',
		response: function(data){
			return data;
		}		
	}; 
	 
	$('#Form_bank_account').form({
        title: '收款账号设置',
        grid: 20,
        autobinding:true, 
        // validators: jRad.validators,
        fields: fields_params, 
		item:json,
        url: '/vip-ws/ws/0.1/shroffAccount/editAccountInfo',
		preSubmit:function(data){ 
			data.shopAccountId = carsmart_config.shopId; 
			return data
		},
        success: function() { 
            $.jRadMessage({level:'success',message:'账户信息添加成功。',selector:wraper});
            initAccountInfo();
        }
    });
	$("div.installAccount a").click(function(){
		$("#Form_bank_account").form({
			item:json
		}).form('open');
	});

	function saveContractInfo(){
		var scrollTop;
		var json = $('#contractInfo').form('getValue');
		var flag = $('#contractInfo').form('validateAll');
		var agree =  $("div[data-name = 'agree']").checkbox('val');
		if(agree.length == 0){
			return false
		}
		if(flag){
			json.shopAccountId = carsmart_config.shopId;
			json.shroffAccountId = $('#contractInfo input[name="shroffAccountId"]',wraper).val();
			json.contractType=$('div[data-name="contractType"]',wraper).html();
			json.commissionRate=parseFloat($('div[data-name="commissionRate"]',wraper).html())/100;
			json.paymentPeriod=$('div[data-name="paymentPeriod"]',wraper).html();
			json.expirationYears=parseInt($('div[data-name="expirationYears"]',wraper).html());
			$.jRadPost({
				url:'/vip-ws/ws/0.1/businessContractBack/commitBusinessContract',
				data:json,
				success:function(data){
					initContractInfo()
				},
				error:function(xhr){
					var mes = eval("("+xhr.responseText+")");  
					$.jRadMessage({level:'error',message:mes[0].message,selector:wraper})
				}
			})
		}
	}

});
document.getElementById('bankAccount').oncontextmenu=function(){
	return false
};
document.getElementById('bankAccount').onkeydown=function(e){
	e = (e) ? e : window.event;
	if(e.ctrlKey && (e.keyCode==67 || e.keyCode==86)){
		return false
	}
};
document.getElementById('bankAccountAgain').oncontextmenu=function(){
	return false
};
document.getElementById('bankAccountAgain').onkeydown=function(e){
	e = (e) ? e : window.event;
	if(e.ctrlKey && (e.keyCode==86 || e.keyCode==67)){
		return false
	}
}
	 
</script>