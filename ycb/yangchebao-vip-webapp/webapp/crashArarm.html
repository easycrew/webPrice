<style>
    .hDiv table th, .bDiv table td, .hDiv table td .bDiv table th{text-align:center;}
    
    .earth-title{height:50px;line-height: 50px;background:#9EB1CF;overflow: hidden;color:#fff;font-size:14px;}
    .earth-title img{float:left;margin:12px 10px 0 20px;}
    .peonum{float:left;}
    .point{float:right;margin-right:30px;cursor: pointer;}
    .earth-title span i{font-style: normal;}

    #Wraper_crash_alarm  #y_map img{
       max-width: none;
    }
</style>
<div class="urlContentWraper" id="Wraper_crash_alarm">
    <div class="ui-info-layout">
        <div class="ydiv">
            <div class="earth-title" style="padding-left:20px;">
                <span class="peonum">碰撞车辆地图</span>
                <span class="point">收起∧</span>
            </div>
            <div id="y_map" style="height:500px;min-width:600px;margin:0 auto 20px;border:1px solid #666;"></div>
        </div>
        <div class="vdiv">
            <table id="Table_crash_alarm"></table>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function() {
        var bData = $.jRadGet({
            url:'/vip-ws/ws/0.1/businessShake/queryMapInfo?businessInfoId='+carsmart_config.businessInfoId
        });
        var shopInfoItem =$.jRadGet({
             url : "/vip-ws/ws/0.1/business/queryBasicInfo?shopAccountId="+carsmart_config.shopId
        });
        if(shopInfoItem){
            var baiduLa = shopInfoItem.baiduLatitude;//纬度
            var baidulo = shopInfoItem.baiduLongtitude;//经度
        }

        var map = new BMap.Map("y_map");
        map.enableScrollWheelZoom(true);   
        var point = new BMap.Point(baidulo, baiduLa);  
        map.centerAndZoom(point, 13); 

        var carIcon = new BMap.Icon("userManage/map-car.png", new BMap.Size(24, 30), {anchor: new BMap.Size(12, 15)}); 
        if(bData){
            $.each(bData,function(i){
                var item = bData[i]
                var markerList = new BMap.Marker(new BMap.Point(item.longitude,item.latitude),{
                     icon: carIcon
                });
                map.addOverlay(markerList);
            })
        } 

        $(".earth-title").delegate(".point","click",function(){
            $("#y_map").slideToggle();
            if($(this).html() == '收起∧'){
                $(this).html("展开∨");
            }else{
                $(this).html("收起∧");
            }
        });

        var wraper = $('#Wraper_crash_alarm');
        var page_column_model = new Array();

        var entityModel = {};
        var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});
       
        //page_column_model.push({display: '客户id', name : 'userInfoId',hidden:true});
        page_column_model.push({display: '告警时间', name : 'warnTime'});
        page_column_model.push({display: '车牌号', name : 'plateNumber'}); 
        page_column_model.push({display: '车系', name : 'model'});
        page_column_model.push({display: '车主姓名', name : 'ownerName'});
        page_column_model.push({display: '电话', name : 'mobile'});
        page_column_model.push({display: '车况', name : 'warnCnt'}); 
        page_column_model.push({display: '告警位置', name : 'warnAddress'});

        $('#Table_crash_alarm').flexigrid({
            reload: true,
            pagination: {diaplay_pages: 10,align:'bottom',showText: '从第_start_到_end_项 共_total_项'},
            colModel: page_column_model,
            pagedStyle: 'oc',
            method:'get',
            showSearch:true,
            showCheckbox: false, 
            overflow:true,
            checkBoxType:'single',
            onError:showError2,
            url:'/vip-ws/ws/0.1/businessShake/queryShakeList?&businessInfoId='+carsmart_config.businessInfoId
        });

        //$('.vdiv .hDiv tr th').eq(0).attr("style","display:none;")

        function showError2(xhr){
            var errormsg = eval("(" + xhr.responseText + ")");
            var vdiv = $("#Wraper_crash_alarm  .vdiv");
            $.jRadMessage({level:'error',message:errormsg[0].message,selector:vdiv});
        }

        $('.tDiv',wraper).before('<span style="margin:0 20px 0 14px;font-size:15px;float:left;line-height:60px;">碰撞告警列表</span>');
        

    });
</script>