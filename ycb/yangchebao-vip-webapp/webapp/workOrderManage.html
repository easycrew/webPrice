<meta name="renderer" content="webkit">
<style>
    #Wraper_workOrder_manage #Form_workOrder_manage .regist{display:none;}
     /*#Wraper_workOrder_manage table th,#Wraper_workOrder_manage table td{
        text-align: center;
     }*/
    .hDiv table th, .bDiv table td, .hDiv table td .bDiv table th{text-align:center;}
    input[type="checkbox"], input[type="radio"] {height: 18px;opacity: 1;position: static;width: 18px;z-index: 12;}
    #Form_workOrder table tr th, #Form_workOrder table tr td {border: 1px solid #DFE3EC;border-right:none;border-left:none;/*text-align: left;*/}
    /*table tr td{text-align: center;}*/
    /* 车系 */
    .ul-letters { float: left;}
    .uperCase{ border: 1px solid #bfbfbf;color: #505050;cursor: pointer;height: 20px;line-height: 20px;margin: 1px 6px 3px 0px;text-align: center;width: 20px;float: left;}
    .ul-letters .active {border: 2px solid #3ea5f4;height: 16px;line-height: 16px;width: 16px;}
    .brand-letter {overflow: hidden;padding: 5px 0 5px;}
    .car-list{overflow:hidden;margin-left:14px;}
    .car-list li{float:left;padding:5px 15px;margin:8px 5px 5px 5px;margin-right:18px;display:inline;text-align:center;height:28px;line-height:28px;border:1px solid #ccc;cursor:pointer;}
    .last{display:none;float:left;border:1px solid #ccc;padding:5px;overflow:hidden;}
    .last span{float:left;margin-top:1px;}
    .last a{ border: none;color: #fff;cursor: pointer;background:#2f8ac8;float: left;height: 20px;line-height: 20px;margin: 1px 3px 3px 3px;text-align: center;width:20px;}
    .last a:hover{text-decoration:underline;}
    /* 车系 */
    /*.ycb-table{width:0 auto;}*/
    .ycb-table tr{/*height:64px;line-height:64px;*/}
    .ycb-table thead tr{height:90px;}
    .ycb-table tr td{word-break:break-all}
    .ycb-table tr td, .ycb-table tr{height:64px;overflow: hidden;}
    .ycb-table tbody tr input[type="text"]{background:#F4F7FC; /*width:195px;*/width:65%; height:30px;border:none;margin-left:20px;color:#333;}
    .ycb-table tbody tr textarea{background:#F4F7FC; width:50%; height:90px;margin:20px;border:none;color:#333;}
    .tab-title{text-align: center;font-size: 28px;color:#9EA6B4;font-weight: bold;background:#9eb1cf;}
    .tab-title p{margin:0;}
    .tab-title .title-p1{margin-top:18px;line-height:30px;height:30px;}
    .tab-title .title-p2{line-height:42px;height:42px;}
    .tab-title p span{color:#fff;}
    /*.tab-title p .return{}*/
    .tab-title p .f-right{float:right;margin-right:20px;border:1px solid #D0D8E3;color:#4A6DA7;padding:9px 15px;height:10px;line-height:10px;cursor:pointer;font-size:16px;background: #fff;color:#4a6da7;}
    .row1 label, .row1 i{font-size:20px;/*color:#9EA6B4;*/color:#666;/*margin-left:33px;*/display:inline-block;}
    .row1 i{font-style: normal;}
    .row1 span{font-size:20px;color:#9EA6B4;margin-left:15px;margin-right:30px;vertical-align: middle;}
    /* 模拟radion */
    .checkbox{width: 26px;height: 26px;display: block;float: none;background:url(css/images/2check.png)  0 0 no-repeat;cursor: pointer;position: absolute;top: 2px;left: 0;}
    .checkbox-con{display:inline-block;padding:0;}
    .checkbox-con .cur{background:url(css/images/1check.png) 0 0 no-repeat;}
    .checkbox-con span{display: inline-block;position: relative;padding-left: 28px;margin-right: 10px;line-height:30px;}
    .checkbox-con .ipt-hide{position: absolute;width: 0;height: 0;border: none;}
    .checkbox-con span{vertical-align: middle;}
    /* 模拟end */
    /*.row1 td{white-space:nowrap;}
    .row1 td label, .row1 td span{white-space:nowrap;} word-wrap: break-word;word-break: normal; */
    /*.nowrap td, .nowrap td label, .nowrap td span{white-space:nowrap;}*/
    .row2 input[type="text"]{margin-right:20px;}
    .row2 span{margin:0;line-height: 0}
    .row1 .ycb-button{display:block;background:#9EB1CF; width:110px;line-height:33px;text-align: center;height:33px;font-size:30px;color:#fff;cursor:pointer;display:inline-block;margin:0;}
    .ycb-div4 em{font-style: normal;}
    .ycb-tu{position: absolute;cursor:pointer;display:block;filter:alpha(opacity=40);-moz-opacity:0.4;opacity: 0.4;z-index:105;background: #fff;}
    .tu1{width:50px;height:60px;top:40px;left:0px;}
    .tu2{height: 35px;left: 15px;top: 100px;width: 80px;}
    .tu3{height: 35px;left: 15px;top: 5px;width: 80px;}
    .tu4{height: 40px;left: 110px;top: 100px;width: 80px;}
    .tu5{height: 40px;left: 110px;top: 5px;width: 80px;}
    .tu6{width:50px;height:60px;top:40px;left:304px;}
    .tu7{height: 40px;left: 265px;top: 100px;width: 80px;}
    .tu8{ height: 40px;left: 265px;top: 5px;width: 80px;}
    .tu9{height: 40px;left: 187px;top: 100px;width: 80px;}
    .tu10{height: 40px;left: 187px;top: 5px;width: 80px;}
    .round{width:16px;height:16px;display: inline-block;font-size:50px;line-heigth:16px;text-align:center;color:red;text-decoration:none;position: absolute;left:50%;top:50%;margin-left:-18px;margin-top:-16px;z-index:10000;filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;}
    .round:hover{text-decoration: none;}
    .ycb-div5 span{font-size:18px;}
    .comData .input-wrap{border:none;background:none;height:0px;padding:0;}
    .comData .input-wrap input{background-color: #f4f7fc !important;margin-left:0 !important;margin-top:-10px;padding:3px;}
    .add-on{display:none;}
    .reason{text-align: center;}
    .table-condensed tr td, .table-condensed tr th{color:#333;}
    .tab-title .fl{float: left;font-size:14px;margin-left:25px;}
    .tab-title .fr{float: right;font-size:14px;margin-right:25px;}
    #Form_workOrder table .tr-border td{border:1px solid #DFE3EC;}
    .tr-bg{background: #f7f8fc;}
    .tr-center td{text-align: center;}
    .tr-center em{font-style: normal;color:#2e89fb;font-size:15px;margin: 0 5px;vertical-align:middle;cursor:pointer;}
    .ycb-table tbody tr td input.manage-sign{background:none;border:none;border-bottom:1px solid #cfd1db;width:200px;}
    .pro-sevrice{color:#a2aab7;margin:30px 0 0px 90px;}
    .pro-sevrice p{padding-left:37px;margin:0;}
    #part-table{border:1px solid #cfd1db;}
    #part-table tr{height:40px;}
    #part-table tr th{background: #dfe3ec;text-align: center;color:#5d6f8f;border:1px solid #cfd1db;}
    #part-table tr td{text-align: center;color:#5d6f8f;border:1px solid #cfd1db;}
    #part-table tr td span{color:#2e83f9;cursor: pointer;}
    /* 弹窗 */
    .ybs-yuangong-select, .ybs-gongshi-select{width:1000px;background: #dfe3ec;position:fixed;z-index: 99999;left:50%;/*top:50%;*/top:10px;bottom:10px;margin:20px 0 20px -500px;overflow:hidden;}
    .alert-head{height:40px;padding:0 30px;overflow: hidden;line-height:40px;background: #2e83f8;}
    .alert-head span{float:left;font-size:16px;color:#fff;}
    .alert-head a{float:right;width:21px;height:21px;background:url(./img/y-colse.png) 0 0 no-repeat;margin-top:10px;}
    .ycb-alert-wrap{padding:35px;overflow-y:auto;}
    /*.ybs-yuangong-select .y-h2{color:#1d77f2;font-size:18px;text-align: center;padding:20px 33px 0 33px;}*/
    .drag{position:fixed;width:100%;height:100%;left:0;top:0;filter:;background: #000;z-index:99990;filter:alpha(opacity=70);-moz-opacity:0.7; opacity: 0.7;}
    .employSel{width:200px;height:30px;}
    .button-yuangong, .button-gongwei{width:100px;height:30px;border:none;background: #2e83f9;line-height:30px;text-align: center;color:#fff;margin-left:20px;}
    .workUl{/*margin:30px 38px 30px 30px;*/margin:15px 38px 15px 0px;}
    .workUl li{border:1px solid #c3ddfe;float:left;margin:2px 6px;height:33px;line-height:33px;background: #9eb1cf url(css/images/cntbg.png) 0 0 repeat-x;padding:0 18px;/*color:#5678c0;*/color:#000;font-size:14px;cursor:pointer;}
    .workUl .t-active{background:#2e83f9;color:#fff;}
    .workUl .getClrea{float:right;}
    /*.ycbTable, .ycbMech{margin:0 30px;}*/
    .ycbTable, .ycbMech{position: relative;background: #fff;}
    .ycbTable table td, .ycbTable table th, .ycbMech table td, .ycbMech table th{text-align: center;border:1px solid #ccc;}
    .ycbTable table thead tr, .ycbMech table thead tr{background:#DFE3EC;border:1px solid #A3AECD;height:32px;}
    .ycbTable table thead tr th, .ycbMech table thead tr th{font-family:"STHeitiSC-Light";font-size:14px;color:#5D6F8F;}
    .rowcolor{background:#DFE3ED;border:1px solid #9EB1CF;font-size:16px;}
    .ycbTable input[type="radio"], .ycbMech input[type="radio"]{position: static;filter:alpha(opacity=100);-moz-opacity:1; opacity: 1;}
    .ycbTable label, .ycbMech label{display:inline-block;}
    .warpDiv, .warpDiv2{background:#F7F8FC;position: absolute;text-align: center;}
    .warpDiv div, .warpDiv2 div{word-wrap:break-word;word-break:normal;word-break:break-all;}
    .trurBtn{width:86px;height:32px;line-height:32px;text-align: center;color:#a6aab4;border:1px solid #c3ddfe;}
    .employInput{height:32px;line-height:32px;padding:0 3px;width:193px;border:none;margin:0 0px 0 50px;}
    .warpDiv{position: absolute;}

    .d1{border-top:35px #9eb1cf solid;border-left:170px #dfe3ed solid;width:0;height:0;position:relative;color:#FFF;padding:0;}
    .d1 span{display:block;width:40px;}
    .s1{position:absolute;top:-30px;left:-54px;color:#666;}
    .s2{position:absolute;bottom:3px;right:120px;color:#666;}

    #table_workOrder_jiesuan_workid td{border: none;}
    .jiesuan-p{margin-top:40px;text-align: center;font-size:14px;}
    .jiesuan-btn{margin:10px auto;width:250px;font-size:14px;background: #2f8ac8;padding:10px;color:#fff;display:block;text-align: center;cursor: pointer;}
    .succAndErr{margin-left:15px;font-size:14px;}
    .succAndErr span{margin-right:15px;}
    .qulityName{width:120px;}
    .row1 .workPlay{border: 1px solid #c3ddfe;color: blue;height: 32px;line-height: 32px;text-align: center;width: 86px;}
    .getCash{width:80px;display:inline-block;}
    .partHistory tr{height:40px;}
    .part_title{background: #9EA6B4;color: #fff;height:40px;line-height:40px;padding-left:30px;margin-top:20px;font-size:16px;font-weight: bold;}
    #Table_accountdetail th, #Table_accountdetail td, #Table_accountdetail2 th, #Table_accountdetail2 td{text-align: center;}
    #Table_accountdetail th, #Table_accountdetail2 th{background: #9eb1cf}

    .part-updata, .part-delete{white-space:nowrap;}
    .em-updata-name, .em-updata-gongwei, .em-delete{white-space:nowrap;}
    
</style>
<script src="js/jquery.PrintArea.js" type="text/JavaScript" language="javascript"></script>
<div class="urlContentWraper" id="Wraper_workOrder_manage">
    <div class="ui-info-layout" id="jrad-table">
        <div class="vdiv">
            <table id="Table_workOrder_manage"></table>
        </div>
        <div class="ydiv">
            <table id="Table_workOrder_resrve"></table>
        </div>
    </div>
    <div class="details-box" style="display:none;">
        <div class="details-content">
            <div class="details-scroll">
                <div class="details-content-inner">
                    <div class="grid-layout ui-form" id="Form_workOrder" style="padding-bottom:50px;">
                        <div class="jrad-form">  
                            <div class="grid-layout-main">
                                <table class="ycb-table" style="margin:0 auto;">
                                    <thead>
                                        <tr>
                                            <th colspan="12" class="tab-title clearfix">
                                                <p class="title-p1"><span>养车宝工单</span><span class="return f-right">返回</span><!-- <span class="print f-right">打印</span> --></p>
                                                <p class="title-p2"><span class="fl shop-name"></span><span class="fl shop-addre"></span><span class="fl shop-phone"></span><span class="fr work-status"></span><span class="fr work-number"></span></p>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="row1 nowrap car-emp">
                                            <td colspan="2" style="text-align:right;"><label><span class="ui-form-required" style="margin-right:0;color:red;">*</span>车主电话</label></td>
                                            <td colspan="2" align="left"><input type="text" name="mobile" class="car-mobile" style="width:150px;"></td>
                                            <td colspan="2" style="text-align:right;"><label class="carInfoId">车主姓名</label></td>
                                            <td colspan="2" align="left"><input type="text" class="car-name" style="width:150px;" disabled></td>
                                            <td colspan="2" style="text-align:right;"><label><span class="ui-form-required" style="margin-right:0;color:red;">*</span>车型</label></td>
                                            <td colspan="2" align="left"><input type="text" class="car-style" style="width:150px;" disabled></td>
                                        </tr>
                                        <tr class="row1 nowrap car-emp">
                                            <td colspan="2" style="text-align:right;"><label><span class="ui-form-required" style="margin-right:0;color:red;">*</span>车牌号码</label></td>
                                            <td colspan="2" align="left"><input type="text" class="car-plateNumber" style="width:150px;" disabled></td>
                                            <td colspan="2" style="text-align:right;"><label>车架号</label></td>
                                            <td colspan="2" align="left"><input type="text" class="car-vinNumber" style="width:150px;" disabled></td>
                                            <td colspan="2" style="text-align:right;"><label>发动机号</label></td>
                                            <td colspan="2" align="left"><input type="text" class="car-machineNumber" style="width:150px;" disabled></td>
                                        </tr>
                                        <tr class="row1 nowrap">
                                            <td colspan="2" style="text-align:right;">
                                                <label>
                                                    <span class="ui-form-required" style="margin-right:0;color:red;">*</span>进厂公里数
                                                </label>
                                            </td>
                                            <td colspan="1" style="text-align:left;">
                                                <input type="text" name="carKm" class="car-carKm" style="width:150px;">
                                            </td>
                                            <td colspan="1" style="text-align:right;">
                                                <label>
                                                    <span class="ui-form-required" style="margin-right:0;color:red;">*</span>油表显示
                                                </label>
                                            </td>
                                            <td colspan="2" style="text-align:right">
                                                <div class="checkbox-con ycb-div1">
                                                    <span>
                                                        <input type="radion"  name="ycb1" class="ipt-hide">
                                                        <strong class="checkbox"></strong>0
                                                    </span>
                                                    <span>
                                                        <input type="radion" name="ycb1" class="ipt-hide">
                                                        <strong class="checkbox"></strong>1/4
                                                    </span> 
                                                    <span>
                                                        <input type="radion" name="ycb1" class="ipt-hide">
                                                        <strong class="checkbox cur"></strong>1/2
                                                    </span>
                                                    <span>
                                                        <input type="radion" name="ycb1" class="ipt-hide">
                                                        <strong class="checkbox"></strong>3/4
                                                    </span> 
                                                    <span>
                                                        <input type="radion" name="ycb1" class="ipt-hide">
                                                        <strong class="checkbox"></strong>1
                                                    </span>                           
                                                </div>
                                            </td>
                                            <td colspan="1" style="text-align:center;"><label><span class="ui-form-required" style="margin-right:0;color:red;">*</span>内饰是否损伤</label></td>
                                            <td colspan="2" style="text-align:left">
                                                <div class="checkbox-con ycb-div2">
                                                    <span>
                                                        <input type="radion"  name="ycb2" class="ipt-hide">
                                                        <strong class="checkbox"></strong>是
                                                    </span>
                                                    <span>
                                                        <input type="radion" name="ycb2" class="ipt-hide">
                                                        <strong class="checkbox cur"></strong>否
                                                    </span>                            
                                                </div>
                                            </td>
                                            <td colspan="1" style="text-align:right;">
                                                <label>
                                                    <span class="ui-form-required" style="margin-right:0;color:red;">*</span>
                                                    赠送洗车
                                                </label>
                                            </td>
                                            <td colspan="2" style="text-align:left;">
                                                <div class="checkbox-con ycb-div3">
                                                    <span>
                                                        <input type="radion"  name="ycb3" class="ipt-hide">
                                                        <strong class="checkbox"></strong>是
                                                    </span>
                                                    <span>
                                                        <input type="radion" name="ycb3" class="ipt-hide">
                                                        <strong class="checkbox cur"></strong>否
                                                    </span>                            
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="row1 nowrap">
                                            <td colspan="2" style="text-align:right;">
                                                <label><span class="ui-form-required" style="margin-right:0;color:red;">*</span>机电设备是否故障</label>
                                            </td>
                                            <td colspan="2" align="left">
                                                <div class="checkbox-con ycb-div7">
                                                    <span>
                                                        <input type="radion"  name="ycb7" class="ipt-hide">
                                                        <strong class="checkbox"></strong>是
                                                    </span>
                                                    <span>
                                                        <input type="radion" name="ycb7" class="ipt-hide">
                                                        <strong class="checkbox cur"></strong>否
                                                    </span>                           
                                                </div>
                                            </td>
                                            <td colspan="2" style="text-align:right;">
                                                <label>
                                                    <span class="ui-form-required" style="margin-right:0;color:red;">*</span>排队时间
                                                </label>
                                            </td>
                                            <td colspan="2" align="left">
                                                <div class="checkbox-con ycb-div5">
                                                    <span>
                                                        <input type="radion"  name="ycb5" class="ipt-hide">
                                                        <strong class="checkbox cur"></strong>0
                                                    </span>
                                                    <span>
                                                        <input type="radion" name="ycb5" class="ipt-hide">
                                                        <strong class="checkbox"></strong>0-30分钟
                                                    </span>  
                                                    <span>
                                                        <input type="radion" name="ycb5" class="ipt-hide">
                                                        <strong class="checkbox"></strong>30分钟以上
                                                    </span>                            
                                                </div>
                                            </td>
                                            <td colspan="2" style="text-align:right;">
                                                <label>
                                                    <span class="ui-form-required" style="margin-right:0;color:red;">*</span>客户是否取回废件
                                                </label>
                                            </td>
                                            <td colspan="2" align="left">
                                                <div class="checkbox-con ycb-div6">
                                                    <span>
                                                        <input type="radion"  name="ycb6" class="ipt-hide">
                                                        <strong class="checkbox"></strong>是
                                                    </span>
                                                    <span>
                                                        <input type="radion" name="ycb6" class="ipt-hide">
                                                        <strong class="checkbox cur"></strong>否
                                                    </span>                            
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="row1">
                                            <td colspan="2" style="text-align:center;">
                                                <label>
                                                    客户服务内容陈述
                                                </label>
                                            </td>
                                            <td colspan="4" style="border-right:1px solid #DFE3EC">
                                                <textarea class="repairDiscription" style="width:230px;"></textarea>
                                            </td>
                                            <td colspan="1" style="text-align:center;">
                                                <label>外观检查</label>
                                            </td>
                                            <td colspan="5">
                                                <div style="position:relative;flaot:left;">
                                                    <img src="css/images/select-car.png" style="width:348px;height:142px;">
                                                    <!-- <div class="isIE" style="width:348px;height:142px;position:absolute;left:50%;top:50%;padding:0;margin:-71px 0 0 -174px;z-index:100">  -->
                                                    <div class="isIE" style="width:348px;height:142px;position:absolute;left:10px;top:10px;padding:0;z-index:100"> 
                                                    <em class="ycb-tu tu1">
                                                        <a href="###" class="round" style="filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;">●</a> 
                                                    </em>
                                                    <em class="ycb-tu tu2">
                                                        <a href="###" class="round" style="filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;">●</a>
                                                    </em>
                                                    <em class="ycb-tu tu3">
                                                        <a href="###" class="round" style="filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;">●</a>
                                                    </em>
                                                    <em class="ycb-tu tu4">
                                                        <a href="###" class="round" style="filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;">●</a>
                                                    </em>
                                                    <em class="ycb-tu tu5">
                                                        <a href="###" class="round" style="filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;">●</a>
                                                    </em>
                                                    <em class="ycb-tu tu6">
                                                        <a href="###" class="round" style="filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;">●</a>
                                                    </em>
                                                    <em class="ycb-tu tu7">
                                                        <a href="###" class="round" style="filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;">●</a>
                                                    </em>
                                                    <em class="ycb-tu tu8">
                                                        <a href="###" class="round" style="filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;">●</a>
                                                    </em>
                                                    <em class="ycb-tu tu9">
                                                        <a href="###" class="round" style="filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;">●</a>
                                                    </em>
                                                    <em class="ycb-tu tu10">
                                                        <a href="###" class="round" style="filter:alpha(opacity=50);-moz-opacity:0.5;opacity: 0.5;">●</a>
                                                    </em>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="row1 tr-border tr-bg tr-center">
                                            <td rowspan="2" colspan="1">
                                                <label>关联订单</label>
                                            </td>
                                            <td rowspan="2" colspan="1" style="white-space:nowrap;">
                                                <label>施工技师</label>
                                            </td>
                                            <td rowspan="2" colspan="2">
                                                <label>工位及时间</label>
                                            </td>
                                            <td rowspan="2" colspan="2">
                                                <label>服务名称</label>
                                                <em class="em-add">添加</em>
                                            </td>
                                            <td colspan="4">
                                                <label>配件(配件费)</label>
                                                <em class="em-edit">编辑</em>
                                                <i class="em-history" style="float:right;margin-right:20px;font-size:14px;color:#2e89fb;cursor:pointer;">配件历史</i>
                                            </td>
                                            <td rowspan="2" colspan="1">
                                                <label>工时费</label>
                                            </td>
                                            <td rowspan="2" colspan="1">
                                                <label>结算金额</label>
                                            </td>
                                        </tr>
                                        <tr class="row1 tr-border tr-bg tr-center" id="tab-top">
                                            <td>
                                                <label>配件名称</label>
                                            </td>
                                            <td>
                                                <label>单价(元)</label>
                                            </td>
                                            <td>
                                                <label>数量</label>
                                            </td>
                                            <td>
                                                <label>金额(元)</label>
                                            </td>
                                        </tr>
                                        <tr class="row1 tr-border tr-center cntTr">
                                            <td colspan="1">
                                                <label>合计</label>
                                            </td>
                                            <td colspan="1">
                                                <label></label>
                                            </td>
                                            <td colspan="2">
                                                <label></label>
                                            </td>
                                            <td colspan="2">
                                                <label></label>
                                            </td>
                                            <td colspan="1">
                                                <label></label>
                                            </td>
                                            <td colspan="1">
                                                <label></label>
                                            </td>
                                            <td colspan="1">
                                                <label class="heji1"></label>
                                            </td>
                                            <td colspan="1">
                                                <label class="heji2"></label>
                                            </td>
                                            <td colspan="1">
                                                <label class="heji3"></label>
                                            </td>
                                            <td colspan="1">
                                                <label class="heji4"></label>
                                            </td>
                                        </tr>
                                        <tr class="row1">
                                            <td colspan="2" style="text-align:right;"><label>进厂时间</label></td>
                                            <td colspan="2" align="left"><input type="text" class="carComeTime" style="width:150px;"></td>
                                            <td colspan="2" style="text-align:right;"><label>预计交车时间</label></td>
                                            <td colspan="2" align="left"><input type="text" class="expectCarTime" style="width:150px;"></td>
                                            <td colspan="2" style="text-align:right;"><label>客户签字</label></td>
                                            <td colspan="2" align="left"><input type="text" class="manage-sign"></td>
                                        </tr>
                                        <tr class="row1 tr-center">
                                            <!-- <td rowspan="2" colspan="6">
                                                <label>服务建议</label>
                                                <textarea class="faultOrOption" style="width:230px;"></textarea>
                                            </td> -->
                                            
                                            <td rowspan="2" colspan="2" style="text-align:center;">
                                                <label>服务建议</label>
                                            </td>
                                            <td rowspan="2" colspan="4" style="text-align:left;">
                                                <textarea class="faultOrOption" style="width:230px;"></textarea>
                                            </td>
                                            <td colspan="1" style="border-right:1px solid #DFE3EC;border-left:1px solid #DFE3EC">
                                                <label>质检信息</label>
                                            </td>
                                            <td colspan="5">
                                                <label class="lab-complet">完工时间：</label>
                                                <span class="completeDate"></span>
                                                <label>质检员：</label>
                                                <!-- <select class="qulityName"></select> -->
                                                <span class="qualityPeopleName"></span>
                                            </td>
                                        </tr>
                                        <tr class="row1 tr-center">
                                            <td colspan="1" style="border-right:1px solid #DFE3EC;border-left:1px solid #DFE3EC">
                                                <label>结算信息</label>
                                            </td>
                                            <td colspan="5">
                                                <label class="lab_getCash">收银员：</label>
                                                <label class="getCash"></label>
                                                <input type="submit" value="结算" class="workPlay">
                                            </td>
                                        </tr> 
                                    </tbody>
                                </table>
                                <!-- 配件历史 -->
                                <div class="partHistory">
                                    <div class="ui-info-layout">
                                        <!-- <div class="sdiv" style="margin-top:20px;">
                                            <table id="Table_partHitory_old"></table>
                                        </div>
                                        <div class="zdiv" style="margin-top:20px;">
                                            <table id="Table_partHitory_new"></table>
                                        </div> -->
                                        <div class="part_title">原配件內容</div>
                                        <table id="Table_accountdetail">
                                            <tr>
                                                <th>工单号</th>
                                                <th>服务名称 </th>
                                                <th>配件名称</th>
                                                <th>单价</th>
                                                <th>数量</th>
                                                <th>结算金额</th>
                                            </tr>
                                        </table>
                                        <div class="part_title">配件修改历史</div>
                                        <table id="Table_accountdetail2">
                                            <tr>
                                                <th>服务名称</th>
                                                <th>配件名称</th>
                                                <th>单价</th>
                                                <th>数量</th>
                                                <th>结算金额</th>
                                                <th>配件差价</th>
                                                <th>操作时间</th>
                                            </tr>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="jrad-buttons-container ui-buttons-container" style="position:relative;height:100px;"> 
                            <button class="btn btn-small btn-primary jrad-btn-primary addBtn" style="position:absolute;margin-left:-24px;left:50%;top:50%;margin-top:-10px;">保存全部</button>
                            <button class="btn btn-small btn-primary jrad-btn-primary updateBtn" style="position:absolute;margin-left:-24px;left:50%;top:50%;margin-top:-10px;">保存修改</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="Form_detail_info" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid">
                <div class="span25 grid-layout-content">
                    <div class="grid-row-fluid">
                        <label class="span3 grid-layout-label"></label>
                        <div class="span20 grid-layout-content">
                            <div name="offerType" class="jrad-radio-container">
                            </div>
                        </div>
                    </div>
                    <div class="grid-row-fluid ser">
                        <label class="span6 grid-layout-label">服务名称：</label>
                        <div class="span14 grid-layout-content">
                            <div name="serviceId" class="jrad-select-container"></div>
                            <p style="display:none;color:#f00;">请选择服务名称</p>
                        </div>
                    </div>
                    <div class="grid-row-fluid answerList1 act" style="display:none">
                        <label class="span6 grid-layout-label">一级系统：</label>
                        <div class="span14 grid-layout-content">
                            <div name="s1" class="jrad-select-container"></div>
                        </div>
                    </div>
                    <div class="grid-row-fluid answerList2 act" style="display:none">
                        <label class="span6 grid-layout-label">二级系统：</label>
                        <div class="span14 grid-layout-content">
                            <div name="s2" class="jrad-select-container"></div>
                        </div>
                    </div>
                    <div class="grid-row-fluid answerList3 act" style="display:none">
                        <label class="span6 grid-layout-label">部位：</label>
                        <div class="span14 grid-layout-content">
                            <div name="s3" class="jrad-select-container"></div>
                        </div>
                    </div>
                    <div class="grid-row-fluid answerList3 act" style="display:none">
                        <label class="span6 grid-layout-label">所需工时：</label>
                        <div class="span14 grid-layout-content">
                            <div name="workHour" class="jrad-input-container"></div>
                        </div>
                    </div>
                    <div class="grid-row-fluid other-service" style="display:none">
                        <label class="span6 grid-layout-label">其他项目：</label>
                        <div class="span14 grid-layout-content" placeholder="请输入项目名称">
                            <div name="serviceName" class="jrad-input-container"></div>
                        </div>
                    </div>
                    <div class="grid-row-fluid other-service" style="display:none">
                        <label class="span6 grid-layout-label">所需工时：</label>
                        <div class="span14 grid-layout-content" placeholder="请输入所需工时">
                            <div name="workHour" class="jrad-input-container"></div>
                        </div>
                    </div>
                    <div class="grid-row-fluid number-service" style="display:none">
                        <label class="span6 grid-layout-label">订单编号：</label>
                        <div class="span14 grid-layout-content">
                            <div name="orderNumber" class="jrad-input-container"></div>
                        </div>
                    </div>
                    <p class="notip" style="display:none;color:#f00;padding-left:132px;">请选择部位</p>
                    <p class="hideserid" style="color:#fff;"></p>
                    <div class="pro-sevrice">
                        <div>说明：1、洗车、保养、美容、维修为店铺在养车宝创建的服务，工时费、结算金额不可修改；</div>
                        <p>2、施工部位：直接选择施工的车辆部位，工时费、结算金额自行设置；</p>
                        <p>3、其它项目：服务名称、工时费、结算金额都自行写入；</p>
                        <p>4、已有订单：输入已有的订单编号，服务名称、工时费、结算金额都自行写入。</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确定</button>
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div> 

    <div id="work_reason" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid">
                <div class="span24 grid-layout-content">
                    <div class="reason"></div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div> 

    <div id="Form_customer_add" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid"> 
                <p class="note" style="padding-left:85px;color:#ff0000;">此客户暂无基本信息，请先输入基本信息。</p>
                <label class="span5 grid-layout-label" style="margin-left:0;"><span class="ui-form-required">*</span>姓名：</label>
                <div class="span8 grid-layout-content fluid-wrap">
                    <div name="userName" class="jrad-input-container" placeholder="例：李先生、刘备">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>手机：</label>
                <div class="span8 grid-layout-content fluid-wrap">
                    <div name="mobile" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid time">
                <label class="span5 grid-layout-label">生日：</label>
                <div class="span8 grid-layout-content fluid-wrap">
                    <div name="birthday" class="jrad-dateinput-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">家庭住址：</label>
                <div class="span8 grid-layout-content fluid-wrap">
                    <div name="familyAddress" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次服务时间：</label>
                <div class="span8 grid-layout-content fluid-wrap">
                    <div name="lastServiceTime" class="jrad-dateinput-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次回访时间：</label>
                <div class="span8 grid-layout-content fluid-wrap">
                    <div name="lastVisitTime" class="jrad-dateinput-container">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">下一步</button>
            <!-- <button class="jrad-btn-normal btn btn-small btn-default">取消</button> -->
        </div>
    </div> 

    <div id="Form_customer_add_userCar" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div name="brands"></div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label"><span class="ui-form-required">*</span>车系：</label>
                <div class="span15">
                    <div class="searchBox" id="searchBox">
                        <div class="brand" id="brand_show">
                            <div class="brand-letter">
                                <span class="condition-title">按字母查找</span>
                                <ul class="ul-letters">
                                </ul>
                                <div class="last" style="position:relative;"></div>
                            </div>
                            <ul class="car-list">
                            </ul>
                        </div>
                    </div>
                </div>
            </div> 
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>车牌：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="plateNumber" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>车架号：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="vinNumber" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">发动机号：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="machineNumber" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">底盘号：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="chassisNumber" class="jrad-input-container">
                    </div>
                    <p class="note">养车宝会通过上面3个字段查询违章，以您店铺的名义通知客户。</p>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">购车日期：</label>
                <input name="startDate" id="startDate" class="date-picker" style="width:303px;height:20px;margin-left:6px;padding:4px;" />
                <!-- <div class="span14 grid-layout-content fluid-wrap">
                    <div name="buyDate" class="jrad-dateinput-container">
                    </div>
                </div> -->
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">里程(km)：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="totalMileage" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">是否二手车：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="isUsed" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">颜色：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="color" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">内饰风格：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="interiorStyle" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">几成新：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="percentNew" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">是否改装：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="isRefit" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次保养时间：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="lastMaintainDate" class="jrad-dateinput-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次保养里程：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="lastMaintainMileage" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次年审时间：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="lastLimitedDate" class="jrad-dateinput-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次保险时间：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="lastInsuredDate" class="jrad-dateinput-container">
                    </div>
                    <p class="note">养车宝会通过上面字段判断用户是否需要保养、保险，若需要，会通知客户到您的店铺服务。请尽量填写完整。</p>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确定</button>
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div>  

    <div id="Form_select_car" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form" style="padding-left:50px;">
            <p class="note">请选择需要维修的车辆</p>
            <div class="checkbox-con ycb-div4" id="ycb-div4" style="display:block">                        
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">下一步</button>
        </div>
    </div>

    <div id="Form_edit_Part" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid">  
                <div class="partList">
                    <table id="part-table" border="1">
                        <thead>
                            <tr>
                                <th>服务名称</th>
                                <th>配件名称</th>
                                <th>单价(元)</th>
                                <th>数量</th>
                                <th>金额(元)</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>                       
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确定</button>
            <!-- <button class="jrad-btn-normal btn btn-small btn-default">取消</button> -->
        </div>
    </div>

    <div id="Form_part_caozuo" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid nameInput">
                <label class="span6 grid-layout-label">配件名称：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="partName" class="jrad-input-container">
                    </div>
                    <p>为了方便下次可以直接使用，请在库存模块管理配件吧！</p>
                </div>
            </div>
            <div class="grid-row-fluid nameSelect">
                <label class="span6 grid-layout-label">配件名称：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="commodityId" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span6 grid-layout-label">单价(元)：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="partPrice" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span6 grid-layout-label">数量：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="partNum" class="jrad-input-container">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确定</button>
            <!-- <button class="jrad-btn-normal btn btn-small btn-default">取消</button> -->
        </div>
    </div> 

    <div id="Form_workOrder_jiesuan_workid" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <table id="table_workOrder_jiesuan_workid" style="border:none;"></table>
            <div class="shaMa" style="display:none;">
                <p class="jiesuan-p">打开养车宝客户端扫一扫付款，还需支付178元</p>
                <div style="width:180px;height:150px;margin:10px auto;">
                    <img src="http://172.18.180.11/group1/M00/02/8C/ChfUUVZ4tM-AJlD_AAAcNNhcw3M916.jpg">
                </div>
            </div>
            <p class="jiesuan-p">若客户线下支付，请点击下方按钮确认支付完成</p>
            <bottom class="jiesuan-btn">客户选择线下当面支付<span></span>元</bottom>
        </div>
    </div>

</div>

<div class="ybs-gongshi-select" style="display:none">
    <div class="alert-head"><span>工位工时选择</span><a href="javascript:void(0)"></a></div>
    <div class="ycb-alert-wrap">
        <div class="clearfix"> 
            <button class="trurBtn" style="float:left">确认选择</button>
            <input class="employInput" style="float:left">
            <button class="button-gongwei" style="float:left">查询空闲工位</button>
            <div class="succAndErr" style="float:left;width:420px;"></div>
        </div>
        <div class="ul-gongwei"></div>
        <div class="ycbTable"></div>
    </div>
</div>

<div class="ybs-yuangong-select" style="display:none">
    <div class="alert-head"><span>员工选择</span><a href="javascript:void(0)"></a></div>
    <div class="ycb-alert-wrap">
        <div> 
            <select class="employSel"></select>
            <button class="button-yuangong">确认选择</button>
        </div>
        <ul class="ul-yuangong"></ul>
        <div class="ycbMech"></div>
    </div>
</div>

<div class="drag" style="display:none"><div>

<script type="text/javascript">
$(document).ready(function(){
    //从其他页面跳转过来
    if($.cookie("workId") != null){
        var item = $.cookie("workId")
        editAndInfoCookie(item)
        function editAndInfoCookie(item){
            var dtails = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getWorkOrder?workOrderId='+item});
            $('#jrad-table',wraper).hide();
            $('.details-box',wraper).show();
            $("#btn-scroll-up").click(); 

            $('.shop-name').html(dtails.busiReg);
            $('.shop-addre').html('地址：'+dtails.address);
            if(dtails.serviceTel == ''){
                $('.shop-phone').hide();
            }else{
                $('.shop-phone').show().html('电话：'+dtails.serviceTel);
            }
            if(dtails.workOrderType == ''){
                $('.work-status').hide();
            }else{
                $('.work-status').show().html('工单状态：'+dtails.workOrderType).attr("orderTypeCode",dtails.orderTypeCode);
            }
            if(dtails.workOrderType == "待结算"){
                $(".workPlay").show();
            }else{
                $(".workPlay").hide();
            }

            $('.work-number').html('工单编号：'+dtails.number);
            $('.work-number').attr('workOrderId',dtails.workOrderId)

            $(".car-mobile").val(dtails.mobile);
            $(".car-mobile").attr({disabled:"disabled",userInfoId:dtails.userInfoId});
            $(".carInfoId").attr("carInfoId",dtails.carInfoId)
            $(".car-name").val(dtails.userName)
            $(".car-style").val(dtails.seriesId)

            $(".car-plateNumber").val(dtails.plateNmber)
            $(".car-vinNumber").val(dtails.vinNumber)
            $(".car-machineNumber").val(dtails.machineNumber)
            $(".car-carKm").val(dtails.carKm)
            $(".completeDate").html(dtails.completeDate)
            $(".qualityPeopleName").html(dtails.qualityPeopleName);
            $(".getCash").html(dtails.cashierName)
            $(".partHistory").hide();
            $(".addBtn").hide();
            $(".updateBtn").hide();
            

            $(".ycb-div1 strong").removeClass("cur")
            if(dtails.carOilRemain == 1){
                $(".ycb-div1 strong").eq(0).addClass("cur")
            }else if(dtails.carOilRemain == 2){
                $(".ycb-div1 strong").eq(1).addClass("cur")
            }else if(dtails.carOilRemain == 3){
                $(".ycb-div1 strong").eq(2).addClass("cur")
            }else if(dtails.carOilRemain == 4){
                $(".ycb-div1 strong").eq(3).addClass("cur")
            }else{
                $(".ycb-div1 strong").eq(4).addClass("cur")
            }

            if(dtails.interiorDestory == 0){
                $(".ycb-div2 strong").eq(1).addClass("cur")
            }else{
                $(".ycb-div2 strong").eq(1).removeClass("cur")
                $(".ycb-div2 strong").eq(0).addClass("cur")
            }
            if(dtails.isWash == 0){
                $(".ycb-div3 strong").eq(1).addClass("cur")
            }else{
                $(".ycb-div3 strong").eq(1).removeClass("cur")
                $(".ycb-div3 strong").eq(0).addClass("cur")
            }
            if(dtails.elecDeviceIsDestory == 0){
                $(".ycb-div7 strong").eq(1).addClass("cur")
            }else{
                $(".ycb-div7 strong").eq(1).removeClass("cur")
                $(".ycb-div7 strong").eq(0).addClass("cur")
            }

            $(".ycb-div5 strong").removeClass("cur")
            if(dtails.lineUp == 1){
                $(".ycb-div5 strong").eq(0).addClass("cur")
            }else if(dtails.carOilRemain == 2){
                $(".ycb-div5 strong").eq(1).addClass("cur")
            }else{
                $(".ycb-div5 strong").eq(2).addClass("cur")
            }

            if(dtails.isRetainUsed == 0){
                $(".ycb-div6 strong").eq(1).addClass("cur")
            }else{
                $(".ycb-div6 strong").eq(1).removeClass("cur")
                $(".ycb-div6 strong").eq(0).addClass("cur")
            }

            $(".repairDiscription").val(dtails.repairDiscription);
            $(".faultOrOption").text(dtails.faultOrOption);

            var arr = dtails.appearanceInspectArea.split(",");
            $.each(arr,function(i){
                var item = arr[i]
                if(item == 1){
                    $(".ycb-tu a").eq(i).attr("style","filter:alpha(opacity=100);-moz-opacity:1;opacity:1;");
                }else{
                    $(".ycb-tu a").eq(i).css("style","filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;");
                }
            })

            addAppbody_cookie();

            $("#Form_workOrder .em-add").click(function(){ 
                if($(".car-mobile").val() == ''){
                    $.jRadAlert("请先填写车主电话。","error");
                    return false;
                }else{
                    var _this = $(this) 
                    $(".ser").show(); 
                    $(".act").hide();
                    $(".other-service").hide();  
                    $(".number-service").hide();
                    $("#Form_detail_info",wraper).form({
                        fields:field_params,
                        title:'项目详情',
                        grid: 18,
                        item:{offerType:1},
                        submit:function(){
                            var json = {}
                            json.businessInfoId = carsmart_config.businessInfoId;
                            json.workOrderId = $(".work-number").attr("workorderid")
                            json.userInfoId = $('.car-mobile').attr("userinfoid");
                            json.carInfoId = $(".carInfoId").attr("carInfoId");
                            json.mobile = $(".car-mobile").val();
                            json.offerType = $('#Form_detail_info div[name="offerType"]',wraper).radio('val');
                            json.serviceId = $('.ser div[name="serviceId"]',wraper).select('val');
                            
                            if($('#Form_detail_info div[name="offerType"]',wraper).radio('val') == 7){
                                json.orderNumber = $('.number-service div[name="orderNumber"]',wraper).input('val');
                            }
                            if($('#Form_detail_info div[name="offerType"]',wraper).radio('val') == 5){
                                json.serviceName = $('.act div[name="s3"]').select('val');
                                json.workHour = $('.act div[name="workHour"]').input('val');
                            }
                            if($('#Form_detail_info div[name="offerType"]',wraper).radio('val') == 6){
                                json.serviceName = $('.other-service div[name="serviceName"]').input('val');
                                json.workHour = $('.other-service div[name="workHour"]').input('val');
                            }
                            $.jRadPost({
                                url:'/vip-ws/ws/0.1/busiWorkOrder/addAppointmentOrder',
                                data:json,
                                success:function(data){ 
                                    //var workHourHid = 
                                    addAppbody_cookie();
                                    hejiFn()
                                    $("#Form_detail_info",wraper).form({}).form('close');
                                },
                                error:function(xhr){
                                    var errormsg = eval("(" + xhr.responseText + ")");
                                    $.jRadMessage({message: errormsg[0].message,level: 'error',selector:$("#Form_detail_info .pop-up-middle")})
                                }
                            });
                        }
                    }).form('open');
                }
            })

            $("#Form_workOrder").undelegate('.em-edit','click').delegate('.em-edit','click',function(){
                var workOrderId = $('.work-number').attr('workOrderId')
                $("#Form_edit_Part").form({
                    title:'服务配件表',
                    grid: 18,
                    submit:function(){
                        $.jRadGet({
                            url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId,
                            success:function(data){   
                                $("#Form_edit_Part",wraper).form({}).form('close')
                                addAppbody_cookie()
                                hejiFn()
                            }
                        });
                    }
                }).form('open');
                $("#Form_edit_Part .pop-up-close").click(function(){
                    $("#Form_edit_Part",wraper).form({}).form('close')
                    addAppbody_cookie()
                    hejiFn()
                })
                addAppEditBody()
                function addAppEditBody(){
                    var workOrderId = $(".work-number").attr("workorderid")
                    var partData = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId})
                    var str1 = "";
                    var str2 = "";
                    var str3 = "";
                    var inStr = "";
                    var appId = '';
                    var ars = [];
                    $.each(partData,function(i){
                        var item = partData[i];
                        appId = item.appointmentOrderId;
                        var postListData = item.partsList;
                        if(postListData.length == 0){
                            str1 += '<tr>'
                                + '<td>'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'<br><span class="add-part">添加配件</span>'+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label></label>'
                                +'</td>'
                                + '<td>'
                                    +'<label></label>'
                                +'</td>'
                                + '<td>'
                                    +'<label></label>'
                                +'</td>'
                                + '<td>'
                                    +'<label></label>'
                                +'</td>'
                                + '<td>'
                                +'</td>'
                            +'</tr>'
                        }
                        if(postListData.length == 1){
                            str2 += '<tr>'
                                + '<td>'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'<br><span class="add-part">添加配件</span>'+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+postListData[0].partName+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+postListData[0].partPrice+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+postListData[0].partNum+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+postListData[0].sumPartPrice+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<span class="part-updata" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+postListData[0].partsDetailId+'" commodityId="'+postListData[0].commodityId+'">修改&nbsp;&nbsp;&nbsp;&nbsp;</span>'
                                    +'<span class="part-delete" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+postListData[0].partsDetailId+'" commodityId="'+postListData[0].commodityId+'">删除</span>'
                                +'</td>'
                            +'</tr>'
                        }
                        if(postListData.length >= 2){
                            var lg = postListData.length;
                            $.each(postListData,function(j){
                                var inCont = postListData[j]
                                inStr = '<td>'
                                        +'<label>'+inCont.partName+'</label>'
                                    +'</td>'
                                    + '<td>'
                                        +'<label>'+inCont.partPrice+'</label>'
                                    +'</td>'
                                    + '<td>'
                                        +'<label>'+inCont.partNum+'</label>'
                                    +'</td>'
                                    + '<td>'
                                        +'<label>'+inCont.sumPartPrice+'</label>'
                                    +'</td>'
                                    str3 += '<tr class="edit-creatTr">'
                                        + '<td rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'<br><span class="add-part">添加配件</span>'+'</label>'
                                        +'</td>'
                                        + inStr
                                        + '<td>'
                                            +'<span class="part-updata" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+inCont.partsDetailId+'" commodityId="'+inCont.commodityId+'">修改&nbsp;&nbsp;&nbsp;&nbsp;</span>'
                                            +'<span class="part-delete" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+inCont.partsDetailId+'" commodityId="'+inCont.commodityId+'">删除</span>'
                                        +'</td>'
                                    +'</tr>'
                                
                            })
                        }
                        ars.push(item.appointmentOrderId)
                    })
                    $('#part-table tbody').html("");

                    //$('.edit-creatTr').remove();
                    $('#part-table tbody').append(str1).append(str2).append(str3);
                    //$('#tab-top').after(str1).after(str2).after(str3);
                    $.each(ars,function(i){
                        var aa = ars[i]
                        if($("."+aa).length >=2 ){
                            $("."+aa).hide();
                            $(".edit-creatTr ."+aa).eq(0).show();
                        }
                    })
                }

                $("#Form_edit_Part",wraper).undelegate('.add-part','click').delegate('.add-part','click',function(){
                    var _that = $(this)
                    $("#Form_edit_Part").form({}).form('close')
                    var partEmp = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                    $("#Form_part_caozuo").form({
                        title:'配件操作',
                        grid: 12,
                        item:{},
                        url:'/vip-ws/ws/0.1/busiWorkOrder/addPart',
                        preSubmit:function(json){
                            json.appointmentOrderId = _that.parent().attr('appointmentOrderId')
                            json.workOrderId = $(".work-number").attr("workorderid");
                            if($('.work-status')){
                                json.workOrderStatus = $('.work-status').attr("orderTypeCode")
                            }
                            if($('.nameSelect').is(':visible')){
                                json.partName = $('#Form_part_caozuo div[name=commodityId] span').html();
                            }
                            if($('.nameInput').is(':visible')){
                                json.partName = $('#Form_part_caozuo input[name=partName]').val();
                            }
                            json.shopAccountId = carsmart_config.shopId;
                            json.operatorId = carsmart_config.userId;
                            json.operator = carsmart_config.operatorName;
                            json.saveType = 1;

                            return json
                        },
                        success:function(data){
                            $("#Form_part_caozuo").form({}).form('close')
                            $("#Form_edit_Part").form({}).form('open')
                            addAppEditBody()
                        },
                        error:function(xhr){
                            var errormsg = eval("(" + xhr.responseText + ")");
                            $.jRadMessage({level:'error',message:errormsg[0].message,selector:$("#Form_part_caozuo .pop-up-middle")});
                        }
                    }).form('open')
                    if(partEmp.length == 0){
                        $(".nameSelect").hide();
                        $(".nameInput").show();
                    }else{
                        $(".nameInput").hide();
                        $(".nameSelect").show();
                        $("#Form_part_caozuo div[name='partPrice']").input('val',partEmp[0].salePrice)
                        $("#Form_part_caozuo div[name='partPrice']").input('readonly',true)
                        $('#Form_part_caozuo div[name=commodityId]').select({
                            urlData:{
                                url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId,
                                id: 'commodityId',
                                name: 'partName',
                                type: 'get',
                                dataType: 'json'
                            },
                            onclick:function(data){
                                var partEmp2 = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                                var salePrice;
                                if(partEmp2.length != 0){
                                    $.each(partEmp2,function(i){
                                        var item = partEmp2[i];
                                        if(item.commodityId == data.id){
                                            salePrice = item.salePrice;
                                        }
                                    })
                                }
                                $("#Form_part_caozuo div[name='partPrice']").input('val',salePrice);
                            }
                        });
                    }
                })

                $("#Form_edit_Part",wraper).undelegate('.part-updata','click').delegate('.part-updata','click',function(){
                    var _that = $(this)
                    var partsDetailId = _that.attr('partsDetailId');
                    var partName = _that.parent().parent().find("td label").eq(1).html();
                    var partPrice = _that.parent().parent().find("td label").eq(2).html()
                    var partNum = _that.parent().parent().find("td label").eq(3).html()
                    var partEmp = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                    $("#Form_edit_Part").form({}).form('close')
                    $("#Form_part_caozuo").form({
                        title:'配件操作',
                        grid: 12,
                        item:{'partPrice':partPrice,'partNum':partNum},
                        url:'/vip-ws/ws/0.1/busiWorkOrder/editPart',
                        preSubmit:function(json){
                            json.partsDetailId = partsDetailId;
                            json.workOrderId = $(".work-number").attr("workorderid");
                            if($('.work-status')){
                                json.workOrderStatus = $('.work-status').attr("orderTypeCode")
                            }
                            if($('.nameSelect').is(':visible')){
                                json.partName = $('#Form_part_caozuo div[name=commodityId] span').html();
                            }
                            if($('.nameInput').is(':visible')){
                                json.partName = $('#Form_part_caozuo input[name=partName]').val();
                            }
                            json.appointmentOrderId = _that.attr('appointmentOrderId')
                            json.shopAccountId = carsmart_config.shopId;
                            json.operatorId = carsmart_config.userId;
                            json.operator = carsmart_config.operatorName;
                            json.saveType = 2;
                            //json.isFirstData = 1;
                            return json
                        },
                        success:function(data){
                            $("#Form_part_caozuo").form({}).form('close')
                            $("#Form_edit_Part").form({}).form('open')
                            addAppEditBody()
                        },
                        error:function(xhr){
                            var errormsg = eval("(" + xhr.responseText + ")");
                            $.jRadMessage({level:'error',message:errormsg[0].message,selector:$("#Form_part_caozuo .pop-up-middle")});
                        }
                    }).form('open')
                    if(partEmp.length == 0){
                        $(".nameSelect").hide();
                        $(".nameInput").show();
                        $("#Form_part_caozuo div[name='partName']").input('val',partName)
                    }else{
                        $(".nameInput").hide();
                        $(".nameSelect").show();

                        $("#Form_part_caozuo div[name='partPrice']").input('readonly',true)
                        $('#Form_part_caozuo div[name=commodityId]').select({
                            urlData:{
                                url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId,
                                id: 'commodityId',
                                name: 'partName',
                                type: 'get',
                                dataType: 'json'
                            },
                            onclick:function(data){
                                var partEmp2 = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                                var salePrice;
                                if(partEmp2.length != 0){
                                    $.each(partEmp2,function(i){
                                        var item = partEmp2[i];
                                        if(item.commodityId == data.id){
                                            salePrice = item.salePrice;
                                        }
                                    })
                                }
                                $("#Form_part_caozuo div[name='partPrice']").input('val',salePrice);
                            }
                        });

                        var commodityId;
                        if(partEmp.length != 0){
                            $.each(partEmp,function(i){
                                var item = partEmp[i];
                                if(item.partName == partName){
                                    commodityId = item.commodityId;
                                }
                            })
                        }
                        $("#Form_part_caozuo div[name='commodityId']").select('val',commodityId);
                    }
                })

                $("#Form_edit_Part",wraper).undelegate('.part-delete','click').delegate('.part-delete','click',function(){
                    $("#Form_edit_Part").form({}).form('close')
                    var _that = $(this)
                    var partsDetailId = _that.attr('partsDetailId');
                    var postData={};
                    postData.partsDetailId=partsDetailId;
                    postData.partName=_that.parent().parent().find("td label").eq(1).html();
                    postData.partNum=_that.parent().parent().find("td label").eq(3).html()
                    postData.partPrice=_that.parent().parent().find("td label").eq(2).html()
                    postData.workOrderId=$(".work-number").attr("workorderid");
                    if($('.work-status')){
                        postData.workOrderStatus = $('.work-status').attr("orderTypeCode")
                    }
                    postData.appointmentOrderId = _that.attr('appointmentOrderId')
                    postData.commodityId=_that.attr('commodityId');
                    postData.shopAccountId = carsmart_config.shopId;
                    postData.operatorId = carsmart_config.userId;
                    postData.operator = carsmart_config.operatorName;
                    postData.saveType = 3;
                    $.jRadConfirm('确认删除吗？',1,function(){
                        $.jRadAjax({
                            type:'post',
                            data:postData,
                            url:'/vip-ws/ws/0.1/busiWorkOrder/delPart',  
                            success: function(){
                                $("#Form_edit_Part").form({}).form('open')
                                addAppEditBody()
                            },
                            error:function(xhr){
                                var errormsg = eval("(" + xhr.responseText + ")"); 
                                if (errormsg != undefined) {
                                    $('#Form_edit_Part').flexMessage(errormsg[0].message, 'error');
                                }
                            }
                        });
                    });
                })
            })
               
            /* 配件历史 */  
            $("#Form_workOrder",wraper).undelegate('.em-history','click').delegate('.em-history','click',function(){  
                $(".ycb-table tbody").hide(); 
                $(".partHistory").show();
                var busiWorkOrderId = $(".work-number").attr("workorderid");
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsHistoryData?busiWorkOrderId='+busiWorkOrderId+'&isFirst='+1,
                    success:function(data){
                        var tr_len=$("#Table_accountdetail",wraper).find("tr").length;
                        for(cur=0;cur<tr_len;cur++){
                          if(cur!==0){
                            $("#Table_accountdetail",wraper).find("tr").eq(cur).hide();
                          }
                        };
                        var str="";
                        if(data.length != 0){
                            $.each(data,function(i){
                                var _item=data[i];
                                str+="<tr>"
                                    +"<td>"+dtails.number+"</td>"
                                    +"<td>"+_item.serviceName+"</td>"
                                    +"<td>"+_item.partName+"</td>"
                                    +"<td>"+_item.partPrice+"</td>"
                                    +"<td>"+_item.partNum+"</td>"
                                    +"<td>"+_item.totalAmount+"</td>"
                                    +"</tr>";
                            });
                            $("#Table_accountdetail").append(str);
                        }else{
                            var str1 = $("<tr><td style='text-align:center' colspan='6'>沒有配件內容</td></tr>")
                            $("#Table_accountdetail tbody").append(str1)
                        }
                    }
                })
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsHistoryData?busiWorkOrderId='+busiWorkOrderId+'&isFirst='+0,
                    success:function(data){
                        var tr_len=$("#Table_accountdetail2",wraper).find("tr").length;
                        for(cur=0;cur<tr_len;cur++){
                          if(cur!==0){
                            $("#Table_accountdetail2",wraper).find("tr").eq(cur).hide();
                          }
                        };
                        var str="";
                        if(data.length != 0){
                            $.each(data,function(i){
                                var _item=data[i];
                                str+="<tr>"
                                    +"<td>"+_item.serviceName+"</td>"
                                    +"<td>"+_item.partName+"</td>"
                                    +"<td>"+_item.partPrice+"</td>"
                                    +"<td>"+_item.partNum+"</td>"
                                    +"<td>"+_item.totalAmount+"</td>"
                                    +"<td>"+_item.difAmount+"</td>"
                                    +"<td>"+_item.createDate+"</td>"
                                    +"</tr>";
                            });
                            $("#Table_accountdetail2").append(str);
                        }else{
                            var str2 = $("<tr><td style='text-align:center' colspan='7'>沒有配件修改历史</td></tr>")
                            $("#Table_accountdetail2 tbody").append(str2)
                        }
                    }
                })

                $(".title-p1 span").eq(0).html("配件修改历史")
                $(".sdiv .mDiv").html("原配件内容");
                $(".zdiv .mDiv").html("配件修改历史");
                $(".ui-form .bbit-grid").css("margin","0")
                $(".updateBtn").hide();
                $(".f-right").removeClass("return").addClass("part-return")

                $("#Form_workOrder",wraper).undelegate('.part-return','click').delegate('.part-return','click',function(){
                    $('#jrad-table',wraper).hide(); 
                    $('.details-box',wraper).show();
                    $(".ycb-table tbody").show(); 

                    //$(".updateBtn").show();
                    
                    var item = {workOrderId:busiWorkOrderId}
                    editAndInfo(item)
                    $(".partHistory").hide();
                    $(".title-p1 span").eq(0).html("养车宝工单")
                    $(".f-right").removeClass("part-return").addClass("return")
                    if(!$(".em-add").is(':visible')){
                        $(".em-updata-name").hide();
                        $(".em-updata-gongwei").hide();
                        $(".em-delete").hide();
                        $(".updateBtn").hide();
                        $(".addBtn").hide();
                    }
                    else{
                        $(".updateBtn").show();
                    }
                })
            })

            $("#Form_workOrder",wraper).undelegate('.em-delete','click').delegate('.em-delete','click',function(){
                var _that = $(this)
                var pastData = {};
                pastData.appointmentOrderId = _that.prev().attr('appointmentOrderId');
                pastData.businessInfoId = carsmart_config.businessInfoId;
                pastData.userInfoId = carsmart_config.userId;
                $.jRadConfirm('确认删除吗？',1,function(){
                    $.jRadAjax({
                        type:'post',
                        data:pastData,
                        url:'/vip-ws/ws/0.1/busiWorkOrder/delAppointmentOrder',  
                        success: function(){
                            
                            addAppbody_cookie();
                            hejiFn()

                        },
                        error:function(xhr){
                            var errormsg = eval("(" + xhr.responseText + ")"); 
                            if (errormsg != undefined) {
                                $('#Form_edit_Part').flexMessage(errormsg[0].message, 'error');
                            }
                        }
                    });
                });
            })
            
            /* 工位及时间 */
            $("#Form_workOrder",wraper).undelegate('.em-updata-gongwei','click').delegate('.em-updata-gongwei','click',function(){
                var _that = $(this)
                $(".ybs-gongshi-select").show();
                $(".drag").show();
                $(".ul-gongwei").html("");
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/AppointmentManager/getWorkHourStationList?businessInfoId='+carsmart_config.businessInfoId,
                    success:function(data){
                        var staUl;
                        staUl = $('<ul class="clearfix workUl"></ul>');
                        $.each(data,function(i){
                            var item = data[i]
                            var staLi;
                            staLi = $('<li stationId="'+item.stationId+'">'+item.stationName+'</li>')
                            staUl.append(staLi)
                        })
                        $(".ul-gongwei").append(staUl)
                        $(".ul-gongwei ul li").eq(0).addClass("t-active");
                    }   
                })

                var appointmentOrderId = _that.parent().parent().find("td label").eq(3).attr("appointmentorderid");
                var plateNumber = $(".car-plateNumber").val();
                var serviceName = _that.parent().parent().find("td label").eq(3).html();
                var workHour = _that.attr("workHour");
                var stationId = $(".ul-gongwei ul li[class='t-active']").attr("stationId");
                if(!stationId){
                    stationId = ''
                }

                gwAndTimeFnItem(appointmentOrderId,plateNumber,serviceName,workHour,stationId)

                function gwAndTimeFnItem(appointmentOrderId,plateNumber,serviceName,workHour,stationId){
                    createTable(stationId)
                    function createTable(stationId){
                        var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
                        var startTime = getTimeForBusi.startHour;       
                        var endTime = getTimeForBusi.endHour;
                        var arr=[];
                        for(var i = startTime; i<=endTime-1; i++){
                            var s = i+1;
                            if (s >= 10)
                            {
                                var starParam = i + ":00";
                                var endParam = i+1 +":00";
                                arr.push(starParam + "-" +endParam);
                            }
                            else{
                                var starParam = "0"+i + ":00";
                                var endParam = "0"+s+":00";
                                arr.push(starParam + "-" +endParam);
                            } 
                        }
                        var table =$('<table></table');
                        $.jRadGet({
                            url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?stationId='+stationId,
                            success:function(data){
                                var th;
                                var thead = $('<thead></thead>');
                                var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                                $.each(data,function(i){
                                    var item1 = data[i]
                                    th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                                    tr.append(th);
                                    thead.append(tr)
                                })  
                                table.append(thead);

                                return tableData = data;
                            }
                        })
                        $(".ycbTable").append(table)
                        var yesdaty = $(".ycbTable thead th").eq(1).attr("DatePara");
                        var dodaty = $(".ycbTable thead th").eq(2).attr("DatePara");
                        var masdaty = $(".ycbTable thead th").eq(3).attr("DatePara");
                        var tbody = $('<tbody></tbody>');
                        $.each(arr,function(i){
                            var z = startTime+i
                            if(z >= 10){
                                var startTimeBy = z
                            }else{
                                var startTimeBy = "0"+z
                            }
                            var starParamDou1 = startTimeBy+":00"+":00"
                            var starParamDou2 = startTimeBy+":10"+":00"
                            var starParamDou3 = startTimeBy+":20"+":00"
                            var starParamDou4 = startTimeBy+":30"+":00"
                            var starParamDou5 = startTimeBy+":40"+":00"
                            var starParamDou6 = startTimeBy+":50"+":00"
                            var item2 = arr[i]
                            var tr0;
                            var tr1;
                            var tr2;
                            tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                            tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                            tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                            tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                            tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                            tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                            tbody.append(tr1)
                            tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
                        })
                        table.append(tbody)
                        $(".ycbTable").html("");
                        $(".ycbTable").append(table)
                        $(".ycb-alert-wrap").css("height",$(".ybs-gongshi-select").height()-180);     

                        var valArr = [];
                        $('.ycbTable input').each(function(i){
                            valArr.push($('.ycbTable input').eq(i).attr("value"))
                        })
                        var tdtwowid = $(".ycbTable table td").eq(1).width()/2;
                        var inpuWid = $(".ycbTable input").eq(0).width();
                        $.each(tableData,function(i){
                            var item = tableData[i];
                            $.each(item.orderList,function(j){
                                var str = item.orderList[j];
                                var X1;
                                var Y1;
                                $.each(valArr,function(k){
                                    if(str.appointmentStartTime == valArr[k]){
                                        X1 = $('.ycbTable input').eq(k).position().top;
                                        Y1 = $('.ycbTable input').eq(k).position().left-tdtwowid+inpuWid+4;
                                    }
                                })
                                var tdWidth = $('.ycbTable input').eq(0).parent().width()+2;
                                var tdHeight = $('.ycbTable input').eq(0).parent().height()+2;
                                
                                var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+str.plateNumber+'<br>'+str.serviceName+'</div>')
                                $(".ycbTable").append(warpDiv)
                            })
                        })

                        var warpDiv2 = $('<div class="warpDiv2" style="display:table;"></div>').html("")
                        $(".ycbTable input").bind('click',function(){
                            $(".succAndErr").html("")
                            var X1 = $(this).position().top;
                            var Y1 = $(this).position().left-100;
                            var tdWidth = $(this).parent().width()+2;
                            var tdHeight = $(this).parent().height()+2;
                            // warpDiv2.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html(plateNumber+'<br>'+serviceName).attr("val",$(this).attr("value"))
                            warpDiv2.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+plateNumber+'<br>'+serviceName+'</div>').attr("val",$(this).attr("value"))
                            $(".ycbTable").append(warpDiv2)
                            var aWarpDiv = $(".ycbTable .warpDiv");
                            for (var i = 0; i < aWarpDiv.length; i++){
                                if ( cdTest (warpDiv2,aWarpDiv.eq(i)) ){
                                    $(".succAndErr").html("选择工时与其他预约服务时间重复！").css("color","red")
                                    $(".ycbTable .warpDiv2").remove();
                                    $(this).attr("checked",false);
                                }
                            }
                        })       
                    }

                    function cdTest (obj1,obj2){
                        var l1=obj1.offset().left;
                        var r1=obj1.offset().left+obj1.width();
                        var t1=obj1.offset().top;
                        var b1=obj1.offset().top+obj1.height();
                        
                        var l2=obj2.offset().left;
                        var r2=obj2.offset().left+obj2.width();
                        var t2=obj2.offset().top;
                        var b2=obj2.offset().top+obj2.height();
                        
                        if (r1<l2 || l1>r2 || b1<t2 || t1>b2) {
                                return false;
                        }else{
                                return true;
                        }
                    }

                    $(".workUl li").click(function() {   
                        $(".workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
                        var stationId = $(".workUl li").eq($(this).index()).attr("stationId");
                        createTable(stationId);
                    });

                    /* 弹框里的确认选择 */
                    $(".trurBtn").click(function(){

                        if($(".ycbTable .warpDiv2").length != 0){
                            $(".ybs-gongshi-select").hide();
                            $(".drag").hide();
                            var pastData = {};
                            pastData.appointmentOrderId = appointmentOrderId;
                            pastData.workHour = workHour;
                            pastData.workStationInfoId = $(".ul-gongwei .t-active").attr("stationid");
                            pastData.appointmentStartTime = $(".warpDiv2").attr("val");
                            $.ajax({
                                type:'post',
                                async:false,
                                dataType:'json',
                                data:$.toJSON(pastData),
                                contentType:'application/json;charset=utf-8',
                                url:'/vip-ws/ws/0.1/AppointmentManager/editAppointOrder',  
                                success: function(){
                                    addAppbody_cookie();
                                    $("#Form_detail_info",wraper).form({}).form('close');
                                }
                            })
                        }else{
                            //alert("请选择工位工时");
                            $.jRadAlert("请选择工位工时",'error');
                        }
                    })

                    /* 查询空闲工位 */
                    $(".button-gongwei").click(function(){
                        var businessInfoId = carsmart_config.businessInfoId;
                        var freeTime = $(".employInput").val();
                        var workHour = $(this).attr("workhour");
                        $(".succAndErr").html("")
                        $.ajax({
                            type:'get',
                            async:false,
                            url:'/vip-ws/ws/0.1/AppointmentManager/getFreeStation?businessInfoId='+carsmart_config.businessInfoId+'&freeTime='+freeTime+'&workHour='+workHour,  
                            success: function(data){
                                if(data.length == 0){
                                    $(".succAndErr").html("没有空闲工位")
                                }else{
                                    var arrStation;
                                    arrStation = $('<div></div>');
                                    $.each(data,function(i){
                                        var item = data[i];
                                        var alistr;
                                        alistr = $('<span stationId="'+item.stationId+'">'+item.stationName+'</span>');
                                        arrStation.append(alistr)
                                    })
                                    $(".succAndErr").html("空闲工位：").append(arrStation).css("color","#393939")
                                }
                            },
                            error:function(xhr){
                                var mes = eval("("+xhr.responseText+")");  
                                $(".succAndErr").html(mes[0].message).css("color","#ff0000")
                            }
                        })
                    })
                    $(".alert-head a").click(function(){
                        $(".ybs-yuangong-select").hide();
                        $(".ybs-gongshi-select").hide();
                        $(".drag").hide();
                    })
                }
            })

            /* 技师按钮 */
            $("#Form_workOrder",wraper).undelegate('.em-updata-name','click').delegate('.em-updata-name','click',function(){
                var _that = $(this)
                $(".ybs-yuangong-select").show();
                $(".drag").show();
                var mach = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId})
                $(".employSel").html("")
                $.each(mach,function(i){
                    var item = mach[i]
                    var creatOption = $('<option emp="'+item.shopEmployeeId+'" positionName="'+item.positionName+'">'+item.name+'</option>')
                    $(".employSel").append(creatOption)
                })

                $(".ul-yuangong").html("");
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId,
                    success:function(data){
                        var staUl = '';
                        var staLi = '';
                        staUl = $('<ul class="clearfix workUl"></ul>');
                        $.each(data,function(i){
                            var item = data[i]
                            staLi = $('<li class="" shopEmployeeId="'+item.shopEmployeeId+'">'+item.name+'('+item.positionName+')'+'</li>')
                            staUl.append(staLi)
                        })
                        $(".ul-yuangong").append(staUl)
                        $(".ul-yuangong ul li").eq(0).addClass("t-active");
                    }   
                })

                var appointmentOrderId = _that.parent().parent().find("td label").eq(3).attr("appointmentorderid");
                var plateNumber = $(".car-plateNumber").val();
                var serviceName = _that.parent().parent().find("td label").eq(3).html();
                var workHour = _that.attr("workHour");
                var shopEmployeeId_a = $(".ul-yuangong ul li[class='t-active']").attr("shopEmployeeId");

                jishiFnItem(appointmentOrderId,plateNumber,serviceName,workHour,shopEmployeeId_a)

                function jishiFnItem(appointmentOrderId,plateNumber,serviceName,workHour,shopEmployeeId_a){

                    createTable(shopEmployeeId_a)

                    function createTable(shopEmployeeId_a){
                        var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
                        var startTime = getTimeForBusi.startHour;       
                        var endTime = getTimeForBusi.endHour;
                        var arr=[];
                        for(var i = startTime; i<=endTime-1; i++){
                            var s = i+1;
                            if (s >= 10)
                            {
                                var starParam = i + ":00";
                                var endParam = i+1 +":00";
                                arr.push(starParam + "-" +endParam);
                            }
                            else{
                                var starParam = "0"+i + ":00";
                                var endParam = "0"+s+":00";
                                arr.push(starParam + "-" +endParam);
                            } 
                        }
                        var table =$('<table></table');
                        $.jRadGet({
                            url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?shopEmployeeId='+shopEmployeeId_a,
                            success:function(data){
                                var th;
                                var thead = $('<thead></thead>');
                                var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                                $.each(data,function(i){
                                    var item1 = data[i]
                                    th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                                    tr.append(th);
                                    thead.append(tr)
                                })  
                                table.append(thead) 
                                return tableData = data;
                            }
                        })
                        $(".ycbMech").append(table)
                        var yesdaty = $(".ycbMech thead th").eq(1).attr("DatePara");
                        var dodaty = $(".ycbMech thead th").eq(2).attr("DatePara");
                        var masdaty = $(".ycbMech thead th").eq(3).attr("DatePara");
                        var tbody = $('<tbody></tbody>');
                        $.each(arr,function(i){
                            var z = startTime+i
                            if(z >= 10){
                                var startTimeBy = z
                            }else{
                                var startTimeBy = "0"+z
                            }
                            var starParamDou1 = startTimeBy+":00"+":00"
                            var starParamDou2 = startTimeBy+":10"+":00"
                            var starParamDou3 = startTimeBy+":20"+":00"
                            var starParamDou4 = startTimeBy+":30"+":00"
                            var starParamDou5 = startTimeBy+":40"+":00"
                            var starParamDou6 = startTimeBy+":50"+":00"
                            var item2 = arr[i]
                            var tr0;
                            var tr1;
                            var tr2;
                            tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                            tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                            tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                            tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                            tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                            tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                            tbody.append(tr1)
                            tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
                        })
                        table.append(tbody)
                        $(".ycbMech input[type='radio']").css({"filter":"alpha(opacity=0)","-moz-opacity":"0", "opacity": "0"})
                        $(".ycb-alert-wrap").css("height",$(".ybs-yuangong-select").height()-180);
                        $(".ycbMech").html("");
                        $(".ycbMech").append(table);
                        var valArr = [];
                        $('.ycbMech input').each(function(i){
                            valArr.push($('.ycbMech input').eq(i).attr("value"))
                        })

                        var activeName = $(".ul-yuangong .t-active").html();
                        var tdtwowid = $(".ycbMech table td").eq(1).width()/2;
                        var inpuWid = $(".ycbMech input").eq(0).width();
                        $.each(tableData,function(i){
                            var item = tableData[i];
                            $.each(item.orderList,function(j){
                                var str = item.orderList[j];
                                var X1;
                                var Y1;
                                $.each(valArr,function(k){
                                    if(str.appointmentStartTime == valArr[k]){
                                        X1 = $('.ycbMech input').eq(k).position().top;
                                        Y1 = $('.ycbMech input').eq(k).position().left-tdtwowid+inpuWid+4;
                                    }
                                })
                                var tdWidth = $('.ycbMech input').eq(0).parent().width()+2;
                                var tdHeight = $('.ycbMech input').eq(0).parent().height()+2;
                                
                                var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+activeName+'<br>'+str.serviceName+'</div>') //.attr("val",$(this).attr("value"));
                                $(".ycbMech").append(warpDiv)
                            })
                        })
                    }
                    
                    $(".workUl li").click(function() {   
                        $(".workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
                        var shopEmployeeId = $(".workUl li").eq($(this).index()).attr("shopemployeeid");
                        createTable(shopEmployeeId);
                    });

                    /* 弹框里的确认选择 */
                    $(".button-yuangong").click(function(){
                        $(".ybs-yuangong-select").hide();
                        $(".drag").hide();
                        var pastData = {};
                        pastData.appointmentOrderId = appointmentOrderId;
                        pastData.shopEmployeeId = $('.employSel option:selected').attr("emp");
                        $.ajax({
                            type:'post',
                            async:false,
                            dataType:'json',
                            data:$.toJSON(pastData),
                            contentType:'application/json;charset=utf-8',
                            url:'/vip-ws/ws/0.1/AppointmentManager/editAppointOrder',  
                            success: function(){
                                addAppbody_cookie();
                                $("#Form_detail_info",wraper).form({}).form('close');
                            }
                        })
                    })
                    $('.ybs-yuangong-select').on('click','.alert-head a',function(){
                        $(".ybs-yuangong-select").hide();
                        $(".ybs-gongshi-select").hide();
                        $(".drag").hide();
                    })
                }
            })

            $(".alert-head a").click(function(){
                $(".ybs-yuangong-select").hide();
                $(".ybs-gongshi-select").hide();
                $(".drag").hide();
            })

            /* 价格input框 */
            $('#Form_workOrder').on('blur','.workInputPrice',function(){
                var pastData = {};
                //pastData.appointmentOrderId = $(this).parent().parent().attr("class")
                pastData.appointmentOrderId = $(this).attr("appointmentOrderId")
                pastData.workHourPrice = $(this).val();
                $.ajax({
                    type:'post',
                    async:false,
                    dataType:'json',
                    data:$.toJSON(pastData),
                    contentType:'application/json;charset=utf-8',
                    url:'/vip-ws/ws/0.1/busiWorkOrder/editAppointmentOrder',  
                    success: function(){
                        addAppbody_cookie();
                        var str = '';
                        $(".cntTr").html("")
                        str += '<td colspan="1">'
                                +'<label>合计</label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="2">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="2">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji1"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji2"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji3"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji4"></label>'
                            +'</td>'

                        $(".cntTr").append(str);

                        hejiFn()
                    }
                })
            })

            /* 价格input框 */
            $('#Form_workOrder').on('blur','.clearInputPrice',function(){
                var pastData = {};
                //pastData.appointmentOrderId = $(this).parent().parent().attr("class")
                pastData.appointmentOrderId = $(this).attr("appointmentOrderId")
                pastData.clearPrice = $(this).val();
                $.ajax({
                    type:'post',                
                    async:false,
                    dataType:'json',
                    data:$.toJSON(pastData),
                    contentType:'application/json;charset=utf-8',
                    url:'/vip-ws/ws/0.1/busiWorkOrder/editAppointmentOrder',  
                    success: function(){
                        addAppbody_cookie();
                        var str = '';
                        $(".cntTr").html("")
                        str += '<td colspan="1">'
                                +'<label>合计</label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="2">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="2">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji1"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji2"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji3"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji4"></label>'
                            +'</td>'

                        $(".cntTr").append(str);

                        hejiFn()
                    }
                })
            })
            
            /* 结算按钮 */
            $(".workPlay").click(function(){
                var workOrderId = $('.work-number').attr('workOrderId')
                var operator = carsmart_config.operatorName;
                var data = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/prePayWorkOrder?workOrderId='+workOrderId+'&operator='+operator})

                $('#Form_workOrder_jiesuan_workid').form({
                    title:'收款',
                    grid:14,
                    type:'get'
                }).form('open')
                var workId= $(this).attr("workorderid");
                var str="";
                $("#table_workOrder_jiesuan_workid").html("");
                $.each(data.servicesList,function(i){
                    var _item=data.servicesList[i];
                    str+="<tr>"
                        +"<td>服务"+(i+1)+"</td>"
                        +"<td>"+_item.serviceName+"</td>"
                        +"<td>合计："+_item.money+"</td>"
                        +"<td>"+_item.payType+"</td>"
                        +"</tr>";
                });
                $("#table_workOrder_jiesuan_workid",wraper).append(str);
                $(".jiesuan-btn span").html(data.topay);

                $("#Form_workOrder_jiesuan_workid").on('click','.jiesuan-btn',function(){
                    $('#Form_workOrder_jiesuan_workid').form("close")
                    $.jRadConfirm('已收到客户支付的'+data.topay+'元？',1,function(){   
                        var operator = carsmart_config.operatorName;
                        $.jRadGet({  
                            url:'/vip-ws/ws/0.1/busiWorkOrder/payOffLine?workOrderId='+workOrderId+'&operator='+operator,
                            success: function(data){ 
                                $(".workPlay").val("已结算").attr("disabled",true)
                                $(".work-status").html("工单状态：已结算")
                                $(".return",wraper).click()
                                $(".vdiv .btn-info").eq(2).click();
                            },
                            error:function(xhr){ 
                                $('#Form_workOrder_jiesuan_workid').form({}).form("open")
                                var errormsg = eval("(" + xhr.responseText + ")"); 
                                if (errormsg != undefined) {
                                    $('#Form_workOrder_jiesuan_workid .pop-up-middle').flexMessage(errormsg[0].message, 'error');
                                }
                            }
                        });
                    });
                })
            })

            $(".carComeTime").val(dtails.carComeTime);
            $(".expectCarTime").val(dtails.expectCarTime)
            $(".completeDate").val(dtails.completeDate)

            $('#Form_workOrder .updateBtn').unbind('click').bind('click',function(){
                    var isAndno1 = ''; //油表显示
                    if($(".ycb-div1 strong").eq(0).hasClass("cur")){
                        isAndno1 = 1;
                    }else if($(".ycb-div1 strong").eq(1).hasClass("cur")){
                        isAndno1 = 2;
                    }else if($(".ycb-div1 strong").eq(2).hasClass("cur")){
                        isAndno1 = 3;
                    }else if($(".ycb-div1 strong").eq(3).hasClass("cur")){
                        isAndno1 = 4; 
                    }else{
                        isAndno1 = 5; 
                    }
                    var isAndno2 = '';//内饰是否损失
                    if($(".ycb-div2 strong").eq(0).hasClass("cur")){
                        isAndno2 = 1;
                    }else{
                        isAndno2 = 0;
                    }
                    var isAndno3 = '';//是否洗车
                    if($(".ycb-div3 strong").eq(0).hasClass("cur")){
                        isAndno3 = 1;
                    }else{
                        isAndno3 = 0;
                    }
                    var isAndno7 = '';//机电设备是否故障
                    if($(".ycb-div7 strong").eq(0).hasClass("cur")){
                        isAndno7 = 1;
                    }else{
                        isAndno7 = 0;
                    }
                    var isAndno5 = ''; //排队时间
                    if($(".ycb-div5 strong").eq(0).hasClass("cur")){
                        isAndno5 = 1;
                    }else if($(".ycb-div5 strong").eq(1).hasClass("cur")){
                        isAndno5 = 2;
                    }else{
                        isAndno5 = 3;
                    }
                    var isAndno6 = '';//是否取回废件
                    if($(".ycb-div6 strong").eq(0).hasClass("cur")){
                        isAndno6 = 1;
                    }else{
                        isAndno6 = 0;
                    }
                    var arr = [];
                    var string = '';
                    $(".round").each(function(i){
                        if($(this).attr("style") == "filter:alpha(opacity=100);-moz-opacity:1;opacity: 1;"){
                            arr.push(1)
                        }else{
                            arr.push(0)
                        }
                    })
                    var workOrderId = $('.work-number').attr("workOrderId")
                    var appointmentOrderList = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId});
                    
                    var json = {};
                    json.workOrderId = workOrderId;
                    json.businessInfoId = carsmart_config.businessInfoId;
                    json.userInfoId = $(".car-mobile").attr("userInfoId");
                    json.carInfoId = $(".carInfoId").attr("carInfoId");
                    json.carKm = $('.car-carKm').val();
                    json.carOilRemain = isAndno1;//油表显示
                    json.interiorDestory = isAndno2;//内饰是否损失
                    json.elecDeviceIsDestory = isAndno7;//机电设备是否故障
                    json.lineUp = isAndno5 //排队时间
                    json.isWash = isAndno3; //是否赠送洗车
                    json.isRetainUsed = isAndno6; //是否保留配件
                    json.repairDiscription = $(".repairDiscription").val();
                    json.appearanceInspectArea = arr.toString();
                    json.faultOrOption = $(".faultOrOption").val();
                    json.carComeTime = $('.carComeTime').val();
                    json.expectCarTime = $('.expectCarTime').val();
                    json.opertor = carsmart_config.operatorName;
                    json.appointmentOrderList = appointmentOrderList;

                    $.jRadPost({
                        url:"/vip-ws/ws/0.1/busiWorkOrder/editWorkOrder",
                        data:json, 
                        success:function(){ 
                            $.jRadMessage({level:'success', message:'修改成功！',selectors:$("#Form_workOrder")});
                            $('#Table_workOrder_manage').flexReload();
                            $('#jrad-table',wraper).show();
                            $('.details-box',wraper).hide();
                        },
                        error:function(data){
                            var mes = eval('('+data.responseText+')');
                            $.jRadMessage({level:'error', message:mes[0].message, selectors:$("#Form_workOrder")});
                        }
                    });

                    $("#btn-scroll-up").click();
            });

            var total1 = 0;
            var total2 = 0;
            var total3 = 0;
            var total4 = 0;
            $('.queCnt1').each(function(){
                //$(this).keyup(function(){
                    total1 = 0;
                    $('.queCnt1').each(function(){
                        if($(this).html() === '.' || $(this).html() === '-'){
                            return;
                        }
                        total1 += parseFloat($(this).html() || 0);
                    });
                    //$('.heji1').html(Math.format(total1,'#,###'));
                    $('.heji1').html(total1);
                //});
            });
            $('.queCnt2').each(function(){
                //$(this).keyup(function(){
                    total2 = 0;
                    $('.queCnt2').each(function(){
                        if($(this).html() === '.' || $(this).html() === '-'){
                            return;
                        }
                        total2 += parseFloat($(this).html() || 0);
                    });
                    //$('.heji2').html(Math.format(total2,'#,###.##'));
                    $('.heji2').html(total2);
                //});
            });
            $('.queCnt3').each(function(){
                //$(this).keyup(function(){
                    total3 = 0;
                    $('.queCnt3').each(function(){
                        // if($(this).val() === '.' || $(this).val() === '-'){
                        //     return;
                        //     total3 += parseFloat($(this).val() || 0);
                        // }
                        if($(this).html() === '.' || $(this).html() === '-' || $(this).val() === '.' || $(this).val() === '-'){
                            return;
                        }
                            total3 += parseFloat($(this).html() || $(this).val() || 0);
                    });
                    //$('.heji3').html(Math.format(total3,'#,###.##'));
                    $('.heji3').html(total3);
                //});
            });
            $('.queCnt4').each(function(){
                //$(this).keyup(function(){
                    total4 = 0;
                    $('.queCnt4').each(function(){
                        // if($(this).val() === '.' || $(this).val() === '-'){
                        //     return;
                        //     total4 += parseFloat($(this).val() || 0);
                        // }
                        if($(this).html() === '.' || $(this).html() === '-' || $(this).val() === '.' || $(this).val() === '-'){
                            return;
                        }
                            total4 += parseFloat($(this).html() || $(this).val() || 0);
                    });
                    //$('.heji4').html(Math.format(total4,'#,###.##'));
                    $('.heji4').html(total4);
                //});
            });

            $(".return",wraper).click(function(){
                reatSet()
                $('.details-box',wraper).hide();
                $('#jrad-table',wraper).show(); 
                $(".scroll-up-btn").click();
                $(".ydiv .btn-info").eq(0).click();
                $(".vdiv .btn-info").eq(2).click();
            }); 

            $(".em-updata-name").hide();
            $(".em-updata-gongwei").hide();
            $(".em-delete").hide();
            $(".em-add").hide();
            $(".em-edit").hide();

            //hejiFn()
        }
    }

    function addAppbody_cookie(){
        var workOrderId = $(".work-number").attr("workorderid")
        var partData = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId})
        var str1 = "";
        var str2 = "";
        var str3 = "";
        var inStr = "";
        var appId = '';
        var ars = [];
        $.each(partData,function(i){
            var item = partData[i];
            var del = '';
            if(item.appointmentType == 1){
                del = '<em></em>'
            }else{
                del = '<em class="em-delete">删除</em>'
            }
            if(item.isEditPrice == 0){
                appId = item.appointmentOrderId;
                var postListData = item.partsList;
                if(postListData.length == 0){
                    str1 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                        + '<td colspan="1">'
                            +'<label>'+item.orderNumber+'</label>'
                        +'</td>'
                        + '<td colspan="1" style="white-space:nowrap">'
                            +'<label>'+item.employeeName+'</label>'
                            +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                        +'</td>'
                        + '<td colspan="2">'
                            +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                            +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                        +'</td>'
                        + '<td colspan="2">'
                            +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                            +del
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt1"></label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt2"></label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt3">'+item.workHourPrice+'</label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt4">'+item.clearPrice+'</label>'
                        +'</td>'
                    +'</tr>'
                }
                if(postListData.length == 1){
                    str2 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                        + '<td colspan="1">'
                            +'<label>'+item.orderNumber+'</label>'
                        +'</td>'
                        + '<td colspan="1" style="white-space:nowrap">'
                            +'<label>'+item.employeeName+'</label>'
                            +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                        +'</td>'
                        + '<td colspan="2">'
                            +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                            +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                        +'</td>'
                        + '<td colspan="2">'
                            +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                            +del
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label>'+postListData[0].partName+'</label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label>'+postListData[0].partPrice+'</label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt1">'+postListData[0].partNum+'</label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt2">'+postListData[0].sumPartPrice+'</label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt3">'+item.workHourPrice+'</label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt4">'+item.clearPrice+'</label>'
                        +'</td>'
                    +'</tr>'
                }
                if(postListData.length >= 2){
                    var lg = postListData.length;
                    $.each(postListData,function(j){
                        var inCont = postListData[j]
                        inStr = '<td colspan="1">'
                                +'<label>'+inCont.partName+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label>'+inCont.partPrice+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label  class="queCnt1">'+inCont.partNum+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt2">'+inCont.sumPartPrice+'</label>'
                            +'</td>'

                            str3 += '<tr class="row1 tr-border tr-center creatTr">'
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label>'+item.orderNumber+'</label>'
                                +'</td>'
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="white-space:nowrap">'
                                    +'<label>'+item.employeeName+'</label>'
                                    +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                    +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                    +del
                                +'</td>'
                                + inStr
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label class="queCnt3">'+item.workHourPrice+'</label>'
                                +'</td>'
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label  class="queCnt4">'+item.clearPrice+'</label>'
                                +'</td>'
                            +'</tr>'
                        
                    })
                }
                ars.push(item.appointmentOrderId)
            }
            if(item.isEditPrice == 1){
                appId = item.appointmentOrderId;
                var postListData = item.partsList;
                if(postListData.length == 0){
                    str1 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                        + '<td colspan="1">'
                            +'<label>'+item.orderNumber+'</label>'
                        +'</td>'
                        + '<td colspan="1" style="white-space:nowrap">'
                            +'<label>'+item.employeeName+'</label>'
                            +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                        +'</td>'
                        + '<td colspan="2">'
                            +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                            +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                        +'</td>'
                        + '<td colspan="2">'
                            +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                            +del
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt1"></label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt2"></label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label><input class="workInputPrice queCnt3" type="text" appointmentOrderId="'+item.appointmentOrderId+'"  value="'+item.workHourPrice+'"></label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label><input type="text" class="clearInputPrice queCnt4" appointmentOrderId="'+item.appointmentOrderId+'"  value="'+item.clearPrice+'"></label>'
                        +'</td>'
                    +'</tr>'
                }
                if(postListData.length == 1){
                    str2 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                        + '<td colspan="1">'
                            +'<label>'+item.orderNumber+'</label>'
                        +'</td>'
                        + '<td colspan="1" style="white-space:nowrap">'
                            +'<label>'+item.employeeName+'</label>'
                            +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                        +'</td>'
                        + '<td colspan="2">'
                            +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                            +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                        +'</td>'
                        + '<td colspan="2">'
                            +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                            +del
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label>'+postListData[0].partName+'</label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label>'+postListData[0].partPrice+'</label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label class="queCnt1">'+postListData[0].partNum+'</label>'
                        +'</td>'
                        + '<td colspan="1">'
                            +'<label  class="queCnt2">'+postListData[0].sumPartPrice+'</label>'
                        +'</td>'
                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                            +'<label><input type="text" class="workInputPrice queCnt3" appointmentOrderId="'+item.appointmentOrderId+'"  value="'+item.workHourPrice+'"></label>'
                        +'</td>'
                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                            +'<label><input type="text" class="clearInputPrice queCnt4" appointmentOrderId="'+item.appointmentOrderId+'"  value="'+item.clearPrice+'"></label>'
                        +'</td>'
                    +'</tr>'
                }
                if(postListData.length >= 2){
                    var lg = postListData.length;
                    $.each(postListData,function(j){
                        var inCont = postListData[j]
                        inStr = '<td colspan="1">'
                                +'<label>'+inCont.partName+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label>'+inCont.partPrice+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt1">'+inCont.partNum+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label  class="queCnt2">'+inCont.sumPartPrice+'</label>'
                            +'</td>'

                            str3 += '<tr class="row1 tr-border tr-center creatTr">'
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label>'+item.orderNumber+'</label>'
                                +'</td>'
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="white-space:nowrap">'
                                    +'<label>'+item.employeeName+'</label>'
                                    +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                    +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                    +del
                                +'</td>'
                                + inStr
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label><input type="text" class="workInputPrice queCnt3" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.workHourPrice+'"></label>'
                                +'</td>'
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label><input type="text" class="clearInputPrice queCnt4" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.clearPrice+'"></label>'
                                +'</td>'
                            +'</tr>'
                        
                    })
                }
                ars.push(item.appointmentOrderId)
            }
        })
        $('.creatTr').remove();
        $('#tab-top').after(str1).after(str2).after(str3);
        $.each(ars,function(i){
            var aa = ars[i]
            if($("."+aa).length >=2 ){
                $("."+aa).hide();
                $("."+aa).eq(0).show();
                $("."+aa).eq(1).show();
                $("."+aa).eq(2).show();
                $("."+aa).eq(3).show();
                $("."+aa).eq(4).show();
                $("."+aa).eq(5).show();
            }
        })
    }

    extend = function (a, b) { //合并对象
        if (typeof a !== "object" || typeof b !== "object") {
            return;
        }
        for (key in b) {
            a[key] = b[key];
        }
        return a;
    };

    extend(Math, {
      /*************格式化数值***************/
        format: function (num, style) {
            if (!/#+([^#]+)?(#+)(?:\.(#+))?/.test(style)) {
                return;
            }
            //分割符
            var split = RegExp.$1;
            //保留小数位数
            num = parseFloat(num).toFixed(RegExp.$3.length);
            var re = new RegExp('(\\d{1,' +  RegExp.$2.length + '})(?=(\\d{' +  RegExp.$2.length + '})+(?:$|\\.))', 'g');
            
            if(!/(-?\d+)(?:\.(\d+))?/.test(num)){
                return;
            }
            var d = (RegExp.$2 ? '.' + RegExp.$2 : ''),
                str = RegExp.$1.replace(re, function (a, b, c, d) {
                    return b + split;
                });
            return str + d;
        }
    });

    function hejiFn(){
        var total1 = 0;
        var total2 = 0;
        var total3 = 0;
        var total4 = 0;
        $('.queCnt1').each(function(){
                total1 = 0;
                $('.queCnt1').each(function(){
                    if($(this).html() === '.' || $(this).html() === '-'){
                        return;
                    }
                    total1 += parseFloat($(this).html() || 0);
                });
                $('.heji1').html(Math.format(total1,'#,###'));
        });
        $('.queCnt2').each(function(){
                total2 = 0;
                $('.queCnt2').each(function(){
                    if($(this).html() === '.' || $(this).html() === '-'){
                        return;
                    }
                    total2 += parseFloat($(this).html() || 0);
                });
                $('.heji2').html(Math.format(total2,'#,###.##'));
        });
        $('.queCnt3').each(function(){
                total3 = 0;
                $('.queCnt3').each(function(){
                    if($(this).html() === '.' || $(this).html() === '-' || $(this).val() === '.' || $(this).val() === '-'){
                        return;
                    }
                    if($(this).parent().is(':visible')){
                        total3 += parseFloat($(this).html() || $(this).val() || 0);
                    }
                });
                $('.heji3').html(Math.format(total3,'#,###.##'));
        });
        if($('.queCnt4')){
            $('.queCnt4').each(function(){
                total4 = 0;
                $('.queCnt4').each(function(){
                    if($(this).html() === '.' || $(this).html() === '-' || $(this).val() === '.' || $(this).val() === '-'){
                        return;
                    }
                    if($(this).parent().is(':visible')){
                        total4 += parseFloat($(this).html() || $(this).val() || 0);
                    }
                });
                $('.heji4').html(Math.format(total4,'#,###.##'));
                   
            });
        }else{
            $('.heji4').html("0.00")
        }
        if($(".ycb-table .creatTr").length == 0){
            $('.heji1').html("0")
            $('.heji2').html("0.00")
            $('.heji3').html("0.00")
            $('.heji4').html("0.00")
        }
    }

    function check(ycbDiv){
        $(ycbDiv).on('click',function(){
            $(ycbDiv).removeClass('cur');
            $(this).siblings("input[type='radion']").removeAttr('checked')
            $(this).addClass('cur');
        })
    }
    check('.ycb-div1 .checkbox')
    check('.ycb-div2 .checkbox')
    check('.ycb-div3 .checkbox')
    check('.ycb-div4 .checkbox')
    check('.ycb-div5 .checkbox')
    check('.ycb-div6 .checkbox')
    check('.ycb-div7 .checkbox')
    
    $(".ycb-tu").click(function(){
        if($(this).children().attr("style") == "filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;"){  
            $(this).children().attr("style","filter:alpha(opacity=100);-moz-opacity:1;opacity: 1;")
        }else{
            $(this).children().attr("style","filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;")
        }    
    })

    var wraper = $('#Wraper_workOrder_manage');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();
    var page_column_model_b = new Array();
    var page_list_buttons_b = new Array();

    var page_column_model_c = new Array();
    var page_column_model_d = new Array();

    var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel}); 

    var field_params={};  
    field_params['isUsed']={data:[{id:'2',name:'不确定'},{id:'0',name:'否'},{id:'1',name:'是'}]};
    field_params['color']={data:[{id:'黑',name:'黑'},{id:'白',name:'白'},{id:'红',name:'红'},{id:'粉',name:'粉'},{id:'绿',name:'绿'},{id:'黄',name:'黄'},{id:'灰',name:'灰'},{id:'银',name:'银'},{id:'蓝',name:'蓝'},{id:'棕',name:'棕'},{id:'其他',name:'其他'}]};
    field_params['interiorStyle']={data:[{id:'0',name:'普通'},{id:'1',name:'简约'},{id:'2',name:'豪华'},{id:'3',name:'其他'}]};
    field_params['percentNew']={data:[{id:' ',name:'不确定'},{id:'1',name:'1'},{id:'2',name:'2'},{id:'3',name:'3'},{id:'4',name:'4'},{id:'5',name:'5'},{id:'6',name:'6'},{id:'7',name:'7'},{id:'8',name:'8'},{id:'9',name:'9'},{id:'10',name:'10'}]};
    field_params['isRefit']={data:[{id:'2',name:'不确定'},{id:'0',name:'否'},{id:'1',name:'是'}]};
   
    field_params['serviceId'] = {
        urlData: {
            url:'/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+1+'&businessInfoId='+carsmart_config.businessInfoId,
            id: 'id',
            name: 'serviceName',
            type: 'get',
            dataType: 'json',
            val: '',
            selectedItems:true
        }, 
        unshiftData:{id:'',name:'请选择'},
        onclick:function(data){
            var jsonParm = $.jRadGet({url:'/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+1+'&businessInfoId='+carsmart_config.businessInfoId})
            var price;
            var workHour;
            var serviceId;
            if(data.id == ''){
                $(".hideserid").html("");
            }else{
                $.each(jsonParm,function(i){
                    var item = jsonParm[i];
                    if(item.id == data.id){
                        price = item.reservePrice;
                        workHour = item.workHour
                        serviceId = item.id
                    }
                })
                $(".hideserid").attr({workHour:workHour,price:price,serviceId:serviceId});
            }
        }
    };

    $('#Form_detail_info div[name="offerType"]',wraper).radio({
        data:[{id:'1',name:'洗车'},{id:'2',name:'美容'},{id:'3',name:'保养'},{id:'4',name:'维修'},{id:'5',name:'施工部位'},{id:'6',name:'其他项目'},{id:'7',name:'已有订单'}],
        onclick:function(){
            var key = $('#Form_detail_info div[name="offerType"]',wraper).radio('val');
            if(key == 5){
                $(".act").show();
                $(".ser").hide();
                $(".other-service").hide();
                $(".number-service").hide();
                var s1 = $.jRadGet({url : '/shopmanage-ws/ws/0.1/inspectionHistoryV2Cms/detailCarQuestion'});
                var arr = [];
                $.each(s1,function(i){
                    var a = s1[i];
                    var vk = {};
                    vk.id = a.answerItemIdId;
                    vk.name = a.answerItemName;
                    arr.push(vk);
                });
                arr.unshift({id:'',name:'请选择'});
                $(".answerList1 div[name='s1']",wraper).select({
                    data : arr, 
                    onchange:function(val){
                        var s2 = $(".answerList2 div[name='s2']",wraper);
                        var s3 = $(".answerList3 div[name='s3']",wraper);
                        if(val!=""){ 
                        s2.select({
                            urlData:{url:'/shopmanage-ws/ws/0.1/inspectionHistoryV2Cms/getCarOwernAnswerByPId?parentId='+val,
                                id:'answerItemId',
                                name:'answerItemIdName'
                            },
                            unshiftData:{id:'',name:'请选择'},
                            val:''
                        });
                        }else{
                            s2.select({ 
                                urlData:{url:''},
                                data:[{id:'',name:'请选择'}],
                                val:''
                            }); 
                        }
                        s3.select({ 
                            urlData:{url:''},
                            data:[{id:'',name:'请选择'}],
                            val:''
                        }); 
                    }
                });
                $(".answerList2 div[name='s2']",wraper).select({
                    data : [{"id":"","name":"请选择"}],
                    onchange:function(val){
                        var s3 = $(".answerList3 div[name='s3']",wraper);
                        if(val!=""){ 
                        s3.select({
                            urlData:{url:'/shopmanage-ws/ws/0.1/inspectionHistoryV2Cms/getCarOwernAnswerByPId?parentId='+val,
                                id:'answerItemId',
                                name:'answerItemIdName'
                            },
                            unshiftData:{id:'',name:'请选择'},
                            val:''
                        });
                        
                        }else{
                            s3.select({ 
                                urlData:{url:''},
                                data:[{id:'',name:'请选择'}],
                                val:''
                            });
                        } 
                    }
                }); 
                $(".answerList3 div[name='s3']",wraper).select({
                    data : [{"id":"","name":"请选择"}],
                    onclick:function(data){
                        $(".hideserid").attr("serviceId",data.id)
                    }
                });
            }else if(key ==6){
                $(".other-service").show();
                $(".number-service").hide();
                $(".ser").hide();
                $(".act").hide();
            }else if(key == 7){
                $(".other-service").hide();
                $(".number-service").show();
                $(".ser").hide();
                $(".act").hide();
            }else{
                $(".ser").show();
                $(".act").hide();
                $(".other-service").hide();  
                $(".number-service").hide();
                $('#Form_detail_info div[name="serviceId"]',wraper).select('val','')
                $('#Form_detail_info div[name="serviceId"]',wraper).select({
                    urlData:{
                        url:'/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+key+'&businessInfoId='+carsmart_config.businessInfoId,
                        id: 'id',
                        name: 'serviceName',
                        type: 'get',
                        dataType: 'json',
                        val: '',
                        selectedItems:true
                    }, 
                    unshiftData:{id:'',name:'请选择'},
                    onclick:function(data){
                        var jsonParm = $.jRadGet({url:'/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+key+'&businessInfoId='+carsmart_config.businessInfoId})
                        var price;
                        var workHour;
                        var serviceId;
                        if(data.id == ''){
                            $(".hideserid").html("");
                        }else{
                            $.each(jsonParm,function(i){
                                var item = jsonParm[i];
                                if(item.id == data.id){
                                    price = item.reservePrice;
                                    workHour = item.workHour
                                    serviceId = item.id
                                }
                            })
                            $(".hideserid").attr({workHour:workHour,price:price,serviceId:serviceId});
                        }
                    }
                })                
            }
        }
    });

    var now = new Date();
    var currentdate = now.getFullYear()+"-"+((now.getMonth()+1)<10?"0":"")+(now.getMonth()+1)+"-"+(now.getDate()<10?"0":"")+now.getDate();
    
    $('.date-picker').datepicker( {
        changeMonth: true, 
        changeYear: true, 
        showButtonPanel: true, 
        dateFormat: 'yy-mm', 
        onClose: function(dateText, inst) { 
            var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val(); 
            var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val(); 
            $(this).datepicker('setDate', new Date(year, month, 1)); 
            $("ui-datepicker-calendar").hide();
        },
    });

    page_column_model.push({display: '工单id', name : 'workOrderId',hidden:true});
    page_column_model.push({display: '客户姓名', name : 'userName'});
    page_column_model.push({display: '手机号', name : 'mobile'});
    page_column_model.push({display: '车牌号', name : 'plateNumber'});
    page_column_model.push({display: '排队时间(分)', name : 'lineUp',diy:function(item,$div){
        if(item.lineUp == 1){
            $div.html("0")
        }else if(item.lineUp == 2){
            $div.html("0～30")
        }else{
            $div.html(">30")
        }
    }});
    page_column_model.push({display: '赠送洗车', name : 'isWash'});
    page_column_model.push({display: '客户是否取回废件', name : 'isRetain'});
    page_column_model.push({display: '派单时间', name : 'sendOrderTime'});
    page_column_model.push({display: '完工时间', name : 'completeDate'});
    page_column_model.push({display: '工单状态', name : 'workOrderType'});
    page_column_model.push({display: '操作', name : 'operate',width:200 ,diy:function(item,$div){
            var $info = $("<a>").addClass('flexOperate').html("查看详情");
            var $edit = $("<a>").addClass('flexOperate').html("修改"); 
            var $del = $("<a>").addClass('flexOperate').html("删除");
            if(item.workOrderType == "已结算" || item.workOrderType == "取消"){    
                $div.append($info)
            }else{
                $div.append($info).append($edit).append($del)
            }
            
            $info.click(function(){
                $("#Form_workOrder .btn-primary").hide();
                editAndInfo(item)
                $(".em-updata-name").hide();
                $(".em-updata-gongwei").hide();
                $(".em-delete").hide();
                $(".em-add").hide();
                $(".em-edit").hide();
            })

            $edit.click(function(){
                $('#Form_workOrder .btn-primary').eq(0).hide();
                $('#Form_workOrder .btn-primary').eq(1).show();
                editAndInfo(item)

                $('#Form_workOrder .btn-primary').eq(1).show();
                $(".updateBtn").show(); 
                $(".addBtn").hide();

                $(".em-add").show();
                $(".em-edit").show();
            })

            $del.click(function(){
                $.jRadConfirm('确认删除吗？',1,function(){
                    var postData = {};
                    postData.shopAccountId = carsmart_config.shopId;
                    postData.operator = carsmart_config.operatorName;
                    postData.workOrderId = item.workOrderId;
                    $.jRadPost({  
                        url:'/vip-ws/ws/0.1/busiWorkOrder/delWorkOrder',
                        data:postData, 
                        success: function(data){ 
                            $('#Table_workOrder_manage').flexMessage('删除成功!', 'success');
                            $('#Table_workOrder_manage').flexReload();
                        },
                        error:function(xhr){ 
                            var errormsg = eval("(" + xhr.responseText + ")"); 
                            if (errormsg != undefined) {
                                $('#Table_workOrder_manage').flexMessage(errormsg[0].message, 'error');
                            }
                        }
                    });
                }); 
            });
    }});

    page_column_model_b.push({display: '工单id', name : 'appointmentOrderId',hidden:true});
    page_column_model_b.push({display: '关联订单ID', name : 'orderNumber'});
    page_column_model_b.push({display: '施工技师', name : 'employeeName'});
    page_column_model_b.push({display: '工位及时间',name:'testgong',diy:function(item,$div){
        $div.html(item.stationName+'<br>'+item.appointmentStartTime.substring(5,16)+'-'+item.appointmentEndTime.substring(11,16))
    }});
    page_column_model_b.push({display: '服务名称', name : 'serviceName',width:300});
    page_column_model_b.push({display: '配件费', name : 'partsPrice'});
    page_column_model_b.push({display: '工时费', name : 'workHourPrice'});
    page_column_model_b.push({display: '结算金额', name : 'clearPrice'});


    page_column_model_c.push({display: '工单号', name : 'orderNumb',diy:function(item,$div){
        $div.html($(".work-number").html().substring(5))
    }});
    page_column_model_c.push({display: '服务名称 ', name : 'serviceName'});
    page_column_model_c.push({display: '配件名称', name : 'partName'});
    page_column_model_c.push({display: '单价', name : 'partPrice'});
    page_column_model_c.push({display: '数量', name : 'partNum'});
    page_column_model_c.push({display: '结算金额', name : 'totalAmount'});

    page_column_model_d.push({display: '服务名称', name : 'serviceName'});
    page_column_model_d.push({display: '配件名称', name : 'partName'});
    page_column_model_d.push({display: '单价', name : 'partPrice'});
    page_column_model_d.push({display: '数量', name : 'partNum'});
    page_column_model_d.push({display: '结算金额', name : 'totalAmount'});
    page_column_model_d.push({display: '配件差价', name : 'difAmount'});
    page_column_model_d.push({display: '操作时间', name : 'createDate'});

    //操作区的调用
    function editAndInfo(item){
        var dtails = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getWorkOrder?workOrderId='+item.workOrderId});
        $('#jrad-table',wraper).hide();
        $('.details-box',wraper).show();
        $("#btn-scroll-up").click(); 

        $('.shop-name').html(dtails.busiReg);
        $('.shop-addre').html('地址：'+dtails.address);
        if(dtails.serviceTel == ''){
            $('.shop-phone').hide();
        }else{
            $('.shop-phone').show().html('电话：'+dtails.serviceTel);
        }
        if(dtails.workOrderType == ''){
            $('.work-status').hide();
        }else{
            $('.work-status').show().html('工单状态：'+dtails.workOrderType).attr("orderTypeCode",dtails.orderTypeCode);
        }
        if(dtails.workOrderType == "待结算"){
            $(".workPlay").show();
        }else{
            $(".workPlay").hide();
        }

        $('.work-number').html('工单编号：'+dtails.number);
        $('.work-number').attr('workOrderId',dtails.workOrderId)

        $(".car-mobile").val(dtails.mobile);
        $(".car-mobile").attr({disabled:"disabled",userInfoId:dtails.userInfoId});
        $(".carInfoId").attr("carInfoId",dtails.carInfoId)
        $(".car-name").val(dtails.userName)
        $(".car-style").val(dtails.seriesId)

        $(".car-plateNumber").val(dtails.plateNmber)
        $(".car-vinNumber").val(dtails.vinNumber)
        $(".car-machineNumber").val(dtails.machineNumber)
        $(".car-carKm").val(dtails.carKm)
        $(".completeDate").html(dtails.completeDate)
        $(".qualityPeopleName").html(dtails.qualityPeopleName);
        $(".getCash").html(dtails.cashierName)
        $(".partHistory").hide();

        $(".ycb-div1 strong").removeClass("cur")
        if(dtails.carOilRemain == 1){
            $(".ycb-div1 strong").eq(0).addClass("cur")
        }else if(dtails.carOilRemain == 2){
            $(".ycb-div1 strong").eq(1).addClass("cur")
        }else if(dtails.carOilRemain == 3){
            $(".ycb-div1 strong").eq(2).addClass("cur")
        }else if(dtails.carOilRemain == 4){
            $(".ycb-div1 strong").eq(3).addClass("cur")
        }else if(dtails.carOilRemain == 5){
            $(".ycb-div1 strong").eq(4).addClass("cur")
        }
        if(dtails.carOilRemain == undefined || dtails.carOilRemain == ''){
            $(".ycb-div1 strong").eq(2).addClass("cur")
        }

        if(dtails.interiorDestory == 0){
            $(".ycb-div2 strong").eq(1).addClass("cur")
        }else{
            $(".ycb-div2 strong").eq(1).removeClass("cur")
            $(".ycb-div2 strong").eq(0).addClass("cur")
        }
        $(".ycb-div3 strong").removeClass("cur")
        if(dtails.isWash == 0){
            $(".ycb-div3 strong").eq(1).addClass("cur")
        }else{
            $(".ycb-div3 strong").eq(1).removeClass("cur")
            $(".ycb-div3 strong").eq(0).addClass("cur")
        }
        $(".ycb-div7 strong").removeClass("cur")
        if(dtails.elecDeviceIsDestory == 0){
            $(".ycb-div7 strong").eq(1).addClass("cur")
        }else{
            $(".ycb-div7 strong").eq(1).removeClass("cur")
            $(".ycb-div7 strong").eq(0).addClass("cur")
        }

        $(".ycb-div5 strong").removeClass("cur")
        if(dtails.lineUp == 1){
            $(".ycb-div5 strong").eq(0).addClass("cur")
        }else if(dtails.lineUp == 2){
            $(".ycb-div5 strong").eq(1).addClass("cur")
        }else{
            $(".ycb-div5 strong").eq(2).addClass("cur")
        }

        if(dtails.isRetainUsed == 0){
            $(".ycb-div6 strong").eq(1).addClass("cur")
        }else{
            $(".ycb-div6 strong").eq(1).removeClass("cur")
            $(".ycb-div6 strong").eq(0).addClass("cur")
        }

        $(".repairDiscription").val(dtails.repairDiscription);
        $(".faultOrOption").text(dtails.faultOrOption);

        var arr = dtails.appearanceInspectArea.split(",");
        $.each(arr,function(i){
            var item = arr[i]
            if(item == 1){
                $(".ycb-tu a").eq(i).attr("style","filter:alpha(opacity=100);-moz-opacity:1;opacity:1;");
            }else{
                $(".ycb-tu a").eq(i).css("style","filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;");
            }
        })

        addAppbody();
        function addAppbody(){
            var workOrderId = $(".work-number").attr("workorderid")
            var partData = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId})
            var str1 = "";
            var str2 = "";
            var str3 = "";
            var inStr = "";
            var appId = '';
            var ars = [];
            $.each(partData,function(i){
                var item = partData[i];
                var del = '';
                if(item.appointmentType == 1){
                    del = '<em></em>'
                }else{
                    del = '<em class="em-delete">删除</em>'
                }
                if(item.isEditPrice == 0){
                    appId = item.appointmentOrderId;
                    var postListData = item.partsList;
                    if(postListData.length == 0){
                        str1 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                            + '<td colspan="1">'
                                +'<label>'+item.orderNumber+'</label>'
                            +'</td>'
                            + '<td colspan="1" style="white-space:nowrap">'
                                +'<label>'+item.employeeName+'</label>'
                                +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                            +'</td>'
                            + '<td colspan="2">'
                                +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                            +'</td>'
                            + '<td colspan="2">'
                                +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                +del
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt1"></label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt2"></label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt3">'+item.workHourPrice+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt4">'+item.clearPrice+'</label>'
                            +'</td>'
                        +'</tr>'
                    }
                    if(postListData.length == 1){
                        str2 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                            + '<td colspan="1">'
                                +'<label>'+item.orderNumber+'</label>'
                            +'</td>'
                            + '<td colspan="1" style="white-space:nowrap">'
                                +'<label>'+item.employeeName+'</label>'
                                +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                            +'</td>'
                            + '<td colspan="2">'
                                +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                            +'</td>'
                            + '<td colspan="2">'
                                +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                +del
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label>'+postListData[0].partName+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label>'+postListData[0].partPrice+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt1">'+postListData[0].partNum+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt2">'+postListData[0].sumPartPrice+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt3">'+item.workHourPrice+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt4">'+item.clearPrice+'</label>'
                            +'</td>'
                        +'</tr>'
                    }
                    if(postListData.length >= 2){
                        var lg = postListData.length;
                        $.each(postListData,function(j){
                            var inCont = postListData[j]
                            inStr = '<td colspan="1">'
                                    +'<label>'+inCont.partName+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label>'+inCont.partPrice+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label  class="queCnt1">'+inCont.partNum+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt2">'+inCont.sumPartPrice+'</label>'
                                +'</td>'

                                str3 += '<tr class="row1 tr-border tr-center creatTr">'
                                    + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label>'+item.orderNumber+'</label>'
                                    +'</td>'
                                    + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="white-space:nowrap;display:table-cell">'
                                        +'<label>'+item.employeeName+'</label>'
                                        +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                    +'</td>'
                                    + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                        +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                    +'</td>'
                                    + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                        +del
                                    +'</td>'
                                    + inStr
                                    + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label class="queCnt3">'+item.workHourPrice+'</label>'
                                    +'</td>'
                                    + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label  class="queCnt4">'+item.clearPrice+'</label>'
                                    +'</td>'
                                +'</tr>'
                            
                        })
                    }
                    ars.push(item.appointmentOrderId)
                }
                if(item.isEditPrice == 1){
                    appId = item.appointmentOrderId;
                    var postListData = item.partsList;
                    if(postListData.length == 0){
                        str1 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                            + '<td colspan="1">'
                                +'<label>'+item.orderNumber+'</label>'
                            +'</td>'
                            + '<td colspan="1" style="white-space:nowrap">'
                                +'<label>'+item.employeeName+'</label>'
                                +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                            +'</td>'
                            + '<td colspan="2">'
                                +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                            +'</td>'
                            + '<td colspan="2">'
                                +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                +del
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt1"></label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt2"></label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label><input class="workInputPrice queCnt3" type="text" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.workHourPrice+'"></label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label><input type="text" class="clearInputPrice queCnt4" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.clearPrice+'"></label>'
                            +'</td>'
                        +'</tr>'
                    }
                    if(postListData.length == 1){
                        str2 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                            + '<td colspan="1">'
                                +'<label>'+item.orderNumber+'</label>'
                            +'</td>'
                            + '<td colspan="1" style="white-space:nowrap">'
                                +'<label>'+item.employeeName+'</label>'
                                +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                            +'</td>'
                            + '<td colspan="2">'
                                +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                            +'</td>'
                            + '<td colspan="2">'
                                +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                +del
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label>'+postListData[0].partName+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label>'+postListData[0].partPrice+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label class="queCnt1">'+postListData[0].partNum+'</label>'
                            +'</td>'
                            + '<td colspan="1">'
                                +'<label  class="queCnt2">'+postListData[0].sumPartPrice+'</label>'
                            +'</td>'
                            + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                +'<label><input type="text" class="workInputPrice queCnt3" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.workHourPrice+'"></label>'
                            +'</td>'
                            + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                +'<label><input type="text" class="clearInputPrice queCnt4" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.clearPrice+'"></label>'
                            +'</td>'
                        +'</tr>'
                    }
                    if(postListData.length >= 2){
                        var lg = postListData.length;
                        $.each(postListData,function(j){
                            var inCont = postListData[j]
                            inStr = '<td colspan="1">'
                                    +'<label>'+inCont.partName+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label>'+inCont.partPrice+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt1">'+inCont.partNum+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label  class="queCnt2">'+inCont.sumPartPrice+'</label>'
                                +'</td>'

                                str3 += '<tr class="row1 tr-border tr-center creatTr">'
                                    + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label>'+item.orderNumber+'</label>'
                                    +'</td>'
                                    + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="white-space:nowrap;display:table-cell">'
                                        +'<label>'+item.employeeName+'</label>'
                                        +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                    +'</td>'
                                    + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                        +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                    +'</td>'
                                    + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                        +del
                                    +'</td>'
                                    + inStr
                                    + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label><input type="text" class="workInputPrice queCnt3" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.workHourPrice+'"></label>'
                                    +'</td>'
                                    + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="display:table-cell">'
                                        +'<label><input type="text" class="clearInputPrice queCnt4" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.clearPrice+'"></label>'
                                    +'</td>'
                                +'</tr>'
                            
                        })
                    }
                    ars.push(item.appointmentOrderId)
                }
            })
            $('.creatTr').remove();
            $('#tab-top').after(str1).after(str2).after(str3);
            $.each(ars,function(i){
                var aa = ars[i]
                if($("."+aa).length >=2 ){
                    $("."+aa).hide();
                    $("."+aa).eq(0).show();
                    $("."+aa).eq(1).show();
                    $("."+aa).eq(2).show();
                    $("."+aa).eq(3).show();
                    $("."+aa).eq(4).show();
                    $("."+aa).eq(5).show();
                }
            })
        }

        $("#Form_workOrder .em-add").click(function(){ 
            if($(".car-mobile").val() == ''){
                $.jRadAlert("请先填写车主电话。","error");
                return false;
            }else{
                var _this = $(this) 
                $(".ser").show(); 
                $(".act").hide();
                $(".other-service").hide();  
                $(".number-service").hide();
                $("#Form_detail_info",wraper).form({
                    fields:field_params,
                    title:'项目详情',
                    grid: 18,
                    item:{offerType:1},
                    submit:function(){
                        var json = {}
                        json.businessInfoId = carsmart_config.businessInfoId;
                        json.workOrderId = $(".work-number").attr("workorderid")
                        json.userInfoId = $('.car-mobile').attr("userinfoid");
                        json.carInfoId = $(".carInfoId").attr("carInfoId");
                        json.mobile = $(".car-mobile").val();
                        json.offerType = $('#Form_detail_info div[name="offerType"]',wraper).radio('val');
                        json.serviceId = $('.ser div[name="serviceId"]',wraper).select('val');
                        
                        if($('#Form_detail_info div[name="offerType"]',wraper).radio('val') == 7){
                            json.orderNumber = $('.number-service div[name="orderNumber"]',wraper).input('val');
                        }
                        if($('#Form_detail_info div[name="offerType"]',wraper).radio('val') == 5){
                            // json.serviceName = $('.act div[name="s3"]').select('val');
                            // json.workHour = $('.act div[name="workHour"]').input('val');
                            json.serviceName = $('.act div[name="s3"] span').html();
                            json.workHour = $('.act div[name="workHour"]').input('val');
                            json.serviceId = $('.act div[name="s3"]').select('val');
                        }
                        if($('#Form_detail_info div[name="offerType"]',wraper).radio('val') == 6){
                            json.serviceName = $('.other-service div[name="serviceName"]').input('val');
                            json.workHour = $('.other-service div[name="workHour"]').input('val');
                        }
                        $.jRadPost({
                            url:'/vip-ws/ws/0.1/busiWorkOrder/addAppointmentOrder',
                            data:json,
                            success:function(data){ 
                                //var workHourHid = 
                                addAppbody();
                                hejiFn()
                                $("#Form_detail_info",wraper).form({}).form('close');
                            },
                            error:function(xhr){
                                var errormsg = eval("(" + xhr.responseText + ")");
                                $.jRadMessage({message: errormsg[0].message,level: 'error',selector:$("#Form_detail_info .pop-up-middle")})
                            }
                        });
                    }
                }).form('open');
            }
        })

        $("#Form_workOrder").undelegate('.em-edit','click').delegate('.em-edit','click',function(){
            var workOrderId = $('.work-number').attr('workOrderId')
            $("#Form_edit_Part").form({
                title:'服务配件表',
                grid: 18,
                submit:function(){
                    $.jRadGet({
                        url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId,
                        success:function(data){   
                            $("#Form_edit_Part",wraper).form({}).form('close')
                            addAppbody()
                            hejiFn()
                        }
                    });
                }
            }).form('open');
            $("#Form_edit_Part .pop-up-close").click(function(){
                $("#Form_edit_Part",wraper).form({}).form('close')
                addAppbody()
                hejiFn()
            })
            addAppEditBody()
            function addAppEditBody(){
                var workOrderId = $(".work-number").attr("workorderid")
                var partData = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId})
                var str1 = "";
                var str2 = "";
                var str3 = "";
                var inStr = "";
                var appId = '';
                var ars = [];
                $.each(partData,function(i){
                    var item = partData[i];
                    appId = item.appointmentOrderId;
                    var postListData = item.partsList;
                    if(postListData.length == 0){
                        str1 += '<tr>'
                            + '<td>'
                                +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'<br><span class="add-part">添加配件</span>'+'</label>'
                            +'</td>'
                            + '<td>'
                                +'<label></label>'
                            +'</td>'
                            + '<td>'
                                +'<label></label>'
                            +'</td>'
                            + '<td>'
                                +'<label></label>'
                            +'</td>'
                            + '<td>'
                                +'<label></label>'
                            +'</td>'
                            + '<td>'
                            +'</td>'
                        +'</tr>'
                    }
                    if(postListData.length == 1){
                        str2 += '<tr>'
                            + '<td>'
                                +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'<br><span class="add-part">添加配件</span>'+'</label>'
                            +'</td>'
                            + '<td>'
                                +'<label>'+postListData[0].partName+'</label>'
                            +'</td>'
                            + '<td>'
                                +'<label>'+postListData[0].partPrice+'</label>'
                            +'</td>'
                            + '<td>'
                                +'<label>'+postListData[0].partNum+'</label>'
                            +'</td>'
                            + '<td>'
                                +'<label>'+postListData[0].sumPartPrice+'</label>'
                            +'</td>'
                            + '<td>'
                                +'<span class="part-updata" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+postListData[0].partsDetailId+'" commodityId="'+postListData[0].commodityId+'">修改&nbsp;&nbsp;&nbsp;&nbsp;</span>'
                                +'<span class="part-delete" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+postListData[0].partsDetailId+'" commodityId="'+postListData[0].commodityId+'">删除</span>'
                            +'</td>'
                        +'</tr>'
                    }
                    if(postListData.length >= 2){
                        var lg = postListData.length;
                        $.each(postListData,function(j){
                            var inCont = postListData[j]
                            inStr = '<td>'
                                    +'<label>'+inCont.partName+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+inCont.partPrice+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+inCont.partNum+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+inCont.sumPartPrice+'</label>'
                                +'</td>'
                                str3 += '<tr class="edit-creatTr">'
                                    + '<td rowspan="'+lg+'" class="'+appId+'">'
                                        +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'<br><span class="add-part">添加配件</span>'+'</label>'
                                    +'</td>'
                                    + inStr
                                    + '<td>'
                                        +'<span class="part-updata" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+inCont.partsDetailId+'" commodityId="'+inCont.commodityId+'">修改&nbsp;&nbsp;&nbsp;&nbsp;</span>'
                                        +'<span class="part-delete" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+inCont.partsDetailId+'" commodityId="'+inCont.commodityId+'">删除</span>'
                                    +'</td>'
                                +'</tr>'
                            
                        })
                    }
                    ars.push(item.appointmentOrderId)
                })
                $('#part-table tbody').html("");

                //$('.edit-creatTr').remove();
                $('#part-table tbody').append(str1).append(str2).append(str3);
                //$('#tab-top').after(str1).after(str2).after(str3);
                $.each(ars,function(i){
                    var aa = ars[i]
                    if($("."+aa).length >=2 ){
                        $("."+aa).hide();
                        $(".edit-creatTr ."+aa).eq(0).show();
                    }
                })
            }

            $("#Form_edit_Part",wraper).undelegate('.add-part','click').delegate('.add-part','click',function(){
                var _that = $(this)
                $("#Form_edit_Part").form({}).form('close')
                var partEmp = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                $("#Form_part_caozuo").form({
                    title:'配件操作',
                    grid: 12,
                    item:{},
                    url:'/vip-ws/ws/0.1/busiWorkOrder/addPart',
                    preSubmit:function(json){
                        json.appointmentOrderId = _that.parent().attr('appointmentOrderId')
                        json.workOrderId = $(".work-number").attr("workorderid");
                        if($('.work-status')){
                            json.workOrderStatus = $('.work-status').attr("orderTypeCode")
                        }
                        if($('.nameSelect').is(':visible')){
                            json.partName = $('#Form_part_caozuo div[name=commodityId] span').html();
                        }
                        if($('.nameInput').is(':visible')){
                            json.partName = $('#Form_part_caozuo input[name=partName]').val();
                        }
                        json.shopAccountId = carsmart_config.shopId;
                        json.operatorId = carsmart_config.userId;
                        json.operator = carsmart_config.operatorName;
                        json.saveType = 1;

                        return json
                    },
                    success:function(data){
                        $("#Form_part_caozuo").form({}).form('close')
                        $("#Form_edit_Part").form({}).form('open')
                        addAppEditBody()
                    },
                    error:function(xhr){
                        var errormsg = eval("(" + xhr.responseText + ")");
                        $.jRadMessage({level:'error',message:errormsg[0].message,selector:$("#Form_part_caozuo .pop-up-middle")});
                    }
                }).form('open')

                $("#Form_part_caozuo .pop-up-close").click(function(){
                    //$("#Form_part_caozuo",wraper).form({}).form('close')
                    addAppbody()
                    hejiFn()
                })

                if(partEmp.length == 0){
                    $(".nameSelect").hide();
                    $(".nameInput").show();
                }else{
                    $(".nameInput").hide();
                    $(".nameSelect").show();
                    $("#Form_part_caozuo div[name='partPrice']").input('val',partEmp[0].salePrice);
                    $("#Form_part_caozuo div[name='partPrice']").input('readonly',true);
                    var s_commodityId = partEmp[0].commodityId;
                    $('#Form_part_caozuo div[name="commodityId"]').select({
                        urlData:{
                            url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId,
                            id: 'commodityId',
                            name: 'partName',
                            type: 'get',
                            dataType: 'json'
                        },
                        onclick:function(data){
                            var partEmp2 = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                            var salePrice;
                            if(partEmp2.length != 0){
                                $.each(partEmp2,function(i){
                                    var item = partEmp2[i];
                                    if(item.commodityId == data.id){
                                        salePrice = item.salePrice;
                                    }
                                })
                            }
                            $("#Form_part_caozuo div[name='partPrice']").input('val',salePrice);
                        }
                    });
                    $("#Form_part_caozuo div[name='commodityId']").select('val',s_commodityId);
                }
            })

            $("#Form_edit_Part",wraper).undelegate('.part-updata','click').delegate('.part-updata','click',function(){
                var _that = $(this)
                var partsDetailId = _that.attr('partsDetailId');
                var partName = _that.parent().parent().find("td label").eq(1).html();
                var partPrice = _that.parent().parent().find("td label").eq(2).html()
                var partNum = _that.parent().parent().find("td label").eq(3).html()
                var partEmp = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                $("#Form_edit_Part").form({}).form('close')
                $("#Form_part_caozuo").form({
                    title:'配件操作',
                    grid: 12,
                    item:{'partPrice':partPrice,'partNum':partNum},
                    url:'/vip-ws/ws/0.1/busiWorkOrder/editPart',
                    preSubmit:function(json){
                        json.partsDetailId = partsDetailId;
                        json.workOrderId = $(".work-number").attr("workorderid");
                        if($('.work-status')){
                            json.workOrderStatus = $('.work-status').attr("orderTypeCode")
                        }
                        if($('.nameSelect').is(':visible')){
                            json.partName = $('#Form_part_caozuo div[name=commodityId] span').html();
                        }
                        if($('.nameInput').is(':visible')){
                            json.partName = $('#Form_part_caozuo input[name=partName]').val();
                        }
                        json.appointmentOrderId = _that.attr('appointmentOrderId')
                        json.shopAccountId = carsmart_config.shopId;
                        json.operatorId = carsmart_config.userId;
                        json.operator = carsmart_config.operatorName;
                        json.saveType = 2;
                        return json
                    },
                    success:function(data){
                        $("#Form_part_caozuo").form({}).form('close')
                        $("#Form_edit_Part").form({}).form('open')
                        addAppEditBody()
                    },
                    error:function(xhr){
                        var errormsg = eval("(" + xhr.responseText + ")");
                        $.jRadMessage({level:'error',message:errormsg[0].message,selector:$("#Form_part_caozuo .pop-up-middle")});
                    }
                }).form('open')

                $("#Form_part_caozuo .pop-up-close").click(function(){
                    //$("#Form_part_caozuo",wraper).form({}).form('close')
                    addAppbody()
                    hejiFn()
                })

                if(partEmp.length == 0){
                    $(".nameSelect").hide();
                    $(".nameInput").show();
                    $("#Form_part_caozuo div[name='partName']").input('val',partName)
                }else{
                    $(".nameInput").hide();
                    $(".nameSelect").show();

                    $("#Form_part_caozuo div[name='partPrice']").input('readonly',true)
                    $('#Form_part_caozuo div[name=commodityId]').select({
                        urlData:{
                            url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId,
                            id: 'commodityId',
                            name: 'partName',
                            type: 'get',
                            dataType: 'json'
                        },
                        onclick:function(data){
                            var partEmp2 = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                            var salePrice;
                            if(partEmp2.length != 0){
                                $.each(partEmp2,function(i){
                                    var item = partEmp2[i];
                                    if(item.commodityId == data.id){
                                        salePrice = item.salePrice;
                                    }
                                })
                            }
                            $("#Form_part_caozuo div[name='partPrice']").input('val',salePrice);
                        }
                    });

                    var commodityId;
                    if(partEmp.length != 0){
                        $.each(partEmp,function(i){
                            var item = partEmp[i];
                            if(item.partName == partName){
                                commodityId = item.commodityId;
                            }
                        })
                    }
                    $("#Form_part_caozuo div[name='commodityId']").select('val',commodityId);
                }
            })

            $("#Form_edit_Part",wraper).undelegate('.part-delete','click').delegate('.part-delete','click',function(){
                $("#Form_edit_Part").form({}).form('close')
                var _that = $(this)
                var partsDetailId = _that.attr('partsDetailId');
                var postData={};
                postData.partsDetailId=partsDetailId;
                postData.partName=_that.parent().parent().find("td label").eq(1).html();
                postData.partNum=_that.parent().parent().find("td label").eq(3).html()
                postData.partPrice=_that.parent().parent().find("td label").eq(2).html()
                postData.workOrderId=$(".work-number").attr("workorderid");
                if($('.work-status')){
                    postData.workOrderStatus = $('.work-status').attr("orderTypeCode")
                }
                postData.appointmentOrderId = _that.attr('appointmentOrderId')
                postData.commodityId=_that.attr('commodityId');
                postData.shopAccountId = carsmart_config.shopId;
                postData.operatorId = carsmart_config.userId;
                postData.operator = carsmart_config.operatorName;
                postData.saveType = 3;
                $.jRadConfirm('确认删除吗？',1,function(){
                    $.jRadAjax({
                        type:'post',
                        data:postData,
                        url:'/vip-ws/ws/0.1/busiWorkOrder/delPart',  
                        success: function(){
                            $("#Form_edit_Part").form({}).form('open')
                            addAppEditBody()
                        },
                        error:function(xhr){
                            var errormsg = eval("(" + xhr.responseText + ")"); 
                            if (errormsg != undefined) {
                                $('#Form_edit_Part').flexMessage(errormsg[0].message, 'error');
                            }
                        }
                    });
                });
            })
        })
           
        /* 配件历史 */  
        $("#Form_workOrder",wraper).undelegate('.em-history','click').delegate('.em-history','click',function(){  
            $(".ycb-table tbody").hide(); 
            $(".partHistory").show();
            var busiWorkOrderId = $(".work-number").attr("workorderid");
            $.jRadGet({
                url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsHistoryData?busiWorkOrderId='+busiWorkOrderId+'&isFirst='+1,
                success:function(data){
                    var tr_len=$("#Table_accountdetail",wraper).find("tr").length;
                    for(cur=0;cur<tr_len;cur++){
                      if(cur!==0){
                        $("#Table_accountdetail",wraper).find("tr").eq(cur).hide();
                      }
                    };
                    var str="";
                    if(data.length != 0){
                        $.each(data,function(i){
                            var _item=data[i];
                            str+="<tr>"
                                +"<td>"+dtails.number+"</td>"
                                +"<td>"+_item.serviceName+"</td>"
                                +"<td>"+_item.partName+"</td>"
                                +"<td>"+_item.partPrice+"</td>"
                                +"<td>"+_item.partNum+"</td>"
                                +"<td>"+_item.totalAmount+"</td>"
                                +"</tr>";
                        });
                        $("#Table_accountdetail").append(str);
                    }else{
                        var str1 = $("<tr><td style='text-align:center' colspan='6'>沒有配件內容</td></tr>")
                        $("#Table_accountdetail tbody").append(str1)
                    }
                }
            })
            $.jRadGet({
                url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsHistoryData?busiWorkOrderId='+busiWorkOrderId+'&isFirst='+0,
                success:function(data){
                    var tr_len=$("#Table_accountdetail2",wraper).find("tr").length;
                    for(cur=0;cur<tr_len;cur++){
                      if(cur!==0){
                        $("#Table_accountdetail2",wraper).find("tr").eq(cur).hide();
                      }
                    };
                    var str="";
                    if(data.length != 0){
                        $.each(data,function(i){
                            var _item=data[i];
                            str+="<tr>"
                                +"<td>"+_item.serviceName+"</td>"
                                +"<td>"+_item.partName+"</td>"
                                +"<td>"+_item.partPrice+"</td>"
                                +"<td>"+_item.partNum+"</td>"
                                +"<td>"+_item.totalAmount+"</td>"
                                +"<td>"+_item.difAmount+"</td>"
                                +"<td>"+_item.createDate+"</td>"
                                +"</tr>";
                        });
                        $("#Table_accountdetail2").append(str);
                    }else{
                        var str2 = $("<tr><td style='text-align:center' colspan='7'>沒有配件修改历史</td></tr>")
                        $("#Table_accountdetail2 tbody").append(str2)
                    }
                }
            })

            $(".title-p1 span").eq(0).html("配件修改历史")
            $(".sdiv .mDiv").html("原配件内容");
            $(".zdiv .mDiv").html("配件修改历史");
            $(".ui-form .bbit-grid").css("margin","0")
            $(".updateBtn").hide();
            $(".f-right").removeClass("return").addClass("part-return")

            $("#Form_workOrder",wraper).undelegate('.part-return','click').delegate('.part-return','click',function(){
                $('#jrad-table',wraper).hide(); 
                $('.details-box',wraper).show();
                $(".ycb-table tbody").show(); 
                //$(".updateBtn").show();
                var item = {workOrderId:busiWorkOrderId}
                editAndInfo(item)
                $(".partHistory").hide();
                $(".title-p1 span").eq(0).html("养车宝工单")
                $(".f-right").removeClass("part-return").addClass("return")
                if(!$(".em-add").is(':visible')){
                    $(".em-updata-name").hide();
                    $(".em-updata-gongwei").hide();
                    $(".em-delete").hide();
                    $(".updateBtn").hide();
                    $(".addBtn").hide();
                }
                else{
                    $(".updateBtn").show();
                }
            })
        })

        $("#Form_workOrder",wraper).undelegate('.em-delete','click').delegate('.em-delete','click',function(){
            var _that = $(this)
            var pastData = {};
            pastData.appointmentOrderId = _that.prev().attr('appointmentOrderId');
            pastData.businessInfoId = carsmart_config.businessInfoId;
            pastData.userInfoId = carsmart_config.userId;
            $.jRadConfirm('确认删除吗？',1,function(){
                $.jRadAjax({
                    type:'post',
                    data:pastData,
                    url:'/vip-ws/ws/0.1/busiWorkOrder/delAppointmentOrder',  
                    success: function(){
                        addAppbody();
                        hejiFn()
                    },
                    error:function(xhr){
                        var errormsg = eval("(" + xhr.responseText + ")"); 
                        if (errormsg != undefined) {
                            $('#Form_edit_Part').flexMessage(errormsg[0].message, 'error');
                        }
                    }
                });
            });
        })
        
        /* 工位及时间 */
        $("#Form_workOrder",wraper).undelegate('.em-updata-gongwei','click').delegate('.em-updata-gongwei','click',function(){
            var _that = $(this)
            $(".ybs-gongshi-select").show();
            $(".drag").show();
            $(".ul-gongwei").html("");
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/getWorkHourStationList?businessInfoId='+carsmart_config.businessInfoId,
                success:function(data){
                    var staUl;
                    staUl = $('<ul class="clearfix workUl"></ul>');
                    $.each(data,function(i){
                        var item = data[i]
                        var staLi;
                        staLi = $('<li stationId="'+item.stationId+'">'+item.stationName+'</li>')
                        staUl.append(staLi)
                    })
                    $(".ul-gongwei").append(staUl)
                    $(".ul-gongwei ul li").eq(0).addClass("t-active");
                }   
            })

            var appointmentOrderId = _that.parent().parent().find("td label").eq(3).attr("appointmentorderid");
            var plateNumber = $(".car-plateNumber").val();
            var serviceName = _that.parent().parent().find("td label").eq(3).html();
            var workHour = _that.attr("workHour");
            var stationId = $(".ul-gongwei ul li[class='t-active']").attr("stationId");

            gwAndTimeFnItem(appointmentOrderId,plateNumber,serviceName,workHour,stationId)

            function gwAndTimeFnItem(appointmentOrderId,plateNumber,serviceName,workHour,stationId){

                createTable(stationId)

                function createTable(stationId){
                    var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
                    var startTime = getTimeForBusi.startHour;       
                    var endTime = getTimeForBusi.endHour;
                    var arr=[];
                    for(var i = startTime; i<=endTime-1; i++){
                        var s = i+1;
                        if (s >= 10)
                        {
                            var starParam = i + ":00";
                            var endParam = i+1 +":00";
                            arr.push(starParam + "-" +endParam);
                        }
                        else{
                            var starParam = "0"+i + ":00";
                            var endParam = "0"+s+":00";
                            arr.push(starParam + "-" +endParam);
                        } 
                    }
                    var table =$('<table></table');
                    $.jRadGet({
                        url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?stationId='+stationId,
                        success:function(data){
                            var th;
                            var thead = $('<thead></thead>');
                            var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                            $.each(data,function(i){
                                var item1 = data[i]
                                th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                                tr.append(th);
                                thead.append(tr)
                            })  
                            table.append(thead);

                            return tableData = data;
                        }
                    })
                    $(".ycbTable").append(table)
                    var yesdaty = $(".ycbTable thead th").eq(1).attr("DatePara");
                    var dodaty = $(".ycbTable thead th").eq(2).attr("DatePara");
                    var masdaty = $(".ycbTable thead th").eq(3).attr("DatePara");
                    var tbody = $('<tbody></tbody>');
                    $.each(arr,function(i){
                        var z = startTime+i
                        if(z >= 10){
                            var startTimeBy = z
                        }else{
                            var startTimeBy = "0"+z
                        }
                        var starParamDou1 = startTimeBy+":00"+":00"
                        var starParamDou2 = startTimeBy+":10"+":00"
                        var starParamDou3 = startTimeBy+":20"+":00"
                        var starParamDou4 = startTimeBy+":30"+":00"
                        var starParamDou5 = startTimeBy+":40"+":00"
                        var starParamDou6 = startTimeBy+":50"+":00"
                        var item2 = arr[i]
                        var tr0;
                        var tr1;
                        var tr2;
                        tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                        tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                        tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                        tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                        tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                        tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                        tbody.append(tr1)
                        tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
                    })
                    table.append(tbody)
                    $(".ycbTable").html("");
                    $(".ycbTable").append(table)
                    $(".ycb-alert-wrap").css("height",$(".ybs-gongshi-select").height()-180);     

                    var valArr = [];
                    $('.ycbTable input').each(function(i){
                        valArr.push($('.ycbTable input').eq(i).attr("value"))
                    })
                    var tdtwowid = $(".ycbTable table td").eq(1).width()/2;
                    var inpuWid = $(".ycbTable input").eq(0).width();
                    $.each(tableData,function(i){
                        var item = tableData[i];
                        $.each(item.orderList,function(j){
                            var str = item.orderList[j];
                            var X1;
                            var Y1;
                            $.each(valArr,function(k){
                                if(str.appointmentStartTime == valArr[k]){
                                    X1 = $('.ycbTable input').eq(k).position().top;
                                    Y1 = $('.ycbTable input').eq(k).position().left-tdtwowid+inpuWid+4;
                                }
                            })
                            var tdWidth = $('.ycbTable input').eq(0).parent().width()+2;
                            var tdHeight = $('.ycbTable input').eq(0).parent().height()+2;
                            
                            var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+str.plateNumber+'<br>'+str.serviceName+'</div>')
                            $(".ycbTable").append(warpDiv)
                        })
                    })

                    var warpDiv2 = $('<div class="warpDiv2" style="display:table;"></div>').html("")
                    $(".ycbTable input").bind('click',function(){
                        $(".succAndErr").html("")
                        var X1 = $(this).position().top;
                        var Y1 = $(this).position().left-100;
                        var tdWidth = $(this).parent().width()+2;
                        var tdHeight = $(this).parent().height()+2;
                        // warpDiv2.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html(plateNumber+'<br>'+serviceName).attr("val",$(this).attr("value"))
                        warpDiv2.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+plateNumber+'<br>'+serviceName+'</div>').attr("val",$(this).attr("value"))
                        $(".ycbTable").append(warpDiv2)
                        var aWarpDiv = $(".ycbTable .warpDiv");
                        for (var i = 0; i < aWarpDiv.length; i++){
                            if ( cdTest (warpDiv2,aWarpDiv.eq(i)) ){
                                $(".succAndErr").html("选择工时与其他预约服务时间重复！").css("color","red")
                                $(".ycbTable .warpDiv2").remove();
                                $(this).attr("checked",false);
                            }
                        }
                    })       
                }

                function cdTest (obj1,obj2){
                    var l1=obj1.offset().left;
                    var r1=obj1.offset().left+obj1.width();
                    var t1=obj1.offset().top;
                    var b1=obj1.offset().top+obj1.height();
                    
                    var l2=obj2.offset().left;
                    var r2=obj2.offset().left+obj2.width();
                    var t2=obj2.offset().top;
                    var b2=obj2.offset().top+obj2.height();
                    
                    if (r1<l2 || l1>r2 || b1<t2 || t1>b2) {
                            return false;
                    }else{
                            return true;
                    }
                }

                $(".workUl li").click(function() {   
                    $(".workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
                    var stationId = $(".workUl li").eq($(this).index()).attr("stationId");
                    createTable(stationId);
                });

                /* 弹框里的确认选择 */
                $(".trurBtn").click(function(){

                    if($(".ycbTable .warpDiv2").length != 0){
                        $(".ybs-gongshi-select").hide();
                        $(".drag").hide();
                        var pastData = {};
                        pastData.appointmentOrderId = appointmentOrderId;
                        pastData.workHour = workHour;
                        pastData.workStationInfoId = $(".ul-gongwei .t-active").attr("stationid");
                        pastData.appointmentStartTime = $(".warpDiv2").attr("val");
                        $.ajax({
                            type:'post',
                            async:false,
                            dataType:'json',
                            data:$.toJSON(pastData),
                            contentType:'application/json;charset=utf-8',
                            url:'/vip-ws/ws/0.1/AppointmentManager/editAppointOrder',  
                            success: function(){
                                addAppbody();
                                $("#Form_detail_info",wraper).form({}).form('close');
                            }
                        })
                    }else{
                        //alert("请选择工位工时");
                        $.jRadAlert("请选择工位工时",'error');
                    }
                })

                /* 查询空闲工位 */
                $(".button-gongwei").click(function(){
                    var businessInfoId = carsmart_config.businessInfoId;
                    var freeTime = $(".employInput").val();
                    var workHour = $(this).attr("workhour");
                    $(".succAndErr").html("")
                    $.ajax({
                        type:'get',
                        async:false,
                        url:'/vip-ws/ws/0.1/AppointmentManager/getFreeStation?businessInfoId='+carsmart_config.businessInfoId+'&freeTime='+freeTime+'&workHour='+workHour,  
                        success: function(data){
                            if(data.length == 0){
                                $(".succAndErr").html("没有空闲工位")
                            }else{
                                var arrStation;
                                arrStation = $('<div></div>');
                                $.each(data,function(i){
                                    var item = data[i];
                                    var alistr;
                                    alistr = $('<span stationId="'+item.stationId+'">'+item.stationName+'</span>');
                                    arrStation.append(alistr)
                                })
                                $(".succAndErr").html("空闲工位：").append(arrStation).css("color","#393939")
                            }
                        },
                        error:function(xhr){
                            var mes = eval("("+xhr.responseText+")");  
                            $(".succAndErr").html(mes[0].message).css("color","#ff0000")
                        }
                    })
                })
                $(".alert-head a").click(function(){
                    $(".ybs-yuangong-select").hide();
                    $(".ybs-gongshi-select").hide();
                    $(".drag").hide();
                })
            }
        })

        /* 技师按钮 */
        $("#Form_workOrder",wraper).undelegate('.em-updata-name','click').delegate('.em-updata-name','click',function(){
            var _that = $(this)
            $(".ybs-yuangong-select").show();
            $(".drag").show();
            var mach = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId})
            $(".employSel").html("")
            $.each(mach,function(i){
                var item = mach[i]
                var creatOption = $('<option emp="'+item.shopEmployeeId+'" positionName="'+item.positionName+'">'+item.name+'</option>')
                $(".employSel").append(creatOption)
            })

            $(".ul-yuangong").html("");
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId,
                success:function(data){
                    var staUl = '';
                    var staLi = '';
                    staUl = $('<ul class="clearfix workUl"></ul>');
                    $.each(data,function(i){
                        var item = data[i]
                        staLi = $('<li class="" shopEmployeeId="'+item.shopEmployeeId+'">'+item.name+'('+item.positionName+')'+'</li>')
                        staUl.append(staLi)
                    })
                    $(".ul-yuangong").append(staUl)
                    $(".ul-yuangong ul li").eq(0).addClass("t-active");
                }   
            })

            var appointmentOrderId = _that.parent().parent().find("td label").eq(3).attr("appointmentorderid");
            var plateNumber = $(".car-plateNumber").val();
            var serviceName = _that.parent().parent().find("td label").eq(3).html();
            var workHour = _that.attr("workHour");
            var shopEmployeeId_a = $(".ul-yuangong ul li[class='t-active']").attr("shopEmployeeId");

            jishiFnItem(appointmentOrderId,plateNumber,serviceName,workHour,shopEmployeeId_a)

            function jishiFnItem(appointmentOrderId,plateNumber,serviceName,workHour,shopEmployeeId_a){

                createTable(shopEmployeeId_a)

                function createTable(shopEmployeeId_a){
                    var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
                    var startTime = getTimeForBusi.startHour;       
                    var endTime = getTimeForBusi.endHour;
                    var arr=[];
                    for(var i = startTime; i<=endTime-1; i++){
                        var s = i+1;
                        if (s >= 10)
                        {
                            var starParam = i + ":00";
                            var endParam = i+1 +":00";
                            arr.push(starParam + "-" +endParam);
                        }
                        else{
                            var starParam = "0"+i + ":00";
                            var endParam = "0"+s+":00";
                            arr.push(starParam + "-" +endParam);
                        } 
                    }
                    var table =$('<table></table');
                    $.jRadGet({
                        url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?shopEmployeeId='+shopEmployeeId_a,
                        success:function(data){
                            var th;
                            var thead = $('<thead></thead>');
                            var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                            $.each(data,function(i){
                                var item1 = data[i]
                                th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                                tr.append(th);
                                thead.append(tr)
                            })  
                            table.append(thead) 
                            return tableData = data;
                        }
                    })
                    $(".ycbMech").append(table)
                    var yesdaty = $(".ycbMech thead th").eq(1).attr("DatePara");
                    var dodaty = $(".ycbMech thead th").eq(2).attr("DatePara");
                    var masdaty = $(".ycbMech thead th").eq(3).attr("DatePara");
                    var tbody = $('<tbody></tbody>');
                    $.each(arr,function(i){
                        var z = startTime+i
                        if(z >= 10){
                            var startTimeBy = z
                        }else{
                            var startTimeBy = "0"+z
                        }
                        var starParamDou1 = startTimeBy+":00"+":00"
                        var starParamDou2 = startTimeBy+":10"+":00"
                        var starParamDou3 = startTimeBy+":20"+":00"
                        var starParamDou4 = startTimeBy+":30"+":00"
                        var starParamDou5 = startTimeBy+":40"+":00"
                        var starParamDou6 = startTimeBy+":50"+":00"
                        var item2 = arr[i]
                        var tr0;
                        var tr1;
                        var tr2;
                        tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                        tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                        tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                        tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                        tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                        tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                        tbody.append(tr1)
                        tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
                    })
                    table.append(tbody)
                    $(".ycbMech input[type='radio']").css({"filter":"alpha(opacity=0)","-moz-opacity":"0", "opacity": "0"})
                    $(".ycb-alert-wrap").css("height",$(".ybs-yuangong-select").height()-180);
                    $(".ycbMech").html("");
                    $(".ycbMech").append(table);
                    var valArr = [];
                    $('.ycbMech input').each(function(i){
                        valArr.push($('.ycbMech input').eq(i).attr("value"))
                    })

                    var activeName = $(".ul-yuangong .t-active").html();
                    var tdtwowid = $(".ycbMech table td").eq(1).width()/2;
                    var inpuWid = $(".ycbMech input").eq(0).width();
                    $.each(tableData,function(i){
                        var item = tableData[i];
                        $.each(item.orderList,function(j){
                            var str = item.orderList[j];
                            var X1;
                            var Y1;
                            $.each(valArr,function(k){
                                if(str.appointmentStartTime == valArr[k]){
                                    X1 = $('.ycbMech input').eq(k).position().top;
                                    Y1 = $('.ycbMech input').eq(k).position().left-tdtwowid+inpuWid+4;
                                }
                            })
                            var tdWidth = $('.ycbMech input').eq(0).parent().width()+2;
                            var tdHeight = $('.ycbMech input').eq(0).parent().height()+2;
                            
                            var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+activeName+'<br>'+str.serviceName+'</div>') //.attr("val",$(this).attr("value"));
                            $(".ycbMech").append(warpDiv)
                        })
                    })
                }
                
                $(".workUl li").click(function() {   
                    $(".workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
                    var shopEmployeeId = $(".workUl li").eq($(this).index()).attr("shopemployeeid");
                    createTable(shopEmployeeId);
                });

                /* 弹框里的确认选择 */
                $(".button-yuangong").click(function(){
                    $(".ybs-yuangong-select").hide();
                    $(".drag").hide();
                    var pastData = {};
                    pastData.appointmentOrderId = appointmentOrderId;
                    pastData.shopEmployeeId = $('.employSel option:selected').attr("emp");
                    $.ajax({
                        type:'post',
                        async:false,
                        dataType:'json',
                        data:$.toJSON(pastData),
                        contentType:'application/json;charset=utf-8',
                        url:'/vip-ws/ws/0.1/AppointmentManager/editAppointOrder',  
                        success: function(){
                            addAppbody();
                            $("#Form_detail_info",wraper).form({}).form('close');
                        }
                    })
                })
                $('.ybs-yuangong-select').on('click','.alert-head a',function(){
                    $(".ybs-yuangong-select").hide();
                    $(".ybs-gongshi-select").hide();
                    $(".drag").hide();
                })
            }
        })

        $(".alert-head a").click(function(){
            $(".ybs-yuangong-select").hide();
            $(".ybs-gongshi-select").hide();
            $(".drag").hide();
        })

        /* 价格input框 */
        $('#Form_workOrder').on('blur','.workInputPrice',function(){
            var pastData = {};
            pastData.appointmentOrderId = $(this).attr("appointmentOrderId")
            //pastData.appointmentOrderId = $(this).parent().parent().attr("class")
            pastData.workHourPrice = $(this).val();
            $.ajax({
                type:'post',
                async:false,
                dataType:'json',
                data:$.toJSON(pastData),
                contentType:'application/json;charset=utf-8',
                url:'/vip-ws/ws/0.1/busiWorkOrder/editAppointmentOrder',  
                success: function(){
                    addAppbody();
                    var str = '';
                    $(".cntTr").html("")
                    str += '<td colspan="1">'
                            +'<label>合计</label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="2">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="2">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label class="heji1"></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label class="heji2"></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label class="heji3"></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label class="heji4"></label>'
                        +'</td>'

                    $(".cntTr").append(str);

                    hejiFn()
                }
            })
        })

        /* 价格input框 */
        $('#Form_workOrder').on('blur','.clearInputPrice',function(){
            var pastData = {};
            //pastData.appointmentOrderId = $(this).parent().parent().attr("class")
            pastData.appointmentOrderId = $(this).attr("appointmentOrderId")
            pastData.clearPrice = $(this).val();
            $.ajax({
                type:'post',                
                async:false,
                dataType:'json',
                data:$.toJSON(pastData),
                contentType:'application/json;charset=utf-8',
                url:'/vip-ws/ws/0.1/busiWorkOrder/editAppointmentOrder',  
                success: function(){
                    addAppbody();
                    var str = '';
                    $(".cntTr").html("")
                    str += '<td colspan="1">'
                            +'<label>合计</label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="2">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="2">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label class="heji1"></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label class="heji2"></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label class="heji3"></label>'
                        +'</td>'
                        +'<td colspan="1">'
                            +'<label class="heji4"></label>'
                        +'</td>'

                    $(".cntTr").append(str);

                    hejiFn()
                }
            })
        })
        
        /* 结算按钮 */
        $(".workPlay").click(function(){
            var workOrderId = $('.work-number').attr('workOrderId')
            var operator = carsmart_config.operatorName;
            var data = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/prePayWorkOrder?workOrderId='+workOrderId+'&operator='+operator})

            $('#Form_workOrder_jiesuan_workid').form({
                title:'收款',
                grid:14,
                type:'get'
            }).form('open')
            var workId= $(this).attr("workorderid");
            var str="";
            $("#table_workOrder_jiesuan_workid").html("");
            $.each(data.servicesList,function(i){
                var _item=data.servicesList[i];
                str+="<tr>"
                    +"<td>服务"+(i+1)+"</td>"
                    +"<td>"+_item.serviceName+"</td>"
                    +"<td>合计："+_item.money+"</td>"
                    +"<td>"+_item.payType+"</td>"
                    +"</tr>";
            });
            $("#table_workOrder_jiesuan_workid",wraper).append(str);
            $(".jiesuan-btn span").html(data.topay);

            $("#Form_workOrder_jiesuan_workid").on('click','.jiesuan-btn',function(){
                $('#Form_workOrder_jiesuan_workid').form("close")
                $.jRadConfirm('已收到客户支付的'+data.topay+'元？',1,function(){   
                    var operator = carsmart_config.operatorName;
                    $.jRadGet({  
                        url:'/vip-ws/ws/0.1/busiWorkOrder/payOffLine?workOrderId='+workOrderId+'&operator='+operator,
                        success: function(data){ 
                            $(".workPlay").val("已结算").attr("disabled",true)
                            $(".work-status").html("工单状态：已结算")
                            $(".return",wraper).click()
                            $(".vdiv .btn-info").eq(2).click();
                        },
                        error:function(xhr){ 
                            $('#Form_workOrder_jiesuan_workid').form({}).form("open")
                            var errormsg = eval("(" + xhr.responseText + ")"); 
                            if (errormsg != undefined) {
                                $('#Form_workOrder_jiesuan_workid .pop-up-middle').flexMessage(errormsg[0].message, 'error');
                            }
                        }
                    });
                });
            })
        })

        $(".carComeTime").val(dtails.carComeTime);
        $(".expectCarTime").val(dtails.expectCarTime)
        $(".completeDate").val(dtails.completeDate)

        $('#Form_workOrder .updateBtn').unbind('click').bind('click',function(){
                var isAndno1 = ''; //油表显示
                if($(".ycb-div1 strong").eq(0).hasClass("cur")){
                    isAndno1 = 1;
                }else if($(".ycb-div1 strong").eq(1).hasClass("cur")){
                    isAndno1 = 2;
                }else if($(".ycb-div1 strong").eq(2).hasClass("cur")){
                    isAndno1 = 3;
                }else if($(".ycb-div1 strong").eq(3).hasClass("cur")){
                    isAndno1 = 4; 
                }else{
                    isAndno1 = 5; 
                }
                var isAndno2 = '';//内饰是否损失
                if($(".ycb-div2 strong").eq(0).hasClass("cur")){
                    isAndno2 = 1;
                }else{
                    isAndno2 = 0;
                }
                var isAndno3 = '';//是否洗车
                if($(".ycb-div3 strong").eq(0).hasClass("cur")){
                    isAndno3 = 1;
                }else{
                    isAndno3 = 0;
                }
                var isAndno7 = '';//机电设备是否故障
                if($(".ycb-div7 strong").eq(0).hasClass("cur")){
                    isAndno7 = 1;
                }else{
                    isAndno7 = 0;
                }
                var isAndno5 = ''; //排队时间
                if($(".ycb-div5 strong").eq(0).hasClass("cur")){
                    isAndno5 = 1;
                }else if($(".ycb-div5 strong").eq(1).hasClass("cur")){
                    isAndno5 = 2;
                }else{
                    isAndno5 = 3;
                }
                var isAndno6 = '';//是否取回废件
                if($(".ycb-div6 strong").eq(0).hasClass("cur")){
                    isAndno6 = 1;
                }else{
                    isAndno6 = 0;
                }
                var arr = [];
                var string = '';
                $(".round").each(function(i){
                    if($(this).attr("style") == "filter:alpha(opacity=100);-moz-opacity:1;opacity: 1;"){
                        arr.push(1)
                    }else{
                        arr.push(0)
                    }
                })
                var workOrderId = $('.work-number').attr("workOrderId")
                var appointmentOrderList = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId});
                
                var json = {};
                json.workOrderId = workOrderId;
                json.businessInfoId = carsmart_config.businessInfoId;
                json.userInfoId = $(".car-mobile").attr("userInfoId");
                json.carInfoId = $(".carInfoId").attr("carInfoId");
                json.carKm = $('.car-carKm').val();
                json.carOilRemain = isAndno1;//油表显示
                json.interiorDestory = isAndno2;//内饰是否损失
                json.elecDeviceIsDestory = isAndno7;//机电设备是否故障
                json.lineUp = isAndno5 //排队时间
                json.isWash = isAndno3; //是否赠送洗车
                json.isRetainUsed = isAndno6; //是否保留配件
                json.repairDiscription = $(".repairDiscription").val();
                json.appearanceInspectArea = arr.toString();
                json.faultOrOption = $(".faultOrOption").val();
                json.carComeTime = $('.carComeTime').val();
                json.expectCarTime = $('.expectCarTime').val();
                json.opertor = carsmart_config.operatorName;
                json.appointmentOrderList = appointmentOrderList;

                $.jRadPost({
                    url:"/vip-ws/ws/0.1/busiWorkOrder/editWorkOrder",
                    data:json, 
                    success:function(){ 
                        $.jRadMessage({level:'success', message:'修改成功！',selectors:$("#Form_workOrder")});
                        $('#Table_workOrder_manage').flexReload();
                        $('#jrad-table',wraper).show();
                        $('.details-box',wraper).hide();
                    },
                    error:function(data){
                        var mes = eval('('+data.responseText+')');
                        $.jRadMessage({level:'error', message:mes[0].message, selectors:$("#Form_workOrder")});
                    }
                });

                $("#btn-scroll-up").click();
        });
        
        hejiFn()
    }

    page_search_items.push({row:'1',type:'jrad-input',display:'客户姓名',name:'userName'});
    page_search_items.push({row:'1',type:'jrad-input',display:'手机号',name:'mobile'});
    page_search_items.push({row:'1',type:'jrad-input',display:'车牌号',name:'plateNumber'});
    page_search_items.push({row:'2',type:'jrad-input',display:'关联订单编号',name:'orderNumber'});

    page_search_items.push({row:'2',type:'jrad-select',display:'排队时间(分)',name:'lineUp',params:{data:[
        {id:' ',name:'全部'},{id:'1',name:'0'},{id:'2',name:'0～30'},{id:'3',name:'>30'}]}
    });
    page_search_items.push({row:'2',type:'jrad-select',display:'赠送洗车',name:'isWash',params:{data:[
        {id:' ',name:'全部'},{id:'1',name:'是'},{id:'0',name:'否'}]}
    });
    page_search_items.push({row:'3',type:'jrad-select',display:'客户是否取回废件',name:'isRetain',params:{data:[
        {id:' ',name:'全部'},{id:'1',name:'是'},{id:'0',name:'否'}]}
    });
    page_search_items.push({row:'3',type:'jrad-select',display:'工单状态',name:'workOrderType',params:{data:[
        {id:' ',name:'全部'},{id:'1',name:'待派单'},{id:'2',name:'施工中'},{id:'3',name:'质检中'},{id:'4',name:'待结算'},{id:'5',name:'已结算'},{id:'6',name:'取消'}]}
    });

    page_search_items.push({row:'4',type:'jrad-dateinput',display:'派单时间始',name:'sendOrderTimeStart'});
    page_search_items.push({row:'4',type:'jrad-dateinput',display:'派单时间终',name:'sendOrderTimeEnd'});
    page_search_items.push({row:'5',type:'jrad-dateinput',display:'完工时间始',name:'completeDateStart'});
    page_search_items.push({row:'5',type:'jrad-dateinput',display:'完工时间终',name:'completeDateEnd'});

    $('#Form_workOrder',wraper).form({
        validators: jRad.validators,
        fields:field_params,
        layout: 'grid', 
        autobinding: false
    }); 

    $('#Form_workOrder .carComeTime').datetimepickerBS({
        format: 'yyyy-mm-dd hh:ii',
        autoclose: 1, 
        startView: 2,
        maxView: 1,
        todayHighlight:true,
        pickerPosition:'bottom-left', 
        language: "zh-CN"
    });    
    $('#Form_workOrder .expectCarTime').datetimepickerBS({
        format: 'yyyy-mm-dd hh:ii',
        autoclose: 1, 
        startView: 2,
        maxView: 1,
        todayHighlight:true,
        pickerPosition:'bottom-left', 
        language: "zh-CN"
    });
    $('.ybs-gongshi-select .employInput').datetimepickerBS({
        format: 'yyyy-mm-dd hh:ii:ss',
        autoclose: 1, 
        startView: 2,
        maxView: 1,
        todayHighlight:true,
        pickerPosition:'bottom-left', 
        language: "zh-CN"
    }); 

    page_list_buttons.push({title: '创建',displayname:'创建',bclass: 'icon-plus',
        onpress : function(){
            var busInfo = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/preCreateWorkOrder?businessInfoId='+carsmart_config.businessInfoId})
            $('.shop-name').html(busInfo.busiReg);
            $('.shop-addre').html('地址：'+busInfo.address);
            if(busInfo.serviceTel == ''){
                $('.shop-phone').hide();
            }else{
                $('.shop-phone').html('电话：'+busInfo.serviceTel);
            }
            $('.work-status').hide()
            $('.work-number').html('工单编号：'+busInfo.number);
            $('.work-number').attr('workOrderId',busInfo.workOrderId)

            $('#jrad-table',wraper).hide(); 
            $('.details-box',wraper).show();
            $("#btn-scroll-up").click(); 
            $("#Form_workOrder .btn-primary").show();
            $('#Form_workOrder .btn-primary').eq(0).show();
            $('#Form_workOrder .btn-primary').eq(1).hide();
            $(".workPlay").hide();

            $(".em-updata-name").show();
            $(".em-updata-gongwei").show();
            $(".em-delete").show();
            $(".em-add").show();
            $(".em-edit").show();

            $(".partHistory").hide();

            reatSet() //重置时

            addAppbody();
            function addAppbody(){
                var workOrderId = $(".work-number").attr("workorderid")
                var partData = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId})
                var str1 = "";
                var str2 = "";
                var str3 = "";
                var inStr = "";
                var appId = '';
                var ars = [];
                $.each(partData,function(i){
                    var item = partData[i];
                    var del = '';
                    if(item.appointmentType == 1){
                        del = '<em></em>'
                    }else{
                        del = '<em class="em-delete">删除</em>'
                    }
                    if(item.isEditPrice == 0){
                        appId = item.appointmentOrderId;
                        var postListData = item.partsList;
                        if(postListData.length == 0){
                            str1 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                                + '<td colspan="1">'
                                    +'<label>'+item.orderNumber+'</label>'
                                +'</td>'
                                + '<td colspan="1" style="white-space:nowrap">'
                                    +'<label>'+item.employeeName+'</label>'
                                    +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2">'
                                    +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                    +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2" style="word-break:break-all">'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                    +del
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label></label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label></label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt1"></label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt2"></label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt3">'+item.workHourPrice+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt4">'+item.clearPrice+'</label>'
                                +'</td>'
                            +'</tr>'
                        }
                        if(postListData.length == 1){
                            str2 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                                + '<td colspan="1">'
                                    +'<label>'+item.orderNumber+'</label>'
                                +'</td>'
                                + '<td colspan="1" style="white-space:nowrap">'
                                    +'<label>'+item.employeeName+'</label>'
                                    +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2">'
                                    +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                    +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2" style="word-break:break-all">'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                    +del
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label>'+postListData[0].partName+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label>'+postListData[0].partPrice+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt1">'+postListData[0].partNum+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt2">'+postListData[0].sumPartPrice+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt3">'+item.workHourPrice+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt4">'+item.clearPrice+'</label>'
                                +'</td>'
                            +'</tr>'
                        }
                        if(postListData.length >= 2){
                            var lg = postListData.length;
                            $.each(postListData,function(j){
                                var inCont = postListData[j]
                                inStr = '<td colspan="1">'
                                        +'<label>'+inCont.partName+'</label>'
                                    +'</td>'
                                    + '<td colspan="1">'
                                        +'<label>'+inCont.partPrice+'</label>'
                                    +'</td>'
                                    + '<td colspan="1">'
                                        +'<label  class="queCnt1">'+inCont.partNum+'</label>'
                                    +'</td>'
                                    + '<td colspan="1">'
                                        +'<label class="queCnt2">'+inCont.sumPartPrice+'</label>'
                                    +'</td>'

                                    str3 += '<tr class="row1 tr-border tr-center creatTr">'
                                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label>'+item.orderNumber+'</label>'
                                        +'</td>'
                                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="white-space:nowrap">'
                                            +'<label>'+item.employeeName+'</label>'
                                            +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                        +'</td>'
                                        + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                            +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                        +'</td>'
                                        + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'" style="word-break:break-all">'
                                            +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                            +del
                                        +'</td>'
                                        + inStr
                                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label class="queCnt3">'+item.workHourPrice+'</label>'
                                        +'</td>'
                                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label  class="queCnt4">'+item.clearPrice+'</label>'
                                        +'</td>'
                                    +'</tr>'
                                
                            })
                        }
                        ars.push(item.appointmentOrderId)
                    }
                    if(item.isEditPrice == 1){
                        appId = item.appointmentOrderId;
                        var postListData = item.partsList;
                        if(postListData.length == 0){
                            str1 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                                + '<td colspan="1">'
                                    +'<label>'+item.orderNumber+'</label>'
                                +'</td>'
                                + '<td colspan="1" style="white-space:nowrap">'
                                    +'<label>'+item.employeeName+'</label>'
                                    +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2">'
                                    +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                    +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2" style="word-break:break-all">'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                    +del
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label></label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label></label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt1"></label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt2"></label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label><input class="workInputPrice queCnt3" type="text" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.workHourPrice+'"></label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label><input type="text" class="clearInputPrice queCnt4" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.clearPrice+'"></label>'
                                +'</td>'
                            +'</tr>'
                        }
                        if(postListData.length == 1){
                            str2 += '<tr class="row1 tr-border tr-center creatTr '+appId+'">'
                                + '<td colspan="1">'
                                    +'<label>'+item.orderNumber+'</label>'
                                +'</td>'
                                + '<td colspan="1" style="white-space:nowrap">'
                                    +'<label>'+item.employeeName+'</label>'
                                    +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2">'
                                    +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                    +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                +'</td>'
                                + '<td colspan="2" style="word-break:break-all">'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                    +del
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label>'+postListData[0].partName+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label>'+postListData[0].partPrice+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label class="queCnt1">'+postListData[0].partNum+'</label>'
                                +'</td>'
                                + '<td colspan="1">'
                                    +'<label  class="queCnt2">'+postListData[0].sumPartPrice+'</label>'
                                +'</td>'
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label><input type="text" class="workInputPrice queCnt3" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.workHourPrice+'"></label>'
                                +'</td>'
                                + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                    +'<label><input type="text" class="clearInputPrice queCnt4" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.clearPrice+'"></label>'
                                +'</td>'
                            +'</tr>'
                        }
                        if(postListData.length >= 2){
                            var lg = postListData.length;
                            $.each(postListData,function(j){
                                var inCont = postListData[j]
                                inStr = '<td colspan="1">'
                                        +'<label>'+inCont.partName+'</label>'
                                    +'</td>'
                                    + '<td colspan="1">'
                                        +'<label>'+inCont.partPrice+'</label>'
                                    +'</td>'
                                    + '<td colspan="1">'
                                        +'<label class="queCnt1">'+inCont.partNum+'</label>'
                                    +'</td>'
                                    + '<td colspan="1">'
                                        +'<label  class="queCnt2">'+inCont.sumPartPrice+'</label>'
                                    +'</td>'

                                    str3 += '<tr class="row1 tr-border tr-center creatTr">'
                                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label>'+item.orderNumber+'</label>'
                                        +'</td>'
                                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'" style="white-space:nowrap">'
                                            +'<label>'+item.employeeName+'</label>'
                                            +'<em class="em-updata-name" workHour="'+item.workHour+'">修改</em>'
                                        +'</td>'
                                        + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label>'+item.stationName+"<br>"+item.appointmentStartTime.substring(5,16)+"-"+item.appointmentEndTime.substring(11,16)+'</label>'
                                            +'<em class="em-updata-gongwei" workHour="'+item.workHour+'">修改</em>'
                                        +'</td>'
                                        + '<td colspan="2" rowspan="'+lg+'" class="'+appId+'" style="word-break:break-all">'
                                            +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'</label>'
                                            +del
                                        +'</td>'
                                        + inStr
                                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label><input type="text" class="workInputPrice queCnt3" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.workHourPrice+'"></label>'
                                        +'</td>'
                                        + '<td colspan="1" rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label><input type="text" class="clearInputPrice queCnt4" appointmentOrderId="'+item.appointmentOrderId+'" value="'+item.clearPrice+'"></label>'
                                        +'</td>'
                                    +'</tr>'
                                
                            })
                        }
                        ars.push(item.appointmentOrderId)
                    }
                })
                $('.creatTr').remove();
                $('#tab-top').after(str1).after(str2).after(str3);
                $.each(ars,function(i){
                    var aa = ars[i]
                    if($("."+aa).length >=2 ){
                        $("."+aa).hide();
                        $("."+aa).eq(0).show();
                        $("."+aa).eq(1).show();
                        $("."+aa).eq(2).show();
                        $("."+aa).eq(3).show();
                        $("."+aa).eq(4).show();
                        $("."+aa).eq(5).show();
                    }
                })
            }
            /* 增加 */
            $("#Form_workOrder").on('click','.em-add',function(){
                if($(".car-mobile").val() == ''){
                    $.jRadAlert("请先填写车主电话。","error");
                    return false;
                }else{
                    var _this = $(this) 
                    $(".ser").show(); 
                    $(".act").hide();
                    $(".other-service").hide();  
                    $(".number-service").hide();
                    $("#Form_detail_info",wraper).form({
                        fields:field_params,
                        title:'项目详情',
                        grid: 18,
                        item:{offerType:1},
                        submit:function(){
                            var json = {}
                            json.businessInfoId = carsmart_config.businessInfoId;
                            json.workOrderId = $(".work-number").attr("workorderid")
                            json.userInfoId = $('.car-mobile').attr("userinfoid");
                            json.carInfoId = $(".carInfoId").attr("carInfoId")
                            json.offerType = $('#Form_detail_info div[name="offerType"]',wraper).radio('val');
                            json.serviceId = $('.ser div[name="serviceId"]',wraper).select('val');
                            
                            if($('#Form_detail_info div[name="offerType"]',wraper).radio('val') == 7){
                                json.orderNumber = $('.number-service div[name="orderNumber"]',wraper).input('val');
                            }
                            if($('#Form_detail_info div[name="offerType"]',wraper).radio('val') == 5){
                                json.serviceName = $('.act div[name="s3"] span').html();
                                json.workHour = $('.act div[name="workHour"]').input('val');
                            }
                            if($('#Form_detail_info div[name="offerType"]',wraper).radio('val') == 6){
                                json.serviceName = $('.other-service div[name="serviceName"]').input('val');
                                json.workHour = $('.other-service div[name="workHour"]').input('val');
                            }
                            $.jRadPost({
                                url:'/vip-ws/ws/0.1/busiWorkOrder/addAppointmentOrder',
                                data:json,
                                success:function(data){ 
                                    addAppbody();
                                    hejiFn()
                                    $("#Form_detail_info",wraper).form({}).form('close');
                                },
                                error:function(xhr){
                                    var errormsg = eval("(" + xhr.responseText + ")");
                                    $.jRadMessage({message: errormsg[0].message,level: 'error',selector:$("#Form_detail_info .pop-up-middle")})
                                }
                            });
                        }
                    }).form('open');
                }
            })

            /* 编辑 */
            $("#Form_workOrder").on('click','.em-edit',function(){
                var workOrderId = $('.work-number').attr('workOrderId')
                $("#Form_edit_Part").form({
                    title:'服务配件表',
                    grid: 18,
                    submit:function(){
                        $.jRadGet({
                            url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId,
                            success:function(data){   
                                $("#Form_edit_Part",wraper).form({}).form('close')
                                addAppbody()
                                hejiFn()
                            }
                        });
                    }
                }).form('open');
                
                $("#Form_edit_Part .pop-up-close").click(function(){
                    addAppbody()
                    hejiFn()
                })

                addAppEditBody()
                function addAppEditBody(){
                    var workOrderId = $(".work-number").attr("workorderid")
                    var partData = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId})
                    var str1 = "";
                    var str2 = "";
                    var str3 = "";
                    var inStr = "";
                    var appId = '';
                    var ars = [];
                    $.each(partData,function(i){
                        var item = partData[i];
                        appId = item.appointmentOrderId;
                        var postListData = item.partsList;
                        if(postListData.length == 0){
                            str1 += '<tr>'
                                + '<td>'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'<br><span class="add-part">添加配件</span>'+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label></label>'
                                +'</td>'
                                + '<td>'
                                    +'<label></label>'
                                +'</td>'
                                + '<td>'
                                    +'<label></label>'
                                +'</td>'
                                + '<td>'
                                    +'<label></label>'
                                +'</td>'
                                + '<td>'
                                +'</td>'
                            +'</tr>'
                        }
                        if(postListData.length == 1){
                            str2 += '<tr>'
                                + '<td>'
                                    +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'<br><span class="add-part">添加配件</span>'+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+postListData[0].partName+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+postListData[0].partPrice+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+postListData[0].partNum+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<label>'+postListData[0].sumPartPrice+'</label>'
                                +'</td>'
                                + '<td>'
                                    +'<span class="part-updata" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+postListData[0].partsDetailId+'" commodityId="'+postListData[0].commodityId+'">修改&nbsp;&nbsp;&nbsp;&nbsp;</span>'
                                    +'<span class="part-delete" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+postListData[0].partsDetailId+'" commodityId="'+postListData[0].commodityId+'">删除</span>'
                                +'</td>'
                            +'</tr>'
                        }
                        if(postListData.length >= 2){
                            var lg = postListData.length;
                            $.each(postListData,function(j){
                                var inCont = postListData[j]
                                inStr = '<td>'
                                        +'<label>'+inCont.partName+'</label>'
                                    +'</td>'
                                    + '<td>'
                                        +'<label>'+inCont.partPrice+'</label>'
                                    +'</td>'
                                    + '<td>'
                                        +'<label>'+inCont.partNum+'</label>'
                                    +'</td>'
                                    + '<td>'
                                        +'<label>'+inCont.sumPartPrice+'</label>'
                                    +'</td>'
                                    str3 += '<tr class="edit-creatTr">'
                                        + '<td rowspan="'+lg+'" class="'+appId+'">'
                                            +'<label appointmentOrderId="'+item.appointmentOrderId+'">'+item.serviceName+'<br><span class="add-part">添加配件</span>'+'</label>'
                                        +'</td>'
                                        + inStr
                                        + '<td>'
                                            +'<span class="part-updata" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+inCont.partsDetailId+'" commodityId="'+inCont.commodityId+'">修改&nbsp;&nbsp;&nbsp;&nbsp;</span>'
                                            +'<span class="part-delete" appointmentOrderId="'+item.appointmentOrderId+'" partsDetailId="'+inCont.partsDetailId+'" commodityId="'+inCont.commodityId+'">删除</span>'
                                        +'</td>'
                                    +'</tr>'
                                
                            })
                        }
                        ars.push(item.appointmentOrderId)
                    })
                    $('#part-table tbody').html("");

                    $('.edit-creatTr').remove();
                    $('#part-table tbody').append(str1).append(str2).append(str3);
                    $.each(ars,function(i){
                        var aa = ars[i]
                        if($("."+aa).length >=2 ){
                            $("."+aa).hide();
                            $(".edit-creatTr ."+aa).eq(0).show();
                        }
                    })
                }

                $("#Form_edit_Part",wraper).undelegate('.add-part','click').delegate('.add-part','click',function(){
                    var _that = $(this)
                    $("#Form_edit_Part").form({}).form('close')
                    var partEmp = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                    $("#Form_part_caozuo").form({
                        title:'配件操作',
                        grid: 12,
                        item:{},
                        url:'/vip-ws/ws/0.1/busiWorkOrder/addPart',
                        preSubmit:function(json){
                            json.appointmentOrderId = _that.parent().attr('appointmentOrderId')
                            json.workOrderId = $(".work-number").attr("workorderid");
                            if($('.work-status')){
                                json.workOrderStatus = $('.work-status').attr("orderTypeCode")
                            }
                            if($('.nameSelect').is(':visible')){
                                json.partName = $('#Form_part_caozuo div[name=commodityId] span').html();
                            }
                            if($('.nameInput').is(':visible')){
                                json.partName = $('#Form_part_caozuo input[name=partName]').val();
                            }
                            json.shopAccountId = carsmart_config.shopId;
                            json.operatorId = carsmart_config.userId;
                            json.operator = carsmart_config.operatorName;
                            json.saveType = 1;

                            return json
                        },
                        success:function(data){
                            $("#Form_part_caozuo").form({}).form('close')
                            $("#Form_edit_Part").form({}).form('open')
                            addAppEditBody()
                        },
                        error:function(xhr){
                            var errormsg = eval("(" + xhr.responseText + ")");
                            $.jRadMessage({level:'error',message:errormsg[0].message,selector:$("#Form_part_caozuo .pop-up-middle")});
                        }
                    }).form('open')
                    $("#Form_part_caozuo .pop-up-close").click(function(){
                        addAppbody()
                        hejiFn()
                    })
                    if(partEmp.length == 0){
                        $(".nameSelect").hide();
                        $(".nameInput").show();
                    }else{
                        $(".nameInput").hide();
                        $(".nameSelect").show();
                        $("#Form_part_caozuo div[name='partPrice']").input('val',partEmp[0].salePrice)
                        $("#Form_part_caozuo div[name='partPrice']").input('readonly',true)
                        var s_commodityId = partEmp[0].commodityId
                        $('#Form_part_caozuo div[name=commodityId]').select({
                            urlData:{
                                url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId,
                                id: 'commodityId',
                                name: 'partName',
                                type: 'get',
                                dataType: 'json'
                            },
                            onclick:function(data){
                                var partEmp2 = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                                var salePrice;
                                if(partEmp2.length != 0){
                                    $.each(partEmp2,function(i){
                                        var item = partEmp2[i];
                                        if(item.commodityId == data.id){
                                            salePrice = item.salePrice;
                                        }
                                    })
                                }
                                $("#Form_part_caozuo div[name='partPrice']").input('val',salePrice);
                            }
                        });
                        $("#Form_part_caozuo div[name='commodityId']").select('val',s_commodityId);
                    }
                })

                $("#Form_edit_Part",wraper).undelegate('.part-updata','click').delegate('.part-updata','click',function(){
                    var _that = $(this)
                    var partsDetailId = _that.attr('partsDetailId');
                    var partName = _that.parent().parent().find("td label").eq(1).html();
                    var partPrice = _that.parent().parent().find("td label").eq(2).html()
                    var partNum = _that.parent().parent().find("td label").eq(3).html()
                    var partEmp = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                    $("#Form_edit_Part").form({}).form('close')
                    $("#Form_part_caozuo").form({
                        title:'配件操作',
                        grid: 12,
                        item:{'partPrice':partPrice,'partNum':partNum},
                        url:'/vip-ws/ws/0.1/busiWorkOrder/editPart',
                        preSubmit:function(json){
                            json.appointmentOrderId = _that.attr('appointmentOrderId')
                            json.partsDetailId = partsDetailId;
                            json.workOrderId = $(".work-number").attr("workorderid");
                            if($('.work-status')){
                                json.workOrderStatus = $('.work-status').attr("orderTypeCode")
                            }
                            if($('.nameSelect').is(':visible')){
                                json.partName = $('#Form_part_caozuo div[name=commodityId] span').html();
                            }
                            if($('.nameInput').is(':visible')){
                                json.partName = $('#Form_part_caozuo input[name=partName]').val();
                            }
                            json.shopAccountId = carsmart_config.shopId;
                            json.operatorId = carsmart_config.userId;
                            json.operator = carsmart_config.operatorName;
                            json.saveType = 2;
                            return json
                        },
                        success:function(data){
                            $("#Form_part_caozuo").form({}).form('close')
                            $("#Form_edit_Part").form({}).form('open')
                            addAppEditBody()
                        },
                        error:function(xhr){
                            var errormsg = eval("(" + xhr.responseText + ")");
                            $.jRadMessage({level:'error',message:errormsg[0].message,selector:$("#Form_part_caozuo .pop-up-middle")});
                        }
                    }).form('open')
                    $("#Form_part_caozuo .pop-up-close").click(function(){
                        addAppbody()
                        hejiFn()
                    })
                    if(partEmp.length == 0){
                        $(".nameSelect").hide();
                        $(".nameInput").show();
                        $("#Form_part_caozuo div[name='partName']").input('val',partName)
                    }else{
                        $(".nameInput").hide();
                        $(".nameSelect").show();

                        $("#Form_part_caozuo div[name='partPrice']").input('readonly',true)
                        $('#Form_part_caozuo div[name=commodityId]').select({
                            urlData:{
                                url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId,
                                id: 'commodityId',
                                name: 'partName',
                                type: 'get',
                                dataType: 'json'
                            },
                            onclick:function(data){
                                var partEmp2 = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getCommdityList?shopAccountId='+carsmart_config.shopId})
                                var salePrice;
                                if(partEmp2.length != 0){
                                    $.each(partEmp2,function(i){
                                        var item = partEmp2[i];
                                        if(item.commodityId == data.id){
                                            salePrice = item.salePrice;
                                        }
                                    })
                                }
                                $("#Form_part_caozuo div[name='partPrice']").input('val',salePrice);
                            }
                        });

                        var commodityId;
                        if(partEmp.length != 0){
                            $.each(partEmp,function(i){
                                var item = partEmp[i];
                                if(item.partName == partName){
                                    commodityId = item.commodityId;
                                }
                            })
                        }
                        $("#Form_part_caozuo div[name='commodityId']").select('val',commodityId);
                    }
                })

                $("#Form_edit_Part",wraper).undelegate('.part-delete','click').delegate('.part-delete','click',function(){
                    $("#Form_edit_Part").form({}).form('close')
                    var _that = $(this)
                    var partsDetailId = _that.attr('partsDetailId');
                    var postData={};
                    postData.partsDetailId=partsDetailId;
                    postData.partName=_that.parent().parent().find("td label").eq(1).html();
                    postData.partNum=_that.parent().parent().find("td label").eq(3).html()
                    postData.partPrice=_that.parent().parent().find("td label").eq(2).html()
                    postData.workOrderId=$(".work-number").attr("workorderid");
                    if($('.work-status')){
                        postData.workOrderStatus = $('.work-status').attr("orderTypeCode")
                    }
                    postData.appointmentOrderId = _that.attr('appointmentOrderId')
                    postData.commodityId=_that.attr('commodityId');
                    postData.shopAccountId = carsmart_config.shopId;
                    postData.operatorId = carsmart_config.userId;
                    postData.operator = carsmart_config.operatorName;
                    postData.saveType = 3;
                    $.jRadConfirm('确认删除吗？',1,function(){
                        $.jRadAjax({
                            type:'post',
                            data:postData,
                            url:'/vip-ws/ws/0.1/busiWorkOrder/delPart',  
                            success: function(){
                                $("#Form_edit_Part").form({}).form('open')
                                addAppEditBody()
                            },
                            error:function(xhr){
                                var errormsg = eval("(" + xhr.responseText + ")"); 
                                if (errormsg != undefined) {
                                    $('#Form_edit_Part').flexMessage(errormsg[0].message, 'error');
                                }
                            }
                        });
                    });
                })
            })

            /* 配件历史 */ 
            $("#Form_workOrder",wraper).undelegate('.em-history','click').delegate('.em-history','click',function(){ 
                $(".ycb-table tbody").hide(); 
                $(".partHistory").show();
                var busiWorkOrderId = $(".work-number").attr("workorderid");

                $.jRadGet({
                    url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsHistoryData?busiWorkOrderId='+busiWorkOrderId+'&isFirst='+1,
                    success:function(data){
                        var tr_len=$("#Table_accountdetail",wraper).find("tr").length;
                        for(cur=0;cur<tr_len;cur++){
                          if(cur!==0){
                            $("#Table_accountdetail",wraper).find("tr").eq(cur).hide();
                          }
                        };
                        var str="";
                        if(data.length != 0){
                            $.each(data,function(i){
                                var _item=data[i];
                                str+="<tr>"
                                    +"<td>"+dtails.number+"</td>"
                                    +"<td>"+_item.serviceName+"</td>"
                                    +"<td>"+_item.partName+"</td>"
                                    +"<td>"+_item.partPrice+"</td>"
                                    +"<td>"+_item.partNum+"</td>"
                                    +"<td>"+_item.totalAmount+"</td>"
                                    +"</tr>";
                            });
                            $("#Table_accountdetail").append(str);
                        }else{
                            var str1 = $("<tr><td style='text-align:center' colspan='6'>沒有配件內容</td></tr>")
                            $("#Table_accountdetail tbody").append(str1)
                        }
                    }
                })
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsHistoryData?busiWorkOrderId='+busiWorkOrderId+'&isFirst='+0,
                    success:function(data){
                        var tr_len=$("#Table_accountdetail2",wraper).find("tr").length;
                        for(cur=0;cur<tr_len;cur++){
                          if(cur!==0){
                            $("#Table_accountdetail2",wraper).find("tr").eq(cur).hide();
                          }
                        };
                        var str="";
                        if(data.length != 0){
                            $.each(data,function(i){
                                var _item=data[i];
                                str+="<tr>"
                                    +"<td>"+_item.serviceName+"</td>"
                                    +"<td>"+_item.partName+"</td>"
                                    +"<td>"+_item.partPrice+"</td>"
                                    +"<td>"+_item.partNum+"</td>"
                                    +"<td>"+_item.totalAmount+"</td>"
                                    +"<td>"+_item.difAmount+"</td>"
                                    +"<td>"+_item.createDate+"</td>"
                                    +"</tr>";
                            });
                            $("#Table_accountdetail2").append(str);
                        }else{
                            var str2 = $("<tr><td style='text-align:center' colspan='7'>沒有配件修改历史</td></tr>")
                            $("#Table_accountdetail2 tbody").append(str2)
                        }
                    }
                })

                $(".title-p1 span").eq(0).html("配件修改历史")
                $(".sdiv .mDiv").html("原配件内容");
                $(".zdiv .mDiv").html("配件修改历史");
                $(".ui-form .bbit-grid").css("margin","0")
                $(".addBtn").hide();
                $(".title-p1 .f-right").unbind("click");
                $(".title-p1 .f-right").removeClass("return").addClass("part-return")
                $(".part-return").bind("click",function(){
                    $(".ycb-table tbody").show(); 
                    $(".addBtn").show();
                    $(".partHistory").hide();

                    $(".title-p1 span").eq(0).html("养车宝工单")
                    $(".f-right").removeClass("part-return").addClass("return")
                })
            })

            /* 删除 */
            $("#Form_workOrder",wraper).undelegate('.em-delete','click').delegate('.em-delete','click',function(){
                var _that = $(this)
                var pastData = {};
                pastData.appointmentOrderId = _that.prev().attr('appointmentOrderId');
                pastData.businessInfoId = carsmart_config.businessInfoId;
                pastData.userInfoId = carsmart_config.userId;
                $.jRadConfirm('确认删除吗？',1,function(){
                    $.jRadAjax({
                        type:'post',
                        data:pastData,
                        url:'/vip-ws/ws/0.1/busiWorkOrder/delAppointmentOrder',  
                        success: function(){
                            addAppbody();
                            hejiFn()
                        },
                        error:function(xhr){
                            var errormsg = eval("(" + xhr.responseText + ")"); 
                            if (errormsg != undefined) {
                                $('#Form_edit_Part').flexMessage(errormsg[0].message, 'error');
                            }
                        }
                    });
                });
            })

            /* 工位及时间 */
            $("#Form_workOrder",wraper).undelegate('.em-updata-gongwei','click').delegate('.em-updata-gongwei','click',function(){
                var _that = $(this)
                $(".ybs-gongshi-select").show();
                $(".drag").show();
                $(".ul-gongwei").html("");
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/AppointmentManager/getWorkHourStationList?businessInfoId='+carsmart_config.businessInfoId,
                    success:function(data){
                        if(data.length == 0){
                            $(".ul-yuangong").html("商家还没有设置工时和工位，请先到工位设置菜单创建工时和工位！").css({"text-align":"center","font-size":"16px","margin":"30px","color":"#ff0000"});
                            }else{
                            var staUl;
                            staUl = $('<ul class="clearfix workUl"></ul>');
                            $.each(data,function(i){
                                var item = data[i]
                                var staLi;
                                staLi = $('<li stationId="'+item.stationId+'">'+item.stationName+'</li>')
                                staUl.append(staLi)
                            })
                            $(".ul-gongwei").append(staUl)
                            $(".ul-gongwei ul li").eq(0).addClass("t-active");
                        }
                    }   
                })

                var appointmentOrderId = _that.parent().parent().find("td label").eq(3).attr("appointmentorderid");
                var plateNumber = $(".car-plateNumber").val();
                var serviceName = _that.parent().parent().find("td label").eq(3).html();
                var workHour = _that.attr("workHour");
                var stationId = $(".ul-gongwei ul li[class='t-active']").attr("stationId");
                if(!stationId){
                    stationId = ''
                }

                gwAndTimeFnItem(appointmentOrderId,plateNumber,serviceName,workHour,stationId)

                function gwAndTimeFnItem(appointmentOrderId,plateNumber,serviceName,workHour,stationId){
                    createTable(stationId)
                    function createTable(stationId){
                        var arr=[];
                        var startTime;
                        var endTime;
                        $.jRadGet({
                            url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId,
                            success:function(data){
                                startTime = data.startHour;       
                                endTime = data.endHour;
                                for(var i = startTime; i<=endTime-1; i++){
                                    var s = i+1;
                                    if (s >= 10)
                                    {
                                        var starParam = i + ":00";
                                        var endParam = i+1 +":00";
                                        arr.push(starParam + "-" +endParam);
                                    }
                                    else{
                                        var starParam = "0"+i + ":00";
                                        var endParam = "0"+s+":00";
                                        arr.push(starParam + "-" +endParam);
                                    } 
                                }
                            },
                            error:function(xhr){
                                var mes = eval("("+xhr.responseText+")");
                                if(mes[0].message == '营业时间缺失,无法获取'){
                                    $(".ul-gongwei").html("商家还没有设置营业时间，请先到店铺设置主店信息！").css({"text-align":"center","font-size":"16px","margin":"30px","color":"#ff0000"});
                                    $(".ycbTable").html("")
                                }
                                //var mes = eval("("+xhr.responseText+")");  
                                //$.jRadMessage({level:'error', message:mes[0].message,selector:$(".ybs-gongshi-select .alert-head")});
                            }
                        });
                        
                        var table =$('<table></table');
                        $.jRadGet({
                            url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?stationId='+stationId,
                            success:function(data){
                                var th;
                                var thead = $('<thead></thead>');
                                var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                                $.each(data,function(i){
                                    var item1 = data[i]
                                    th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                                    tr.append(th);
                                    thead.append(tr)
                                })  
                                table.append(thead);

                                return tableData = data;
                            },
                            error:function(){
                                $(".ul-gongwei").html("商家还没有设置工时和工位，请先到工位设置菜单创建工时和工位！").css({"text-align":"center","font-size":"16px","margin":"30px","color":"#ff0000"});
                                $(".ycbTable").html("")
                                arr = '';
                                return tableData = '';
                            }
                        })
                        $(".ycbTable").append(table)
                        var yesdaty = $(".ycbTable thead th").eq(1).attr("DatePara");
                        var dodaty = $(".ycbTable thead th").eq(2).attr("DatePara");
                        var masdaty = $(".ycbTable thead th").eq(3).attr("DatePara");
                        var tbody = $('<tbody></tbody>');
                        $.each(arr,function(i){
                            var z = startTime+i
                            if(z >= 10){
                                var startTimeBy = z
                            }else{
                                var startTimeBy = "0"+z
                            }
                            var starParamDou1 = startTimeBy+":00"+":00"
                            var starParamDou2 = startTimeBy+":10"+":00"
                            var starParamDou3 = startTimeBy+":20"+":00"
                            var starParamDou4 = startTimeBy+":30"+":00"
                            var starParamDou5 = startTimeBy+":40"+":00"
                            var starParamDou6 = startTimeBy+":50"+":00"
                            var item2 = arr[i]
                            var tr0;
                            var tr1;
                            var tr2;
                            tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                            tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                            tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                            tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                            tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                            tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                            tbody.append(tr1)
                            tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
                        })
                        table.append(tbody)
                        $(".ycbTable").html("");
                        $(".ycbTable").append(table)
                        $(".ycb-alert-wrap").css("height",$(".ybs-gongshi-select").height()-180);     

                        var valArr = [];
                        $('.ycbTable input').each(function(i){
                            valArr.push($('.ycbTable input').eq(i).attr("value"))
                        })
                        var tdtwowid = $(".ycbTable table td").eq(1).width()/2;
                        var inpuWid = $(".ycbTable input").eq(0).width();
                        $.each(tableData,function(i){
                            var item = tableData[i];
                            $.each(item.orderList,function(j){
                                var str = item.orderList[j];
                                var X1;
                                var Y1;
                                $.each(valArr,function(k){
                                    if(str.appointmentStartTime == valArr[k]){
                                        X1 = $('.ycbTable input').eq(k).position().top;
                                        Y1 = $('.ycbTable input').eq(k).position().left-tdtwowid+inpuWid+4;
                                    }
                                })
                                var tdWidth = $('.ycbTable input').eq(0).parent().width()+2;
                                var tdHeight = $('.ycbTable input').eq(0).parent().height()+2;
                                
                                var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+str.plateNumber+'<br>'+str.serviceName+'</div>') //.attr("val",$(this).attr("value"));
                                $(".ycbTable").append(warpDiv)
                            })
                        })

                        var warpDiv2 = $('<div class="warpDiv2" style="display:table;"></div>').html("")
                        $(".ycbTable input").bind('click',function(){ 
                            $(".succAndErr").html("")
                            var X1 = $(this).position().top;
                            var Y1 = $(this).position().left-100;
                            var tdWidth = $(this).parent().width()+2;
                            var tdHeight = $(this).parent().height()+2;
                            warpDiv2.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+plateNumber+'<br>'+serviceName+'</div>').attr("val",$(this).attr("value"))
                            $(".ycbTable").append(warpDiv2)
                            var aWarpDiv = $(".ycbTable .warpDiv");
                            for (var i = 0; i < aWarpDiv.length; i++) 
                            {
                                if ( cdTest (warpDiv2,aWarpDiv.eq(i))  ) 
                                {
                                    $(".succAndErr").html("选择工时与其他预约服务时间重复！").css("color","red")
                                    $(".ycbTable .warpDiv2").remove();
                                    $(this).attr("checked",false);
                                }
                            }
                        })       
                    }

                    function cdTest (obj1,obj2){
                        var l1=obj1.offset().left;
                        var r1=obj1.offset().left+obj1.width();
                        var t1=obj1.offset().top;
                        var b1=obj1.offset().top+obj1.height();
                        
                        var l2=obj2.offset().left;
                        var r2=obj2.offset().left+obj2.width();
                        var t2=obj2.offset().top;
                        var b2=obj2.offset().top+obj2.height();
                        
                        if (r1<l2 || l1>r2 || b1<t2 || t1>b2) {
                                return false;
                        }else{
                                return true;
                        }
                    }
                    $(".workUl li").click(function() {   
                        $(".workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
                        var stationId = $(".workUl li").eq($(this).index()).attr("stationId");
                        createTable(stationId);
                    });
                    /* 弹框里的确认选择 */
                    $('.ybs-gongshi-select .trurBtn').unbind('click').bind('click',function(){  
                        if($(".ycbTable .warpDiv2").length != 0){
                            var pastData = {};
                            pastData.appointmentOrderId = appointmentOrderId;
                            pastData.workHour = workHour;
                            pastData.workStationInfoId = $(".ul-gongwei .t-active").attr("stationid");
                            pastData.appointmentStartTime = $(".warpDiv2").attr("val");
                            $.ajax({
                                type:'post',
                                async:false,
                                dataType:'json',
                                data:$.toJSON(pastData),
                                contentType:'application/json;charset=utf-8',
                                url:'/vip-ws/ws/0.1/AppointmentManager/editAppointOrder',  
                                success: function(){
                                    $(".ybs-gongshi-select").hide();
                                    $(".drag").hide();
                                    addAppbody();
                                    $("#Form_detail_info",wraper).form({}).form('close');
                                },
                                error:function(xhr){
                                    var mes = eval("("+xhr.responseText+")");  
                                    $(".succAndErr").html(mes[0].message).css("color","red")
                                }
                            })
                        }else{
                            $(".ybs-gongshi-select").hide();
                            $(".drag").hide();
                            $.jRadAlert("请选择工位工时",'error',function(){
                                $(".ybs-gongshi-select").show();
                                $(".drag").show();
                            },300000);
                        }
                    })

                    //查询空闲工位
                    $(".button-gongwei").click(function(){
                        var businessInfoId = carsmart_config.businessInfoId;
                        var freeTime = $(".employInput").val();
                        var workHour = $(this).attr("workhour");
                        $(".succAndErr").html("")
                        $.ajax({
                            type:'get',
                            async:false,
                            url:'/vip-ws/ws/0.1/AppointmentManager/getFreeStation?businessInfoId='+carsmart_config.businessInfoId+'&freeTime='+freeTime+'&workHour='+workHour,  
                            success: function(data){
                                if(data.length == 0){
                                    $(".succAndErr").html("没有空闲工位")
                                }else{
                                    var arrStation;
                                    arrStation = $('<div></div>');
                                    $.each(data,function(i){
                                        var item = data[i];
                                        var alistr;
                                        alistr = $('<span stationId="'+item.stationId+'">'+item.stationName+'</span>');
                                        arrStation.append(alistr)
                                    })
                                    $(".succAndErr").html("空闲工位：").append(arrStation).css("color","#393939")
                                }
                            },
                            error:function(xhr){
                                var mes = eval("("+xhr.responseText+")");  
                                $(".succAndErr").html(mes[0].message).css("color","#ff0000")
                            }
                        })
                    })
                    $(".alert-head a").click(function(){
                        $(".ybs-yuangong-select").hide();
                        $(".ybs-gongshi-select").hide();
                        $(".drag").hide();
                    })
                }
            })

            /* 技师按钮 */
            $("#Form_workOrder",wraper).undelegate('.em-updata-name','click').delegate('.em-updata-name','click',function(){
                var _that = $(this)
                $(".ybs-yuangong-select").show();
                $(".drag").show();
                var mach = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId})
                $(".employSel").html("")
                $.each(mach,function(i){
                    var item = mach[i]
                    var creatOption = $('<option emp="'+item.shopEmployeeId+'" positionName="'+item.positionName+'">'+item.name+'</option>')
                    $(".employSel").append(creatOption)
                })

                $(".ul-yuangong").html("");
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId,
                    success:function(data){
                        var staUl = '';
                        var staLi = '';
                        staUl = $('<ul class="clearfix workUl"></ul>');
                        $.each(data,function(i){
                            var item = data[i]
                            staLi = $('<li class="" shopEmployeeId="'+item.shopEmployeeId+'">'+item.name+'('+item.positionName+')'+'</li>')
                            staUl.append(staLi)
                        })
                        $(".ul-yuangong").append(staUl)
                        $(".ul-yuangong ul li").eq(0).addClass("t-active");
                    }   
                })

                var appointmentOrderId = _that.parent().parent().find("td label").eq(3).attr("appointmentorderid");
                var plateNumber = $(".car-plateNumber").val();
                var serviceName = _that.parent().parent().find("td label").eq(3).html();
                var workHour = _that.attr("workHour");
                var shopEmployeeId_a = $(".ul-yuangong ul li[class='t-active']").attr("shopEmployeeId");

                jishiFnItem(appointmentOrderId,plateNumber,serviceName,workHour,shopEmployeeId_a)

                function jishiFnItem(appointmentOrderId,plateNumber,serviceName,workHour,shopEmployeeId_a){

                    createTable(shopEmployeeId_a)

                    function createTable(shopEmployeeId_a){
                        var arr=[];
                        var startTime;
                        var endTime;
                        $.jRadGet({
                            url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId,
                            success:function(data){
                                startTime = data.startHour;       
                                endTime = data.endHour;
                                for(var i = startTime; i<=endTime-1; i++){
                                    var s = i+1;
                                    if (s >= 10)
                                    {
                                        var starParam = i + ":00";
                                        var endParam = i+1 +":00";
                                        arr.push(starParam + "-" +endParam);
                                    }
                                    else{
                                        var starParam = "0"+i + ":00";
                                        var endParam = "0"+s+":00";
                                        arr.push(starParam + "-" +endParam);
                                    } 
                                }
                            },
                            error:function(xhr){
                                var mes = eval("("+xhr.responseText+")");  
                                $.jRadMessage({level:'error', message:mes[0].message,selector:$(".ybs-yuangong-select .alert-head")});
                            }
                        });
                        
                        var table =$('<table></table');
                        $.jRadGet({
                            url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?shopEmployeeId='+shopEmployeeId_a,
                            success:function(data){
                                var th;
                                var thead = $('<thead></thead>');
                                var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                                $.each(data,function(i){
                                    var item1 = data[i]
                                    th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                                    tr.append(th);
                                    thead.append(tr)
                                })  
                                table.append(thead) 
                                return tableData = data;
                            }
                        })
                        $(".ycbMech").append(table)
                        var yesdaty = $(".ycbMech thead th").eq(1).attr("DatePara");
                        var dodaty = $(".ycbMech thead th").eq(2).attr("DatePara");
                        var masdaty = $(".ycbMech thead th").eq(3).attr("DatePara");
                        var tbody = $('<tbody></tbody>');
                        $.each(arr,function(i){
                            var z = startTime+i
                            if(z >= 10){
                                var startTimeBy = z
                            }else{
                                var startTimeBy = "0"+z
                            }
                            var starParamDou1 = startTimeBy+":00"+":00"
                            var starParamDou2 = startTimeBy+":10"+":00"
                            var starParamDou3 = startTimeBy+":20"+":00"
                            var starParamDou4 = startTimeBy+":30"+":00"
                            var starParamDou5 = startTimeBy+":40"+":00"
                            var starParamDou6 = startTimeBy+":50"+":00"
                            var item2 = arr[i]
                            var tr0;
                            var tr1;
                            var tr2;
                            tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                            tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                            tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                            tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                            tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                            tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                            tbody.append(tr1)
                            tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
                        })
                        table.append(tbody)
                        $(".ycbMech input[type='radio']").css({"filter":"alpha(opacity=0)","-moz-opacity":"0", "opacity": "0"})
                        $(".ycb-alert-wrap").css("height",$(".ybs-yuangong-select").height()-180);
                        $(".ycbMech").html("");
                        $(".ycbMech").append(table);
                        var valArr = [];
                        $('.ycbMech input').each(function(i){
                            valArr.push($('.ycbMech input').eq(i).attr("value"))
                        })

                        var activeName = $(".ul-yuangong ul .t-active").html();
                        var tdtwowid = $(".ycbMech table td").eq(1).width()/2;
                        var inpuWid = $(".ycbMech input").eq(0).width();
                        $.each(tableData,function(i){
                            var item = tableData[i];
                            $.each(item.orderList,function(j){
                                var str = item.orderList[j];
                                var X1;
                                var Y1;
                                $.each(valArr,function(k){
                                    if(str.appointmentStartTime == valArr[k]){
                                        X1 = $('.ycbMech input').eq(k).position().top;
                                        Y1 = $('.ycbMech input').eq(k).position().left-tdtwowid+inpuWid+4;
                                    }
                                })
                                var tdWidth = $('.ycbMech input').eq(0).parent().width()+2;
                                var tdHeight = $('.ycbMech input').eq(0).parent().height()+2;
                                // var warpDiv = $('<div class="warpDiv"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html(str.plateNumber+'<br>'+str.serviceName) 
                                
                                var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+activeName+'<br>'+str.serviceName+'</div>')
                                $(".ycbMech").append(warpDiv)
                            })
                        })
                    }
                    $(".ul-yuangong .workUl li").unbind("click").bind("click",function(){
                        $(".ul-yuangong .workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
                        var shopEmployeeId = $(".ul-yuangong .workUl li").eq($(this).index()).attr("shopemployeeid");
                        createTable(shopEmployeeId);
                    })

                    /* 弹框里的确认选择 */
                    $(".button-yuangong").click(function(){
                        $(".ybs-yuangong-select").hide();
                        $(".drag").hide();
                        var pastData = {};
                        pastData.appointmentOrderId = appointmentOrderId;
                        pastData.shopEmployeeId = $('.employSel option:selected').attr("emp");
                        $.ajax({
                            type:'post',
                            async:false,
                            dataType:'json',
                            data:$.toJSON(pastData),
                            contentType:'application/json;charset=utf-8',
                            url:'/vip-ws/ws/0.1/AppointmentManager/editAppointOrder',  
                            success: function(){
                                addAppbody();
                                $("#Form_detail_info",wraper).form({}).form('close');
                            }
                        })
                    })
                    $('.ybs-yuangong-select').on('click','.alert-head a',function(){
                        $(".ybs-yuangong-select").hide();
                        $(".ybs-gongshi-select").hide();
                        $(".drag").hide();
                    })
                }
            })

            $("#Form_workOrder .alert-head a").click(function(){
                $(".ybs-yuangong-select").hide();
                $(".ybs-gongshi-select").hide();
                $(".drag").hide();
            })

            $('#Form_workOrder').on('blur','.workInputPrice',function(){
                var pastData = {};
                pastData.appointmentOrderId = $(this).attr("appointmentOrderId")
                pastData.workHourPrice = $(this).val();
                $.ajax({
                    type:'post',
                    async:false,
                    dataType:'json',
                    data:$.toJSON(pastData),
                    contentType:'application/json;charset=utf-8',
                    url:'/vip-ws/ws/0.1/busiWorkOrder/editAppointmentOrder',  
                    success: function(){
                        addAppbody();
                        var str = '';
                        $(".cntTr").html("")
                        str += '<td colspan="1">'
                                +'<label>合计</label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="2">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="2">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji1"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji2"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji3"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji4"></label>'
                            +'</td>'

                        $(".cntTr").append(str);

                        hejiFn()
                        //return;
                    }
                })
            })

            $('#Form_workOrder').on('blur','.clearInputPrice',function(){
                var pastData = {};
                //pastData.appointmentOrderId = $(this).parent().parent().attr("class")
                pastData.appointmentOrderId = $(this).attr("appointmentOrderId")
                pastData.clearPrice = $(this).val();
                $.ajax({
                    type:'post',                
                    async:false,
                    dataType:'json',
                    data:$.toJSON(pastData),
                    contentType:'application/json;charset=utf-8',
                    url:'/vip-ws/ws/0.1/busiWorkOrder/editAppointmentOrder',  
                    success: function(){
                        addAppbody();
                        var str = '';
                        $(".cntTr").html("")
                        str += '<td colspan="1">'
                                +'<label>合计</label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="2">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="2">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji1"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji2"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji3"></label>'
                            +'</td>'
                            +'<td colspan="1">'
                                +'<label class="heji4"></label>'
                            +'</td>'

                        $(".cntTr").append(str)

                        hejiFn()
                        //return;
                    }
                })
            })

            $(".car-mobile").removeAttr("disabled");
            $('#Form_workOrder input[name="mobile"]').blur(function(){
                var str = $('#Form_workOrder input[name="mobile"]').val();
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/userManager/checkMobileForWorkOrder?mobile='+str+'&businessInfoId='+carsmart_config.businessInfoId,
                    async:false,
                    success:function(data){
                        if(data.code == 1){
                            $('#Form_customer_add_userCar').form({}).form('close')
                            $('#Form_customer_add').form({
                                title: '创建客户',
                                item:{mobile:str},
                                submit:function(){
                                    var flag = $('#Form_customer_add',wraper).form('validateAll');
                                    if(flag){
                                        var json = $('#Form_customer_add',wraper).form('getValue'); 
                                        json.businessInfoId = carsmart_config.businessInfoId; 
                                        $.jRadPost({
                                            url:'/vip-ws/ws/0.1/userManager/addUser',
                                            data:json,
                                            success:function(data){ 
                                                $('#Form_customer_add').form('close');
                                                $('#Form_customer_add_userCar').form({
                                                    title: '创建车辆',
                                                    fields:field_params,
                                                    item:{mobile:str},
                                                    url:'/vip-ws/ws/0.1/userManager/addCarInfoForWorkOrder',
                                                    preSubmit:function(json){
                                                        json.businessInfoId = carsmart_config.businessInfoId;
                                                        json.userInfoId = data.userInfoId;
                                                        json.ownerName = data.ownerName;
                                                        json.seriesId = $('.last span').attr("id");
                                                        json.buyDate = $('#startDate').val()
                                                        return json;
                                                    },
                                                    success: function(data) {
                                                        $('#Table_car_info').flexMessage('创建成功', 'success','3');
                                                        $('#Table_car_info').flexReload();
                                                        $(".car-style").val(data.seriesId);
                                                        $(".car-plateNumber").val(data.plateNumber);
                                                        $(".car-vinNumber").val(data.vinNumber);
                                                        $(".car-machineNumber").val(data.machineNumber);
                                                        $(".carInfoId").attr("carInfoId",data.carInfoid)
                                                    }
                                                }).form('open');
                                                $('#startDate').val("");
                                                $(".car-mobile").attr("userInfoId",data.userInfoId)
                                                $(".car-name").val(data.ownerName);
                                                $("#Form_customer_add_userCar input[name='plateNumber']").attr("maxlength","10")
                                                $("#Form_customer_add_userCar input[name='machineNumber']").attr("maxlength","30")
                                                $("#Form_customer_add_userCar input[name='vinNumber']").attr("maxlength","30")
                                                $("#Form_customer_add_userCar input[name='chassisNumber']").attr("maxlength","30")
                                                $('.last').hide()
                                                $('.ul-letters').show();
                                                $('.condition-title').show();
                                                brandFn()
                                                $('.car-list').show().html('');
                                                $("#Form_customer_add_userCar .pop-up-close").click(function(){
                                                    $(".car-mobile").val("");
                                                })
                                            },
                                            error:function(data){
                                                var mes = eval('('+data.responseText+')');
                                                $.jRadMessage({level:'error', message:mes[0].message,selector:$("#Form_customer_add .pop-up-middle",wraper)});
                                                return false
                                            }
                                        });
                                    }    
                                }
                            }).form('open');
                            $("#Form_customer_add div[name='mobile']").input('readonly',true)
                            $("#Form_customer_add .pop-up-close").click(function(){
                                $(".car-mobile").val("");
                            })
                        }
                        else if(data.code == 2){
                            //var carList = data.carList;
                            $(".car-mobile").attr("userInfoId",data.userInfoId);
                            $('#Form_select_car',wraper).form({
                                title: '选择车辆',
                                grid:10,
                                autobinding: false
                            }).form('open');
                            $(".ycb-div4").html("")
                            var carList = data.carList;
                            $.each(carList,function(i,v){
                                var item = carList[i]
                                var _span = $('<span style="display:block;margin:15px 0;"></span>')
                                var _input = $('<input type="radion"  name="ycb" class="ipt-hide"/>')
                                var _strong = $('<strong class="checkbox" vinNumber="'+item.vinNumber+'" machineNumber="'+item.machineNumber+'" userName="'+item.userName+'" carInfoId="'+item.carInfoId+'"></strong>')
                                var _em = $('<em></em>').html(item.seriesId+'&nbsp;&nbsp;'+item.plateNumber)
                                $(".ycb-div4").append(_span.append(_input).append(_strong).append(_em))
                            })
                            $(".ycb-div4").append($("<span style='display:block;'></span>").append($("<input type='radion'  name='ycb' class='ipt-hide'/>")).append($("<strong class='checkbox'></strong")).append($("<em>其他车辆</em>")))
                            $(".ycb-div4 span strong").eq(0).addClass("cur");
                            $('.ycb-div4 .checkbox').on('click',function(){
                                $('.ycb-div4 .checkbox').removeClass('cur');
                                $(this).siblings("input[type='radion']").removeAttr('checked')
                                $(this).addClass('cur');
                            })
                            $("#Form_select_car .pop-up-close").click(function(){
                                $(".car-mobile").val("");
                            })
                            $("#Form_select_car .jrad-btn-primary").click(function(){
                                if($(".ycb-div4 span strong").last().hasClass("cur")){ 
                                    $('#Form_select_car').form({}).form("close");         
                                    $('#Form_customer_add_userCar').form({
                                        title: '创建车辆',
                                        fields:field_params,
                                        item:{},
                                        url:'/vip-ws/ws/0.1/userManager/addCarInfoForWorkOrder',
                                        preSubmit:function(json){
                                            json.businessInfoId = carsmart_config.businessInfoId;
                                            json.userInfoId = data.userInfoId;
                                            json.ownerName = data.ownerName;
                                            json.seriesId = $('.last span').attr("id");
                                            json.buyDate = $('#startDate').val()
                                            return json;
                                        },
                                        success: function(data){
                                            $('#Table_car_info').flexMessage('创建成功', 'success');
                                            $('#Table_car_info').flexReload();
                                            $(".car-name").val(data.userName);
                                            $(".car-style").val(data.seriesId);
                                            $(".car-plateNumber").val(data.plateNumber);
                                            $(".car-vinNumber").val(data.vinNumber);
                                            $(".car-machineNumber").val(data.machineNumber);
                                            $(".carInfoId").attr("carInfoId",data.carInfoid)
                                        }
                                    }).form('open');
                                    $('#startDate').val("");
                                    $("#Form_customer_add_userCar input[name='plateNumber']").attr("maxlength","10")
                                    $("#Form_customer_add_userCar input[name='machineNumber']").attr("maxlength","30")
                                    $("#Form_customer_add_userCar input[name='vinNumber']").attr("maxlength","30")
                                    $("#Form_customer_add_userCar input[name='chassisNumber']").attr("maxlength","30")
                                    $('.last').hide()
                                    $('.ul-letters').show();
                                    $('.condition-title').show();
                                    brandFn()
                                    $('.car-list').show().html('');
                                    $(".carInfoId").attr("carInfoId",data.carInfoId)
                                    $("#Form_customer_add_userCar .pop-up-close").click(function(){
                                        $(".car-mobile").val("");
                                    })
                                }else{ 
                                    var content1 = $(".ycb-div4 span .cur").next().html().split("&nbsp;&nbsp;")[0]
                                    var content2 = $(".ycb-div4 span .cur").next().html().split("&nbsp;&nbsp;")[1]
                                    var userName = $(".ycb-div4 span .cur").attr("userName")
                                    var carInfoId = $(".ycb-div4 span .cur").attr("carInfoId")
                                    var vinNumber = $(".ycb-div4 span .cur").attr("vinNumber")
                                    var machineNumber = $(".ycb-div4 span .cur").attr("machineNumber")
                                    $(".car-name").val(userName);
                                    $(".car-style").val(content1);
                                    $(".car-plateNumber").val(content2);
                                    $(".car-vinNumber").attr("vinNumber",vinNumber)
                                    $(".car-machineNumber").attr("machineNumber",machineNumber)
                                    $(".car-vinNumber").val(vinNumber)
                                    $(".car-machineNumber").val(machineNumber)
                                    $(".carInfoId").attr("carInfoId",carInfoId)
                                    $('#Form_select_car').form({}).form("close");  
                                }
                            })
                        }else{
                            $(".car-mobile").attr("userInfoId",data.userInfoId);
                            $('#Form_customer_add_userCar').form({
                                title: '创建车辆',
                                fields:field_params,
                                item:{},
                                url:'/vip-ws/ws/0.1/userManager/addCarInfoForWorkOrder',
                                preSubmit:function(json){
                                    json.businessInfoId = carsmart_config.businessInfoId;
                                    json.userInfoId = data.userInfoId;
                                    json.ownerName = data.ownerName;
                                    json.seriesId = $('.last span').attr("id");
                                    json.buyDate = $('#startDate').val()
                                    return json;
                                },
                                success: function(data) {
                                    $('#Table_car_info').flexMessage('创建成功', 'success','3');
                                    $('#Table_car_info').flexReload();
                                    $(".car-name").val(data.userName);
                                    $(".car-style").val(data.seriesId);
                                    $(".car-plateNumber").val(data.plateNumber);
                                    $(".car-vinNumber").val(data.vinNumber); 
                                    $(".car-machineNumber").val(data.machineNumber);
                                    $(".carInfoId").attr("carInfoId",data.carInfoId)
                                }
                            }).form('open');
                            $('#startDate').val("");
                            $("#Form_customer_add_userCar input[name='plateNumber']").attr("maxlength","10")
                            $("#Form_customer_add_userCar input[name='machineNumber']").attr("maxlength","30")
                            $("#Form_customer_add_userCar input[name='vinNumber']").attr("maxlength","30")
                            $("#Form_customer_add_userCar input[name='chassisNumber']").attr("maxlength","30")
                            $('.last').hide()
                            $('.ul-letters').show();
                            $('.condition-title').show();
                            brandFn()
                            $('.car-list').show().html('');
                            $("#Form_customer_add_userCar .pop-up-close").click(function(){
                                $(".car-mobile").val("");
                            })
                        }
                    },
                    error:function(xhr){
                        var errormsg = eval("(" + xhr.responseText + ")");
                        if(errormsg[0].message == '手机号码不能为空'){
                            $("#work_reason",wraper).form({
                                grid:10
                            }).form('open'); 
                            $(".car-mobile").val("");
                            $("#work_reason .reason").html("")
                            $("#work_reason .reason").html("手机号码不能为空，请修改");
                        }
                        if(errormsg[0].message == '手机号格式录入不正确'){
                            $("#work_reason",wraper).form({
                                grid: 10
                            }).form('open'); 
                            $(".car-mobile").val("");
                            $("#work_reason .reason").html("")
                            $("#work_reason .reason").html("手机号格式录入不正确，请修改");
                        }
                    }
                })
            })
            
            $('#Form_workOrder .addBtn').unbind('click').bind('click',function(){
                var isAndno1 = ''; //油表显示
                if($(".ycb-div1 strong").eq(0).hasClass("cur")){
                    isAndno1 = 1;
                }else if($(".ycb-div1 strong").eq(1).hasClass("cur")){
                    isAndno1 = 2;
                }else if($(".ycb-div1 strong").eq(2).hasClass("cur")){
                    isAndno1 = 3;
                }else if($(".ycb-div1 strong").eq(3).hasClass("cur")){
                    isAndno1 = 4; 
                }else{
                    isAndno1 = 5; 
                }
                var isAndno2 = '';//内饰是否损失
                if($(".ycb-div2 strong").eq(0).hasClass("cur")){
                    isAndno2 = 1;
                }else{
                    isAndno2 = 0;
                }
                var isAndno3 = '';//是否洗车
                if($(".ycb-div3 strong").eq(0).hasClass("cur")){
                    isAndno3 = 1;
                }else{
                    isAndno3 = 0;
                }
                var isAndno7 = '';//机电设备是否故障
                if($(".ycb-div7 strong").eq(0).hasClass("cur")){
                    isAndno7 = 1;
                }else{
                    isAndno7 = 0;
                }
                var isAndno5 = ''; //排队时间
                if($(".ycb-div5 strong").eq(0).hasClass("cur")){
                    isAndno5 = 1;
                }else if($(".ycb-div5 strong").eq(1).hasClass("cur")){
                    isAndno5 = 2;
                }else{
                    isAndno5 = 3;
                }
                var isAndno6 = '';//是否取回废件
                if($(".ycb-div6 strong").eq(0).hasClass("cur")){
                    isAndno6 = 1;
                }else{
                    isAndno6 = 0;
                }
                var arr = [];
                var string = '';
                $(".round").each(function(i){
                    if($(this).attr("style") == "filter:alpha(opacity=100);-moz-opacity:1;opacity: 1;"){
                        arr.push(1)
                    }else{
                        arr.push(0)
                    }
                })
                var workOrderId = $('.work-number').attr("workOrderId")
                var appointmentOrderList = $.jRadGet({url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList?workOrderId='+workOrderId});
                
                var json = {};
                json.workOrderId = workOrderId;
                json.businessInfoId = carsmart_config.businessInfoId;
                json.userInfoId = $(".car-mobile").attr("userInfoId");
                json.carInfoId = $(".carInfoId").attr("carInfoId");
                json.carKm = $('.car-carKm').val();
                json.carOilRemain = isAndno1;//油表显示
                json.interiorDestory = isAndno2;//内饰是否损失
                json.elecDeviceIsDestory = isAndno7;//机电设备是否故障
                json.lineUp = isAndno5 //排队时间
                json.isWash = isAndno3; //是否赠送洗车
                json.isRetainUsed = isAndno6; //是否保留配件
                json.repairDiscription = $(".repairDiscription").val();
                json.appearanceInspectArea = arr.toString();
                json.faultOrOption = $(".faultOrOption").val();
                json.carComeTime = $('.carComeTime').val();
                json.expectCarTime = $('.expectCarTime').val();
                json.opertor = carsmart_config.operatorName;
                json.appointmentOrderList = appointmentOrderList;
                json.qualityPeopleId = $('.qulityName option:selected').attr("emp")

                $.jRadPost({
                    url:"/vip-ws/ws/0.1/busiWorkOrder/addWorkOrder",
                    data:json, 
                    success:function(){ 
                        $.jRadMessage({level:'success', message:'保存成功！',selectors:$("#Form_workOrder")});
                        $('#Table_workOrder_manage').flexReload();
                        $('#jrad-table',wraper).show();
                        $('.details-box',wraper).hide();
                    },
                    error:function(data){
                        var mes = eval('('+data.responseText+')');
                        $.jRadMessage({level:'error', message:mes[0].message, selectors:$("#Form_workOrder")});
                    }
                });
                $("#btn-scroll-up").click();
            });

            hejiFn()
        }
    });

    $('#Table_workOrder_manage').flexigrid({
        reload:true,
        pagination: {diaplay_pages: 5,align:'bottom',showText: '从第_start_到_end_项 共_total_项'},
        colModel : page_column_model,
        buttons : page_list_buttons,
        searchitems :page_search_items,
        pagedStyle: 'oc',
        method:'get', 
        showSearch:true,
        overflow:true,
        showCheckbox:false,
        //extParam: {},
        url:'/vip-ws/ws/0.1/busiWorkOrder/getWorkOrderList?businessInfoId='+carsmart_config.businessInfoId,
        onError:showRemarkError,
        checkBoxType:'single',
        trEvent:function(){ 
            var checked = $('#Table_workOrder_manage').getCheckedTrs();  
            $('#Table_workOrder_resrve').flexOptions({ 
                extParam:{
                    workOrderId: checked[0].workOrderId
                }
            }).flexReload();
        }
    }) 
    $('.vdiv .tDiv',wraper).before('<span style="margin:0 20px 0 14px;font-size:15px;float:left;line-height:60px;">工单列表</span>');

    $('#Table_workOrder_resrve').flexigrid({
        reload:true,
        pagination: {diaplay_pages: 5,align:'bottom',showText: '从第_start_到_end_项 共_total_项'},
        colModel : page_column_model_b,
        buttons : page_list_buttons_b,
        pagedStyle: 'oc',
        method:'get', 
        showSearch:true,
        showCheckbox:false,
        overflow:true,
        //extParam: {},
        url:'/vip-ws/ws/0.1/busiWorkOrder/getPartsList',
        onError:showRemarkError,
        checkBoxType:'single'
    })

    $(".return",wraper).click(function(){
        reatSet()
        $('.details-box',wraper).hide();
        $('#jrad-table',wraper).show(); 
        $(".scroll-up-btn").click();
        $(".ydiv .btn-info").eq(0).click();
    }); 

    $('.vdiv .hDiv tr th').eq(0).attr("style","display:none;")
    $('.ydiv .hDiv tr th').eq(0).attr("style","display:none;")
    $('.hDiv',wraper).css('overflow','hidden');
    $('.bDiv',wraper).css('overflow-x','scroll');

    function reatSet(){
        $(".car-emp input").val("");       
        $(".editTd span").html("");
        $(".orderNumber").val("");
        $(".row1 strong").removeClass("cur");
        $(".row1 strong").eq(2).addClass("cur");
        $(".row1 strong").eq(6).addClass("cur");
        $(".row1 strong").eq(8).addClass("cur");
        $(".row1 strong").eq(10).addClass("cur");
        $(".row1 strong").eq(11).addClass("cur");
        $(".row1 strong").eq(15).addClass("cur");
        $(".row1 textarea").val("");
        $(".ycb-tu a").attr("style","filter:alpha(opacity=30);-moz-opacity:0.3;opacity: 0.3;");
        $(".row2 input").val("")
        $(".car-carKm").val("")
        $(".carComeTime").val("")
        $(".expectCarTime").val("")
        $(".emp").val("")
        $(".completeDate").html("")
        $(".qualityPeopleName").html("")
        $(".getCash").html("")
    }
});

function brandFn(){
    var brandList = $.ajax({url:"/shopmanage-ws/ws/0.1/support/brand/list",async:false});
    var msg = eval("(" + brandList.responseText + ")");
    var A_Z="";
    for(var i=65;i<91;i++){
        if(i == 69 || i== 73 || i == 85 || i == 86){
            A_Z+="";
        }else{  
            A_Z+="<li  class='uperCase uperCasess' data-num="+i+">"+String.fromCharCode(i)+"</li>";
        }
    };
    $("#searchBox .ul-letters").html(A_Z);

    $('.ul-letters li').on('click',function(){
        var str = $(this).html();
        var data = eval('msg.'+str)
        var _li = '';
        $('.car-list').html("");
        $.each(data,function(i){
            var item = data[i]
            _li += '<li data-id='+item.id+'>'+item.name+'</li>'
        })
        $('.car-list').append(_li);

        $('.car-list li').on('click',function(){
            var str = $(this).attr("data-id")
            //http://10.23.31.151/shopmanage-ws/ws/0.1/modelCms/factory/list?brandId=84&_=1449651904401
            var modelList = $.ajax({url:'/shopmanage-ws/ws/0.1/support/model/list?brandId='+str,async:false})
            var data2 = eval("(" + modelList.responseText + ")");
            $('.car-list').html("");
            var _li2 = '';
            $.each(data2,function(i){
                var item2 = data2[i]
                _li2 += '<li data-id='+item2.id+'>'+item2.name+'</li>'
            })
            $('.car-list').append(_li2);

            $('.car-list li').on('click',function(){
                $('.car-list').html("");
                var str = $(this).attr("data-id")
                var modelList2 = $.ajax({url:'/shopmanage-ws/ws/0.1/modelCms/model/list?factoryId='+str,async:false})
                var data3 = eval("(" + modelList2.responseText + ")");
                $('.car-list').html("");
                var _li3 = '';
                $.each(data3,function(i){
                    var item3 = data3[i]
                    _li3 += '<li data-id='+item3.modelId+'>'+item3.modelName+'</li>'
                })
                $('.car-list').append(_li3);
                
                $('.car-list li').on('click',function(){
                    var str = $(this).attr("data-id")
                    $('.ul-letters').hide();
                    $('.car-list').hide();
                    $('.condition-title').hide();
                    $('.last').show().html('<span id='+str+'>'+$(this).html()+'</span><a href="javascript:void(0)">X</a>');

                    $('.last a').on('click',function(){
                        $('.last').hide();
                        $('.ul-letters').show();
                        $('.condition-title').show();
                        $('.uperCase').removeClass("active");
                        $('.car-list').show().html('');
                    })
                })

            })

            
        })
    });

    $("body").on("click","#searchBox .uperCasess", function(){
        $(this).siblings(".uperCase").removeClass("active").end().addClass("active");
    })
}

function showRemarkError(xhr){
    var cDiv = $("#Wraper_workOrder_manage .cDiv");
    $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
}
</script>
