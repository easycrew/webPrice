<style>
    .hDiv table th, .bDiv table td, .hDiv table td .bDiv table th{
        text-align:center;
    }
    .strong{
        font-size:20px;
        font-weight:bold;
        line-height:40px;
    }    
    /* Tipso Bubble Styles 提示层样式*/
    .tipso_bubble, .tipso_bubble > .tipso_arrow{
        -webkit-box-sizing: border-box;
        -moz-box-sizing:    border-box;
        box-sizing:         border-box;
    }
    .tipso_bubble {
        position: absolute;
        text-align: center;
        border-radius: 6px;
        z-index: 9999;
        /*border:1px solid #d99118;*/
        padding: 10px;
        font-size: 12px;
    }
    .tipso_style{
        /*cursor: help;*/
        /*border-bottom: 1px dotted;*/
    }

    /* Tipso Bubble Div */
    .tipso_bubble > .tipso_arrow{
        position: absolute;
        width: 0; height: 0;
        border: 8px solid #d99118;
        pointer-events: none;
    }
    .tipso_bubble.top > .tipso_arrow {
        border-top-color: #000;
        border-right-color: transparent;
        border-left-color: transparent;
        border-bottom-color: transparent;
        top: 100%;
        left: 50%;
        margin-left: -8px;
    }
    .tipso_bubble.bottom > .tipso_arrow {
        border-bottom-color: #000;
        border-right-color: transparent;
        border-left-color: transparent;
        border-top-color: transparent;
        bottom: 100%;
        left: 50%;
        margin-left: -8px;
    }
    .tipso_bubble.left > .tipso_arrow {
        border-left-color: #000;
        border-top-color: transparent;
        border-bottom-color: transparent;
        border-right-color: transparent;
        top: 50%;
        left: 100%;
        margin-top: -8px;
    }
    .tipso_bubble.right > .tipso_arrow {
        border-right-color: #000;
        border-top-color: transparent;
        border-bottom-color: transparent;
        border-left-color: transparent;
        top: 50%;
        right: 100%;
        margin-top: -8px;
    }
    .Oval{width:20px;height:20px;margin-left:5px;cursor:pointer;}
    .ul-letters {
        float: left;
    }
    .uperCase{
        border: 1px solid #bfbfbf;
        color: #505050;
        cursor: pointer;
        height: 20px;
        line-height: 20px;
        margin: 1px 6px 3px 0px;
        text-align: center;
        width: 20px;
        float: left;
    }
    .ul-letters .active {
        border: 2px solid #3ea5f4;
        height: 16px;
        line-height: 16px;
        width: 16px;
    }

    .brand-letter {overflow: hidden;padding: 5px 0 5px;}
    .car-list{overflow:hidden;margin-left:14px;}
    .car-list li{float:left;padding:5px 15px;margin:8px 5px 5px 5px;margin-right:18px;display:inline;text-align:center;height:28px;line-height:28px;border:1px solid #ccc;cursor:pointer;}
    .last{display:none;float:left;border:1px solid #ccc;padding:5px;overflow:hidden;}
    .last span{float:left;margin-top:1px;}
    .last a{ border: none;color: #fff;cursor: pointer;background:#2f8ac8;float: left;height: 20px;line-height: 20px;margin: 1px 3px 3px 3px;text-align: center;width:20px;}
    .last a:hover{text-decoration:underline;}
    #Form_customer_Dtails div, #Form_car_Dtails div {
        line-height: 30px;
    }
    .table-condensed th, .table-condensed td {
        color: #666;
    }
    /*.ui-datepicker-calendar {
        display: none;
    } */ 
</style>
<div class="urlContentWraper" id="Wraper_customer_manage">
    <div class="ui-info-layout">
    	<div class="vdiv">
            <table id="Table_customer_list"></table>
        </div>
        <div class="sdiv" style="margin-top:10px;">
           <!-- <h2 class="header smaller lighter blue">车辆信息</h2> -->
           <table id="Table_car_info"></table>
        </div>
        <div class="udiv" style="margin-top:10px;">
           <!-- <h2 class="header smaller lighter blue">维保工单信息</h2> -->
           <table id="Table_workOrder_info"></table>
        </div>
	</div>
    <div id="Form_customer_add" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid"> 
                <label class="span5 grid-layout-label"><span class="ui-form-required">*</span>姓名：</label>
                <div class="span11 grid-layout-content fluid-wrap">
                    <div name="userName" class="jrad-input-container" placeholder="例：李先生、刘备">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>手机：</label>
                <div class="span11 grid-layout-content fluid-wrap">
                    <div name="mobile" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid time">
                <label class="span5 grid-layout-label">生日：</label>
                <div class="span11 grid-layout-content fluid-wrap">
                    <div name="birthday" class="jrad-dateinput-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">家庭住址：</label>
                <div class="span11 grid-layout-content fluid-wrap">
                    <div name="familyAddress" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid time time4">
                <label class="span5 grid-layout-label">上次服务时间：</label>
                <div class="span11 grid-layout-content fluid-wrap">
                    <div name="lastServiceTime" class="jrad-dateinput-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid time time5">
                <label class="span5 grid-layout-label">上次回访时间：</label>
                <div class="span11 grid-layout-content fluid-wrap">
                    <div name="lastVisitTime" class="jrad-dateinput-container">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确定</button>
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div> 

    <div id="Form_car_add" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div name="brands"></div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label"><span class="ui-form-required">*</span>车系：</label>
                <div class="span15">
                    <div class="searchBox" id="searchBox">
                        <div class="brand" id="brand_show">
                            <div class="brand-letter">
                                <span class="condition-title">按字母查找</span>
                                <ul class="ul-letters">
                                </ul>
                                <div class="last"></div>
                            </div>
                            <ul class="car-list"></ul>
                        </div>
                    </div>
                </div>
            </div> 
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>车牌：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="plateNumber" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label"><span class="ui-form-required">*</span>车架号：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="vinNumber" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">发动机号：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="machineNumber" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">底盘号：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="chassisNumber" class="jrad-input-container">
                    </div>
                    <p class="note">养车宝会通过上面3个字段查询违章，以您店铺的名义通知客户。</p>
                </div>
            </div>
            <div class="grid-row-fluid buy">
                <label class="span5 grid-layout-label">购车日期：</label> 
                <input name="startDate" id="startDate" class="date-picker" style="width:349px;height:20px;margin-left:6px;padding:4px;" /> 
                <!-- <div class="span14 grid-layout-content fluid-wrap">
                    <div name="buyDate" class="jrad-dateinput-container">
                    </div>
                </div> -->
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">里程(km)：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="totalMileage" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">是否二手车：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="isUsed" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">颜色：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="color" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">内饰风格：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="interiorStyle" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">几成新：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="percentNew" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">是否改装：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="isRefit" class="jrad-select-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid time">
                <label class="span5 grid-layout-label">上次保养时间：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="lastMaintainDate" class="jrad-dateinput-container limitTime">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次保养里程：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="lastMaintainMileage" class="jrad-input-container limitTime">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次年审时间：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="lastLimitedDate" class="jrad-dateinput-container limitTime">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次保险时间：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="lastInsuredDate" class="jrad-dateinput-container">
                    </div>
                    <p class="note">养车宝会通过上面字段判断用户是否需要保养、保险，若需要，会通知客户到您的店铺服务。请尽量填写完整。</p>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确定</button>
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>  
    </div> 

    <div id="Form_customer_Dtails" class="grid-layout ui-form"  style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label strong">基本信息</label>
            </div>  
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label">会员级别：</label>
                <div class="span5 grid-layout-content">
                    <div name="userGrade"></div>
                </div> 
            </div>
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label">姓名：</label>
                <div class="span5 grid-layout-content">
                    <div name="userName"></div>
                </div> 
            </div>
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label">手机：</label>
                <div class="span5 grid-layout-content">
                    <div name="mobile"></div>
                </div> 
            </div>
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label">生日：</label>
                <div class="span5 grid-layout-content">
                    <div name="birthday"></div>
                </div> 
            </div>
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label">家庭住址：</label>
                <div class="span5 grid-layout-content">
                    <div name="familyAddress"></div>
                </div> 
            </div>
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label strong">服务信息</label>
            </div>
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label">总消费金额：</label>
                <div class="span6 grid-layout-content">
                    <div name="totalUserPay"></div>
                </div> 
            </div>
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label">订单数量：</label>
                <div class="span5 grid-layout-content">
                    <div name="serviceCnt"></div>
                </div> 
            </div>
            <div class="grid-row-fluid">
                <label class="span4 grid-layout-label">上次服务时间：</label>
                <div class="span5 grid-layout-content">
                    <div name="lastServiceTime"></div>
                </div> 
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div>

    <div id="Form_car_Dtails" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">车系：</label>
                <div class="span14 grid-layout-content">
                    <div name="carModel"></div>
                </div>
            </div> 
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">车牌：</label>
                <div class="span14 grid-layout-content">
                    <div name="plateNumber"></div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">车架号：</label>
                <div class="span14 grid-layout-content">
                    <div name="vinNumber">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">发动机号：</label>
                <div class="span14 grid-layout-content">
                    <div name="machineNumber">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">底盘号：</label>
                <div class="span14 grid-layout-content">
                    <div name="chassisNumber">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">购车日期：</label>
                <div class="span14 grid-layout-content">
                    <div name="buyDate">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">里程(km)：</label>
                <div class="span14 grid-layout-content">
                    <div name="totalMileage">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">是否二手车：</label>
                <div class="span14 grid-layout-content">
                    <div name="isUsed">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">颜色：</label>
                <div class="span14 grid-layout-content">
                    <div name="color">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">内饰风格：</label>
                <div class="span14 grid-layout-content">
                    <div name="interiorStyle">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">几成新：</label>
                <div class="span14 grid-layout-content">
                    <div name="percentNew">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">是否改装：</label>
                <div class="span14 grid-layout-content">
                    <div name="isRefit">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次保养时间：</label>
                <div class="span14 grid-layout-content">
                    <div name="lastMaintainDate">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次保养里程：</label>
                <div class="span14 grid-layout-content">
                    <div name="lastMaintainMileage">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次年审时间：</label>
                <div class="span14 grid-layout-content">
                    <div name="lastLimitedDate">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">上次保险时间：</label>
                <div class="span14 grid-layout-content">
                    <div name="lastInsuredDate"></div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div> 
</div>
<script type="text/javascript" src="js/tipso.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
	var wraper = $('#Wraper_customer_manage');
	var parentId = carsmart_config.shopId;
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array(); 
    var page_column_model_b = new Array();
    var page_list_buttons_b = new Array(); 
    var page_column_model_c = new Array();
    var page_list_buttons_c = new Array(); 

	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});

    jRad.params['liveness']={data:[{id:' ',name:'全部'},{id:'0',name:'沉默'},{id:'1',name:'一般'},{id:'2',name:'活跃'}]};
    jRad.params['userGrade']={data:[{id:' ',name:'全部'},{id:'0',name:'普通'},{id:'1',name:'会员'}]};
    var field_params={};  
    field_params['isUsed']={data:[{id:'2',name:'不确定'},{id:'0',name:'否'},{id:'1',name:'是'}]};
    field_params['color']={data:[{id:'黑',name:'黑'},{id:'白',name:'白'},{id:'红',name:'红'},{id:'粉',name:'粉'},{id:'绿',name:'绿'},{id:'黄',name:'黄'},{id:'灰',name:'灰'},{id:'银',name:'银'},{id:'蓝',name:'蓝'},{id:'棕',name:'棕'},{id:'其他',name:'其他'}]};
    field_params['interiorStyle']={data:[{id:'0',name:'普通'},{id:'1',name:'简约'},{id:'2',name:'豪华'},{id:'3',name:'其他'}]};
    field_params['percentNew']={data:[{id:' ',name:'不确定'},{id:'1',name:'1'},{id:'2',name:'2'},{id:'3',name:'3'},{id:'4',name:'4'},{id:'5',name:'5'},{id:'6',name:'6'},{id:'7',name:'7'},{id:'8',name:'8'},{id:'9',name:'9'},{id:'10',name:'10'}]};
    field_params['isRefit']={data:[{id:'2',name:'不确定'},{id:'0',name:'否'},{id:'1',name:'是'}]};

    var now = new Date();
    var currentdate = now.getFullYear()+"-"+((now.getMonth()+1)<10?"0":"")+(now.getMonth()+1)+"-"+(now.getDate()<10?"0":"")+now.getDate();
   
    page_column_model.push({display: '客户id', name : 'userInfoId',hidden:true});
    page_column_model.push({display: '客户姓名', name : 'userName',diy:function(item,$div){
        if(item.userName == '' || item.userName == undefined){
            $div.html("--")
        }else{
            $div.html(item.userName)
        }
    }}); 
    page_column_model.push({display: '手机号', name : 'mobile'}); 
    page_column_model.push({display: '活跃度', name : 'liveness'});
    page_column_model.push({display: '客户级别', name : 'userGrade',diy:function(item,$div){
        var $up = $("<a>").addClass('up').attr("style","margin-left:10px;").html("升级");
        var $down = $("<a>").addClass('down').attr("style","margin-left:10px;").html("降级");
        if(item.userGrade == "0"){
            $div.html('普通').append($up)
        }else{
            $div.html('会员').append($down)
        }
        $up.click(function(){
            $.jRadConfirm('确认升级吗？',1,function(){
                var checked = $('#Table_customer_list').getCheckedTrs();
                var postData = {};
                postData.businessInfoId = carsmart_config.businessInfoId;
                postData.userInfoId = checked[0].userInfoId; 
                postData.gradeFlag = 1
                $.jRadPost({
                    data:postData, 
                    url:'/vip-ws/ws/0.1/userManager/updateUserGrade',
                    success: function(data){ 
                        $('#Table_customer_list').flexMessage('升级成功!', 'success');
                        $('#Table_customer_list').flexReload();
                    },
                    error:function(xhr){ 
                        var errormsg = eval("(" + xhr.responseText + ")"); 
                        if (errormsg != undefined) {
                            $('#Table_customer_list').flexMessage(errormsg[0].message, 'error');
                        }
                    }
                }); 
            }); 
        })
        $down.click(function(){
            var checked = $('#Table_customer_list').getCheckedTrs();
            $.jRadConfirm('确认降级吗？',1,function(){
                var checked = $('#Table_customer_list').getCheckedTrs();
                var postData = {};
                postData.businessInfoId = carsmart_config.businessInfoId;
                postData.userInfoId = checked[0].userInfoId; 
                postData.gradeFlag = 0
                $.jRadPost({
                    data:postData, 
                    url:'/vip-ws/ws/0.1/userManager/updateUserGrade',
                    success: function(data){ 
                        $('#Table_customer_list').flexMessage('降级成功!', 'success');
                        $('#Table_customer_list').flexReload();
                    },
                    error:function(xhr){ 
                        var errormsg = eval("(" + xhr.responseText + ")"); 
                        if (errormsg != undefined) {
                            $('#Table_customer_list').flexMessage(errormsg[0].message, 'error');
                        }
                    }
                });
            }); 
        })
    }});
    page_column_model.push({display: '定位信息', name : 'locationAddress',diy:function(item,$div){
        if(item.locationAddress == '' || item.locationAddress == undefined){
            $div.html("--")
        }else{
            $div.html(item.locationAddress)
        }
    }}); 
    page_column_model.push({display: '服务次数', name : 'serviceCnt'}); 
    page_column_model.push({display: '消费金额', name : 'totalUserPay'});
    page_column_model.push({display: '距离(km)', name : 'distance'});
    page_column_model.push({display: '操作', name : 'operate',width:200,diy:function(item,$div){
        var $info = $("<a>").addClass('flexOperate').html("查看详情");
        var $edit = $("<a>").addClass('flexOperate').html("修改"); 
        var $del = $("<a>").addClass('flexOperate').html("删除");
        $div.append($info).append($edit).append($del)
        
        $info.click(function(){
            var dtails = $.jRadGet({url:'/vip-ws/ws/0.1/userManager/getUserDetail?businessInfoId='+carsmart_config.businessInfoId+'&userInfoId='+item.userInfoId});
            $('#Form_customer_Dtails').form({
                title: '查看详情', 
            }).form('open');
            $('#Form_customer_Dtails div[name="userName"]',wraper).html(dtails.userName);
            $('#Form_customer_Dtails div[name="mobile"]',wraper).html(dtails.mobile);
            $('#Form_customer_Dtails div[name="birthday"]',wraper).html(dtails.birthday);
            $('#Form_customer_Dtails div[name="familyAddress"]',wraper).html(dtails.familyAddress);
            $('#Form_customer_Dtails div[name="lastServiceTime"]',wraper).html(dtails.lastServiceTime);
            var str = '';
            if(dtails.userGrade == "0"){
                str = '普通';
            }else{
                str = '会员'
            }
            $('#Form_customer_Dtails div[name="userGrade"]',wraper).html(str);
            $('#Form_customer_Dtails div[name="serviceCnt"]',wraper).html(dtails.serviceCnt);
            $('#Form_customer_Dtails div[name="totalUserPay"]',wraper).html(dtails.totalUserPay);
        })

        $edit.click(function(){
            var dtails = $.jRadGet({url:'/vip-ws/ws/0.1/userManager/getUserDetail?businessInfoId='+carsmart_config.businessInfoId+'&userInfoId='+item.userInfoId});
            $('#Form_customer_add').form({
                title: '修改', 
                item: dtails,  
                url: '/vip-ws/ws/0.1/userManager/updateUser',
                preSubmit:function(json){ 
                    var checked = $('#Table_customer_list').getCheckedTrs();
                    json.businessInfoId = carsmart_config.businessInfoId;
                    json.userInfoId = checked[0].userInfoId;
                    return json;
                },
                success:function(){ 
                    $('#Table_customer_list').flexMessage('修改成功', 'success');
                    $('#Table_customer_list').flexReload();
                }
            }).form('open');
        });

        $del.click(function(){
            $.jRadConfirm('确认删除吗？',1,function(){
                var checked = $('#Table_customer_list').getCheckedTrs();
                var postData = {};
                postData.businessInfoId = carsmart_config.businessInfoId;
                postData.userInfoId = checked[0].userInfoId;
                $.jRadPost({  
                    url:'/vip-ws/ws/0.1/userManager/deleteUser',
                    data:postData, 
                    success: function(data){ 
                        $('#Table_customer_list').flexMessage('删除成功!', 'success');
                        $('#Table_customer_list').flexReload();
                    },
                    error:function(xhr){ 
                        var errormsg = eval("(" + xhr.responseText + ")"); 
                        if (errormsg != undefined) {
                            $('#Table_customer_list').flexMessage(errormsg[0].message, 'error');
                        }
                    }
                });
            }); 
        });
    }});
    
    page_search_items.push({row:'1',type:'jrad-input',display:'客户姓名',name:'userName'});
    page_search_items.push({row:'1',type:'jrad-input',display:'手机号',name:'mobile'});
    page_search_items.push({row:'1',type:'jrad-select',display:'活跃度',name:'liveness',params:jRad.params['liveness']});
    page_search_items.push({row:'2',type:'jrad-select',display:'客户级别',name:'userGrade',params:jRad.params['userGrade']});

    page_list_buttons.push({title: '新增',displayname:'新增',bclass: 'icon-plus',
        onpress: function() { 
            $('#Form_customer_add').form({
                title: '创建客户',
                item:{},
                url:'/vip-ws/ws/0.1/userManager/addUser',
                preSubmit:function(json){
                    json.businessInfoId = carsmart_config.businessInfoId;
                    return json;
                },
                success: function() {
                    $('#Table_customer_list').flexMessage('创建成功', 'success','3');
                    $('#Table_customer_list').flexReload();
                }
            }).form('open');
            $("#Form_customer_add input[name='plateNumber']").attr("maxlength","10")
            $("#Form_customer_add input[name='machineNumber']").attr("maxlength","30")
            $("#Form_customer_add input[name='vinNumber']").attr("maxlength","30")
            $("#Form_customer_add input[name='chassisNumber']").attr("maxlength","30")
        }
    });

    $('#Table_customer_list').flexigrid({
        reload: true,
        pagination: {diaplay_pages: 10,align:'bottom',showText: '从第_start_到_end_项 共_total_项'},
        colModel: page_column_model,
        searchitems: page_search_items,
        buttons : page_list_buttons,
        pagedStyle: 'oc',
		method:'get',
		showSearch:true,
        showCheckbox: false, 
        overflow:true,
        checkBoxType:'single',
        onError:showError2,
        url:'/vip-ws/ws/0.1/userManager/getUserList?businessInfoId='+carsmart_config.businessInfoId,
        trEvent:function(){		 
			var checked = $('#Table_customer_list').getCheckedTrs();  
			$('#Table_car_info').flexOptions({ 
				extParam:{
					userInfoId: checked[0].userInfoId,
                    businessInfoId:carsmart_config.businessInfoId
				}
			}).flexReload();
            
		}
    });

    $('.vdiv .tDiv',wraper).before('<span style="margin:0 20px 0 14px;font-size:15px;float:left;line-height:60px;">客户列表</span>');

    $('.cDiv:eq(0) th:eq(3) div',wraper).html('活跃度'+'<img class="Oval" src="css/images/Oval.png"  data-toggle="tooltip" title="活跃：最近180天服务大于5次，或最近15天有到店服务。<br>一般：最近180天服务1至5次，或最近两个月有到店服务。<br>沉默：最近180天没有服务">')
    $('.Oval').tipso({background:'#11afd2',color:'#fff'});
    $('.vdiv .hDiv tr th').eq(0).attr("style","display:none;")

    function showError2(xhr){
        var errormsg = eval("(" + xhr.responseText + ")");
        var vdiv = $("#Wraper_customer_manage .vdiv");
        $.jRadMessage({level:'error',message:errormsg[0].message,selector:vdiv});
    }

    $('.date-picker').datepicker( {
        changeMonth: true, 
        changeYear: true, 
        showButtonPanel: true, 
        dateFormat: 'yy-mm', 
        onClose: function(dateText, inst) { 
            var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val(); 
            var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val(); 
            $(this).datepicker('setDate', new Date(year, month, 1)); 
            $("ui-datepicker-calendar").hide();
        },
    }); 

    page_column_model_b.push({display: '车辆ID', name : 'carInfoId',hidden:true});
    page_column_model_b.push({display: '车系', name : 'seriesId'});
    page_column_model_b.push({display: '车牌', name : 'plateNumber',diy:function(item,$div){
        if(item.plateNumber == '' || item.plateNumber == undefined){
            $div.html("--")
        }else{
            $div.html(item.plateNumber)
        }
    }});
    page_column_model_b.push({display: '购车日期', name : 'buyDate',diy:function(item,$div){
        if(item.buyDate == '' || item.buyDate == undefined){
            $div.html("--")
        }else{
            $div.html(item.buyDate)
        }
    }});
    page_column_model_b.push({display: '里程(km)', name : 'totalMileage'}); 
    page_column_model_b.push({display: '是否二手车', name : 'isUsed'});
    page_column_model_b.push({display: '颜色', name : 'color'});
    page_column_model_b.push({display: '内饰风格', name : 'interiorStyle'});
    page_column_model_b.push({display: '几成新', name : 'percentNew'});
    page_column_model_b.push({display: '是否改装', name : 'isRefit'});
    page_column_model_b.push({display: '添加时间', name : 'createDate'});
    page_column_model_b.push({display: '操作',width:200 ,diy:function(item,$div){
        var $info = $("<a>").addClass('flexOperate').html("查看详情");
        var $edit = $("<a>").addClass('flexOperate').html("修改"); 
        var $del = $("<a>").addClass('flexOperate').html("删除");
        if(item.sourceFlag == 'ycb'){
            $div.append($info);  
        }else{
            $div.append($info).append($edit).append($del);
        }
        $info.click(function(){
            $('#Form_car_Dtails').form({
                title: '查看详情',  
            }).form('open');
            var carDetail = $.jRadGet({url:'/vip-ws/ws/0.1/userManager/getCarInfoDetail?carInfoId='+item.carInfoId});

            $('#Form_car_Dtails div[name="carModel"]',wraper).html(carDetail.carModel);
            $('#Form_car_Dtails div[name="plateNumber"]',wraper).html(carDetail.plateNumber);
            $('#Form_car_Dtails div[name="machineNumber"]',wraper).html(carDetail.machineNumber);
            $('#Form_car_Dtails div[name="vinNumber"]',wraper).html(carDetail.vinNumber);
            $('#Form_car_Dtails div[name="chassisNumber"]',wraper).html(carDetail.chassisNumber);
            $('#Form_car_Dtails div[name="buyDate"]',wraper).html(carDetail.buyDate);
            $('#Form_car_Dtails div[name="totalMileage"]',wraper).html(carDetail.totalMileage);
            var str = '';
            if(carDetail.isUsed == "0"){str = '否';}else if(carDetail.isUsed == "1"){str = '是'}else{str = '不确定'}
            $('#Form_car_Dtails div[name="isUsed"]',wraper).html(str);
            $('#Form_car_Dtails div[name="color"]',wraper).html(carDetail.color); 
            var str1 = '';
            if(carDetail.interiorStyle == "0"){str1 = '普通';}else if(carDetail.interiorStyle == "1"){str1 = '简约'}else if(carDetail.interiorStyle == "2"){str1 = '豪华'}else{str1 = '其他'}
            $('#Form_car_Dtails div[name="interiorStyle"]',wraper).html(str1);
            if(carDetail.percentNew == 0){
                $('#Form_car_Dtails div[name="percentNew"]',wraper).html('不确定');
            }else{
                $('#Form_car_Dtails div[name="percentNew"]',wraper).html(carDetail.percentNew);
            }
            var str2 = '';
            if(carDetail.isUsed == "0"){str2 = '否';}else if(carDetail.isUsed == "1"){str2 = '是'}else{str2 = '不确定'}
            $('#Form_car_Dtails div[name="isRefit"]',wraper).html(str2);
            $('#Form_car_Dtails div[name="lastInsuredDate"]',wraper).html(carDetail.lastInsuredDate);
            $('#Form_car_Dtails div[name="lastLimitedDate"]',wraper).html(carDetail.lastLimitedDate);
            $('#Form_car_Dtails div[name="lastMaintainDate"]',wraper).html(carDetail.lastMaintainDate);
            $('#Form_car_Dtails div[name="lastMaintainMileage"]',wraper).html(carDetail.lastMaintainMileage);
        })

        $edit.click(function(){
            var carDetail = $.jRadGet({url:'/vip-ws/ws/0.1/userManager/getCarInfoDetail?carInfoId='+item.carInfoId});
            $('#Form_car_add').form({
                title: '修改车辆', 
                item: carDetail,  
                fields:field_params,
                url: '/vip-ws/ws/0.1/userManager/updateCarInfo',
                preSubmit:function(json){ 
                    var checked = $('#Table_car_info').getCheckedTrs();
                    json.businessInfoId = carsmart_config.businessInfoId;
                    json.carInfoId = checked[0].carInfoId;
                    json.seriesId = $('.last span').attr("id");
                    json.buyDate = $('#startDate').val();
                    return json;
                },
                success:function(){ 
                    $('#Table_car_info').flexMessage('修改成功', 'success');
                    $('#Table_car_info').flexReload();
                }
            }).form('open');

            $('#startDate').val(carDetail.buyDate);

            $("#Form_car_add input[name='plateNumber']").attr("maxlength","10")
            $("#Form_car_add input[name='machineNumber']").attr("maxlength","30")
            $("#Form_car_add input[name='vinNumber']").attr("maxlength","30")
            $("#Form_car_add input[name='chassisNumber']").attr("maxlength","30")
            $('.last').show().html('');
            var _span = $('<span>').html(carDetail.carModel).attr("id",carDetail.seriesId)
            var _a = $('<a>').html('X')
            $('.last').append(_span).append(_a)
            $('.condition-title').hide();
            $('.ul-letters').hide();
            $('.last a').on('click',function(){
                $('.last').hide();
                $('.ul-letters').show();
                brandFn()
                $('.condition-title').show();
                $('.uperCase').removeClass("active");
                $('.car-list').show().html('');
            })
        });
        $del.click(function(){
            $.jRadConfirm('确认删除吗？',1,function(){
                var checked = $('#Table_car_info').getCheckedTrs();
                var postData = []; 
                $.each(checked,function(i){
                    var postJson={};
                    postJson.businessInfoId=carsmart_config.businessInfoId;
                    postJson.plateNumber=this.plateNumber;
                    postJson.carInfoId=this.carInfoId;
                    postData.push(postJson)
                });
                $.jRadPost({  
                    url:'/vip-ws/ws/0.1/userManager/delCarInfo',
                    data:postData, 
                    success: function(data){ 
                        $('#Table_car_info').flexMessage('删除成功!', 'success');
                        $('#Table_car_info').flexReload();
                    },
                    error:function(xhr){ 
                        var errormsg = eval("(" + xhr.responseText + ")"); 
                        if (errormsg != undefined) {
                            $('#Table_car_info').flexMessage(errormsg[0].message, 'error');
                        }
                    }
                });
            }); 
        });
    }});

    page_list_buttons_b.push({title: '新增',displayname:'新增',bclass: 'icon-plus',
        prefunc:function(){
            var checked = $('#Table_customer_list').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },
        onpress: function(){
            var checked = $('#Table_customer_list').getCheckedTrs();
            $('#Form_car_add').form({
                title: '创建车辆',
                grid:18,
                item:{},
                fields:field_params,
                validators: jRad.validators, 
                url:'/vip-ws/ws/0.1/userManager/addCarInfo',
                preSubmit:function(json){
                    json.businessInfoId = carsmart_config.businessInfoId;
                    json.userInfoId = checked[0].userInfoId;
                    json.ownerName = checked[0].userName;
                    json.seriesId = $('.last span').attr("id");
                    json.buyDate = $('#startDate').val()
                    return json;
                },
                success: function() {
                    $('#Table_car_info').flexMessage('创建成功', 'success','3');
                    $('#Table_car_info').flexReload();
                }
            }).form('open');
            $('#startDate').val("");
            $("#Form_car_add input[name='plateNumber']").attr("maxlength","10")
            $("#Form_car_add input[name='machineNumber']").attr("maxlength","30")
            $("#Form_car_add input[name='vinNumber']").attr("maxlength","30")
            $("#Form_car_add input[name='chassisNumber']").attr("maxlength","30")
            $('.last').html("").hide()
            $('.ul-letters').show();
            $('.condition-title').show();
            brandFn()
            $('.car-list').show().html('');
        }
    });

    $('#Table_car_info').flexigrid({
        reload:true,
		method:'get',
		pagination: {diaplay_pages: 10,align:'bottom',showText: '从第_start_到_end_项 共_total_项'},
        colModel : page_column_model_b,
        buttons : page_list_buttons_b,
        pagedStyle: 'oc',
        autoload: false,
        showSearch:true,
        url:'/vip-ws/ws/0.1/userManager/getCarInfoList',
        onError:showError,
        trEvent:function(){   
            var checked = $('#Table_car_info').getCheckedTrs();  
            $('#Table_workOrder_info').flexOptions({ 
                extParam:{
                    carInfoId: checked[0].carInfoId,
                    businessInfoId: carsmart_config.businessInfoId
                }
            }).flexReload();
        }
    });

    $('.sdiv .tDiv',wraper).before('<span style="margin:0 20px 0 14px;font-size:15px;float:left;line-height:60px;">车辆信息列表</span>');

    $('.sdiv .hDiv tr th').eq(1).attr("style","display:none;")
    $(".vdiv .searchButtons .btn").eq(0).on("click",function(){
        $(".sdiv .btn").eq(0).addClass("disabled").unbind("click")
    })
    function showError(xhr){
        var errormsg = eval("(" + xhr.responseText + ")");
        var sdiv = $("#Wraper_customer_manage .sdiv");
        $.jRadMessage({level:'error',message:errormsg[0].message,selector:sdiv});
    }
    page_column_model_c.push({display: '工单ID', name : 'workOrderId',hidden:true});
    page_column_model_c.push({display: '客户姓名', name : 'userName'});
    page_column_model_c.push({display: '手机号', name : 'mobile'}); 
    // page_column_model_c.push({display: '车主是否等待', name : 'isWait'});
    page_column_model_c.push({display: '赠送洗车', name : 'isWash'}); 
    page_column_model_c.push({display: '客户是否取回废件', name : 'isRetain'}); 
    // page_column_model_c.push({display: '消费金额', name : 'payamount'});
    page_column_model_c.push({display: '工单生成时间', name : 'sendOrderTime'});
    page_column_model_c.push({display: '维修完成时间', name : 'completeDate'});
    page_column_model_c.push({display: '操作',width:200 ,diy:function(item,$div){
        var $info = $("<a workid='"+item.repairId+"'></a>").addClass('flexOperate').html("查看详情");
        var $edit = $("<a workid='"+item.repairId+"'></a>").addClass('flexOperate').html("修改"); 
        var $del = $("<a></a>").addClass('flexOperate').html("删除");
        if(item.sourceFlag == 'ycb'){
            $div.append($info);  
        }else{
            $div.append($info).append($edit).append($del);
        }
        $info.click(function(){
            var workId = $(this).attr("workid")
            var cookietime = new Date(); 
            cookietime.setTime(cookietime.getTime() + 2000);//coockie保存2秒
            $.cookie("workId",workId,{expires:cookietime})
            $.jRadOpen({'url':'workOrderManage.html'})
        })

        $edit.click(function(){
            var workId = $(this).attr("workid")
            var cookietime = new Date(); 
            cookietime.setTime(cookietime.getTime() + 2000);//coockie保存2秒
            $.cookie("workId",workId,{expires:cookietime})
            $.jRadOpen({'url':'workOrderManage.html'})
        });

        $del.click(function(){
            $.jRadConfirm('确认删除吗？',1,function(){
                var checked = $('#Table_workOrder_info').getCheckedTrs();
                var postData = {}; 
                postData.repairId=checked[0].repairId;
                $.jRadPost({  
                    url:'/vip-ws/ws/0.1/userManager/delWorkOrder',
                    data:postData, 
                    success: function(data){ 
                        $('#Table_workOrder_info').flexMessage('删除成功!', 'success');
                        $('#Table_workOrder_info').flexReload();
                    },
                    error:function(xhr){ 
                        var errormsg = eval("(" + xhr.responseText + ")"); 
                        if (errormsg != undefined) {
                            $('#Table_workOrder_info').flexMessage(errormsg[0].message, 'error');
                        }
                    }
                });
            }); 
        });
    }});
    page_list_buttons_c.push({title: '新增',displayname:'新增',bclass: 'icon-plus',
        onpress: function(){
            //$.jRadOpen({'name':'工单管理','url':'workOrderManage.html'});

            $.jRadOpen({'url':'workOrderManage.html'})
        }
    });
    $('#Table_workOrder_info').flexigrid({
        reload:true,
        showCheckbox: false,
        method:'get',
        url:'/vip-ws/ws/0.1/busiWorkOrder/getWorkOrderList?businessInfoId='+carsmart_config.businessInfoId,
        pagination: {diaplay_pages: 10,align:'bottom',showText: '从第_start_到_end_项 共_total_项'},
        colModel : page_column_model_c,
        buttons : page_list_buttons_c,
        autoload: false, 
        onError:showError3,
        pagedStyle: 'oc'
    });

    $('.udiv .tDiv',wraper).before('<span style="margin:0 20px 0 14px;font-size:15px;float:left;line-height:60px;">工单列表</span>');
    function showError3(xhr){
        var errormsg = eval("(" + xhr.responseText + ")");
        var udiv = $("#Wraper_customer_manage .udiv");
        $.jRadMessage({level:'error',message:errormsg[0].message,selector:udiv});
    }
    $('.udiv .hDiv tr th').eq(0).attr("style","display:none;")
    $('.hDiv',wraper).css('overflow','hidden');
    $('.bDiv',wraper).css('overflow-x','scroll');

    function brandFn(){
        var brandList = $.ajax({url:"/shopmanage-ws/ws/0.1/support/brand/list",async:false});
        var msg = eval("(" + brandList.responseText + ")");
        var A_Z="";
        for(var i=65;i<91;i++){
            if(i == 69 || i== 73 || i == 85 || i == 86){
                A_Z+="";
            }else{  
                A_Z+="<li  class='uperCase uperCasess' data-num="+i+">"+String.fromCharCode(i)+"</li>";
            }
        };
        $("#searchBox .ul-letters").html(A_Z);

        $('.ul-letters li').on('click',function(){
            var str = $(this).html();
            var data = eval('msg.'+str)
            var _li = '';
            $('.car-list').html("");
            $.each(data,function(i){
                var item = data[i]
                _li += '<li data-id='+item.id+'>'+item.name+'</li>'
            })
            $('.car-list').append(_li);

            $('.car-list li').on('click',function(){
                var str = $(this).attr("data-id")
                //http://10.23.31.151/shopmanage-ws/ws/0.1/modelCms/factory/list?brandId=84&_=1449651904401
                var modelList = $.ajax({url:'/shopmanage-ws/ws/0.1/support/model/list?brandId='+str,async:false})
                var data2 = eval("(" + modelList.responseText + ")");
                $('.car-list').html("");
                var _li2 = '';
                $.each(data2,function(i){
                    var item2 = data2[i]
                    _li2 += '<li data-id='+item2.id+'>'+item2.name+'</li>'
                })
                $('.car-list').append(_li2);

                $('.car-list li').on('click',function(){
                    $('.car-list').html("");
                    var str = $(this).attr("data-id")
                    var modelList2 = $.ajax({url:'/shopmanage-ws/ws/0.1/modelCms/model/list?factoryId='+str,async:false})
                    var data3 = eval("(" + modelList2.responseText + ")");
                    $('.car-list').html("");
                    var _li3 = '';
                    $.each(data3,function(i){
                        var item3 = data3[i]
                        _li3 += '<li data-id='+item3.modelId+'>'+item3.modelName+'</li>'
                    })
                    $('.car-list').append(_li3);
                    
                    $('.car-list li').on('click',function(){
                        var str = $(this).attr("data-id")
                        $('.ul-letters').hide();
                        $('.car-list').hide();
                        $('.condition-title').hide();
                        $('.last').show().html('<span id='+str+'>'+$(this).html()+'</span><a href="javascript:void(0)">X</a>');

                        $('.last a').on('click',function(){
                            $('.last').hide();
                            $('.ul-letters').show();
                            $('.condition-title').show();
                            $('.uperCase').removeClass("active");
                            $('.car-list').show().html('');
                        })
                    })

                })

                
            })
        });

        $("body").on("click","#searchBox .uperCasess", function(){
            $(this).siblings(".uperCase").removeClass("active").end().addClass("active");
        })
    }

});
</script>