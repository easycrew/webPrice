<style> 
    .cDiv table tr td, .cDiv table tr th{text-align:center;}
</style>
<div class="urlContentWraper" id="Wraper_shop_rescue">
	<!-- 列表显示 -->
    <div class="ui-info-layout">
        <table id="Table_shop_rescue">
        </table>
	</div>
	<div id="Form_shop_rescue" class="grid-layout ui-form">
		<div class="grid-layout-main jrad-form">
			<div class="grid-row-fluid"> 
				<label class="span5 grid-layout-label">
				   <span class="ui-form-required">*</span>
					救援类型：
				</label>
				<div class="span8 grid-layout-content fluid-wrap">
					<div data-name="rescueServiceId" class="jrad-select-container">
					</div>
				</div>
			</div>
			<div class="grid-row-fluid">
				<label class="span5 grid-layout-label">
				<span class="ui-form-required">*</span>
					救援报价：
				</label>
				<div class="span8 grid-layout-content fluid-wrap">
					<div data-name="rescueUnit" class="jrad-input-container">
					</div>
				</div>
			</div>
			<div class="grid-row-fluid">
				<label class="span5 grid-layout-label">
				<span class="ui-form-required">*</span>
					救援范围：
				</label>
				<div class="span8 grid-layout-content fluid-wrap">
					<div data-name="rescueRegion" class="jrad-select-container">
					</div>
				</div>
			</div>
            <input type="hidden" name="rescueServiceId"/>
            <input type="hidden" name="shopAccountId"/>
            <input type="hidden" name="lastModifier"/>
		</div>
		<div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">
                确定
            </button>
            <button class="jrad-btn-normal btn btn-small btn-default">
                取消
            </button>
        </div>
		</div>
	</div> 
<script type="text/javascript">
$(document).ready(function() {
	var wraper = $('#Wraper_shop_rescue');
	var parentId = carsmart_config.shopId;
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array(); 
    var entityModel = {};
    var rescueServices = [];
    var _rescue = $.jRadGet({
        url: '/vip-ws/ws/0.1/shopAccountBack/listRescueService'
    });
    $.each(_rescue.rescueServices,
    function(index, vo) {
        var __id = vo['rescueServiceId'];
        var __name = vo['rescueServiceName'];
        var __tm = {
            'id': __id,
            'name': __name
        };
        rescueServices.push(__tm);
    });
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});   
	jRad.validators['rescueServiceId'] = [{msg:"救援类型不能为空",type:'min',value:1}];	
	jRad.validators['rescueUnit'] = [{msg:"救援报价不能为空",type:'min',value:1}];	
	jRad.validators['rescueRegion'] = [{msg:" 救援范围不能为空",type:'min',value:1}];
	var fields_params = {};
    fields_params['rescueServiceId']={data:rescueServices};
    fields_params['rescueRegion'] = {
        data: [{id:'0',name:'请选择'},{id:'5',name:'5公里内'},{id:'10',name:'10公里内'},{id:'15',name:'15公里内'},{id:'20',name:'20公里内'}] 
    };
    $('#Form_shop_rescue').form({
        fluid: true,
        item:{},
        validators: jRad.validators,
        fields: fields_params,
        autobinding:true
    });
    page_column_model.push({display: '救援类型', name : 'rescueServiceName'});
    page_column_model.push({display: '救援报价/次', name : 'rescueUnit'}); 
    page_column_model.push({display: '救援范围(多少公里内)', name : 'rescueRegin'});
    page_column_model.push({display: '操作', name : 'modify',diy:function(item,$div){
        var editrescue=$("<a>").addClass("edit_rescue").attr({href:"javascript:"}).css("margin-right","5px").html("编辑"); 
        var delrescue=$("<a>").addClass("del_rescue").attr({href:"javascript:"}).html("删除"); 
        $div.html(editrescue);
        $div.append(delrescue);
        $("a.edit_rescue",$div).bind('click',function(){
            var _item = $ .jRadGet({url : '/vip-ws/ws/0.1/shopAccountBack/rescueRadarDetail?busiRescueRadarId='+item.busiRescueRadarId});
            _item.busiRescueRadarId=item.busiRescueRadarId;
            $("#Form_shop_rescue").form({
                title: '编辑',
                item:_item,
                url:'/vip-ws/ws/0.1/shopAccountBack/editRrescueRadar',
                preSubmit:function(json){
                    json.shopAccountId=carsmart_config.shopId;
                    json.busiRescueRadarId=item.busiRescueRadarId;
                    json.lastModifier=carsmart_config.operatorName;
                    return json;
                },
                success:function(){ 
                    $('#Table_shop_rescue').flexMessage('编辑成功', 'success');
                    $('#Table_shop_rescue').flexReload();
                }  
            }).form('open');
        });
        $("a.del_rescue",$div).bind('click',function(){
            var postData={};
            postData.busiRescueRadarIds=item.busiRescueRadarId;
            $.jRadConfirm('确认删除？', 1,
            function() {
                $.jRadPost({
                    url:'/vip-ws/ws/0.1/shopAccountBack/delRrescueRadar',
                    data:postData, 
                    success:function(){ 
                        $('#Table_shop_rescue').flexMessage('删除成功!', 'success');
                        $('#Table_shop_rescue').flexReloadSearch(); 
                     
                    },error:function(xhr){
                        var errormsg = eval("(" + xhr.responseText + ")"); 
                        if (errormsg != undefined) {
                            $('#Table_shop_rescue').flexMessage(errormsg[0].message, 'error');
                        }
                    }
                });
            });
        })
    }});
   
   
    page_list_buttons.push({
        title: '新增',
		displayname:'新增',
        bclass: 'icon-plus',
        onpress: function() { 
			$('#Form_shop_rescue').form({
                title: '新增',
                item:{"rescueRegion":"0","rescueServiceId":"1"},
				validators: jRad.validators, 
				url:'/vip-ws/ws/0.1/shopAccountBack/addRrescueRadar',
                preSubmit:function(json){
                    json.shopAccountId=carsmart_config.shopId;
                    json.lastModifier=carsmart_config.operatorName;
                    return json;
                },
                success: function() {
                    $('#Table_shop_rescue').flexMessage('创建成功', 'success','3');
                    $('#Table_shop_rescue').flexReload();
                }
            }).form('open');
        }
    });

    $('#Table_shop_rescue').flexigrid({
        reload: true,
        grid:40,
        pagination: {diaplay_pages: 10,align:'bottom',showText: '从第_start_到_end_项 共_total_项'},
        colModel: page_column_model,
        buttons: page_list_buttons,
        searchitems: page_search_items,
        pagedStyle: 'oc',
		method:'get',
		showSearch:true,
        url:'/vip-ws/ws/0.1/shopAccountBack/listRrescueRadar?shopAccountId='+carsmart_config.shopId, 
        //1.CMS查询0.总店查询分店，此时userId为当前登录用户的ID 
        overflow:true 
    }); 
    
    $('.tDiv',wraper).before('<span style="margin:0 20px 0 14px;font-size:15px;float:left;line-height:60px;">救援服务列表</span>');
    $('.hDiv',wraper).css('overflow','hidden');
    $('.bDiv',wraper).css('overflow-x','scroll');
    
});
</script>