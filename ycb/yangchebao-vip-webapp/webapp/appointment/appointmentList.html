<style>
    .ycbtn{background: #64a0f3;color:#fff;height:30px;line-height:30px;padding:0 10px;}
    .time-ycb-btn, .jishi-ycb-btn{background:#64a0f3;width:80px;height:30px;line-height:30px;color:#fff;border:none;text-align: center;}
    .ul-letters { float: left;}
    .uperCase{ border: 1px solid #bfbfbf;color: #505050;cursor: pointer;height: 20px;line-height: 20px;margin: 1px 6px 3px 0px;text-align: center;width: 20px;float: left;}
    .ul-letters .active {border: 2px solid #3ea5f4;height: 16px;line-height: 16px;width: 16px;}
    .brand-letter {overflow: hidden;padding: 5px 0 5px;}
    .car-list{overflow:hidden;margin-left:14px;}
    .car-list li{float:left;padding:5px 15px;margin:8px 5px 5px 5px;margin-right:18px;display:inline;text-align:center;height:28px;line-height:28px;border:1px solid #ccc;cursor:pointer;}
    .last{display:none;float:left;border:1px solid #ccc;padding:5px;overflow:hidden;}
    .last span{float:left;margin-top:1px;}
    .last a{ border: none;color: #fff;cursor: pointer;background:#2f8ac8;float: left;height: 20px;line-height: 20px;margin: 1px 3px 3px 3px;text-align: center;width:20px;}
    .last a:hover{text-decoration:underline;}


    .ybs-yuangong-select, .ybs-gongshi-select{width:1000px;background: #dfe3ec;position:fixed;z-index: 99999;left:50%;/*top:50%;*/top:10px;bottom:10px;margin:20px 0 20px -500px;overflow:hidden;}

    .table-condensed tr td, .table-condensed tr th{color:#333;}
    .alert-head{height:40px;padding:0 30px;overflow: hidden;line-height:40px;background: #2e83f8;}
    .alert-head span{float:left;font-size:16px;color:#fff;}
    .alert-head a{float:right;width:21px;height:21px;background:url(./img/y-colse.png) 0 0 no-repeat;margin-top:10px;}
    .ycb-alert-wrap{padding:35px;overflow-y:auto;}
    /*.ybs-yuangong-select .y-h2{color:#1d77f2;font-size:18px;text-align: center;padding:20px 33px 0 33px;}*/
    .drag{position:fixed;width:100%;height:100%;left:0;top:0;filter:;background: #000;z-index:99990;filter:alpha(opacity=70);-moz-opacity:0.7; opacity: 0.7;}
    .employSel{width:200px;height:30px;}
    .button-yuangong, .button-gongwei, .button-yuangong-sel{width:100px;height:30px;border:none;background: #2e83f9;line-height:30px;text-align: center;color:#fff;margin-left:20px;}

    .workUl{/*margin:30px 38px 30px 30px;*/margin:15px 38px 15px 0px;}
    .workUl li{border:1px solid #c3ddfe;float:left;margin:2px 6px;height:33px;line-height:33px;background: #9eb1cf url(css/images/cntbg.png) 0 0 repeat-x;padding:0 18px;/*color:#5678c0;*/color:#000;font-size:14px;cursor:pointer;}
    .workUl .t-active{background:#2e83f9;color:#fff;}
    .workUl .getClrea{float:right;}
    /*.ycbTable, .ycbMech{margin:0 30px;}*/
    .ycbTable, .ycbMech{position: relative;background: #fff;}
    .ycbTable table td, .ycbTable table th, .ycbMech table td, .ycbMech table th{text-align: center;}
    .ycbTable table thead tr, .ycbMech table thead tr{background:#DFE3EC;border:1px solid #A3AECD;height:32px;}
    .ycbTable table thead tr th, .ycbMech table thead tr th{font-family:"STHeitiSC-Light";font-size:14px;color:#5D6F8F;}
    .rowcolor{background:#DFE3ED;border:1px solid #9EB1CF;font-size:16px;}
    .ycbTable input[type="radio"], .ycbMech input[type="radio"]{position: static;filter:alpha(opacity=100);-moz-opacity:1; opacity: 1;}
    .ycbTable label, .ycbMech label{display:inline-block;}
    .warpDiv, .warpDiv2{background:#F7F8FC;position: absolute;text-align: center;}
    
    .warpDiv div, .warpDiv2 div{word-wrap:break-word;word-break:normal;word-break:break-all;}
    /*.warpDiv{position: absolute;}*/
    .trurBtn, .trurBtn-sel{width:86px;height:32px;line-height:32px;text-align: center;color:#a6aab4;border:1px solid #c3ddfe;}

    .employInput{height:32px;line-height:32px;padding:0 3px;width:193px;border:none;margin:0 0px 0 50px;}
    .succAndErr{margin-left:15px;font-size:14px;}
    .succAndErr span{margin-right:15px;}
    .gw-edit, .yg-edit{cursor:pointer;color:#3586f5;}
    .infotab, .infotab tr th, .infotab tr td {border:none;}
    .infotab tr{height:30px;}
    .infotab tr td span{color:#2f8ac8;cursor: pointer;}
    .msg-tipSet{line-height:40px;padding-left:10px;}
    .add{display:inline-block;font-size:20px;position:relative;left:0;top:6px;cursor:pointer;}
    .del{display:inline-block;font-size:20px;cursor:pointer;position:relative;left:13px;top:3px;}


    .d1{border-top:35px #9eb1cf solid;border-left:170px #dfe3ed solid;width:0;height:0;position:relative;color:#FFF;padding:0;}
    .d1 span{display:block;width:40px;}
    .s1{position:absolute;top:-30px;left:-54px;color:#666;}
    .s2{position:absolute;bottom:3px;right:120px;color:#666;}
</style>
<div class="urlContentWraper" id="Wraper_appointment_manage">
    <div class="ui-info-layout" id="jrad-table">
        <div class="vdiv">
			<table id="Table_appointment_manage"></table>
		</div>
    </div>

    <div id="Form_select_price" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid">
                <div class="span25 grid-layout-content">
                    <div class="grid-row-fluid">
                        <label class="span3 grid-layout-label"></label>
                        <div class="span20 grid-layout-content">
                            <div name="offerType" class="jrad-radio-container">
                            </div>
                        </div>
                    </div>
                    <div class="grid-row-fluid">
                        <table class="infotab">
                            <thead> 
                                <tr>
                                    <th>服务名称</th>
                                    <th>预订价(元)</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确定</button>
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div> 

    <div id="work_reason" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid">
                <div class="span24 grid-layout-content">
                    <div class="reason"></div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div> 

    <div id="Form_msg_set" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="msg-tipSet"><strong>客户预约短信</strong><span>（客户预约成功后，给相关人短信通知）</span></div>
            <div class="grid-row-fluid type1">
                <label class="span5 grid-layout-label">手机号码：</label>
                <div class="span15 grid-layout-content fluid-wrap">
                    <div name="mobile" class="jrad-input-container mobile">
                    </div>
                </div>
                <span class="add">+</span>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">短信示例：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div style="color:#999;margin-top:4px;">用户13xxxxxxxxx，预约服务：洗车-人工普洗-小轿车，请尽快联系客户确认。</div>
                </div>
            </div>
            <div class="msg-tipSet"><strong>预约确认短信</strong><span>（预约到点前20分钟，提醒相关人确认客户是否到店）</span></div>
            <div class="grid-row-fluid type2">
                <label class="span5 grid-layout-label">手机号码：</label>
                <div class="span15 grid-layout-content fluid-wrap">
                    <div name="mobile" class="jrad-input-container mobile">
                    </div>
                </div>
                <span class="add">+</span>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">短信示例：</label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div style="color:#999;margin-top:4px;">用户13xxxxxxxxx，车牌京A111222还有20分钟到达预约时间，请确认客户是否到店。</div>
                </div>
            </div>
            <div class="msg-tipSet"><strong>日报短信</strong><span>（每天21点，给相关人发送最近3天的预约情况）</span></div>
            <div class="grid-row-fluid type3">
                <label class="span5 grid-layout-label">手机号码：</label>
                <div class="span15 grid-layout-content fluid-wrap">
                    <div name="mobile" class="jrad-input-container mobile">
                    </div>
                </div>
                <span class="add">+</span>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">短信示例：</label>
                <div class="span15 grid-layout-content fluid-wrap">
                    <div style="color:#999;margin-top:4px;">151230完工8单：保养-更换汽油滤芯（1），保养-空调清洗（3），维修-更换车灯（4）。<br>151231预约9单：保养-更换汽油滤芯（2），保养-空调清洗（5），维修-更换车灯（2）。<br>160101预约10单：保养-更换汽油滤芯（1），保养-空调清洗（4），维修-更换车灯（5）。</div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确认</button>
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div> 

    <div id="Form_is_confirm" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label"></label>
                <div class="span14 grid-layout-content fluid-wrap">
                    <div name="isConfirmOrder" class="jrad-radio-container">
                    </div>
                    <p class="note">选择是：客户预约后，需要客服确认后，手动点击“预约确认”生成工单。<br>选择否：客户预约后，默认已确认，不用客服电话确认，自动生成工单。<p>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确认</button>
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div> 

    <div id="Form_appointment_add" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid selectCwash"> 
                <label class="span5 grid-layout-label" style="margin-left:0;">
                <span class="ui-form-required">*</span>是否洗车：</label>
                <div class="span8 grid-layout-content fluid-wrap">
                    <div name="isWash" class="jrad-radio-container">
                    </div>
                </div>
            </div>
            <div class="noCwach">
                <div class="grid-row-fluid">
                    <label class="span5 grid-layout-label">
                    <span class="ui-form-required">*</span>车牌号：</label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div name="plateNumber" class="jrad-input-container">
                        </div>
                        <p class="tip"></p>
                    </div>
                    <div class="span4 grid-layout-content fluid-wrap">
                        <button class="ycbtn">查询</button>
                    </div>
                </div>
                <div class="grid-row-fluid noSearch" style="display:none;margin-top:-10px;">
                    <label class="span5 grid-layout-label"></label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div class="noSearchClass"></div>
                    </div>
                </div>
                <div class="grid-row-fluid">
                    <label class="span5 grid-layout-label">
                    <span class="ui-form-required">*</span>手机号码：</label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div name="mobile" class="jrad-input-container">
                        </div>
                    </div>
                </div>
                <div class="grid-row-fluid">
                    <label class="span5 grid-layout-label"><span class="ui-form-required">*</span>车系：</label>
                    <div class="span14">
                        <div class="searchBox" id="searchBox">
                            <div class="brand" id="brand_show">
                                <div class="brand-letter">
                                    <span class="condition-title">按字母查找</span>
                                    <ul class="ul-letters">
                                    </ul>
                                    <div class="last"></div>
                                </div>
                                <ul class="car-list"></ul>
                            </div>
                        </div>
                    </div>
                </div> 
                <div class="grid-row-fluid appointDiv">
                    <label class="span5 grid-layout-label">
                    <span class="ui-form-required">*</span>预约服务：</label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div name="service" class="jrad-radio-container">
                        </div>
                    </div>
                </div>  
                <div class="grid-row-fluid isshow">
                    <label class="span5 grid-layout-label">养车宝服务：</label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div name="zeroService" class="jrad-select-container service"></div>
                    </div>
                </div> 
                <div class="grid-row-fluid twoShow" style="display:none">
                    <label class="span5 grid-layout-label"></label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div class="plusPrice"></div>
                    </div>
                </div>
                <div class="other" style="display:none">
                    <div class="grid-row-fluid">
                        <label class="span5 grid-layout-label"><span class="ui-form-required">*</span>服务名称：</label>
                        <div class="span12 grid-layout-content">
                            <div name="otherService" class="jrad-input-container"></div>
                        </div>
                    </div>
                    <div class="grid-row-fluid">
                        <label class="span5 grid-layout-label"><span class="ui-form-required">*</span>所需工时：</label>
                        <div class="span12 grid-layout-content">
                            <div name="workHour" class="jrad-input-container"></div>
                        </div>
                    </div>
                    <div class="grid-row-fluid">
                        <label class="span5 grid-layout-label"><span class="ui-form-required">*</span>服务价格：</label>
                        <div class="span12 grid-layout-content">
                            <div name="workHourPrice" class="jrad-input-container"></div>
                        </div>
                    </div>
                </div>
                <div class="grid-row-fluid yuyueTime" style="display:none">
                    <label class="span5 grid-layout-label">
                    <span class="ui-form-required">*</span>预约时间：</label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <button type="submit" value="点击选择" class="time-ycb-btn">点击选择</button>
                        <p class="time-position" style="display:none"></p>
                    </div>
                </div>
                <div class="grid-row-fluid yuyuejishi" style="display:none">
                    <label class="span5 grid-layout-label">
                    <span class="ui-form-required">*</span>预约技师：</label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <button type="submit" value="点击选择" class="jishi-ycb-btn">点击选择</button>
                        <p class="jishi-position" style="display:none"></p>
                    </div>
                </div>
                <div class="grid-row-fluid">
                    <label class="span5 grid-layout-label">备注：</label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div name="remark" class="jrad-textarea-container">
                        </div>
                    </div>
                </div>
            </div>
            <div class="yesCwach" style="display:none">
                <div class="grid-row-fluid">
                    <label class="span5 grid-layout-label">
                    <span class="ui-form-required">*</span>手机号码：</label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div name="mobile" class="jrad-input-container">
                        </div>
                    </div>
                </div>
                <div class="grid-row-fluid">
                    <label class="span5 grid-layout-label">
                    <span class="ui-form-required">*</span>预约服务：</label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div name="serviceId" class="jrad-select-container">
                        </div>
                    </div>
                </div>
                <div class="grid-row-fluid sePrice" style="display:none">
                    <label class="span5 grid-layout-label"></label>
                    <div class="span12 grid-layout-content fluid-wrap">
                        <div class="serverPrice"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确认</button>
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div>  

    <div id="Form_appointment_add_sel" class="grid-layout ui-form" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>车牌号：</label>
                <div class="span12 grid-layout-content fluid-wrap">
                    <div name="plateNumber" class="jrad-input-container">
                    </div>
                    <p class="tip"></p>
                </div>
                <div class="span4 grid-layout-content fluid-wrap">
                    <button class="ycbtn">查询</button>
                </div>
            </div>
            <div class="grid-row-fluid noSearch2" style="display:none;margin-top:-10px;">
                <label class="span5 grid-layout-label"></label>
                <div class="span12 grid-layout-content fluid-wrap">
                    <div class="noSearchClass2"></div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>手机号码：</label>
                <div class="span12 grid-layout-content fluid-wrap">
                    <div name="mobile" class="jrad-input-container">
                    </div>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label"><span class="ui-form-required">*</span>车系：</label>
                <div class="span14">
                    <div class="searchBox" id="searchBox">
                        <div class="brand" id="brand_show">
                            <div class="brand-letter">
                                <span class="condition-title">按字母查找</span>
                                <ul class="ul-letters">
                                </ul>
                                <div class="last"></div>
                            </div>
                            <ul class="car-list"></ul>
                        </div>
                    </div>
                </div>
            </div> 
            <div class="grid-row-fluid selPrice" style="display:none">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>预约服务：</label>
                <div class="span12 grid-layout-content fluid-wrap">
                    <div name="serviceName" style="line-height:30px;"></div>
                    <p class="select-position" style="display:none"></p>
                </div>
            </div>
            <div class="grid-row-fluid yuyueTime" style="display:none">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>预约时间：</label>
                <div class="span12 grid-layout-content fluid-wrap">
                    <button type="submit" value="点击选择" class="time-ycb-btn">点击选择</button>
                    <p class="time-position" style="display:none"></p>
                </div>
            </div>
            <div class="grid-row-fluid yuyuejishi" style="display:none">
                <label class="span5 grid-layout-label">
                <span class="ui-form-required">*</span>预约技师：</label>
                <div class="span12 grid-layout-content fluid-wrap">
                    <button type="submit" value="点击选择" class="jishi-ycb-btn">点击选择</button>
                    <p class="jishi-position" style="display:none"></p>
                </div>
            </div>
            <div class="grid-row-fluid">
                <label class="span5 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content fluid-wrap">
                    <div name="remark" class="jrad-textarea-container">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <button class="jrad-btn-primary btn btn-small btn-primary">确认</button>
            <button class="jrad-btn-normal btn btn-small btn-default">取消</button>
        </div>
    </div> 
    
</div>
<div class="ybs-gongshi-select" style="display:none">
    <div class="alert-head"><span>工位工时选择</span><a href="javascript:void(0)"></a></div>
    <div class="ycb-alert-wrap">
        <div class="clearfix"> 
            <button class="trurBtn" style="float:left">确认选择</button>
            <input class="employInput" style="float:left">
            <button class="button-gongwei" style="float:left">查询空闲工位</button>
            <div class="succAndErr" style="float:left;width:420px;"></div>
        </div>
        <div class="ul-gongwei"></div>
        <div class="ycbTable"></div>
    </div>
</div>
<div class="ybs-yuangong-select" style="display:none">
    <div class="alert-head"><span>员工选择</span><a href="javascript:void(0)"></a></div>
    <div class="ycb-alert-wrap">
        <div> 
            <select class="employSel"></select>
            <button class="button-yuangong">确认选择</button>
            <span class="debut"></span>
        </div>
        <ul class="ul-yuangong"></ul>
        <div class="ycbMech"></div>
    </div>
</div>
<div class="drag" style="display:none"><div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_appointment_manage');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();
	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel}); 

    var validators = {};
    validators['mobile'] = [{msg: "请输入手机号码",type: "min",value: "1"}];

    jRad.params['status'] = {data: [{id:'0',name:'未确定'},{id:' ',name:'全部'},{id:'1',name:'已确认'},{id:'2',name:'取消预约'},{id:'3',name:'已完成'}]};

    jRad.params['appointType'] = {
        data: [{id:'客户端预约',name:'客户端预约'},{id:'线下预约',name:'线下预约'},{id:'线下预约(系统生成)',name:'线下预约(系统生成)'}],
        queryParam:'name',
        fl: 'name',
        displayField:'name',
        valueField:'id',
        defaultValue: '',
        response: function(data){
            return data;
        }
    };

    var field_params={};  
    field_params['isWash']={
        data:[{id:'0',name:'否'},{id:'1',name:'是'}],
        onclick:function(){  
            if($("div[name='isWash']",wraper).radio('val')=='1'){ 
               $(".yesCwach",wraper).show();
               $(".noCwach",wraper).hide()
            }
            else{
               $(".yesCwach",wraper).hide();
               $(".noCwach",wraper).show()
            }
        }
    };
    field_params['serviceId']={
        urlData:{
            url:'/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+1+'&businessInfoId='+carsmart_config.businessInfoId,
            id: 'id',
            name: 'serviceName',
            type: 'get',
            dataType: 'json',
            val: '',
            selectedItems:true
        }, 
        unshiftData:{id:'',name:'请选择'},
        onclick:function(data){
            $(".sePrice").show();
            $(".serverPrice").attr("serviceId",data.id);
            $(".serverPrice").attr("serviceName",data.name);
            var jsonParm = $.jRadGet({url:'/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+1+'&businessInfoId='+carsmart_config.businessInfoId})
            var price;
            var workHour;
            if(data.id == ''){
                $(".serverPrice").hide();
            }else{
                if(jsonParm != 0){
                    $.each(jsonParm,function(i){
                        var item = jsonParm[i];
                        if(item.id == data.id){
                            price = item.reservePrice;
                            workHour = item.workHour
                        }
                    })
                }
                $(".serverPrice").show().html("服务预订价："+price+"元").attr({workHour:workHour,price:price});
            }
        }
    };

    field_params['service']={
        data:[{id:'0',name:'养车宝服务'},{id:'1',name:'其他服务'}],
        onclick:function(){  
            if($("div[name='service']",wraper).radio('val')=='1'){ 
                $(".isshow").hide();
                $(".defaultHide").hide();
                $(".twoShow").hide();
                $(".other").show()
                $(".yuyueTime").hide();
            }
            else{
                $(".isshow").show();
                $(".defaultHide").show();
                $(".twoShow").hide();
                $(".other").hide()
                $(".yuyueTime").hide();
            }
        }
    };
    field_params['zeroService'] = {
        data:[{id:'',name:'请选择'},{id:'2',name:'美容'},{id:'3',name:'保养'},{id:'4',name:'维修'}] ,
        onchange:function(val){ 
            getServiceSonNode(1,val,wraper); 
        }
    };
    field_params['isConfirmOrder'] = {
        data:[{id:'1',name:'是'},{id:'0',name:'否'}]
    };
    /*  查询报价 */
    field_params['offerType'] = {
        data:[{id:'2',name:'美容'},{id:'3',name:'保养'},{id:'4',name:'维修'}] ,
        onclick:function(val){ 
            var key = $("#Form_select_price div[name='offerType']").radio("val");
            $.jRadGet({
                url:'/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+key+'&businessInfoId='+carsmart_config.businessInfoId,
                //async:false,
                success:function(data){
                    var str = '';
                    $('#Form_select_price table tbody').html("");
                    if(data.length != 0){
                        $.each(data,function(i){
                            var item = data[i]
                            str+="<tr class='rowData'>"
                                +'<td>'+item.serviceName+'</td>'
                                +'<td>'+item.reservePrice+'</td>'
                                +'<td><span id="'+item.id+'" workHour="'+item.workHour+'" reservePrice="'+item.reservePrice+'">创建预约单</span></td>'
                                +"</tr>"
                        });
                    }
                    $('#Form_select_price table tbody').append(str)
                    $(".infotab span").click(function(){
                        createAppoint_sel()
                        $(".time-position").hide();
                        $(".selPrice").show();
                        $(".yuyueTime").show();
                        $("div[name='serviceName']").html($(this).parent().parent().find("td").eq(0).html());
                        $(".select-position").show().html("服务价："+$(this).parent().parent().find("td").eq(1).html()+"元").attr({"serviceId":$(this).attr("id"),"workHour":$(this).attr("workHour"),"reservePrice":$(this).attr("reservePrice")});
                    })
                },
                error:function(xhr){
                    var mes = eval("("+xhr.responseText+")");  
                    $.jRadMessage({level:'error',message:mes[0].message,selector:$("#Form_select_price .pop-up-middle")})
                }
            })
        }
    };

    page_column_model.push({display: '预约单ID', name : 'appointOrderId',hidden:true});
    page_column_model.push({display: '手机号码', name : 'mobile'});
    page_column_model.push({display: '客户信息',name:'manageInfo',width:150,diy:function(item,$div){
        var _userGrade=item.userGrade;
        var _serviceCnt=item.serviceCnt;
        var _totalUserPay=item.totalUserPay;
        var _couponPrice=item.couponPrice;
        if(_userGrade==undefined){
            _userGrade='';
        }
        if(_serviceCnt==undefined){
            _serviceCnt='';
        }
        if(_totalUserPay==undefined){
            _totalUserPay='';
        }
        var aaa = _userGrade+"<br>本店订单："+_serviceCnt+"<br>本店消费："+_totalUserPay;
        $div.html(aaa);
    }});
    page_column_model.push({display: '关联工单编号', name : 'workOrderNumber',diy:function(item,$div){
        var $aa = $("<a>").addClass('flexOperate').html(item.workOrderNumber); 
        $div.append($aa)
        $aa.click(function(){
            var workId = item.workOrderId
            var cookietime = new Date(); 
            cookietime.setTime(cookietime.getTime() + 2000);//coockie保存2秒
            $.cookie("workId",workId,{expires:cookietime})
            $.jRadOpen({'url':'workOrderManage.html'})
        })
    }});
    page_column_model.push({display: '关联工单ID', name : 'workOrderId',hidden:true});
    page_column_model.push({display: '车牌号', name : 'plateNumber'});
    page_column_model.push({display: '预约技师', name : 'employeeName',width:120,diy:function(item,$div){
        if(item.employeeName == ''){
            $div.html("")
            var $edit0 = $("<a>").addClass('flexOperate yg-edit').html("&nbsp;&nbsp;修改"); 
            $div.append($edit0);
            var appointmentOrderId = item.appointOrderId;  
            var plateNumber = item.plateNumber;   
            var serviceName = item.serviceName; 
            var workHour = item.workHour;       
            var shopEmployeeId_a = item.employeeId;   
            var appStartTime = item.appointStartTime;  
            //console.log(shopEmployeeId_a)       
            $edit0.click(function(){
                jishiFnItem(appointmentOrderId,plateNumber,serviceName,workHour,shopEmployeeId_a,appStartTime);
            })
        }else{
            var $edit1 = $("<a>").addClass('flexOperate yg-edit').html("&nbsp;&nbsp;修改"); 
            $div.append(item.employeeName).append($edit1);
            var appointmentOrderId = item.appointOrderId;  
            var plateNumber = item.plateNumber;   
            var serviceName = item.serviceName; 
            var workHour = item.workHour;       
            var shopEmployeeId_a = item.employeeId;  
            var appStartTime = item.appointStartTime;    
            //console.log(shopEmployeeId_a)          
            $edit1.click(function(){
                jishiFnItem(appointmentOrderId,plateNumber,serviceName,workHour,shopEmployeeId_a,appStartTime);
            })
        }

    }});
    page_column_model.push({display: '预约工位及时间',name:'timeandgw',width:180,diy:function(item,$div){
        var _stationName = item.stationName;
        var _appointStartTime = item.appointStartTime;
        var _appointEndTime = item.appointEndTime;
        var $edit2 = $("<a>").addClass('flexOperate gw-edit').html("<br>修改"); 
        if(_stationName == undefined){
            _stationName = '';
        }
        if(_appointStartTime == undefined){
            _appointStartTime = '';
        }
        if(_appointEndTime == undefined){
            _appointEndTime = '';
        }
        if(_appointStartTime !='' && _appointEndTime !='' &&  _appointEndTime !=''){

            var bbb = _stationName +"<br>"+_appointStartTime.substring(0,16)+"~"+_appointEndTime.substring(11,16);
        }
        $div.append(bbb).append($edit2);
        var appointmentOrderId = item.appointOrderId;
        var plateNumber = item.plateNumber;   
        var serviceName = item.serviceName; 
        var workHour = item.workHour;
        var stationId = item.workStationId;                    
        $edit2.click(function(){
            gwAndTimeFnItem(appointmentOrderId,plateNumber,serviceName,workHour,stationId);
        })

    }});
    page_column_model.push({display: '预约服务', name : 'serviceName',width:320});
    page_column_model.push({display: '预约方式', name : 'appointType',width:150,diy:function(item,$div){
        if(item.appointType == 1){
            $div.html("客户端预约")
        }else if(item.appointType == 2){
            $div.html("线下预约")
        }else{
            $div.html("线下预约(系统生成)")
        }
    }});
    page_column_model.push({display: '状态', name : 'status',width:100,diy:function(item,$div){
        if(item.status == 0){
            $div.html("未确认")
        }else if(item.status == 1){
            $div.html("已确认")
        }else if(item.status == 2){
            $div.html("取消预约")
        }else{
            $div.html("已完成")
        }
    }})
    page_column_model.push({display: '备注', name : 'remark',width:150});
    page_column_model.push({display: '操作',name:'edit',width:130,diy:function(item,$div){
            var $edit = $("<a>").addClass('flexOperate').html("预约确认"); 
            var $del = $("<a>").addClass('flexOperate').html("取消");
            if(item.status == '0'){
                $div.append($edit).append($del); 
            }else if(item.status == '1'){
                $div.append($del);
            }else if(item.status == '2'){
                $div.html("");
            }
            $edit.click(function(){
                $.jRadConfirm('预约单已确认？',1,function(){
                    var postData = []; 
                    var confirm = 'confirm'
                    var postJson={};
                    postJson.businessInfoId=carsmart_config.businessInfoId;
                    postJson.appointmentOrderId=item.appointOrderId;
                    postJson.operate = confirm;
                    postJson.operator = carsmart_config.operatorName;
                    postJson.mobile = item.mobile;
                    postJson.serviceName=item.serviceName;
                    postJson.workOrderId = item.workOrderId;
                    postJson.shopAccountId = carsmart_config.shopId;
                    //postData.push(postJson)
                    $.jRadPost({  
                        url:'/vip-ws/ws/0.1/AppointmentManager/changeAppointOrderStatus',
                        data:postJson, 
                        success: function(data){ 
                            $('#Table_appointment_manage').flexMessage('确认成功!', 'success');
                            $('#Table_appointment_manage').flexReload();
                        },
                        error:function(xhr){ 
                            var errormsg = eval("(" + xhr.responseText + ")"); 
                            if (errormsg != undefined) {
                                $('#Table_appointment_manage').flexMessage(errormsg[0].message, 'error');
                            }
                        }
                    });
                }); 
            });            
            $del.click(function(){
                $.jRadConfirm('确认取消此预约单？',1,function(){
                    var postData = []; 
                    var cannel = 'cannel'
                    var postJson={};
                    postJson.businessInfoId=carsmart_config.businessInfoId;
                    postJson.appointmentOrderId=item.appointOrderId;
                    postJson.operate = cannel;
                    postJson.operator = carsmart_config.operatorName;
                    postJson.mobile = item.mobile;
                    postJson.serviceName=item.serviceName;
                    postJson.workOrderId = item.workOrderId;
                    postJson.shopAccountId = carsmart_config.shopId;
                    //postData.push(postJson)
                    $.jRadPost({  
                        url:'/vip-ws/ws/0.1/AppointmentManager/changeAppointOrderStatus',
                        data:postJson, 
                        success: function(data){ 
                            $('#Table_appointment_manage').flexMessage('取消成功!', 'success');
                            $('#Table_appointment_manage').flexReload();
                        },
                        error:function(xhr){ 
                            var errormsg = eval("(" + xhr.responseText + ")"); 
                            if (errormsg != undefined) {
                                $('#Table_appointment_manage').flexMessage(errormsg[0].message, 'error');
                            }
                        }
                    });
                }); 
            });
    }});
    
    page_search_items.push({row:'1',type:'jrad-input',display:'车牌号',name:'plateNumber'});
    page_search_items.push({row:'1',type:'jrad-input',display:'手机号码',name:'mobile'});
    page_search_items.push({row:'1',type:'jrad-select',display:'预约技师',name:'employeeId',params:{
        urlData: {
            url: '/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId,
            id: 'shopEmployeeId',
            name: 'name',
            type: 'get',
            dataType: 'json'
        },
        unshiftData: {id:'',name:'全部'}
    }});
    page_search_items.push({row:'2',type:'jrad-dateinput',display:'预约时间',name:'appointTime'});
    page_search_items.push({row:'2',type:'jrad-input',display:'预约服务',name:'appointServiceName'});
    page_search_items.push({row:'2',type:'jrad-autocomplete',display:'预约方式',name:'appointType',params:jRad.params['appointType']});
    page_search_items.push({row:'3',type:'jrad-select',display:'状态',name:'status',params:jRad.params['status']});

    page_list_buttons.push({title: '创建',displayname:'创建',bclass: 'icon-plus',
        onpress : function(){
            createAppoint()
        }
    });

    page_list_buttons.push({title: '查询报价',displayname:'查询报价',bclass: 'icon-plus',
        onpress : function(){
            $("#Form_select_price").form({
                title:'查询报价',
                fields:field_params,
                item:{"offerType":2}
            }).form('open')
            $.jRadGet({
                url:'/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+2+'&businessInfoId='+carsmart_config.businessInfoId,
                //async:false,
                success:function(data){
                    var str = '';
                    $('#Form_select_price table tbody').html("");

                    if(data.length != 0){
                        $.each(data,function(i){
                            var item = data[i]
                            str+="<tr class='rowData'>"
                                +'<td>'+item.serviceName+'</td>'
                                +'<td>'+item.reservePrice+'</td>'
                                +'<td><span id="'+item.id+'" workHour="'+item.workHour+'" reservePrice="'+item.reservePrice+'">创建预约单</span></td>'
                                +"</tr>"
                        });
                    }
                    $('#Form_select_price table tbody').append(str)
                    $(".infotab span").click(function(){
                        createAppoint_sel()
                        $(".time-position").hide();
                        $(".selPrice").show();
                        $(".yuyueTime").show();
                        $("div[name='serviceName']").html($(this).parent().parent().find("td").eq(0).html());
                        $(".select-position").show().html("服务价："+$(this).parent().parent().find("td").eq(1).html()+"元").attr({"serviceId":$(this).attr("id"),"workHour":$(this).attr("workHour"),"reservePrice":$(this).attr("reservePrice")});
                    })
                },
                error:function(xhr){
                    var mes = eval("("+xhr.responseText+")");  
                    $.jRadMessage({level:'error',message:mes[0].message,selector:$("#Form_select_price .pop-up-middle")})
                }
            })
        }
    })

    page_list_buttons.push({title: '短信通知设置',displayname:'短信通知设置',bclass: 'icon-plus',
        onpress : function(){
            var obj = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getBusiConnectInfo?businessInfoId='+carsmart_config.businessInfoId})
            $("#Form_msg_set").form({
                title:'短信通知设置',
                fields:field_params,
                validators: validators,
                grid:12,
                item:{},
                url:'/vip-ws/ws/0.1/AppointmentManager/updateBusiConnect',
                preSubmit:function(json){
                    json.businessInfoId = carsmart_config.businessInfoId;
                    json.operator = carsmart_config.operatorName;
                    var mobileList = [];
                    var arr1=[];
                    var arr2=[];
                    var arr3=[];
                    $.each($('.type1 div.mobile'),function(i){
                        var number=$('.type1 div.mobile').eq(i).input('val');
                        while(number.indexOf(" ")!=-1){
                            number=number.replace(" ","");
                        }
                        if(/^\d+/.test(number)){
                            arr1.push(number)
                        }
                    });
                    $.each($('.type2 div.mobile'),function(i){
                        var number=$('.type2 div.mobile').eq(i).input('val');
                        while(number.indexOf(" ")!=-1){
                            number=number.replace(" ","");
                        }
                        if(/^\d+/.test(number)){
                            arr2.push(number)
                        }
                    });
                    $.each($('.type3 div.mobile'),function(i){
                        var number=$('.type3 div.mobile').eq(i).input('val');
                        while(number.indexOf(" ")!=-1){
                            number=number.replace(" ","");
                        }
                        if(/^\d+/.test(number)){
                            arr3.push(number)
                        }
                    });
                    $.each(arr1,function(i){
                        var jsonp = {};
                        jsonp.connectType = 1
                        jsonp.mobile = arr1[i]
                        mobileList.push(jsonp)
                    })
                    $.each(arr2,function(i){
                        var jsonp = {};
                        jsonp.connectType = 2
                        jsonp.mobile = arr2[i]
                        mobileList.push(jsonp)
                    })
                    $.each(arr3,function(i){
                        var jsonp = {};
                        jsonp.connectType = 3
                        jsonp.mobile = arr3[i]
                        mobileList.push(jsonp)
                    })
                    json.mobileList = mobileList
                    return json;
                },
                success: function() {
                    $('#Table_appointment_manage').flexMessage('设置成功', 'success','3');
                    $('#Table_appointment_manage').flexReload();
                }
            }).form('open')

            var m1 = [];
            var m2 = [];
            var m3 = [];
            $.each(obj,function(i){
                var data = obj[i]
                if(data.connectType == "1"){
                    m1.push(data.mobile);
                }
                if(data.connectType == "2"){ 
                    m2.push(data.mobile);
                }
                if(data.connectType == "3"){ 
                    m3.push(data.mobile);
                } 
            })
            $('#Form_msg_set .add_row').remove();
            //$('#Form_msg_set .add_row').hide();
            var len1=m1.length;
            var len2=m2.length;
            var len3=m3.length;
            for(i=1;i<len1;i++){
                var _row=$('<div class="add_row type1">').addClass('grid-row-fluid');
                var _label=$('<label>').addClass("span5 grid-layout-label").html('电话号码：');
                var _div=$('<div>').addClass('span15 grid-layout-content fluid-wrap');
                var _input=$('<div>').addClass('jrad-input-container mobile').attr("name","mobile");
                var _add=$('<span>').html("+").addClass('add');
                var _del=$('<span>').html("-").addClass('del');
                _row.append(_label).append(_div.append(_input)).append(_add).append(_del);
                _input.input({validator:[{msg:"请输入电话号码",type:"min",value:"1"},{msg:"电话号码格式不对",type:"regex",value:/^[0-9]+$/}]});
                $(".type1").last().after(_row);
            };
            $.each($(".type1 div.mobile"),function(j){
                $(".type1 div.mobile").eq(j).input('val',m1[j])
            });

            for(i=1;i<len2;i++){
                var _row=$('<div class="add_row type2">').addClass('grid-row-fluid');
                var _label=$('<label>').addClass("span5 grid-layout-label").html('电话号码：');
                var _div=$('<div>').addClass('span15 grid-layout-content fluid-wrap');
                var _input=$('<div>').addClass('jrad-input-container mobile').attr("name","mobile");
                var _add=$('<span>').html("+").addClass('add');
                var _del=$('<span>').html("-").addClass('del');
                _row.append(_label).append(_div.append(_input)).append(_add).append(_del);
                _input.input({validator:[{msg:"请输入电话号码",type:"min",value:"1"},{msg:"电话号码格式不对",type:"regex",value:/^[0-9]+$/}]});
                $(".type2").last().after(_row);
            };
            $.each($(".type2 div.mobile"),function(j){
                $(".type2 div.mobile").eq(j).input('val',m2[j])
            });

            for(i=1;i<len3;i++){
                var _row=$('<div class="add_row type3">').addClass('grid-row-fluid');
                var _label=$('<label>').addClass("span5 grid-layout-label").html('电话号码：');
                var _div=$('<div>').addClass('span15 grid-layout-content fluid-wrap');
                var _input=$('<div>').addClass('jrad-input-container mobile').attr("name","mobile");
                var _add=$('<span>').html("+").addClass('add');
                var _del=$('<span>').html("-").addClass('del');
                _row.append(_label).append(_div.append(_input)).append(_add).append(_del);
                _input.input({validator:[{msg:"请输入电话号码",type:"min",value:"1"},{msg:"电话号码格式不对",type:"regex",value:/^[0-9]+$/}]});
                $(".type3").last().after(_row);
            };
            $.each($(".type3 div.mobile"),function(j){
                $(".type3 div.mobile").eq(j).input('val',m3[j])
            });
            
            //$('#Form_msg_set .type1 .add').unbind('click').bind('click',function(){
            //$('#Form_msg_set .type1 .add').click(function(){
            $('#Form_msg_set').on('click','.type1 .add',function(){
            //$('.type1 .add').on('click',function(){
                var _row=$('<div class="add_row type1">').addClass('grid-row-fluid');
                var _label=$('<label>').addClass("span5 grid-layout-label").html('电话号码：');
                var _div=$('<div>').addClass('span15 grid-layout-content fluid-wrap');
                var _input=$('<div>').addClass('jrad-input-container mobile');
                var _add=$('<span>').html("+").addClass("add");
                var _del=$('<span>').html("-").addClass("del");
                _row.append(_label).append(_div.append(_input)).append(_add).append(_del);
                _input.input({validator:[{msg:"请输入电话号码",type:"min",value:"1"},{msg:"电话号码格式不对",type:"regex",value:/^[0-9]+$/}]});
                if($('.type1:visible').length<10){
                    $(this).parent().last().after(_row);
                }else{
                    $.jRadAlert("最多可输入10个电话号码！",'error')
                }
            });
            $('#Form_msg_set').on('click','.type2 .add',function(){
                var _row=$('<div class="add_row type2">').addClass('grid-row-fluid');
                var _label=$('<label>').addClass("span5 grid-layout-label").html('电话号码：');
                var _div=$('<div>').addClass('span15 grid-layout-content fluid-wrap');
                var _input=$('<div>').addClass('jrad-input-container mobile');
                var _add=$('<span>').html("+").addClass("add");
                var _del=$('<span>').html("-").addClass("del");
                _row.append(_label).append(_div.append(_input)).append(_add).append(_del);
                _input.input({validator:[{msg:"请输入电话号码",type:"min",value:"1"},{msg:"电话号码格式不对",type:"regex",value:/^[0-9]+$/}]});
                if($('.type2:visible').length<10){
                    $(this).parent().last().after(_row);
                }else{
                    $.jRadAlert("最多可输入10个电话号码！",'error')
                }
            });
            $('#Form_msg_set').on('click','.type3 .add',function(){
                var _row=$('<div class="add_row type3">').addClass('grid-row-fluid');
                var _label=$('<label>').addClass("span5 grid-layout-label").html('电话号码：');
                var _div=$('<div>').addClass('span15 grid-layout-content fluid-wrap');
                var _input=$('<div>').addClass('jrad-input-container mobile');
                var _add=$('<span>').html("+").addClass("add");
                var _del=$('<span>').html("-").addClass("del");
                _row.append(_label).append(_div.append(_input)).append(_add).append(_del);
                _input.input({validator:[{msg:"请输入电话号码",type:"min",value:"1"},{msg:"电话号码格式不对",type:"regex",value:/^[0-9]+$/}]});
                if($('.type3:visible').length<10){
                    $(this).parent().last().after(_row);
                }else{
                    $.jRadAlert("最多可输入10个电话号码！",'error')
                }
            });
            $('#Form_msg_set').on('click','.del',function(){
                $(this).parent().remove();
            });

            $('#Form_msg_set').on('blur','.mobile',function(){
                $(this).input('validate')
            })

                    
        }
    })

    // page_list_buttons.push({title: '是否需要确认',displayname:'是否需要确认',bclass: 'icon-plus',
    //     onpress : function(){
    //         var _item = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getIsConfirmForBusi?businessInfoId='+carsmart_config.businessInfoId})
    //         $("#Form_is_confirm").form({
    //             title:'是否需要确认',
    //             fields:field_params,
    //             grid:12,
    //             item:_item,
    //             url:'/vip-ws/ws/0.1/AppointmentManager/updateIsConfirmForBusi',
    //             preSubmit:function(json){
    //                 json.businessInfoId = carsmart_config.businessInfoId;
    //                 json.isConfirmFlag = $("#Form_is_confirm div[name='isConfirmOrder']").radio("val");
    //                 return json;
    //             },
    //             success: function() {
    //                 $('#Table_appointment_manage').flexMessage('确认成功', 'success','3');
    //                 $('#Table_appointment_manage').flexReload();
    //             }
    //         }).form('open')
    //     }
    // })

	$('#Table_appointment_manage',wraper).flexigrid({
		reload:true,
        pagination: {diaplay_pages: 5,align:'bottom',showText: '从第_start_到_end_项 共_total_项'},
		colModel : page_column_model,
		buttons : page_list_buttons,
		searchitems :page_search_items,
        pagedStyle: 'oc',
        method:'get', 
        showSearch:true,
        showCheckbox:false,
		overflow:true,
        extParam:{'status':0},
		url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderList?businessInfoId='+carsmart_config.businessInfoId,
		onError:showRemarkError,
		checkBoxType:'single'
	}) 

    $('.ybs-gongshi-select .employInput').datetimepickerBS({
        format: 'yyyy-mm-dd hh:ii:ss',
        autoclose: 1, 
        startView: 2,
        maxView: 1,
        todayHighlight:true,
        pickerPosition:'bottom-left', 
        language: "zh-CN"
    }); 

    $('.vdiv .hDiv tr th').eq(0).attr("style","display:none;")
    $('.vdiv .hDiv tr th').eq(4).attr("style","display:none;")
    $('.hDiv',wraper).css('overflow','hidden');
    $('.bDiv',wraper).css('overflow-x','scroll');

    /* 列表里的修改 */
    function gwAndTimeFnItem(appointmentOrderId,plateNumber,serviceName,workHour,stationId){
        $(".ybs-gongshi-select").show();
        $(".drag").show();
        $(".ul-gongwei").html("");
        $(".succAndErr").html("")
        $.jRadGet({
            url:'/vip-ws/ws/0.1/AppointmentManager/getWorkHourStationList?businessInfoId='+carsmart_config.businessInfoId,
            success:function(data){
                var staUl;
                staUl = $('<ul class="clearfix workUl"></ul>');
                if(data.length != 0){
                    $.each(data,function(i){
                        var item = data[i]
                        var staLi;
                        staLi = $('<li stationId="'+item.stationId+'">'+item.stationName+'</li>')
                        staUl.append(staLi)
                    })
                }
                $(".ul-gongwei").append(staUl)

                if(stationId == ''){
                    $(".ul-gongwei ul li").eq(0).addClass("t-active")
                }
                $(".ul-gongwei ul li[stationId]").each(function(i){
                    if($(".ul-gongwei ul li[stationId]")[i] != stationId)
                    {
                        $(".ul-gongwei ul li").eq(0).addClass("t-active")
                    }else{
                        $(".ul-gongwei ul li[shopemployeeid='"+stationId+"']").addClass("t-active")
                    }  
                })

                //$(".ul-gongwei ul li[stationid='"+stationId+"']").addClass("t-active")
                
            }   
        })
        var stationId= $(".ul-gongwei ul li").attr("stationId");

        createTable(stationId)

        function createTable(stationId){
            var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
            var startTime = getTimeForBusi.startHour;       
            var endTime = getTimeForBusi.endHour;
            var arr=[];
            for(var i = startTime; i<=endTime-1; i++){
                var s = i+1;
                if (s >= 10)
                {
                    var starParam = i + ":00";
                    var endParam = i+1 +":00";
                    arr.push(starParam + "-" +endParam);
                }
                else{
                    var starParam = "0"+i + ":00";
                    var endParam = "0"+s+":00";
                    arr.push(starParam + "-" +endParam);
                } 
            }
            var table =$('<table></table');
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?stationId='+stationId,
                success:function(data){
                    var th;
                    var thead = $('<thead></thead>');
                    var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                    if(data.length != 0){
                        $.each(data,function(i){
                            var item1 = data[i]
                            th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                            tr.append(th);
                            thead.append(tr)
                        }) 
                    } 
                    table.append(thead);

                    return tableData = data;
                }
            })
            $(".ycbTable").append(table)
            var yesdaty = $(".ycbTable thead th").eq(1).attr("DatePara");
            var dodaty = $(".ycbTable thead th").eq(2).attr("DatePara");
            var masdaty = $(".ycbTable thead th").eq(3).attr("DatePara");
            var tbody = $('<tbody></tbody>');
            $.each(arr,function(i){
                var z = startTime+i
                if(z >= 10){
                    var startTimeBy = z
                }else{
                    var startTimeBy = "0"+z
                }
                var starParamDou1 = startTimeBy+":00"+":00"
                var starParamDou2 = startTimeBy+":10"+":00"
                var starParamDou3 = startTimeBy+":20"+":00"
                var starParamDou4 = startTimeBy+":30"+":00"
                var starParamDou5 = startTimeBy+":40"+":00"
                var starParamDou6 = startTimeBy+":50"+":00"
                var item2 = arr[i]
                var tr0;
                var tr1;
                var tr2;
                tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                tbody.append(tr1)
                tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
            })
            table.append(tbody)
            $(".ycbTable").html("");
            $(".ycbTable").append(table)
            $(".ycb-alert-wrap").css("height",$(".ybs-gongshi-select").height()-180);     

            var valArr = [];
            $('.ycbTable input').each(function(i){
                valArr.push($('.ycbTable input').eq(i).attr("value"))
            })
            var tdtwowid = $(".ycbTable table td").eq(1).width()/2;
            var inpuWid = $(".ycbTable input").eq(0).width();
            $.each(tableData,function(i){
                var item = tableData[i];
                $.each(item.orderList,function(j){
                    var str = item.orderList[j];
                    var X1;
                    var Y1;
                    $.each(valArr,function(k){
                        if(str.appointmentStartTime == valArr[k]){
                            X1 = $('.ycbTable input').eq(k).position().top;
                            Y1 = $('.ycbTable input').eq(k).position().left-tdtwowid+inpuWid+4;
                        }
                    })
                    var tdWidth = $('.ycbTable input').eq(0).parent().width()+2;
                    var tdHeight = $('.ycbTable input').eq(0).parent().height()+2;
                    var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+str.plateNumber+'<br>'+str.serviceName+'</div>') 
                    $(".ycbTable").append(warpDiv)
                })
            })

            var warpDiv2 = $('<div class="warpDiv2" style="display:table;"></div>').html("")
            $(".ycbTable input").bind('click',function(){
                $(".succAndErr").html("")
                var X1 = $(this).position().top;
                var Y1 = $(this).position().left-100;
                var tdWidth = $(this).parent().width()+2;
                var tdHeight = $(this).parent().height()+2;
                warpDiv2.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+plateNumber+'<br>'+serviceName+'</div>').attr("val",$(this).attr("value"))
                $(".ycbTable").append(warpDiv2)
                var aWarpDiv = $(".ycbTable .warpDiv");
                for (var i = 0; i < aWarpDiv.length; i++) 
                {
                    if ( cdTest (warpDiv2,aWarpDiv.eq(i))  ) 
                    {
                        $(".succAndErr").html("选择工时与其他预约服务时间重复！").css("color","red")
                        $(".ycbTable .warpDiv2").remove();
                        $(this).attr("checked",false);
                    }
                }
            })       
        }

        function cdTest (obj1,obj2){
            var l1=obj1.offset().left;
            var r1=obj1.offset().left+obj1.width();
            var t1=obj1.offset().top;
            var b1=obj1.offset().top+obj1.height();
            
            var l2=obj2.offset().left;
            var r2=obj2.offset().left+obj2.width();
            var t2=obj2.offset().top;
            var b2=obj2.offset().top+obj2.height();
            
            if (r1<l2 || l1>r2 || b1<t2 || t1>b2) {
                    return false;
            }else{
                    return true;
            }
        }

        $(".ul-gongwei").on('click','.workUl li',function(){
            $(".workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
            var stationId = $(".workUl li").eq($(this).index()).attr("stationId");
            createTable(stationId);
        })

        /* 弹框里的确认选择 */
        $('.ybs-gongshi-select .trurBtn').unbind('click').bind('click',function(){
            if($(".ycbTable .warpDiv2").length != 0){
                $(".ybs-gongshi-select").hide();
                $(".drag").hide();
                var pastData = {};
                pastData.appointmentOrderId = appointmentOrderId;
                pastData.workHour = workHour;
                pastData.workStationInfoId = $(".ul-gongwei .t-active").attr("stationid");
                pastData.appointmentStartTime = $(".warpDiv2").attr("val");
                $.ajax({
                    type:'post',
                    //async:false,
                    dataType:'json',
                    data:$.toJSON(pastData),
                    contentType:'application/json;charset=utf-8',
                    url:'/vip-ws/ws/0.1/AppointmentManager/editAppointOrder',  
                    success: function(){
                        $('#Table_appointment_manage').flexMessage('修改成功', 'success','3');
                        $('#Table_appointment_manage').flexReload();
                    }
                }) 
            }else{
                //alert("请选择工位工时");
                $.jRadAlert("请选择工位工时",'error');
            }
        })    

        // $(".trurBtn-sel").click(function(){
        //     $(".ybs-gongshi-select").hide();
        //     $(".drag").hide();
        //     $(".time-position").show().html("已选择："+$(".warpDiv2").attr("val")).attr({gw:$(".ul-gongwei .t-active").html(),gwId:$(".ul-gongwei .t-active").attr("stationid")});
        //     $(".yuyuejishi").show()
        // })
            
        /* 查空闲工位 */

        $('.ybs-yuangong-select .button-gongwei').unbind('click').bind('click',function(){
            //$(".button-gongwei").click(function(){
            var businessInfoId = carsmart_config.businessInfoId;
            var freeTime = $(".employInput").val();
            var workHour = $(".plusPrice").attr("workhour");
            $(".succAndErr").html("")
            $.ajax({
                type:'get',
                //async:false,
                url:'/vip-ws/ws/0.1/AppointmentManager/getFreeStation?businessInfoId='+carsmart_config.businessInfoId+'&freeTime='+freeTime+'&workHour='+workHour,  
                success: function(data){
                    if(data.length == 0){
                        $(".succAndErr").html("没有空闲工位")
                    }else{
                        var arrStation;
                        arrStation = $('<div></div>');
                        $.each(data,function(i){
                            var item = data[i];
                            var alistr;
                            alistr = $('<span stationId="'+item.stationId+'">'+item.stationName+'</span>');
                            arrStation.append(alistr)
                        })
                        $(".succAndErr").html("空闲工位：").append(arrStation).css("color","#393939")
                    }
                },
                error:function(xhr){
                    var mes = eval("("+xhr.responseText+")");  
                    $(".succAndErr").html(mes[0].message).css("color","#ff0000")
                }
            })
        })

        $(".alert-head a").click(function(){
            $(".ybs-yuangong-select").hide();
            $(".ybs-gongshi-select").hide();
            $(".drag").hide();
        })
    }

    function jishiFnItem(appointmentOrderId,plateNumber,serviceName,workHour,shopEmployeeId_a,appStartTime){
        $(".ybs-yuangong-select").show();
        $(".drag").show();
        var mach = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId})
        $(".employSel").html("")
        $.each(mach,function(i){
            var item = mach[i]
            var creatOption = $('<option emp="'+item.shopEmployeeId+'" positionName="'+item.positionName+'">'+item.name+'</option>')
            $(".employSel").append(creatOption)
        })

        $(".ul-yuangong").html("");
        $.jRadGet({
            url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId,
            success:function(data){
                console.log(data.length)
                if(data.length == 0){
                    $(".ul-yuangong").html("商家还没有设置员工，请先到员工管理菜单创建员工！").css({"text-align":"center","font-size":"16px","margin":"30px","color":"#ff0000"});
                }else{
                    var staUl = '';
                    var staLi = '';
                    staUl = $('<ul class="clearfix workUl"></ul>');
                    $.each(data,function(i){
                        var item = data[i]
                        staLi = $('<li class="" shopEmployeeId="'+item.shopEmployeeId+'">'+item.name+'('+item.positionName+')'+'</li>')
                        staUl.append(staLi)
                    })
                    $(".ul-yuangong").append(staUl)
                    
                    if(shopEmployeeId_a == ''){
                        $(".ul-yuangong ul li").eq(0).addClass("t-active")
                    }
                    $(".ul-yuangong ul li[shopemployeeid]").each(function(i){
                        if($(".ul-yuangong ul li[shopemployeeid]")[i] != shopEmployeeId_a)
                        {
                            $(".ul-yuangong ul li").eq(0).addClass("t-active")
                        }else{
                            $(".ul-yuangong ul li[shopemployeeid='"+shopEmployeeId_a+"']").addClass("t-active")
                        }  
                    })
                }
            }   
        })
        
        var shopEmployeeId= $(".ul-yuangong .t-active").attr("shopemployeeid")

        if(shopEmployeeId){
            createTable(shopEmployeeId)
        }

        function createTable(shopEmployeeId){
            var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
            var startTime = getTimeForBusi.startHour;       
            var endTime = getTimeForBusi.endHour;
            var arr=[];
            for(var i = startTime; i<=endTime-1; i++){
                var s = i+1;
                if (s >= 10)
                {
                    var starParam = i + ":00";
                    var endParam = i+1 +":00";
                    arr.push(starParam + "-" +endParam);
                }
                else{
                    var starParam = "0"+i + ":00";
                    var endParam = "0"+s+":00";
                    arr.push(starParam + "-" +endParam);
                } 
            }
            var table =$('<table></table');
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?shopEmployeeId='+shopEmployeeId,
                success:function(data){
                    var th;
                    var thead = $('<thead></thead>');
                    var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                    $.each(data,function(i){
                        var item1 = data[i]
                        th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                        tr.append(th);
                        thead.append(tr)
                    })  
                    table.append(thead) 
                    return tableData = data;
                }
            })
            $(".ycbMech").append(table)
            var yesdaty = $(".ycbMech thead th").eq(1).attr("DatePara");
            var dodaty = $(".ycbMech thead th").eq(2).attr("DatePara");
            var masdaty = $(".ycbMech thead th").eq(3).attr("DatePara");
            var tbody = $('<tbody></tbody>');
            $.each(arr,function(i){
                var z = startTime+i
                if(z >= 10){
                    var startTimeBy = z
                }else{
                    var startTimeBy = "0"+z
                }
                var starParamDou1 = startTimeBy+":00"+":00"
                var starParamDou2 = startTimeBy+":10"+":00"
                var starParamDou3 = startTimeBy+":20"+":00"
                var starParamDou4 = startTimeBy+":30"+":00"
                var starParamDou5 = startTimeBy+":40"+":00"
                var starParamDou6 = startTimeBy+":50"+":00"
                var item2 = arr[i]
                var tr0;
                var tr1;
                var tr2;
                tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                tbody.append(tr1)
                tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
            })
            table.append(tbody)
            $(".ycbMech input[type='radio']").css({"filter":"alpha(opacity=0)","-moz-opacity":"0", "opacity": "0"})
            $(".ycb-alert-wrap").css("height",$(".ybs-yuangong-select").height()-180);
            $(".ycbMech").html("");
            $(".ycbMech").append(table);
            var valArr = [];
            $('.ycbMech input').each(function(i){
                valArr.push($('.ycbMech input').eq(i).attr("value"))
            })
            var activeName = $(".ul-yuangong ul .t-active").html();
            var tdtwowid = $(".ycbMech table td").eq(1).width()/2;
            var inpuWid = $(".ycbMech input").eq(0).width();
            $.each(tableData,function(i){
                var item = tableData[i];
                $.each(item.orderList,function(j){
                    var str = item.orderList[j];
                    var X1;
                    var Y1;
                    $.each(valArr,function(k){
                        if(str.appointmentStartTime == valArr[k]){
                            X1 = $('.ycbMech input').eq(k).position().top;
                            Y1 = $('.ycbMech input').eq(k).position().left-tdtwowid+inpuWid+4;
                        }
                    })
                    var tdWidth = $('.ycbMech input').eq(0).parent().width()+2;
                    var tdHeight = $('.ycbMech input').eq(0).parent().height()+2;
                    var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+activeName+'<br>'+str.serviceName+'</div>') //.attr("val",$(this).attr("value"));
                    $(".ycbMech").append(warpDiv)
                })
            })
        }
        
        $(".ul-yuangong .workUl li").unbind('click').bind('click',function(){
            $(".ul-yuangong .workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
            var shopEmployeeId = $(".ul-yuangong .workUl li").eq($(this).index()).attr("shopEmployeeid");
            createTable(shopEmployeeId);
        })

        /* 弹框里的确认选择 */
        $(".ybs-yuangong-select").undelegate('.button-yuangong','click').delegate('.button-yuangong','click',function(){
        //$(".button-yuangong").click(function(){
            var shopEmployeeId = $('.employSel option:selected').attr("emp");
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/checkWorkEmployee?shopEmployeeId='+shopEmployeeId+'&appointmentStartTime='+appStartTime+'&workHour='+workHour,
                success:function(data){
                    if(data.isBusy == 0){
                        $(".debut").html("")
                    }else{
                        $(".debut").html("员工此时间段内繁忙，请换一个员工选择")
                        return false;
                    }

                    $(".ybs-yuangong-select").hide();
                    $(".drag").hide();
                    var pastData = {};
                    pastData.appointmentOrderId = appointmentOrderId;
                    pastData.shopEmployeeId = $('.employSel option:selected').attr("emp");
                    $.ajax({
                        type:'post',
                        dataType:'json',
                        data:$.toJSON(pastData),
                        contentType:'application/json;charset=utf-8',
                        url:'/vip-ws/ws/0.1/AppointmentManager/editAppointOrder',  
                        success: function(){
                            $('#Table_appointment_manage').flexMessage('修改成功', 'success','3');
                            $('#Table_appointment_manage').flexReload();
                        }
                    })

                },
                error:function(xhr){
                    $(".ybs-yuangong-select").hide();
                    $(".drag").hide();
                    var errormsg = eval("(" + xhr.responseText + ")");
                    $.jRadAlert(errormsg[0].message,'error')
                }
            })
        })

        $('.ybs-yuangong-select').on('click','.alert-head a',function(){
            $(".ybs-yuangong-select").hide();
            $(".ybs-gongshi-select").hide();
            $(".drag").hide();
        })
    }


    /* 点创建按钮的弹窗 */
    function gwAndTimeFn(){
        $(".succAndErr").html("")
        $(".ybs-gongshi-select").show();
        $(".drag").show();
        $(".ul-gongwei").html("");
        $.jRadGet({
            url:'/vip-ws/ws/0.1/AppointmentManager/getWorkHourStationList?businessInfoId='+carsmart_config.businessInfoId,
            success:function(data){
                var staUl;
                staUl = $('<ul class="clearfix workUl"></ul>');
                if(data.length == 0){
                    $(".ul-gongwei").html("商家还没有工位，请先到工位管理菜单创建工位！").css({"text-align":"center","font-size":"16px","margin":"30px","color":"#ff0000"});
                }else{
                    $.each(data,function(i){
                        var item = data[i]
                        var staLi;
                        staLi = $('<li stationId="'+item.stationId+'">'+item.stationName+'</li>')
                        staUl.append(staLi)
                    })
                    $(".ul-gongwei").append(staUl)
                    $(".ul-gongwei ul li").eq(0).addClass("t-active");
                }
            }   
        })
        var stationId= $(".ul-gongwei ul .t-active").attr("stationId");

        if(stationId){
            createTable(stationId)
        }

        function createTable(stationId){
            var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
            var startTime = getTimeForBusi.startHour;       
            var endTime = getTimeForBusi.endHour;
            var arr=[];
            for(var i = startTime; i<=endTime-1; i++){
                var s = i+1;
                if (s >= 10)
                {
                    var starParam = i + ":00";
                    var endParam = i+1 +":00";
                    arr.push(starParam + "-" +endParam);
                }
                else{
                    var starParam = "0"+i + ":00";
                    var endParam = "0"+s+":00";
                    arr.push(starParam + "-" +endParam);
                } 
            }
            var table =$('<table></table');
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?stationId='+stationId,
                success:function(data){
                    var th;
                    var thead = $('<thead></thead>');
                    var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                    $.each(data,function(i){
                        var item1 = data[i]
                        th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                        tr.append(th);
                        thead.append(tr)
                    })  
                    table.append(thead);

                    return tableData = data;
                }
            })
            $(".ycbTable").append(table)
            var yesdaty = $(".ycbTable thead th").eq(1).attr("DatePara");
            var dodaty = $(".ycbTable thead th").eq(2).attr("DatePara");
            var masdaty = $(".ycbTable thead th").eq(3).attr("DatePara");
            var tbody = $('<tbody></tbody>');
            $.each(arr,function(i){
                var z = startTime+i
                if(z >= 10){
                    var startTimeBy = z
                }else{
                    var startTimeBy = "0"+z
                }
                var starParamDou1 = startTimeBy+":00"+":00"
                var starParamDou2 = startTimeBy+":10"+":00"
                var starParamDou3 = startTimeBy+":20"+":00"
                var starParamDou4 = startTimeBy+":30"+":00"
                var starParamDou5 = startTimeBy+":40"+":00"
                var starParamDou6 = startTimeBy+":50"+":00"
                var item2 = arr[i]
                var tr0;
                var tr1;
                var tr2;
                tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                tbody.append(tr1)
                tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
            })
            table.append(tbody)
            $(".ycbTable").html("");
            $(".ycbTable").append(table)
            $(".ycb-alert-wrap").css("height",$(".ybs-gongshi-select").height()-180);     

            var plateNumber = $('#Form_appointment_add div[name="plateNumber"]').input("val");
            var serviceName = '';
            var workHour = '';
            if($("div[name='service']",wraper).radio('val')=='1'){
                serviceName = $(".other div[name='otherService']").input("val")
                workHour = $(".other div[name='workHour']").input("val")
            }else{
                serviceName = $(".plusPrice").attr("serviceName");
                workHour = $(".plusPrice").attr("workHour");
            }

            var valArr = [];
            $('.ycbTable input').each(function(i){
                valArr.push($('.ycbTable input').eq(i).attr("value"))
            })
            var tdtwowid = $(".ycbTable table td").eq(1).width()/2;
            var inpuWid = $(".ycbTable input").eq(0).width();
            $.each(tableData,function(i){
                var item = tableData[i];
                $.each(item.orderList,function(j){
                    var str = item.orderList[j];
                    var X1;
                    var Y1;
                    $.each(valArr,function(k){
                        if(str.appointmentStartTime == valArr[k]){
                            X1 = $('.ycbTable input').eq(k).position().top;
                            Y1 = $('.ycbTable input').eq(k).position().left-tdtwowid+inpuWid+4;
                        }
                    })
                    var tdWidth = $('.ycbTable input').eq(0).parent().width()+2;
                    var tdHeight = $('.ycbTable input').eq(0).parent().height()+2;

                    var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+str.plateNumber+'<br>'+str.serviceName+'</div>') 
                    $(".ycbTable").append(warpDiv)
                })
            })

            var warpDiv2 = $('<div class="warpDiv2" style="display:table;"></div>').html("")
            $(".ycbTable input").bind('click',function(){
                $(".succAndErr").html("")
                var shopEmployeeId = $('.employSel option:selected').attr("emp");
                var appointmentStartTime = $(".time-position").html().substring(4);
                //var workHour = $(".plusPrice").attr("workhour");          
                // var workHour = workHour;      
                var X1 = $(this).position().top;
                var Y1 = $(this).position().left-100;
                var tdWidth = $(this).parent().width()+2;
                var tdHeight = $(this).parent().height()+2;
                warpDiv2.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+plateNumber+'<br>'+serviceName+'</div>').attr("val",$(this).attr("value"))
                $(".ycbTable").append(warpDiv2)
                var aWarpDiv = $(".ycbTable .warpDiv");
                for (var i = 0; i < aWarpDiv.length; i++) 
                {
                    if ( cdTest (warpDiv2,aWarpDiv.eq(i))  ) 
                    {
                        $(".succAndErr").html("选择工时与其他预约服务时间重复！").css("color","red")
                        $(".ycbTable .warpDiv2").remove();
                        $(this).attr("checked",false);
                    }
                }
                
            })       
        }

        function cdTest (obj1,obj2){
            var l1=obj1.offset().left;
            var r1=obj1.offset().left+obj1.width();
            var t1=obj1.offset().top;
            var b1=obj1.offset().top+obj1.height();
            
            var l2=obj2.offset().left;
            var r2=obj2.offset().left+obj2.width();
            var t2=obj2.offset().top;
            var b2=obj2.offset().top+obj2.height();
            
            if (r1<l2 || l1>r2 || b1<t2 || t1>b2) {
                    return false;
            }else{
                    return true;
            }
        }

        $(".workUl li").click(function() {   
            $(".workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
            var stationId = $(".workUl li").eq($(this).index()).attr("stationId");
            createTable(stationId);
        });
 
        /* 查空闲工位 */
        $(".button-gongwei").click(function(){
            var businessInfoId = carsmart_config.businessInfoId;
            var freeTime = $(".employInput").val();
            var workHour = $(".plusPrice").attr("workhour");
            $(".succAndErr").html("")
            $.ajax({
                type:'get',
                //async:false,
                url:'/vip-ws/ws/0.1/AppointmentManager/getFreeStation?businessInfoId='+carsmart_config.businessInfoId+'&freeTime='+freeTime+'&workHour='+workHour,  
                success: function(data){
                    if(data.length == 0){
                        $(".succAndErr").html("没有空闲工位")
                    }else{
                        var arrStation;
                        arrStation = $('<div></div>');
                        $.each(data,function(i){
                            var item = data[i];
                            var alistr;
                            alistr = $('<span stationId="'+item.stationId+'">'+item.stationName+'</span>');
                            arrStation.append(alistr)
                        })
                        $(".succAndErr").html("空闲工位：").append(arrStation).css("color","#393939")
                    }
                },
                error:function(xhr){
                    var mes = eval("("+xhr.responseText+")");  
                    $(".succAndErr").html(mes[0].message).css("color","#ff0000")
                }
            })
        })

        /* 弹框里的确认选择 */
        $('.ybs-gongshi-select .trurBtn').unbind('click').bind('click',function(){
            if($(".ycbTable .warpDiv2").length != 0){
                $(".succAndErr").html("")
                $(".ybs-gongshi-select").hide();
                $(".drag").hide();
                $(".time-position").show().html("已选择："+$(".warpDiv2").attr("val")).attr({gw:$(".ul-gongwei .t-active").html(),gwId:$(".ul-gongwei .t-active").attr("stationid")});
                $(".yuyuejishi").show();
                var businessInfoId = carsmart_config.businessInfoId;
                var appointmentStartTime = $(".warpDiv2").attr("val")
                if($("div[name='service']",wraper).radio('val')=='1'){
                    workHour = $(".other div[name='workHour']").input("val");
                }else{
                    workHour = $(".plusPrice").attr("workHour");
                }
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/AppointmentManager/getDistributeEmployee?businessInfoId='+businessInfoId+'&appointmentStartTime='+appointmentStartTime+'&workHour='+workHour,
                    success:function(data){
                        $(".jishi-position").show().html("已选择："+data.name).attr("shopEmployeeId",data.shopEmployeeId);
                    },
                    error:function(){
                        $(".jishi-position").hide();
                    }
                })
            }else{
                //alert("请选择工位工时");
                //$.jRadAlert("请选择工位工时",'error');
                $(".succAndErr").html("请先选择工时与工位！").css("color","red")
            }
                
        })

        $(".alert-head").on('click','a',function(){
            $(".ybs-yuangong-select").hide();
            $(".ybs-gongshi-select").hide();
            $(".drag").hide();
        })
    }

    function jishiFn(){
        $(".ybs-yuangong-select").show();
        $(".drag").show();
        var mach = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId})
        $(".employSel").html("")
        $.each(mach,function(i){
            var item = mach[i]
            var creatOption = $('<option emp="'+item.shopEmployeeId+'" positionName="'+item.positionName+'">'+item.name+'</option>')
            $(".employSel").append(creatOption)
        })

        $(".ul-yuangong").html("");
        $.jRadGet({
            url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId,
            success:function(data){
                if(data.length == 0){
                    $(".ul-yuangong").html("商家还没有员工设置，请先到员工管理菜单创建员工！").css({"text-align":"center","font-size":"16px","margin":"30px","color":"#ff0000"});
                }else{
                    var staUl = '';
                    var staLi = '';
                    staUl = $('<ul class="clearfix workUl"></ul>');
                    $.each(data,function(i){
                        var item = data[i]
                        var staLi;
                        staLi = $('<li shopEmployeeId="'+item.shopEmployeeId+'">'+item.name+'('+item.positionName+')'+'</li>')
                        staUl.append(staLi)
                    })
                    $(".ul-yuangong").append(staUl)
                    $(".ul-yuangong ul li").eq(0).addClass("t-active");
                }
            }   
        })
        var shopEmployeeId= $(".ul-yuangong ul li").attr("shopEmployeeId")

        createTablejishi(shopEmployeeId)

        function createTablejishi(shopEmployeeId){
            var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
            var startTime = getTimeForBusi.startHour;       
            var endTime = getTimeForBusi.endHour;
            var arr=[];
            for(var i = startTime; i<=endTime-1; i++){
                var s = i+1;
                if (s >= 10)
                {
                    var starParam = i + ":00";
                    var endParam = i+1 +":00";
                    arr.push(starParam + "-" +endParam);
                }
                else{
                    var starParam = "0"+i + ":00";
                    var endParam = "0"+s+":00";
                    arr.push(starParam + "-" +endParam);
                } 
            }
            var table =$('<table></table');
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?shopEmployeeId='+shopEmployeeId,
                success:function(data){
                    var th;
                    var thead = $('<thead></thead>');
                    var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                    $.each(data,function(i){
                        var item1 = data[i]
                        th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                        tr.append(th);
                        thead.append(tr)
                    })  
                    table.append(thead) 
                    return tableData = data;
                }
            })
            $(".ycbMech").append(table)
            var yesdaty = $(".ycbMech thead th").eq(1).attr("DatePara");
            var dodaty = $(".ycbMech thead th").eq(2).attr("DatePara");
            var masdaty = $(".ycbMech thead th").eq(3).attr("DatePara");
            var tbody = $('<tbody></tbody>');
            $.each(arr,function(i){
                var z = startTime+i
                if(z >= 10){
                    var startTimeBy = z
                }else{
                    var startTimeBy = "0"+z
                }
                var starParamDou1 = startTimeBy+":00"+":00"
                var starParamDou2 = startTimeBy+":10"+":00"
                var starParamDou3 = startTimeBy+":20"+":00"
                var starParamDou4 = startTimeBy+":30"+":00"
                var starParamDou5 = startTimeBy+":40"+":00"
                var starParamDou6 = startTimeBy+":50"+":00"
                var item2 = arr[i]
                var tr0;
                var tr1;
                var tr2;
                tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                tbody.append(tr1)
                tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
            })

            table.append(tbody)
            $(".ycbMech").html("");
            $(".ycbMech").append(table)
            $(".ycbMech input[type='radio']").css({"filter":"alpha(opacity=0)","-moz-opacity":"0", "opacity": "0"})
            $(".ycb-alert-wrap").css("height",$(".ybs-yuangong-select").height()-180);

            var plateNumber = $('#Form_appointment_add div[name="plateNumber"]').input("val");
            var serviceName = '';
            var workHour = '';
            if($("div[name='service']",wraper).radio('val')=='1'){
                serviceName = $(".other div[name='otherService']").input("val")
                workHour = $(".other div[name='workHour']").input("val")
            }else{
                serviceName = $(".plusPrice").attr("serviceName");
                workHour = $(".plusPrice").attr("workHour");
            }

            var valArr = [];
            $('.ycbMech input').each(function(i){
                valArr.push($('.ycbMech input').eq(i).attr("value"))
            })
            var activeName = $(".ul-yuangong ul .t-active").html();
            var tdtwowid = $(".ycbMech table td").eq(1).width()/2;
            var inpuWid = $(".ycbMech input").eq(0).width();
            $.each(tableData,function(i){
                var item = tableData[i];
                $.each(item.orderList,function(j){
                    var str = item.orderList[j];
                    var X1;
                    var Y1;
                    $.each(valArr,function(k){
                        if(str.appointmentStartTime == valArr[k]){
                            X1 = $('.ycbMech input').eq(k).position().top;
                            Y1 = $('.ycbMech input').eq(k).position().left-tdtwowid+inpuWid+4;
                        }
                    })
                    var tdWidth = $('.ycbMech input').eq(0).parent().width()+2;
                    var tdHeight = $('.ycbMech input').eq(0).parent().height()+2;

                    var warpDiv = $('<div class="warpDiv"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html(activeName+'<br>'+str.serviceName) //.attr("val",$(this).attr("value"));
                    $(".ycbMech").append(warpDiv)
                })
            })
        }
        //var warpDiv = $('<div class="warpDiv"></div>').html("")
        // $(".ycbMech input").bind('click',function(){
        //     var X1 = $(this).position().top;
        //     var Y1 = $(this).position().left-100;
        //     var tdWidth = $(this).parent().width();
        //     var tdHeight = $(this).parent().height()+3;
        //     warpDiv.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html(plateNumber+'<br>'+serviceName).attr("val",$(this).attr("value"))
        //     $(".ycbMech").append(warpDiv)
        // })
        $(".ybs-yuangong-select").on('click','.ul-yuangong .workUl li',function(){
            $(".ul-yuangong .workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
            var shopEmployeeId = $(".ul-yuangong .workUl li").eq($(this).index()).attr("shopemployeeid");
            //console.log(shopEmployeeId)
            createTablejishi(shopEmployeeId)
        })
        /* 弹框里的确认选择 */
        $(".button-yuangong").click(function(){
            var shopEmployeeId = $('.employSel option:selected').attr("emp");
            var appointmentStartTime = $(".time-position").html().substring(4);
            var workHour = $(".plusPrice").attr("workhour");
            /* 检查是否繁忙 */
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/checkWorkEmployee?shopEmployeeId='+shopEmployeeId+'&appointmentStartTime='+appointmentStartTime+'&workHour='+workHour,
                success:function(data){
                    if(data.isBusy == 0){
                        $(".debut").html("")
                    }else{

                        //$(".debut").html("员工此时间段内繁忙，请换一个员工选择")
                        //alert("员工此时间段内繁忙，请换一个员工选择");

                        $.jRadAlert("员工此时间段内繁忙，请换一个员工选择",'error');
                        //return false;
                    }
                }
            })
            $(".ybs-yuangong-select").hide();
            $(".drag").hide();
            $(".jishi-position").show().html("已选择："+$('.employSel option:selected').html()).attr("shopEmployeeId",$('.employSel option:selected').attr("emp"));
            $(".yuyuejishi").show()
        })
        $('.ybs-yuangong-select').on('click','.alert-head a',function(){
            $(".ybs-yuangong-select").hide();
            $(".ybs-gongshi-select").hide();
            $(".drag").hide();
        })
    }


    /* 创建时函数 */
    function createAppoint(){
        $("#Form_appointment_add").form({
            title:'创建',
            fields:field_params,
            item:{},
            validators: jRad.validators, 
            url:'/vip-ws/ws/0.1/AppointmentManager/createAppointOrder',
            preSubmit:function(json){
                json.businessInfoId = carsmart_config.businessInfoId;
                if($("div[name='isWash']",wraper).radio('val')=='1'){
                    json.serviceId = $(".serverPrice").attr("serviceId");
                    json.serviceName = $(".serverPrice").attr("serviceName");
                    json.workHour = $(".serverPrice").attr("workHour");
                    json.clearPrice = $(".serverPrice").attr("price");
                    json.mobile = $("#Form_appointment_add .yesCwach div[name='mobile']").input("val");
                }else{
                    json.mobile = $("#Form_appointment_add .noCwach div[name='mobile']").input("val");
                    json.appointmentStartTime = $(".time-position").html().substring(4);
                    json.shopEmployeeId = $(".jishi-position").attr("shopEmployeeId")
                    json.workStationInfoId = $(".time-position").attr("gwId");
                    json.seriesId = $('.last span').attr("id");
                    if($("div[name='service']",wraper).radio('val')=='0'){
                        json.serviceId = $(".plusPrice").attr("id");
                        json.serviceName = $(".plusPrice").attr("serviceName");
                        json.workHour = $(".plusPrice").attr("workHour");
                        json.clearPrice = $(".plusPrice").attr("clearPrice");
                    }else{
                        json.isOtherService = 1;
                        json.serviceName = $("#Form_appointment_add div[name='otherService']",wraper).input("val");
                        json.workHour = $("#Form_appointment_add div[name='workHour']",wraper).input("val");
                        json.clearPrice = $("#Form_appointment_add div[name='workHourPrice']",wraper).input("val");
                    }
                }
                return json;
                    
            },
            success: function() {
                $('#Table_appointment_manage').flexMessage('创建成功', 'success','3');
                $('#Table_appointment_manage').flexReload();
            }
        }).form('open')
        $(".noSearch").hide();
        $(".yuyueTime").hide();
        $(".time-position").hide();
        $(".yuyuejishi").hide();        
        $(".jishi-position").hide();
        $(".noCwach").show()
        $(".yesCwach").hide()
        $(".isshow").show();
        $(".other").hide();
        $(".twoShow").hide();
        $(".sePrice").hide();
        $('#Form_appointment_add div[name="isWash"]',wraper).radio('val','0');
        $('#Form_appointment_add div[name="service"]',wraper).radio('val','0');

        $('.last').html("").hide()
        $('.ul-letters').show();
        $('.condition-title').show();
        brandFn()
        $('.car-list').show().html('');

        $('input[name="otherService"]').blur(function(){
            if($('input[name="otherService"]').val() != '' && $('input[name="workHour"]').val() != '' && $('input[name="workHourPrice"]').val() != ''){
                $(".yuyueTime").show();
            }else{$(".yuyueTime").hide()}
        })
        $('input[name="workHour"]').blur(function(){
            if($('input[name="otherService"]').val() != '' && $('input[name="workHour"]').val() != '' && $('input[name="workHourPrice"]').val() != ''){
                $(".yuyueTime").show();
            }else{$(".yuyueTime").hide()}
        })
        $('input[name="workHourPrice"]').blur(function(){
            if($('input[name="otherService"]').val() != '' && $('input[name="workHour"]').val() != '' && $('input[name="workHourPrice"]').val() != ''){
                $(".yuyueTime").show();
            }else{$(".yuyueTime").hide()}
        })

        /* 车牌号查询 */
        $(".ycbtn").click(function(){
            var proNumber = $('#Form_appointment_add div[name="plateNumber"]').input('val');
            var valcode = decodeURI(proNumber)
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/getUserCarInfo?plateNumber='+valcode,
                success:function(data){
                    if(data.length == 0){
                        $(".noSearch").show();
                        $(".noSearchClass").html("暂无查询结果。").css("color","#ff0000");
                    }else{
                        $('#Form_appointment_add div[name="mobile"]').input('val',data.mobile);
                        $(".condition-title").hide();
                        $(".ul-letters").hide();
                        $('.last').show().html('<span id='+data.carInfoId+'>'+data.seriesName+'</span><a href="javascript:void(0)">X</a>')

                        $('.last').on('click','a',function(){
                            $('.last').hide();
                            $('.ul-letters').show();
                            $('.condition-title').show();
                            $('.uperCase').removeClass("active");
                            $('.car-list').show().html('');
                        })
                    }
                },
                error:function(xhr){
                    var mes = eval("("+xhr.responseText+")");  
                    $.jRadMessage({level:'error',message:mes[0].message,selector:$("#Form_appointment_add .pop-up-middle")})
                }
            });
        })

        $('.last').on('click','a',function(){
            $('.last').hide();
            $('.ul-letters').show();
            $('.condition-title').show();
            $('.uperCase').removeClass("active");
            $('.car-list').show().html('');
        })


        /* 工位及时间 */
        $(".time-ycb-btn").click(function(){
            gwAndTimeFn();
        })

        /* 技师按钮 */
        $(".jishi-ycb-btn").click(function(){
            jishiFn();
        })
    }

    /* 查询报价函数 */
    function createAppoint_sel(){
        $("#Form_appointment_add_sel").form({
            title:'创建',
            fields:field_params,
            item:{},
            validators: jRad.validators, 
            url:'/vip-ws/ws/0.1/AppointmentManager/createAppointOrder',
            preSubmit:function(json){
                json.businessInfoId = carsmart_config.businessInfoId;
                json.isWash = 0;
                json.serviceId = $(".select-position").attr("serviceid");
                json.serviceName = $("div[name='serviceName']").html();
                json.workHour = $(".select-position").attr("workHour");
                json.shopEmployeeId = $(".jishi-position").attr("shopemployeeid");
                json.workStationInfoId = $(".time-position").attr("gwid")
                json.mobile = $("#Form_appointment_add_sel div[name='mobile']").input("val");
                json.seriesId = $('.last span').attr("id");
                json.clearPrice = $(".select-position").attr("reserveprice")
                json.appointmentStartTime = $(".time-position").html().substring(4);
                return json;
            },
            success: function() {
                $("#Form_select_price").hide();
                $(".fade").hide()
                //$(".drag").hide();
                $('#Table_appointment_manage').flexMessage('创建成功', 'success','3');
                $('#Table_appointment_manage').flexReload();
            }
        }).form('open')

        $(".yuyuejishi").hide()

        $('.last').html("").hide()
        $('.ul-letters').show();
        $('.condition-title').show();
        brandFn()
        $('.car-list').show().html('');

        /* 车牌号查询 */
        $(".ycbtn").click(function(){
            var proNumber = $('#Form_appointment_add_sel div[name="plateNumber"]').input('val');
            $.jRadGet({
                url:'/vip-ws/ws/0.1/AppointmentManager/getUserCarInfo?plateNumber='+proNumber,
                //async:false,
                success:function(data){
                    if(data.length == 0){
                        $(".noSearch2").show();
                        $(".noSearchClass2").html("暂无查询结果。").css("color","#ff0000");
                    }else{
                        $('#Form_appointment_add_sel div[name="mobile"]').input('val',data.mobile);
                        $(".condition-title").hide();
                        $(".ul-letters").hide();
                        $('.last').show().html('<span id='+data.carInfoId+'>'+data.seriesName+'</span><a href="javascript:void(0)">X</a>')

                        $('.last').on('click','a',function(){
                            $('.last').hide();
                            $('.ul-letters').show();
                            $('.condition-title').show();
                            $('.uperCase').removeClass("active");
                            $('.car-list').show().html('');
                        })
                    }
                },
                error:function(xhr){
                    var mes = eval("("+xhr.responseText+")");  
                    $.jRadMessage({level:'error',message:mes[0].message,selector:$("#Form_appointment_add_sel .pop-up-middle")})
                }
            });
        })

        $('.last').on('click','a',function(){
            $('.last').hide();
            $('.ul-letters').show();
            $('.condition-title').show();
            $('.uperCase').removeClass("active");
            $('.car-list').show().html('');
        })

        /* 工位及时间按钮 */
        $(".time-ycb-btn").click(function(){
            $(".ybs-gongshi-select button").eq(0).removeClass("trurBtn").addClass("trurBtn-sel")
            //var appointmentOrderId = $(".select-position").attr("serviceid").appointOrderId;  
            var plateNumber = $("#Form_appointment_add_sel div[name='plateNumber']").input("val");   
            var serviceName = $("#Form_appointment_add_sel div[name='serviceName']").html(); 
            var workHour = $(".select-position").attr("workhour");
            //var stationId= $(".ul-gongwei ul li").attr("stationId");
            gwAndTimeFnItem2(plateNumber,serviceName,workHour)
            function gwAndTimeFnItem2(plateNumber,serviceName,workHour){
                $(".ybs-gongshi-select").show();
                $(".drag").show();
                $(".ul-gongwei").html("");
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/AppointmentManager/getWorkHourStationList?businessInfoId='+carsmart_config.businessInfoId,
                    success:function(data){
                        var staUl;
                        staUl = $('<ul class="clearfix workUl"></ul>');
                        $.each(data,function(i){
                            var item = data[i]
                            var staLi;
                            staLi = $('<li stationId="'+item.stationId+'">'+item.stationName+'</li>')
                            staUl.append(staLi)
                        })
                        $(".ul-gongwei").append(staUl)

                        $(".ul-gongwei ul li").eq(0).addClass("t-active")
                    }   
                })
                var stationId= $(".ul-gongwei ul .t-active").attr("stationId");

                createTable(stationId)

                function createTable(stationId){
                    var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
                    var startTime = getTimeForBusi.startHour;       
                    var endTime = getTimeForBusi.endHour;
                    var arr=[];
                    for(var i = startTime; i<=endTime-1; i++){
                        var s = i+1;
                        if (s >= 10)
                        {
                            var starParam = i + ":00";
                            var endParam = i+1 +":00";
                            arr.push(starParam + "-" +endParam);
                        }
                        else{
                            var starParam = "0"+i + ":00";
                            var endParam = "0"+s+":00";
                            arr.push(starParam + "-" +endParam);
                        } 
                    }
                    var table =$('<table></table');
                    $.jRadGet({
                        url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?stationId='+stationId,
                        success:function(data){
                            var th;
                            var thead = $('<thead></thead>');
                            var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                            $.each(data,function(i){
                                var item1 = data[i]
                                th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                                tr.append(th);
                                thead.append(tr)
                            })  
                            table.append(thead);

                            return tableData = data;
                        }
                    })
                    $(".ycbTable").append(table)
                    var yesdaty = $(".ycbTable thead th").eq(1).attr("DatePara");
                    var dodaty = $(".ycbTable thead th").eq(2).attr("DatePara");
                    var masdaty = $(".ycbTable thead th").eq(3).attr("DatePara");
                    var tbody = $('<tbody></tbody>');
                    $.each(arr,function(i){
                        var z = startTime+i
                        if(z >= 10){
                            var startTimeBy = z
                        }else{
                            var startTimeBy = "0"+z
                        }
                        var starParamDou1 = startTimeBy+":00"+":00"
                        var starParamDou2 = startTimeBy+":10"+":00"
                        var starParamDou3 = startTimeBy+":20"+":00"
                        var starParamDou4 = startTimeBy+":30"+":00"
                        var starParamDou5 = startTimeBy+":40"+":00"
                        var starParamDou6 = startTimeBy+":50"+":00"
                        var item2 = arr[i]
                        var tr0;
                        var tr1;
                        var tr2;
                        tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                        tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                        tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                        tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                        tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                        tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                        tbody.append(tr1)
                        tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
                    })
                    table.append(tbody)
                    $(".ycbTable").html("");
                    $(".ycbTable").append(table)
                    $(".ycb-alert-wrap").css("height",$(".ybs-gongshi-select").height()-180);     

                    var valArr = [];
                    $('.ycbTable input').each(function(i){
                        valArr.push($('.ycbTable input').eq(i).attr("value"))
                    })
                    var tdtwowid = $(".ycbTable table td").eq(1).width()/2;
                    var inpuWid = $(".ycbTable input").eq(0).width();
                    $.each(tableData,function(i){
                        var item = tableData[i];
                        $.each(item.orderList,function(j){
                            var str = item.orderList[j];
                            var X1;
                            var Y1;
                            $.each(valArr,function(k){
                                if(str.appointmentStartTime == valArr[k]){
                                    X1 = $('.ycbTable input').eq(k).position().top;
                                    Y1 = $('.ycbTable input').eq(k).position().left-tdtwowid+inpuWid+4;
                                }
                            })
                            var tdWidth = $('.ycbTable input').eq(0).parent().width()+2;
                            var tdHeight = $('.ycbTable input').eq(0).parent().height()+2;
                            var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+str.plateNumber+'<br>'+str.serviceName+'</div>') //.attr("val",$(this).attr("value"));
                            $(".ycbTable").append(warpDiv)
                        })
                    })

                    var warpDiv2 = $('<div class="warpDiv2" style="display:table;"></div>').html("")
                    $(".ycbTable input").bind('click',function(){
                        $(".succAndErr").html("")
                        var X1 = $(this).position().top;
                        var Y1 = $(this).position().left-100;
                        var tdWidth = $(this).parent().width()+2;
                        var tdHeight = $(this).parent().height()+2;
                        warpDiv2.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+plateNumber+'<br>'+serviceName+'</div>').attr("val",$(this).attr("value"))
                        // warpDiv2.css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*workHour,"top":X1,"left":Y1}).html(plateNumber+'<br>'+serviceName).attr("val",$(this).attr("value"))
                        $(".ycbTable").append(warpDiv2);
                        var aWarpDiv = $(".ycbTable .warpDiv");
                        for (var i = 0; i < aWarpDiv.length; i++) 
                        {
                            if ( cdTest (warpDiv2,aWarpDiv.eq(i))  ) 
                            {
                                $(".succAndErr").html("选择工时与其他预约服务时间重复！").css("color","red")
                                $(".ycbTable .warpDiv2").remove();
                                $(this).attr("checked",false);
                            }
                        }
                    })       
                }

                function cdTest (obj1,obj2){
                    var l1=obj1.offset().left;
                    var r1=obj1.offset().left+obj1.width();
                    var t1=obj1.offset().top;
                    var b1=obj1.offset().top+obj1.height();
                    
                    var l2=obj2.offset().left;
                    var r2=obj2.offset().left+obj2.width();
                    var t2=obj2.offset().top;
                    var b2=obj2.offset().top+obj2.height();
                    
                    if (r1<l2 || l1>r2 || b1<t2 || t1>b2) {
                            return false;
                    }else{
                            return true;
                    }
                }

                $(".workUl li").click(function() {   
                    $(".workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
                    var stationId = $(".workUl li").eq($(this).index()).attr("stationId");
                    createTable(stationId);
                });   

                $('.ybs-gongshi-select .trurBtn-sel').unbind('click').bind('click',function(){
                    if($(".ycbTable .warpDiv2").length != 0){
                        $(".succAndErr").html("")
                        $(".ybs-gongshi-select").hide();
                        $(".drag").hide();
                        $(".time-position").show().html("已选择："+$(".warpDiv2").attr("val")).attr({gw:$(".ul-gongwei .t-active").html(),gwId:$(".ul-gongwei .t-active").attr("stationid")});
                        $(".yuyuejishi").show()
                        /* 自动排班 */
                        var businessInfoId = carsmart_config.businessInfoId;
                        var appointmentStartTime = $(".warpDiv2").attr("val")
                        var workHour = $(".select-position").attr("workHour");
                        $.jRadGet({
                            url:'/vip-ws/ws/0.1/AppointmentManager/getDistributeEmployee?businessInfoId='+businessInfoId+'&appointmentStartTime='+appointmentStartTime+'&workHour='+workHour,
                            success:function(data){
                                $(".jishi-position").show().html("已选择："+data.name).attr("shopEmployeeId",data.shopEmployeeId);
                            },
                            error:function(){
                                $(".jishi-position").hide();
                            }
                        })
                    }else{
                        $(".succAndErr").html("选择工时与工位！").css("color","red")
                    }
                })

                /* 查询空闲工位 */
                $(".button-gongwei").click(function(){
                    var businessInfoId = carsmart_config.businessInfoId;
                    var freeTime = $(".employInput").val();
                    $(".succAndErr").html("")
                    $.ajax({
                        type:'get',
                        //async:false,
                        url:'/vip-ws/ws/0.1/AppointmentManager/getFreeStation?businessInfoId='+carsmart_config.businessInfoId+'&freeTime='+freeTime,  
                        success: function(data){
                            if(data.length != 0){
                                $.each(data,function(i){
                                    var item = data[i];
                                    $(".succAndErr").append($('<span stationId="'+item.stationId+'">空闲工位：'+item.stationName+'</span>'))
                                })
                            }
                        },
                        error:function(xhr){
                            var mes = eval("("+xhr.responseText+")");  
                            $(".succAndErr").html(mes[0].message).css("color","#ff0000")
                        }
                    })
                })

                $(".alert-head a").click(function(){
                    $(".ybs-yuangong-select").hide();
                    $(".ybs-gongshi-select").hide();
                    $(".drag").hide();
                })
            }

        })

        /* 技师按钮 */
        $(".jishi-ycb-btn").click(function(){
            var plateNumber = $("#Form_appointment_add_sel div[name='plateNumber']").input("val");   
            var serviceName = $("#Form_appointment_add_sel div[name='serviceName']").html(); 
            var workHour = $(".select-position").attr("workhour");
            var shopEmployeeId_a= $(".ul-gongwei ul li").attr("stationId");

            jishiFnItem2(plateNumber,serviceName,workHour);

            function jishiFnItem2(plateNumber,serviceName,workHour){
                $(".ybs-yuangong-select").show();
                $(".drag").show();

                $(".ybs-yuangong-select button").eq(0).removeClass("button-yuangong").addClass("button-yuangong-sel")
                var mach = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId})
                $(".employSel").html("")
                $.each(mach,function(i){
                    var item = mach[i]
                    var creatOption = $('<option emp="'+item.shopEmployeeId+'" positionName="'+item.positionName+'">'+item.name+'</option>')
                    $(".employSel").append(creatOption)
                })

                $(".ul-yuangong").html("");
                $.jRadGet({
                    url:'/vip-ws/ws/0.1/AppointmentManager/getMechanicList?businessInfoId='+carsmart_config.businessInfoId,
                    success:function(data){
                        var staUl = '';
                        var staLi = '';
                            staUl = $('<ul class="clearfix workUl"></ul>');
                        $.each(data,function(i){
                            var item = data[i]
                            staLi = $('<li class="" shopEmployeeId="'+item.shopEmployeeId+'">'+item.name+'('+item.positionName+')'+'</li>')
                            staUl.append(staLi)
                        })
                        $(".ul-yuangong").append(staUl)
                        $(".ul-yuangong ul li").eq(0).addClass("t-active")
                    }   
                })
                
                var shopEmployeeId= $(".ul-yuangong .t-active").attr("shopemployeeid")

                createTable(shopEmployeeId)

                function createTable(shopEmployeeId){
                    var getTimeForBusi = $.jRadGet({url:'/vip-ws/ws/0.1/AppointmentManager/getStartAndEndTimeForBusi?businessInfoId='+carsmart_config.businessInfoId});
                    var startTime = getTimeForBusi.startHour;       
                    var endTime = getTimeForBusi.endHour;
                    var arr=[];
                    for(var i = startTime; i<=endTime-1; i++){
                        var s = i+1;
                        if (s >= 10)
                        {
                            var starParam = i + ":00";
                            var endParam = i+1 +":00";
                            arr.push(starParam + "-" +endParam);
                        }
                        else{
                            var starParam = "0"+i + ":00";
                            var endParam = "0"+s+":00";
                            arr.push(starParam + "-" +endParam);
                        } 
                    }
                    var table =$('<table></table');
                    $.jRadGet({
                        url:'/vip-ws/ws/0.1/AppointmentManager/getAppointOrderByEmployeeId?shopEmployeeId='+shopEmployeeId,
                        success:function(data){
                            var th;
                            var thead = $('<thead></thead>');
                            var tr = $('<tr><th width="16%"><div class="d1"><span class="s1">日期</span><span class="s2">工时</span></div></th></tr>');
                            $.each(data,function(i){
                                var item1 = data[i]
                                th = $('<th width="28%" DatePara="'+item1.currentDateParam+'">'+item1.currentDate+'</th>')
                                tr.append(th);
                                thead.append(tr)
                            })  
                            table.append(thead) 
                            return tableData = data;
                        }
                    })
                    $(".ycbMech").append(table)
                    var yesdaty = $(".ycbMech thead th").eq(1).attr("DatePara");
                    var dodaty = $(".ycbMech thead th").eq(2).attr("DatePara");
                    var masdaty = $(".ycbMech thead th").eq(3).attr("DatePara");
                    var tbody = $('<tbody></tbody>');
                    $.each(arr,function(i){
                        var z = startTime+i
                        if(z >= 10){
                            var startTimeBy = z
                        }else{
                            var startTimeBy = "0"+z
                        }
                        var starParamDou1 = startTimeBy+":00"+":00"
                        var starParamDou2 = startTimeBy+":10"+":00"
                        var starParamDou3 = startTimeBy+":20"+":00"
                        var starParamDou4 = startTimeBy+":30"+":00"
                        var starParamDou5 = startTimeBy+":40"+":00"
                        var starParamDou6 = startTimeBy+":50"+":00"
                        var item2 = arr[i]
                        var tr0;
                        var tr1;
                        var tr2;
                        tr1=$('<tr><td rowspan="6" class="rowcolor">'+item2+'</td><td><input type="radio" name="ycb" value="'+yesdaty+' '+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou1+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou1+'"><label>空闲</label></td></tr>');
                        tr2=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou2+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou2+'"><label>空闲</label></td></tr></tr>');
                        tr3=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou3+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou3+'"><label>空闲</label></td></tr></tr>');
                        tr4=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou4+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou4+'"><label>空闲</label></td></tr></tr>');
                        tr5=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou5+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou5+'"><label>空闲</label></td></tr></tr>');
                        tr6=$('<tr><td style="display:none"><input type="radio" name="ycb"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+yesdaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+dodaty+" "+starParamDou6+'"><label>空闲</label></td><td><input type="radio" name="ycb" value="'+masdaty+" "+starParamDou6+'"><label>空闲</label></td></tr></tr>');
                        tbody.append(tr1)
                        tbody.append(tr2).append(tr3).append(tr4).append(tr5).append(tr6)
                    })
                    table.append(tbody)
                    $(".ycbMech input[type='radio']").css({"filter":"alpha(opacity=0)","-moz-opacity":"0", "opacity": "0"})
                    $(".ycb-alert-wrap").css("height",$(".ybs-yuangong-select").height()-180);
                    $(".ycbMech").html("");
                    $(".ycbMech").append(table);
                    var valArr = [];
                    $('.ycbMech input').each(function(i){
                        valArr.push($('.ycbMech input').eq(i).attr("value"))
                    })
                    var tdtwowid = $(".ycbMech table td").eq(1).width()/2;
                    var inpuWid = $(".ycbMech input").eq(0).width();
                    $.each(tableData,function(i){
                        var item = tableData[i];
                        $.each(item.orderList,function(j){
                            var str = item.orderList[j];
                            var X1;
                            var Y1;
                            $.each(valArr,function(k){
                                if(str.appointmentStartTime == valArr[k]){
                                    X1 = $('.ycbMech input').eq(k).position().top;
                                    Y1 = $('.ycbMech input').eq(k).position().left-tdtwowid+inpuWid+4;
                                }
                            })
                            var tdWidth = $('.ycbMech input').eq(0).parent().width()+2;
                            var tdHeight = $('.ycbMech input').eq(0).parent().height()+2;
                            var warpDiv = $('<div class="warpDiv" style="display:table;"></div>').css({"color":"#ff6e47","width":tdWidth,"height":tdHeight*str.workHour,"top":X1,"left":Y1}).html('<div style="vertical-align:middle;display:table-cell">'+str.plateNumber+'<br>'+str.serviceName+'</div>') //.attr("val",$(this).attr("value"));
                            $(".ycbMech").append(warpDiv)
                        })
                    })
                }
                
                $(".ul-yuangong .workUl li").click(function() {   
                    $(".ul-yuangong .workUl li").eq($(this).index()).addClass("t-active").siblings().removeClass('t-active'); 
                    var shopEmployeeId = $(".ul-yuangong .workUl li").eq($(this).index()).attr("shopemployeeid");
                    createTable(shopEmployeeId);
                });

                $(".button-yuangong-sel").click(function(){
                    var shopEmployeeId = $('.employSel option:selected').attr("emp");
                    var appointmentStartTime = $(".time-position").html().substring(4);
                    var workHour = $(".select-position").attr("workhour");
                    $.jRadGet({
                        url:'/vip-ws/ws/0.1/AppointmentManager/checkWorkEmployee?shopEmployeeId='+shopEmployeeId+'&appointmentStartTime='+appointmentStartTime+'&workHour='+workHour,
                        success:function(data){
                            if(data.isBusy == 0){
                                $(".debut").html("")
                            }else{

                                $(".debut").html("员工此时间段内繁忙，请换一个员工选择")
                                //alert("员工此时间段内繁忙，请换一个员工选择");

                                $.jRadAlert("员工此时间段内繁忙，请换一个员工选择");
                                return false;
                            }
                        }
                    })
                    $(".ybs-yuangong-select").hide();
                    $(".drag").hide();
                    $(".jishi-position").show().html("已选择："+$('.employSel option:selected').html()).attr("shopEmployeeId",$('.employSel option:selected').attr("emp"));
                })
                $('.ybs-yuangong-select').on('click','.alert-head a',function(){
                    $(".ybs-yuangong-select").hide();
                    $(".ybs-gongshi-select").hide();
                    $(".drag").hide();
                })
            }
        })

        $(".alert-head a").click(function(){
            $(".ybs-yuangong-select").hide();
            $(".ybs-gongshi-select").hide();
            $(".drag").hide();
        })
    }


    function showRemarkError(xhr){
        var errormsg = eval("(" + xhr.responseText + ")");
        var cDiv = $("#Wraper_appointment_manage .cDiv");
        $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
    }

    function brandFn(){
        var brandList = $.ajax({url:"/shopmanage-ws/ws/0.1/support/brand/list",
            async:false
        });
        var msg = eval("(" + brandList.responseText + ")");
        
        var A_Z="";
        for(var i=65;i<91;i++){
            if(i == 69 || i== 73 || i == 85 || i == 86){
                A_Z+="";
            }else{  
                A_Z+="<li  class='uperCase uperCasess' data-num="+i+">"+String.fromCharCode(i)+"</li>";
            }
        };
        $("#searchBox .ul-letters").html(A_Z);

        $('.ul-letters li').on('click',function(){
            var str = $(this).html();
            var data = eval('msg.'+str)
            var _li = '';
            $('.car-list').html("");
            $.each(data,function(i){
                var item = data[i]
                _li += '<li data-id='+item.id+'>'+item.name+'</li>'
            })
            $('.car-list').append(_li);

            $('.car-list li').on('click',function(){
                var str = $(this).attr("data-id")
                var modelList = $.ajax({url:'/shopmanage-ws/ws/0.1/support/model/list?brandId='+str,
                    async:false
                })
                var data2 = eval("(" + modelList.responseText + ")");
                $('.car-list').html("");
                var _li2 = '';
                $.each(data2,function(i){
                    var item2 = data2[i]
                    _li2 += '<li data-id='+item2.id+'>'+item2.name+'</li>'
                })
                $('.car-list').append(_li2);

                $('.car-list li').on('click',function(){
                    $('.car-list').html("");
                    var str = $(this).attr("data-id")
                    var modelList2 = $.ajax({url:'/shopmanage-ws/ws/0.1/modelCms/model/list?factoryId='+str,
                        async:false
                    })
                    var data3 = eval("(" + modelList2.responseText + ")");
                    
                    $('.car-list').html("");
                    var _li3 = '';
                    $.each(data3,function(i){
                        var item3 = data3[i]
                        _li3 += '<li data-id='+item3.modelId+'>'+item3.modelName+'</li>'
                    })
                    $('.car-list').append(_li3);
                    
                    $('.car-list li').on('click',function(){
                        var str = $(this).attr("data-id")
                        $('.ul-letters').hide();
                        $('.car-list').hide();
                        $('.condition-title').hide();
                        $('.last').show().html('<span id='+str+'>'+$(this).html()+'</span><a href="javascript:void(0)">X</a>');

                        $('.last a').on('click',function(){
                            $('.last').hide();
                            $('.ul-letters').show();
                            $('.condition-title').show();
                            $('.uperCase').removeClass("active");
                            $('.car-list').show().html('');
                        })
                    })

                })

                
            })
        });

        $("body").on("click","#searchBox .uperCasess", function(){
            $(this).siblings(".uperCase").removeClass("active").end().addClass("active");
        })
    }
    function getServiceSonNode(n,val,wraper){   
        var label = "",serviceClass = "",num = "";
        var node = n;
        if(node==1){
            label = "服务";
            serviceClass = "firstService"; 
            num = "first"; 
            $("#Form_appointment_add .first").parents(".grid-row-fluid").remove();
            $("#Form_appointment_add .second").parents(".grid-row-fluid").remove();
            $("#Form_appointment_add .third").parents(".grid-row-fluid").remove();
            $("#Form_appointment_add .four").parents(".grid-row-fluid").remove();
        }else if(node==2){
            label = "二级服务";
            serviceClass = "secondService"; 
            num = "second"; 
            $("#Form_appointment_add .second").parents(".grid-row-fluid").remove();
            $("#Form_appointment_add .third").parents(".grid-row-fluid").remove();
            $("#Form_appointment_add .four").parents(".grid-row-fluid").remove();
        } else if(node==3){
            label = "三级服务";
            serviceClass = "thirdService"; 
            num = "third"; 
            $("#Form_appointment_add .third").parents(".grid-row-fluid").remove();
            $("#Form_appointment_add .four").parents(".grid-row-fluid").remove();
        } else if(node==4){
            label = "四级服务";
            serviceClass = "fourService"; 
            num = "four"; 
            $("#Form_appointment_add .four").parents(".grid-row-fluid").remove();
        }
        if(val!=""){
            //var item = $.jRadGetDataSources("/shopmanage-ws/ws/0.1/service/getSonServices?parentId="+val,"id","serviceName");
            //var item = $.jRadGetDataSources('/vip-ws/ws/0.1/business/getServiceListByShopId?parentId='+val+'&level='+node+'&shopAccountId='+carsmart_config.shopId,"serviceId","serviceName");
            var item = $.jRadGetDataSources('/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+val+'&businessInfoId='+carsmart_config.businessInfoId,"id","serviceName");
            if(item.length>0){
                item.unshift({id:'',name:'请选择'}); 
                var row = '<div class="grid-row-fluid defaultHide">'
                            +'<label class="span5 grid-layout-label">'+label+'：</label>'
                            +'<div class="span12 grid-layout-content fluid-wrap">'
                            +'<div name="'+serviceClass+'" class="jrad-select-container service '+ num +'"></div>'
                            +'</div>'
                            +'</div>'  
                $("#Form_appointment_add .service:last",wraper).parents(".grid-row-fluid").after(row); 
                node++;
                $('#Form_appointment_add div[name='+serviceClass+']').select({
                    data:item,
                    unshiftData: {id:'',name:'请选择'},
                    onclick:function(data){
                        var price;
                        var id
                        var workHour
                        var serviceName
                        if(data.id == ''){
                            $(".plusPrice").hide();
                        }else{
                            $(".plusPrice").show();
                            var item2 = $.jRadGet({url:'/shopmanage-ws/ws/0.1/businessServiceRel/getBusinessServiceList?serviceType='+val+'&businessInfoId='+carsmart_config.businessInfoId});
                            if(item2.length != 0){
                                $.each(item2,function(i){
                                    var itemDat = item2[i];
                                    if(itemDat.serviceName == data.name){
                                        price = itemDat.reservePrice;
                                        id=itemDat.id;
                                        workHour = itemDat.workHour
                                        serviceName = itemDat.serviceName;
                                    }
                                })
                            }
                            $(".twoShow").show();
                            $(".yuyueTime").show();
                            $(".plusPrice").html("服务预订价："+price+"元").attr({id:id,workHour:workHour,serviceName:serviceName,clearPrice:price});
                        }
                    } 
                });
            } 
        }
    } 
})
</script>
