<style>
	#months_brand_table div{
		text-align:center;
	}
	div.datetimepickerBS-years th.next,div.datetimepickerBS-years th.prev{
		visibility:hidden!important;
	}
	div.datetimepickerBS-years span.old{
		color:#999!important;
	}
	.grid-layout-content label{
		color:#fff;
	}
</style>
<div class="urlContentWraper" id="ycb-start-branch">
	<div class="row-container">
		<div class="jrad-radio-terminal"></div>
	</div>
    <div class="row-fluid">
        <div class="span12">
            <div class="widget-box applay-situation">
                <div class="widget-header">
                    <h3 class="lighter">本店信息统计 </h3> 
                </div>
                <div class="widget-body">
                    <input type="hidden" name="situation">
                    <div class="widget-main">
						<ul class="clearfix jrad-list-situation">
							<li><div><h4>总成交金额（元）</h4><p></p></div></li>
							<li><div><h4>总成交订单（个）</h4><p></p></div></li>
							<li><div><h4>总商铺点击数（人）</h4><p></p></div></li>  
						</ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <div class="widget-box">
                <div class="widget-header">
                    <h3 class="lighter">按月统计表</h3>
                    <div class="span6 grid-layout-content fluid-wrap" style="position:relative;top:9px;left:0;min-width:390px;">
							<div id="searchtype_radio" class="jrad-radio-container"></div>
					</div>
                    <div class="widget-toolbar no-border">
                    	<div class="clearfix time-search-box">
						<div class="input-append date" id="stat_branch_date" style="float:left">
							<div class="input-wrap">
							    <input type="text">
							</div>
							<span class="add-on"><i class="icon-calendar"></i></span>
						</div>
						<button class="btn btn-mini btn-primary jrad-btn-search">搜索</button>                   	
                    	</div>
					</div> 
                </div>
                <div class="widget-body">
                    <div class="widget-main padding-10"> 
                        <div class="row-fluid">
						<div class="jrad-chart span8"></div>
                        <div class="row-container" style="width:30.3%;float:right;">
							<div class="jrad-dimensiontable">
								<table id="months_brand_table">
									<tr>
										<th class="row_header"><div>日期</div></th>
										<th title="成交金额（元）" colspan="1" style="text-align: center;" class="col"><div rel="0:1">成交金额（元）</div></th>
										<th title="成交订单（个）" colspan="1" style="text-align: center;" class="col"><div rel="0:2">成交订单（个）</div></th>
										<th title="店铺点击数（人）" colspan="1" style="text-align: center;" class="col"><div rel="0:3">商铺点击数（人）</div></th>
									</tr> 
								</table>
							</div>
                        </div>
						</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
	<!--button class="btn btn-mini btn-primary" id="jrad-btn-excel">导出EXCEL</button-->
</div>
<script type="text/javascript">
$(document).ready(function(){
	var wraper = $('#ycb-start-branch');
	//总数据 type 1 本店总数据  2 所有店铺总数据 
	$.jRadGet({url:'/vip-ws/ws/0.1/busiStatic/getshopFinishedOrderAndUv?shopAccountId='+carsmart_config.shopId+'&type=1',
		success:function(data){
			$('.jrad-list-situation',wraper).children("li:first").find("p").html(data.totalAmount);
			$('.jrad-list-situation',wraper).children("li:eq(1)").find("p").html(data.totalNum);
			$('.jrad-list-situation',wraper).children("li:last").find("p").html(data.busiPV);	
		}  
	});
	//table
	var year = moment().format('YYYY'); 
	var searchtypeJson = {'1':'成交金额（元）','2':'成交订单（个）','3':'商铺点击数（人）'};
	shopSelfStaticTable(year);
	getChartData(year,"1");
	function shopSelfStaticTable(year){ 
		$.jRadGet({url:'/vip-ws/ws/0.1/busiStatic/shopSelfStaticTable?shopAccountId='+carsmart_config.shopId+'&year='+year,
			success:function(data){ 
				 var _table = $("#months_brand_table");
				 $(".addTr",_table).remove();
				 var str ="";  
				 $.each(data,function(i){
				 	var item = data[i];
				 	str += '<tr class="addTr">'
						+'<th class="row_content"><div rel="1:0">'+item.month+'月</div></th>'
						+'<td class="data"><div rel="0:0">'+item.totalAmount+'</div></td>'
						+'<td class="data"><div rel="1:0">'+item.totalNumber+'</div></td>'
						+'<td class="data"><div rel="1:0">'+item.busiPv+'</div></td>'
						+'</tr>'
				 });  
				_table.append(str);  
			}  
		});
	} 
	function getChartData(year,searchtype){  
		$.jRadGet({url:'/vip-ws/ws/0.1/busiStatic/shopSelfStaticReport?shopAccountId='+carsmart_config.shopId+'&year='+year+'&searchtype='+searchtype,
			success:function(data){  
				var arr = [];
				$.each(data,function(k,v){ 
					arr.push(parseInt(v));
				}); 
				var yLabel = searchtypeJson[searchtype]; 
				 $('.jrad-chart',wraper).charts({
			       data:data,
			       preProcess:function(data){
			       		var chartData = {  
					       chart: { type: 'line' },
					       tooltip: {
								shared: true
						   },
						   xAxis: { categories: ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'] },
						   yAxis:[{
									 labels: {
										// format: '{value}元',
										style: {
											font: 'normal 12px "微软雅黑","宋体",Arial'
										}
									},
									title: {
										text: yLabel,
										style: {
											color: '#2f7ed8'
										}
									} 
								}],
						  series: [{ 
								name:yLabel,
								tooltip: { 
								},
								data:arr
								}]
						};
						return chartData;

			       } 
			    });
	
			}  
		});
	}
	var radioVal = "1";
	$('#searchtype_radio',wraper).radio({
		data:[{id:'1',name:'按成交金额统计'},{id:'2',name:'按成交订单统计'},{id:'3',name:'按商铺点击数统计'}],
		onclick:function(){ 
			var searchtype = $('#searchtype_radio',wraper).radio('val');
			if(searchtype!=radioVal){
				radioVal=searchtype;
				var year = $('#stat_branch_date input').val();
				getChartData(year,searchtype);  
			}
		} 
	});
	$('#searchtype_radio',wraper).radio('val','1');
	$('#stat_branch_date').datetimepickerBS({
	    format: 'yyyy',
	    autoclose: 1,
		startView: 4,
		minView: 4,
		startDate:'2014',
		endDate:'2015',
		pickerPosition:'bottom-left'
	}).on('changeDate',function(ev){		
		var date = ev.date;
        var year = date.getFullYear() ;   
		var searchtype = $('#searchtype_radio',wraper).radio('val');
		getChartData(year,searchtype); 
		shopSelfStaticTable(year); 
	}); 
	$('#stat_branch_date input').val(year); 
});  
</script>