<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta name="description" content="养车宝">
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<link type="text/css" href="activity.css" rel="stylesheet"/>  
<link type="text/css" href="wx.css" rel="stylesheet"/>  
<title>地铁票价查询</title> 
<style type="text/css"> 
.ui-select{
	background-color: #f4f4f4;
	border: 1px solid #e5e5e5;  
	border-radius: 4px;
	padding-left:6px;
	cursor:pointer;
}
.ui-select-inner{
	padding-right:10px;
}
.ui-select-content{
	padding:4px 0px;
}
.ui-select-content .ele-icon{
	background:transparent url('date-arrow.png') no-repeat scroll right -35px;
	padding-right:14px;
	display:block;
	height:30px;
	line-height:30px;
	overflow:hidden;
}
.ui-select-focus .ele-icon{
	background-position:right -52px;
}
.ui-select:focus{
	outline:none;
}
.ui-select-readonly {
  background: #eeeeee !important;
  color:#848484;
  cursor:default;
}  
.ui-select + .droplist .droplist-middle-inner{
	overflow-y:auto;
	overflow-x:hidden;
}
.ui-autocomplete-liselect td,
.ui-autocombo-liselect td,
.droplist .selected td{
	background-color:#3399ff;
	color:#ffffff;
}
.ui-autocomplete-input + .droplist .droplist-top{
	background-color:#efefef;
}
.droplist{
	background-color:#ffffff;
	border:1px #7f9db9 solid;
	display:none;
	position:absolute;
	z-index:15;
}
.droplist .droplist-content{
	overflow-y:auto;
	overflow-x:hidden;
}
.droplist .droplist-items,
.droplist .droplist-header{
	border:0px;
	width:100%;
	*width:auto;
}
.droplist-items tr{
	cursor:pointer;
}
.droplist-items .icon-box{
	padding:5px 0px 5px 5px;
	width:16px;
}
.droplist-items tr:hover td{
	background-color:#3399ff;
	color:#ffffff;
}
.droplist-items td,.droplist-header th{
	border:0px;
	padding:4px 10px;
	white-space:nowrap;
	height: 25px;
	line-height: 25px;
}
.droplist-items tr td:first-child,
.droplist-header tr th:first-child{
	padding-left:5px;
}
.droplist-items tr td:last-child,
.droplist-header tr th:last-child{
	padding-right:5px;
}
.droplist-icon{
	background:transparent url('droplist-icon.png') no-repeat scroll 0 center;
	display:inline-block;
	width:16px;
	height:16px;
	margin-right:5px;
	vertical-align:top;
}
.droplist-items tr:hover .droplist-icon{
	background-position:-17px center;
}
.droplist .droplist-header{
	border-bottom:1px #e5e5e5 solid;
}
.droplist-header th{
	background-color:#efefef;
	color:#777777;	
	font-weight:normal;
	font-size:1.2em;
	text-align:left;
}
.droplist .ui-pagination{
	background-color:#eff3f8;
	padding:5px;
	text-align:right;
}
.droplist .ui-pagination-pageinfo{
	*width:100%;
}
.droplist .ui-pagination-pageinfo > span{
	color:#ffffff;
	background-color: #2283c5;
	border-color: #2283c5;
	margin:0px 0px 0px 5px;
	padding:0px;
	line-height:14px;
	height:16px;
	width:16px;
	text-align:center;
}
.droplist .ui-pagination-pageinfo > span [class*="icon"]{
	margin-right:0px;
	line-height:16px;
	vertical-align:baseline;
}
.droplist .ui-pagination-pageinfo > span:hover{
	background-color: #045e9f;
}
.droplist .ui-pagination-pageinfo span.disabled,
.droplist .ui-pagination-pageinfo span:hover.disabled{
	border-color: #d3dce8;
	background-color: #d3dce8;
	color:#ffffff;
}

.grid-row-fluid {
    width: 100%; 
}
.grid-row-fluid:before, .grid-row-fluid:after {
    content: "";
    display: table;
    line-height: 0;
}
.grid-row-fluid:after {
    clear: both;
}
.grid-row-fluid [class*="span"] {
    display: block;
    float: left; 
    width: 100%;
}
 .grid-layout-label {
	color: #707c92;
	font-size: 1.6em;
	margin-bottom: 0;
	font-weight: normal;
	line-height: 30px;
	height: 30px;
	display: block;
	text-align: left;
}
.grid-layout-content {
    color: #1e1e1e;
    word-break: break-all;
    word-wrap: break-word;
}  
input[type="text"]{
    background-color: #f4f4f4;
    border-radius: 0 !important;
    border-width: 1px;
    box-shadow: none;
    transition-duration: 0.1s;
}
.ui-input {
    background-color: #f4f4f4;
    border: 1px solid #e5e5e5;  
	border-radius: 4px;
    padding: 4px 6px;
}
.ui-input input {
    border: 0 none;
    padding: 0;
    vertical-align: top;
    width: 100%;
    font-size: 1.78em;
} 
input[type="text"]{
    border-radius: 4px;
    color: #555555;
    display: inline-block; 
    height: 32px;
    line-height: 32px; 
}
.ui-input-focus,.ui-select-focus{ 
    box-shadow: #666028;
    color: #838182;
} 
.ui-select,.droplist{
font-size: 1.54em; 
}
.button-wrap {  
    width: 100%;
}  
.grid-row-fluid .tip{
	color: #afa6dd;
	font-size: 1.425em;
	margin-top: 0.42em;
}
.errorTip{
	font-size: 1.425em;
	margin-top: 0.42em;
	color:#fb451f;	
} 
</style>
<body> 
	<div id="freeOrder" class="ui-widget"> 
			<header style="position:relative;">
		 		<img src = "subway-header.png"/>  
		 	</header> 
			<div class="search-wraper">
				<section style="margin:0 5.6em;" class="select-wraper"> 
					 <div class="grid-row-fluid">
						 <label class="span5 grid-layout-label">起点：</label>
						 <div class="span18 grid-layout-content">
							   <div id="originLine" class="jrad-select-container"></div>
							   <div id="origin" class="jrad-select-container"></div>
						 </div>
					</div>
					<div class="grid-row-fluid">
						 <label class="span5 grid-layout-label">终点：</label>
						<div class="span18 grid-layout-content">
							   <div id="destinationLine" class="jrad-select-container"></div>
							   <div id="destination" class="jrad-select-container"></div>
						</div>
					</div>  
					<p class="errorTip" id="error"></p>
				</section>  
				<div class="button-wrap" style="margin:3.6em 0 3.3em;">
					<a class="btn search" href="javascript:void(0)">查看一下我的交通成本</a>
				</div> 
			</div>
			<div class="share-wraper" style="display:none;">
				<div class="info"></div> 
				<div class="button-wrap" style="margin:3.6em 0 3.3em;">
					<a class="btn bt_transmit" href="javascript:void(0)">转发朋友圈告诉小伙伴们～</a>
				</div>
			</div>
			<div class="button-wrap" style="margin:0 0 3.3em;">
				<a class="btn blue" href="http://d.yangchebao.com.cn?cid=dt" style="">下载养车宝立刻省钱！</a>
			</div>		
		
	</div> 
	<script src="js/jquery-1.9.1.min.js"></script>
	<script src="js/jquery.json-2.2.js"></script>  
	<script src="js/ui.select.min.js"></script>
	<script src="js/wx.js"></script>
  	<script type="text/javascript">  
	var shareTitle = '赶紧进来查一查，地铁涨价后，你每天多花多少钱！';
    var descContent = "我每年要为北京交通贡献几千元，我（qu）心（ni）甚（mei）慰（de），你呢？";
    var imgUrl = 'http://www.yangchebao.com.cn/subway/sq.png';
    var lineLink = "http://www.yangchebao.com.cn/subway/subway.html";
	var redirectUrl = "http://www.yangchebao.com.cn/subway/subway.html";

	$(document).ready(function(){ 
		var lineList = [{"id":"1","name":"1号线"},
					{"id":"2","name":"2号线"},
					{"id":"3","name":"4号线"},
					{"id":"4","name":"5号线"},
					{"id":"5","name":"6号线"},
					{"id":"6","name":"8号线"},
					{"id":"7","name":"9号线"},
					{"id":"8","name":"10号线"},
					{"id":"9","name":"13号线"},
					{"id":"10","name":"14号线"},
					{"id":"11","name":"15号线"},
					{"id":"12","name":"八通线"},
					{"id":"13","name":"昌平线"},
					{"id":"14","name":"亦庄线"},
					{"id":"15","name":"房山线"},
					{"id":"16","name":"机场线"},
					{"id":"17","name":"大兴线"}];
		var state = [{"id":"1","name":"苹果园"},{"id":"2","name":"古城"},{"id":"3","name":"八角游乐园"},{"id":"4","name":"八宝山"},{"id":"5","name":"玉泉路"},{"id":"6","name":"五棵松"},{"id":"7","name":"万寿路"},{"id":"8","name":"公主坟"},{"id":"9","name":"军事博物馆"},{"id":"10","name":"木樨地"},{"id":"11","name":"南礼士路"},{"id":"12","name":"复兴门"},{"id":"13","name":"西单"},{"id":"14","name":"天安门西"},{"id":"15","name":"天安门东"},{"id":"16","name":"王府井"},{"id":"17","name":"东单"},{"id":"18","name":"建国门"},{"id":"19","name":"永安里"},{"id":"20","name":"国贸"},{"id":"21","name":"大望路"},{"id":"22","name":"四惠"},{"id":"23","name":"四惠东"}] ;
		$(".share").click(function(){
			shareTimeline();
		});
		$("#originLine").select({
			data:lineList,
			onchange:function(val){ 
				getState(val,"origin"); 
			}
		}); 
		$("#origin").select({
			data:state
		}); 
		$("#destinationLine").select({
			data:lineList,
			onchange:function(val){ 
				getState(val,"destination"); 
			}
		}); 
		$("#destination").select({
			data:state
		}); 

		$('.search').on('click',function(){
			var origin = $("#origin").select("val");
			var destination = $("#destination").select('val');
			if(origin==null||destination==null){
				alert("不要搞笑，你确定你需要地铁么？");
				return;
			}
			if(origin!=destination) {  
				$.ajax({ 
					url:'/yangchebao-pubinfo-ws/ws/0.1/common/get/subway/result?startId='+origin+'&endId='+destination,
					dataType: 'json',
					success:function(data){  
						var arr = data.distanceOut.split("，"); 
						var msg = arr[2].split("单程需");
						var priceNum = data.price.split("多花")[1]; 
						var str = "<p>"+arr[0]+",涨价后单程需要<span>"+msg[1]+"</span>。</p>";
						var str2 = "<p>您的交通成本（往返）每年将增加<span>"+priceNum+"</span>。</p>";
						shareTitle = "地铁涨价啦，每年多为祖国贡献"+ priceNum+"！求超越！求碾压！";
						$(".info").html(str+str2);
						$(".search-wraper").hide();
						$(".share-wraper").show();
					}
				});

			}else {
				alert("不要搞笑，你确定你需要地铁么？")
			}
			return false;
		});
	    function getState(num,name){ 
			$.ajax({
				url:"json/"+num+".json",
				dataType: 'json',
				success:function(resp){
					var state2 = resp.data;
					$("#"+name).select({
						data:state2,
						val:''
					}); 
				}
			}); 
		} 
		 
	});  

var appid = 'wx9f69650fc31578c1';
function shareFriend() {
    WeixinJSBridge.invoke('sendAppMessage',{ 
    	  					"appid": appid,
                            "img_url": imgUrl,
                            "img_width": "640",
                            "img_height": "640",
                            "link": lineLink,
                            "desc": descContent,
                            "title": shareTitle
                            }, function(res) {
                            if(redirectUrl != "undefined") {
                                window.location.href = redirectUrl;
                            }
                            _report('send_msg', res.err_msg);
                            })
}
function shareTimeline() {
    WeixinJSBridge.invoke('shareTimeline',{
                            "img_url": imgUrl,
                            "img_width": "640",
                            "img_height": "640",
                            "link": lineLink,
                            "desc": descContent,
                            "title": shareTitle
                            }, function(res) {
                             if(redirectUrl != "undefined") {
                                window.location.href = redirectUrl;
                             }
                            _report('timeline', res.err_msg);
                            });
}
function shareWeibo() {
    WeixinJSBridge.invoke('shareWeibo',{
                            "content": descContent,
                            "url": lineLink,
                            }, function(res) {
                            _report('weibo', res.err_msg);
                            });
}
//当微信内置浏览器完成内部初始化后会触发WeixinJSBridgeReady事件。
document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {

    WeixinJSBridge.call('showOptionMenu');

        // 发送给好友
        WeixinJSBridge.on('menu:share:appmessage', function(argv){
            shareFriend();
            if (window._T) {
                _T.sendEvent('wx-share-friend');
            }

            });

        // 分享到朋友圈
        WeixinJSBridge.on('menu:share:timeline', function(argv){
            shareTimeline();
            if (window._T) {
                _T.sendEvent('wx-share-timeline');
            }
            });

        // 分享到微博
        WeixinJSBridge.on('menu:share:weibo', function(argv){
            shareWeibo();
            if (window._T) {
                _T.sendEvent('wx-share-weibo');
            }
            });
        }, false);
</script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F0630ae8610f91262c0d43c6bc40fd12b' type='text/javascript'%3E%3C/script%3E"));
</script>
</body> 
</html>

