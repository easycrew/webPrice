<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="black" name="apple-mobile-web-app-status-bar-style" />
	<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script>
	<title></title>
</head>
<style type="text/css">
body{
	background-color:#f4f7f8;  
	color:#1e1e1e;
	font-family:'冬青黑体','黑体','HelveticaNeue-Light';
	font-size:62.5%;
} 
a{
	color:#00a0e9;
	text-decoration: none;
}
a:focus{
	outline:none;
}
ul{
	list-style:none;
}
img{
	border:none;
}
*{
	margin:0;
	padding:0;
	text-shadow:none;
}
.clearfix {
  *zoom: 1;
}
.clearfix:before,
.clearfix:after {
  display: table;
  line-height: 0;
  content: "";
}
.clearfix:after {
  clear: both;
}
.list-module-pic h3 {
    font-size: 1.4em; 
    font-weight: normal; 
    min-height: 1.67em;
} 
.list-module-pic .info {
    color: #323232;
    font-size: 1.2em;
    line-height: 150%;
    margin: 0;
}
.list-module-pic{
	background-color:#f4f7f8;
}
.list-module-pic li {
    border-bottom: 1px solid #c2c2c6;
    padding: 2.1em 1em;
	background-color: #fff;
    margin-top: 1em;
    position: relative;
} 
.list-module-pic .pic {
    float: left;
    height: 6em; 
    width: 8.2em;
    position: relative;
}
.list-module-pic .pic img {
    display: block;
    height: 6em;
    width: 8.2em;
} 
.list-module-pic .pic + div {
    margin-left: 9.5em;
}
.distanceLabel {
    background-color: #fb451f;
    color: #fff;
    display: inline-block;
    float: right;
    font-size: 1em;
    height: 1.1em;
    line-height: 1.1em;
    margin-right: -0.7em;
    padding: 0 1em 0 0.6em;
}
.coupon-icon{
	width: 27px;
	height: 27px;
	background-image: url("http://app.yangchebao.com.cn/group1/M00/0A/E8/ChUBl1VtUuGAZjfFAAAHbdITZFY198.png");
	background-size: 27px auto;
    background-repeat: no-repeat;
	position: absolute;
	left: 5px;
	top:5px;
	z-index: 1;
}
.grade-icon{
	height: 15px; 
	background-color: rgba(0,0,0,0.6);
	width: 100%;
	position: absolute;
} 
.grade-icon .icon {
    background-image: url("http://app.yangchebao.com.cn/group1/M00/0A/E4/ChUBl1VsRlaAWP36AAAQ2kKWVRI237.png");
    background-repeat: no-repeat;
    background-size: 4.5em auto;
    display: inline-block;
    height: 1.5em;
    margin-left: 0.313em;
    vertical-align: middle;
    width: 1.6em;
}
.grade-icon .icon-zf {
    background-position: -3.2em 0;
}
.grade-icon .icon-hzsj {
    background-position: -1.6em 0;
}
.fr {
    float: right;
}
.title{
	font-size: 1.5em;
	height: 38px;
	line-height: 38px;
	background-color: #fff;
	padding: 0 10px;
	border-bottom: 1px solid #c2c2c6;
	font-weight: normal;
    position: relative;
    z-index: 101;
} 
.arrow {
    border-right: 2px solid #d9d9e2;
    border-top: 2px solid #d9d9e2;
    display: inline-block;
    height: 8px;
    right: 10px;
    position: absolute;
    top: 15px;
    transform: rotate(135deg);
    -o-transform: rotate(135deg);
    -webkit-transform: rotate(135deg);
    -moz-transform: rotate(135deg); 
    width: 8px;
}  
.model-list{
    background-color: #fff;
    height: 0;
    overflow: auto;
    position: absolute;
    top: 3.9em;
    transition: height 0.3s ease-out 0s;
    width: 100%;
    z-index: 101; 
}
.two-list{
    width: 50%;
    border-right: 1px solid #d9d9e2;
    box-sizing: border-box;
} 
.two-list li{
  background-color:#f1f3fc;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
} 
.sub-wrap{ 
    background-color: #fff;
    height: 0;
    overflow: auto; 
    transition: height 0.3s ease-out 0s;
    width: 50%;  
    position: absolute;
    top: 3.9em;
    left: 50%;
    z-index: 102;
} 
.sub-list{
    display: none;
}
.sub-list.current{
	display:block;
}
.model-list li,.sub-list li {
    border-bottom: 1px solid #d9d9e2;
    cursor: pointer;
    font-size: 1.5em;
    height: 38px;
    line-height: 38px;
    padding: 0 10px;
}  
.model-list li.selected,.sub-list li.selected{
	background-image: url("http://app.yangchebao.com.cn/group1/M00/0A/F5/ChUBl1VxCAyAHLr9AAACNlXa_ys717.png");
    background-repeat: no-repeat;
    background-size: 23px auto; 
    background-position:right center;
}
.two-list li.selected{
  background-color:#fff;
  background-image:none;
}
.model-list.open {
    height: 80%;
}
.sub-wrap.open {
    height: 80%;
}
.overlay-wrap {
    background-color: rgba(0, 0, 0, 0.6);
    bottom: 0;
    display: none;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 100;
}
.star{
    background-image: url('http://app.yangchebao.com.cn/group1/M00/0A/E4/ChUBl1VsQAiAbOI4AAATdA8-PgQ921.png') ;
    background-repeat: no-repeat;
    background-size:85px auto;
    display:inline-block;
    height:12px;
    width:85px;
    margin-top: 4px;
}
.star-45{
    background-position:0 -1.8em;
}
.star-40{
    background-position:0 -3.55em;
}
.star-35{
    background-position:0 -5.3em;
}
.star-30{
    background-position:0 -7.04em;
}
.star-25{
    background-position:0 -8.8em;
}
.star-20{
    background-position:0 -10.56em;
}
.star-15{
    background-position:0 -12.3em;
}
.star-10{
    background-position:0 -14.04em;
}
.star-05{
    background-position:0 -15.8em;
}
.star-00{
    background-position:0 -17.6em;
}
.tip {
    color: #a0a097;
    cursor: pointer;
    display: none;
    font-size: 1.5em;
    padding: 10px;
    text-align: center;
}
.null-tip::before {
    border-bottom: 1px solid #cfd1db;
    content: "";
    display: inline-block;
    margin-right: 0.5em;
    vertical-align: middle;
    width: 2.4em;
}
.null-tip::after {
    border-bottom: 1px solid #cfd1db;
    content: "";
    display: inline-block;
    margin-left: 0.5em;
    vertical-align: middle;
    width: 2.4em;
}
.null-tip {
    color: #cfd1db;
    font-size: 1.8em;
    margin-top: 2.78em;
    text-align: center;
    display: none;
}
.over-hide{
    height:100%;
	overflow:hidden;
}
</style>
</head>
<body>  
<h1 class="title"><span id="serviceName">选择服务</span><span class="arrow"></span></h1>
<ul id="dropList" class="model-list">  
</ul>
<article class="sub-wrap">
<!-- <ul class="sub-list">
    <li>洗车</li>
    <li>洗车</li>
</ul> -->
</article> 
<div class="overlay-wrap"></div>
<ul class="list-module-pic">
	<!-- <li class="clearfix" shopid="93278">
	    <span class="coupon-icon"></span>
		<div class="pic"> 
			<p class="grade-icon">
				<span class="icon icon-zf fr"></span>
				<span class="icon icon-sdrz fr"></span>
				<span class="icon icon-hzsj fr"></span>
			</p>
			<img src="http://app.yangchebao.com.cn/group1/M00/0A/A2/ChUBl1VdqZGAcnbLAACZaa1lFwM466.jpg"/> 
            <span class="star"></span>
		</div>
		<div>
		<h3><span class="tit">车车翔平度店</span><span class="distanceLabel">100km</span></h3>
		<p class="info">上海市浦东新区平度路108-116号、浦东新区平度路108号</p>
		<p class="info">关注：100&nbsp;&nbsp;&nbsp;&nbsp;好评率：100%</p>
		</div>
	</li>  -->
</ul> 
<p class="null-tip">没有找到符合条件的商家</p> 
<p class="tip">点击查看更多</p>
<script type="text/javascript">
	$(document).ready(function(){
		 var currentSubId = "",currentSubId=""; 
		 var url =window.location.search;   
         var paramJson = {};
         if(url!=undefined&&url!=""){
         var paramsArr = (url.split("?")[1]).split("&"); 
         $.each(paramsArr,function(i){
          var item = paramsArr[i].split("=");
          paramJson[item[0]] = item[1];
         });    
        } 
        var pid = paramJson.service;  
        if(pid=="1"){
           document.title = "洗车";
        }else if(pid=="2"){
           document.title = "美容";
        }else if(pid=="3"){
           document.title = "保养";
        }else if(pid=="4"){
           document.title = "维修";
        }
		paramJson.serviceId = paramJson.service;
		if(paramJson.subService!=undefined&&paramJson.subService!=""){
			paramJson.serviceId = paramJson.subService;
		} 
        $("li").click(function(){
			window.location.href = "http://w2l?shopid="+$(this).attr("shopid");
		});
		$('.title').on('click',function(){
		    $("body").addClass("over-hide");
			$('.overlay-wrap').toggle();
			$('#dropList').toggleClass('open');
			$('#dropList li').removeClass("selected");
			$('.sub-wrap li').removeClass("selected");
            if($('#dropList').hasClass("two-list")){
                $('.sub-wrap').toggleClass('open');
				$("#left-"+currentId).addClass("selected");
				$("#sub-"+currentId).show();
				if(currentSubId==""){
				  $("#sub-"+currentId).find("li:first-child").addClass("selected");
				}else{
				  $("#li-"+currentSubId).addClass("selected");
				}
            } 
		});
		$('#dropList').on('click','li',function(){ 
			if($('#dropList').hasClass("two-list")&&$("#sub-"+$(this).attr('serviceid')).length>0){ 
                $(".sub-list").hide();
                $("#sub-"+$(this).attr('serviceid')).show();
				$("#sub-"+$(this).attr('serviceid')).children("li").removeClass("current");
				$('#dropList li').removeClass("selected");
			    $(this).addClass("selected");
            }else{
				$('#dropList li').removeClass("selected");
			    $(this).addClass("selected");
    			$('.overlay-wrap').hide();
    			$('#dropList').removeClass('open');
                $('.sub-wrap').removeClass('open');
				$("body").removeClass("over-hide");
    			$("#serviceName").html($(this).html());
                paramJson.serviceId = $(this).attr('serviceid');
                pageindex = 0;
                $(".list-module-pic").html("");
                getShopList();
            }
	  }); 
      $(".sub-wrap").on("click",'li',function(){
            $('.overlay-wrap').hide();
            $('#dropList').removeClass('open');
            $('.sub-wrap').removeClass('open');
			$("body").removeClass("over-hide"); 
            paramJson.serviceId = $(this).attr('serviceid');
            pageindex = 0; 
			$(".null-tip").hide();
			$(".tip").hide();
			$(".list-module-pic").html("");
			$('.sub-list li').removeClass("selected");
			$(this).addClass("selected"); 
			currentId = $(this).attr('pid');
			currentSubId = $(this).attr('serviceid'); 
			 $("#serviceName").html($("#left-"+currentId).html());
            getShopList();
      });
	  $('.overlay-wrap').click(function(){
		    $('.overlay-wrap').hide();
            $('#dropList').removeClass('open');
            $('.sub-wrap').removeClass('open');
			$("body").removeClass("over-hide");
	  });
      $(".tip").click(function(){
        getShopList();
      });
      $(".list-module-pic").on("click","li",function(){  
		if($(this).hasClass("coupon")){
		  window.location.href = "http://w2nw?http://10.23.31.151/yangchebao-oc/yibin/shop-detail.html?shopId="+$(this).attr("shopid");  
		}else{
		  window.location.href = "http://w2l?shopid="+$(this).attr("shopid");
		} 
      });
      var pageindex = 0;
      getShopList();
      getServiceList();
      function getShopList(){  
          $.ajax({
              url: '/yangchebao-app-ws/ws/0.1/coupon/business/page?areaName='+paramJson.cityName+'&modelId='+paramJson.modelId+'&serviceId='+paramJson.serviceId+'&lon='+paramJson.lon+'&lat='+paramJson.lat+'&pagesize=10&pageindex='+pageindex,
              type: 'get', 
              dataType: 'json',
              success: function(data) {   
                  if((data.page+1)<data.totalPages){
                    $(".tip").show();
                  } else{
                    $(".tip").hide();
                  } 
                  pageindex++; 
                  var items = data.items;
                  if(items.length=="0"){
                    $(".null-tip").show();
                  }
                  $.each(items,function(i){
                    var item = items[i]; 
                    var className = "";
                    if(item.level!=undefined&&item.level!=""){
                        var score = parseInt(item.level)/2*10;
                        className = "star-"+score; 
                    }else{
                        className="start-00";
                    }
                    var _p = "",cooperationStr = "";
                    if(item.cooperation=="2"||item.cooperation=="3"||item.cooperation=="4"){ 
                        cooperationStr = '<span class="icon icon-sdrz fr"></span>'
                                        +'<span class="icon icon-hzsj fr"></span>';
                        if(data.cooperation=="2"){ 
                        cooperationStr = '<span class="icon icon-hzsj fr"></span>';
                        } 
                    }else{
                        cooperationStr = "";
                    } 
                    if(item.onlinePayStatus=="1"){//0. 不支持；1.支持；
                         cooperationStr +='<span class="icon icon-zf fr"></span>';
                    } 
                    if(cooperationStr!=""){
                        _p = '<p class="grade-icon">'
                            +cooperationStr    
                            +'</p>'; 
                    }
                    var iconStr = "",iconClass="";
                    if(item.hasCouponPrice=="1") {//商家是否支持抵用券 0：不支持  1：支持
                        iconStr = '<span class="coupon-icon"></span>';
                        iconClass=" coupon";
                    }
                    var _li = '<li class="clearfix'+iconClass+'" shopid="'+item.id+'">'
                            + iconStr
                            +'<div class="pic"> '
                            +_p
                            +'    <img src="'+item.logo+'"/> '
                            +'    <span class="star '+className+'"></span>'
                            +'</div>'
                            +'<div>'
                            +'<h3><span class="tit">'+item.name+'</span><span class="distanceLabel">'+item.distance+'</span></h3>'
                            +'<p class="info">'+item.address+'</p>'
                            +'<p class="info">关注：'+item.attentionNumber+'&nbsp;&nbsp;&nbsp;&nbsp;好评率：'+item.totalGoodRatio+'</p>'
                            +'</div>'
                        +'</li> ';
                    $(".list-module-pic").append(_li);
                  }); 
              },error:function(xhr){  
              }
          });  
      } 
	  var currentSubId = "",currentSubId="";
      function getServiceList(){  
          $.ajax({
              url: '/yangchebao-app-ws/ws/0.1/shop/service/v3?id='+paramJson.serviceId+'&areaName='+paramJson.cityName,
              type: 'get', 
              dataType: 'json',
              success: function(data) { 
                var items = data.items;
                var twoList = false;
                $.each(items,function(i){
                    var item = items[i];
					var _li = '<li serviceid="'+item.id+'" id="left-'+item.id+'">'+item.name+'</li>'; 
					if(item.id==paramJson.serviceId){
					   _li = '<li serviceid="'+item.id+'" class="selected" id="left-'+item.id+'">'+item.name+'</li>'; 
					} 
                    $("#dropList").append(_li);
                    if(item.subService!=undefined){
                        twoList = true;
                        var subService = item.subService;
                        var _ul = '<ul class="sub-list" id="sub-'+item.id+'">';
						if(item.id==paramJson.serviceId){
						   _ul = '<ul class="sub-list current" id="sub-'+item.id+'">';
						   currentId = item.id;
						} 
                        $.each(subService,function(j){
                            var sub = subService[j];
                            _ul+='<li serviceid="'+sub.id+'" pid="'+item.id+'" id="li-'+sub.id+'">'+sub.name+'</li>';
                        });
                        _ul+="</ul>";
                        $(".sub-wrap").append(_ul);
                    }
                });
                if(twoList){
                    $("#dropList").addClass("two-list");
                }
              },
              error:function() {}
          });
      }
	});
</script>
</body>
</html>