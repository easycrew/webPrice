<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="format-detection" content="telephone=no" />
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js "></script>
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js "></script>  
<title>订单确认</title>
</head>
<style type="text/css">
*{
padding: 0;
margin: 0;
}
body{
    color: #1e1e1e;
    font-family: "冬青黑体","黑体","HelveticaNeue-Light";
    font-size: 62.5%;
    background-color: #f4f7f8;
} 
a,a:hover{
    text-decoration: none;
    outline: none;
}
img,button {
    border:none;
}
ul,ol{
    list-style: none;
}
.header {
    position: relative;
}
.header img {
  display: block;
  width: 100%;
} 
.text-align-middle section {
    background-color: #fff;
    margin-bottom: 1em;
}
.service-wrap, .carwash-wrap, .want-wrap, .news-wrap, .group-buying-wrap {
    background-color: #fff;
}
.service-wrap {
    height: auto;
    overflow: auto;
    padding: 9px 0 7px;
}
.clearfix::before, .clearfix::after {
    content: "";
    display: table;
    line-height: 0;
}
.clearfix::after {
    clear: both;
}
.clearfix::before, .clearfix::after {
    content: "";
    display: table;
    line-height: 0;
} 
.order-wrap h1{
  font-size: 1.6em;
  color: #fff; 
  padding: 10px;
  background-color: #ffa600;
  min-height: 3.25em;
  vertical-align: middle;
  line-height: 150%;
  font-weight: normal;
}  
.shop,.user{
  padding: 1.43em 0.71em 0 4.17em;  
  background-color: #fff; 
  border-bottom: 1px solid #d9d9e2;
  font-size: 1.4em; 
}
.shop p,.user p{ 
  line-height: 150%;
  padding: 0 0 1.43em 0.71em;  
  color: #1e1e1e; 
  font-size: 1em;
  border-left: 1px solid #d9d9e2;
}
.shop{
 background-size: auto 2.4em;
 background-image: url(http://app.yangchebao.com.cn/group1/M00/09/6D/ChUBl1UrLxeAX5DKAAAETSIODUE147.png);
 background-repeat:no-repeat;  
 background-position:21px center;
}
.user{
 background-size: auto 2.4em;
 background-image: url(http://app.yangchebao.com.cn/group1/M00/09/6D/ChUBl1UrLzeAUgHHAAADkhmE2Vk644.png);
 background-repeat:no-repeat;  
 background-position:21px center;
}
.comment{
  font-size: 1.4em;
  color: #6eaade;
  margin:40px 25px;
  background-color: #e2f0f6;
  border: 1px solid #6eaade;
  border-radius: 5px;
  padding:18px;
  position: relative; 
} 
footer{
  border-top:1px solid #fda28f;
  position: fixed;
  bottom: 0;
  width: 100%;
  z-index: 10;
  background-color: #fff;
}
.button{ 
  margin: 11px 10px;
  font-size: 1.6em;
  height: 2em;
  line-height: 2em;
  text-align: center;
  color: #fff;
  display: block;
  cursor:pointer;
  background-color: #fb451f;
}
.point{
  color: #fb451f;
}
.blue{
  background-color: #6eaade;
}
.two-btn{
  height: auto;
  overflow: auto;
}
.two-btn>div{
 width: 50%;  
 float: left;
} 
.two-btn .left .button{
 margin-right: 5px;
}
.two-btn .right .button{
 margin-left: 5px;
}
.button.white{
 background-color: #fff;
 border: 1px solid #fb451f;
 color: #fb451f;
 margin-top: 0;
}
.two-btn .left p{
  font-size: 1.3em;
  height: 32px;
  vertical-align: middle;
  margin: 11px 0px 11px 10px;
}
.dialog{
  position: fixed;
  width: 100%;
  height: 100%; 
  background-color: rgba(0,0,0,0.4);
  top:0;
  bottom: 0;
  z-index:11;
}
.dialog>div{ 
  margin: 100px 10px 0;
  background-color: #fff; 
  height: auto;
  overflow: auto;
}
.dialog h1{
  height: 33px;
  text-align: center;
  border-bottom: 1px solid #fb451f;
  font-size: 1.7em;
  line-height: 33px; 
  color: #fb451f;
  font-weight: normal;
} 
.dialog p{
  padding: 20px;  
  font-size: 1.6em;
  line-height: 150%; 
  color: #lelele;
  font-weight: normal;
} 
.dialog .dialog-btn{
  font-size: 1.6em;
  color: #fff;
  background-color: #fb451f;
  display: block;
  height: 34px;
  line-height: 34px;
  text-align: center;
  cursor: pointer;
}
.dialog .left{
  margin: 0 9px 17px 27px;
}
.dialog .right{
  margin: 0 27px 17px 9px;
  background-color: #c2c2c6;
}
</style>
<body> 
<section class="order-wrap">   
     <h1>服务内容：<span id="serviceName">洗车</span><br/>价格：<span class="price"></span></h1>
     <article>
       <div class="shop">
            <p><span id="businessName"></span><br/>
          <span id="businessAddress"></span></p>
        </div>
        <div class="user"><p><span id="nickName"></span><br/><span id="mobile"></span></p></div>
     </article>
     <div id="commentWrap" style="padding-bottom:90px;display:none;">
       <article class="comment">
          <p>抵用券金额：<span class="point coupon">￥55</span> </p>
          <p>支付后余额：<span class="point" id="balance">￥50</span></p>
          <!-- <p>请选择如何支付现金部分：</p> -->
       </article>
     </div>
     <footer id="topayWrap" style="display:none;">
        <div class="button-wrap"> 
          <div class="left">
              <div class="button blue" id="topayBtn">支付宝支付<span class="couponCashPrice"></span></div>
          </div> 
          <!--div class="right two-btn">
              <div class="button" id="topayWXBtn">微信支付<span class="couponCashPrice"></span></div>
          </div--> 
       </div> 
	   <div class="button white cashPay">我要洗完车直接支付<span class="couponCashPrice"></span>给商家</div>
     </footer>
    <footer id="rechargeWrap" style="display:none;">
        <div class="button-wrap two-btn"> 
           <div class="left"><p>抵用券余额：<span class="point coupon">¥90</span><br/>不足以支付,请立即充值</p></div>
           <div class="right"><div class="button" id="rechargeBtn">立即充值</div></div>
        </div>  
     </footer>
</section>  
<div class="dialog" style="display:none;">
      <div>
        <h1>提示</h1>
        <p class="info"> </p>
        <div class="btn-wrap"> 
           <div class="dialog-btn left">关闭</div>
        </div>
      </div>
</div>  
<script type="text/javascript">
     $(document).ready(function(){
      var url =window.location.search;  
      var paramJson = {};
      if(url!=undefined&&url!=""){
        var paramsArr = (url.split("?")[1]).split("&"); 
        $.each(paramsArr,function(i){
         var item = paramsArr[i].split("=");
         paramJson[item[0]] = item[1];
        });    
      }    
      reserve();    
      function reserve(){ 
          var postData = {};
          postData.customerId = paramJson.customerId;
          postData.sourceId = paramJson.sourceId;
          postData.itemType = paramJson.itemType;  
          $.ajax({
            url: '/yangchebao-app-ws/ws/0.1/coupon/reserve',
            contentType : "application/json;charset=utf-8",
            dataType : "json",
            type : "POST",
            data : $.toJSON(postData), 
            success: function(data) {    
                 paramJson.mcoupon = data.coupon-data.couponPrice;
                 paramJson.mcash = data.couponCashPrice;
                 $("#serviceName").html(data.serviceName);
                 $(".price").html(data.couponPrice+"元抵用券+"+data.couponCashPrice+"元现金");
                 $("#businessName").html(data.businessName);
                 $("#businessAddress").html(data.businessAddress);
                 $("#nickName").html(data.nickName);
                 $("#mobile").html(data.mobile);
                 $(".coupon").html("￥"+data.coupon);
                 $("#balance").html("￥"+(parseInt(data.coupon)-parseInt(data.couponPrice))); 
                 $(".couponCashPrice").html(data.couponCashPrice+"元"); 
                 if(data.couponPrice>data.coupon){
                   $("#rechargeWrap").show(); 
                 }else{
                   $("#topayWrap").show();
                   $("#commentWrap").show(); 
                 }  
              },error:function(xhr){  
              }
          });  
      } 
       $("#rechargeBtn").click(function(){
          registryOnline();
      }); 
      function registryOnline(){  
         var postData = {};
          postData.customerId = paramJson.customerId;
          postData.payChannelKey = "alipay.wap.wallet";
          postData.couponDinnerId = "1";  
          $.ajax({
            url: '/yangchebao-app-ws/ws/0.1/coupon/rechargeOnline',
            contentType : "application/json;charset=utf-8",
            dataType : "json",
            type : "POST",
            data : $.toJSON(postData),
            async : false,
            success: function(data) {   
              if(data.payUrl!=""){
                window.location.href = data.payUrl;
              }
            },
            error:function(xhr){ 
              var mes = eval('('+xhr.responseText+')');  
            }
          });  
      }
	$("#topayBtn").click(function(){ 
          //window.location.href = 'http://w2l/?presentType=1&needLogin=1&androidName=29&iosName=MyWebViewController&sourceId='+paramJson.sourceId+'&itemType='+paramJson.itemType+'&fromChannel=coupon&payChannel=3';
		  topay(); 
    });   
	   /** $("#topayWXBtn").click(function(){  
			 // window.location.href = 'http://w2l/?presentType=1&needLogin=1&androidName=29&iosName=MyWebViewController&sourceId='+paramJson.sourceId+'&itemType='+paramJson.itemType+'&fromChannel=coupon&payChannel=1';
			  //payChannel 1（微信支付）、2（百度钱包）、3（支付宝）、4（支付宝信用卡）、5（支付宝银行卡）、6（代金券支付）
		});**/   
      $(".cashPay").click(function(){  
		  topay("cash"); 
      });   
      $(".dialog .left").click(function(){
         $(".dialog").hide();
          window.location.href = 'http://app.yangchebao.com.cn/yangchebao-app-ws/ws/0.1/urlMapper/rot/02988399?mcoupon='+paramJson.mcoupon+'&mcash='+paramJson.mcash;
      });
      function topay(type){    
         var postData = {}; 
          postData.customerId = paramJson.customerId;
          postData.sourceId = paramJson.sourceId;
          postData.itemType = paramJson.itemType; 
          postData.payChannelKey = "alipay.wap.wallet"; 
          postData.payType = "1";   
		  if(type=="cash"){
		  postData.payChannelKey = "face.2.face";
		  }		
          $.ajax({ 
            url: '/yangchebao-app-ws/ws/0.1/coupon/topay', 
            contentType : "application/json;charset=utf-8", 
            dataType : "json", 
            type : "POST", 
            data : $.toJSON(postData), 
            async : false, 
            success: function(data) {  
              if(data.payUrl!=undefined&&data.payUrl!=""){ 
                window.location.href = data.payUrl; 
              }else{
			     $(".dialog .info").html(data.message);
			     $(".dialog").show();
			  }
            }, 
            error:function(xhr){ 
              var mes = eval('('+xhr.responseText+')');     
            } 
          });   
      }
   });
</script> 
</body>
</html>