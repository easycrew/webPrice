<!doctype html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>公正的第三方检测</title>  
    <!-- <link href="favicon.ico" rel="shortcut icon"/>   -->
    <script language="javascript" src="./js/jquery-1.10.1.min.js"></script> 
	<script language="javascript" src="./js/jquery.json-2.2.js"></script> 
	<link href="date/mobiscroll.custom-2.13.2.min.css" rel="stylesheet" type="text/css" />
	<script src="date/mobiscroll.custom-2.13.2.min.js" type="text/javascript"></script>
</head>
<style type="text/css">
  body{
	font-family:'华文细黑','HelveticaNeue-Light';
	font-weight:normal;
	font-style:normal;
	line-height:normal;
	font-size:62.5%;
	color:#1e1e1e;
	padding-bottom: 3em;
	-webkit-box-sizing:border-box;
	box-sizing:border-box;
}
body,html{
	min-height:100%;
}
a{
	text-decoration:none;
}
ul{
	list-style:none;
}
img{
	border:none;
}
*{
	margin:0;
	padding:0;
}
.clearfix {
   *zoom: 1;
}
.clearfix:before,
.clearfix:after {
   display: table;
   line-height: 0;
   content: "";
}
.clearfix:after {
  clear: both;
}
.y_btn{
	 background-color: #FF825F; 
     /*box-shadow: 2px 2px 3px rgba(0, 0, 0, 0.5); */
	-webkit-border-radius:5px;
	-moz-border-radius:5px;
	border-radius:5px;	
	color: #fff;
	font-size: 2.3em;
	display: block;
	text-align: center;
	height: 2.11em;
	line-height: 2.11em;
	padding: 0 1em;
	margin:0 0em 0.56em;
	cursor: pointer;
}  
div.share{
	background-color: #34CC89; 
}
.content-wrap{
	padding: 0em 1.4em;
	max-width: 640px;
	margin: 0 auto;
}
.content-wrap ul{
	margin: 3em 0;
}
.content-wrap li{
	margin-bottom: 0.8em;
}
.content-wrap label{
	font-size: 1.8em;
	color: #000;
	width: 2.78em;
	line-height:1.78em; 
	text-align: right;
	float: left;
}
.content-wrap li div{
	-webkit-box-sizing:border-box;
	-moz-box-sizing:border-box;
	box-sizing:border-box;
	margin-left: 5.5em;
}
.content-wrap li input,.content-wrap li select{
	border: 1px solid #DCDCE4;
	background-color: #ffffff; 
	-webkit-box-sizing:border-box;
	-moz-box-sizing:border-box;
	box-sizing:border-box;
	-webkit-border-radius:3px;
	-moz-border-radius:3px;
	border-radius:3px;
	font-size: 1.6em;
	width: 100%;
	height: 2em;
	line-height:1.25em; 
	padding:0.375em 0.5em;
}
.content-wrap .tips{
	color: #999999;
	font-size: 1.6em;
	margin-bottom: 1.875em;
}
.content-wrap .btn{
	margin:0;
}
.success-wrap{
	color:#009b53;
	text-align: center;
	position: absolute;
	top: 50%;
	width: 100%;
	margin-top: -8.8em;
}
.success-wrap h1{
	font-size: 3.6em;
	margin-bottom: 1em;
}
.success-wrap p{
	font-size: 1.6em;
}
.error{
	color: red; 
	font-size: 1.6em; 
	margin-bottom: 1em;
	display:none;
}
.activity_comment{  
    margin: 3em 0; 
    padding: 1em 0em;
    text-align: left; 
	color: #36545F;   
}
.activity_comment div{
	margin-bottom: 0.2rem;
}
.activity_comment span{
	float: left;
	display: inline-block;
	width: 1.2rem;
	font-size: 1.6em;
   line-height: 150%;
   color: #A2A2A2;
}
.activity_comment p{ 
   -webkit-box-sizing: border-box;
   -moz-box-sizing: border-box;
   box-sizing: border-box;
   margin-left: 1.2rem;
   font-size: 1.6em;
   line-height: 150%;
   color: #A2A2A2;
}
header img{
    width: 100%;
    display: block;
}
.success_pic img {
    display: block;
    margin: 0 auto 3em;
    max-width: 286px;
    padding-left:30px;
    width: 100%;
}
div.failReason{
	display: none;
	font-size: 2.7em;
	text-align: center;
}
#sharecover {
    background-color: rgba(0, 0, 0, 0.5);
    bottom: 0; 
    height: 100%;
    left: 0;
    position: fixed;
    right: 0;
    text-align: left;
    top: 0;
    width: 100%;
    z-index:9;
}
#sharecover img{
    width:100%;
}
div.dwo{
	position: fixed!important;
}
</style> 
<body>    
    <div class="content-wrap success_wrap" style="display:none;">
        <div class="success_pic">
            <img src="img/success.png" alt="恭喜申请成功"> 
        </div>  
        <div class="y_btn share" style="font-size:1.8em;">
            立即分享小伙伴
        </div> 
        <div class="activity_comment">
             <div><span>1. </span><p>养车宝客服将于2个工作日内与您电话联系，确认检测预约时间、地点及车辆信息；</p></div>
            <div><span>2. </span><p>完成检测后，检测技师将为您的爱车出据1份检测报告，并标明问题建议；</p></div>
            <div><span>3. </span><p>您关注养车宝微信公众号或下载养车宝客户端，可以收到爱车电子版检测报告，还能分享到朋友圈，提醒好友注意行车安全；</p></div>
            <div><span>4. </span><p>检测当天请您保持电话畅通，如超过预约时间仍无法与您取得联系，本次检测将被取消；</p></div> 
        </div>
    </div> 
    <div class="content-wrap edit_form_wrap">
        <div class="edit_form"> 
            <ul>
                <p class="error nError">&nbsp;</p> 
                <li><label>姓名</label><div><input type="text" id="realName"></div></li>
                <li><label>手机</label><div><input type="text" id="mobile"></div></li>
                <li><label>城市</label><div>
	                <select id="areaId"><option value="">请选择</option></select>
	                <select id="areaIdTwo" style="margin-top: 0.3em;"><option value="">请选择</option></select>
	                <select id="areaIdThree" style="margin-top: 0.3em;"><option value="">请选择</option></select>
                </div></li>
                <li><label>地址</label><div><input type="text" id="address"></div></li>
                <li><label>时间</label><div><input type="text" id="time"/></div></li>
            </ul>
        </div>  
        <div class="y_btn" id="save">
            申请上门检测
        </div> 
        <div class="activity_comment">
            <div><span>1. </span><p>养车宝客服将于2个工作日内与您电话联系，确认检测预约时间、地点及车辆信息；</p></div>
            <div><span>2. </span><p>完成检测后，检测技师将为您的爱车出据1份检测报告，并标明问题建议；</p></div>
            <div><span>3. </span><p>您关注养车宝微信公众号或下载养车宝客户端，可以收到爱车电子版检测报告，还能分享到朋友圈，提醒好友注意行车安全；</p></div>
            <div><span>4. </span><p>检测当天请您保持电话畅通，如超过预约时间仍无法与您取得联系，本次检测将被取消；</p></div>
            <div><span>5. </span><p>养车宝上门检测服务的范围限于北京、广州两地的市区范围。北京市支持五环路以内及天通苑、回龙观地区。广州市支持海珠区、越秀区、番禹区、天河区及荔湾区、白云区的部分区域。</div>
              
        </div>  
    </div> 
    <div id="sharecover" style="display: none;">
        <img src="http://app.yangchebao.com.cn/group1/M00/05/00/ChUBl1SOrkCAV_1UAABSgg_DsAY434.png">
    </div> 
<script language="javascript">
function areaIdTwoShow(){
	document.getElementById('areaIdTwo').style.display='inline-block';
}
function areaIdThreeShow(){
	document.getElementById('areaIdThree').style.display='inline-block';
}

$(function(){   
    var paramJson={};
     var url = window.location.search; 
     var paramsArr = (url.split("?")[1]).split("&"); 
     $.each(paramsArr,function(i){
       var item = paramsArr[i].split("=");
           paramJson[item[0]] = item[1];
     }); 
     $(".share").unbind('click').bind('click',function(){
        window.location.href =  "http://w2l/?shareType=1&shareTitle=养车宝免费检测！&shareContent=我在这免费领取200元上门全车检测啦，再也不用担心4S店保养欺诈！&shareUrl=http://weixin.yangchebao.com.cn/yangchebao-weixin-ws/index.html?"+paramJson.share_serl_num+"&shareImageUrl=http://weixin.yangchebao.com.cn/yangchebao-weixin-ws/img/crayz.png"
    });
    var date = new Date();
    date.setDate(date.getDate()+1);	
	date.setHours("0");
	date.setMinutes("0");
	date.setSeconds("0");
	 $("#time").mobiscroll().datetime({
	        theme: "bootstrap", 
	        mode: "scroller",   
	        display: "model", 
	        lang: "zh",       
	        minDate:date, 
	        dateFormat: 'yy-mm-dd', 
	        stepMinute: 5  
	    });
	 var judgeData = {};
    var postData = {};
    $("#realName").focus(function(){
    	var ediv = $(".error");
    	if(ediv.attr("etype")=="nError"){
    		ediv.hide();
    	}
    });
    $("#mobile").focus(function(){
    	var ediv = $(".error");
    	if(ediv.attr("etype")=="mError"){
    		ediv.hide();
    	}
    });
    $("#time").click(function(){
    	var ediv = $(".error");
    	if(ediv.attr("etype")=="tError"){
    		ediv.hide();
    	}
    });
    $("#address").focus(function(){
    	var ediv = $(".error");
    	if(ediv.attr("etype")=="aError"){
    		ediv.hide();
    	}
    });
    $("#save").click(function(){ 
       var _this = $(this);
		_this.attr("id","save2");  
    	var realName = $.trim($("#realName").val());
    	var mobile = $.trim($("#mobile").val());
 		var time = $.trim($("#time").val());
 		var areaIdLast=$.trim($("select:last").val());
 		var address = $.trim($("#address").val()); 
		if(realName==""){
			$(".error").html("请输入姓名").attr("etype","nError").show(); 
			return false;
		}
		var reg1 = /^[^*\/\\?]+$/;
		var reg=/^[\u4e00-\u9fa5]+$/;
		if(!reg.test(realName)){
		  $(".error").html("输入的姓名只能是汉字").attr("etype","nError").show(); 
		  return false;
		} 
		if(realName.length>20){
			$(".error").html("姓名最多20个汉字").attr("etype","nError").show(); 
			return false;
		}
		if(mobile==""){
			$(".error").html("请输入手机号码").attr("etype","mError").show(); 
			return false;
		} 
		if(!/^1[0-9]{10}$/.test(mobile)){
		  $(".error").html("输入正确格式的手机号码").attr("etype","mError").show(); 
		  return false;
		}
		if(areaIdLast==''){
			$(".error").html("请选择区域").attr("etype","aError").show(); 
			return false;
		}
		if(address==""){
			$(".error").html("请输入地址").attr("etype","aError").show(); 
			return false;
		}   
		if(!reg1.test(address)){
		  $(".error").html("输入的地址含非法字符").attr("etype","aError").show(); 
		  return false;
		} 
		if(time==""){
			$(".error").html("请选择时间").attr("etype","tError").show(); 
			return false;
		}
		var areaId=$('select#areaId').val();
		var areaName=$('option[value="'+areaId+'"]').text();
		var areaIdTwo=$('select#areaIdTwo').val();
		var areaNameTwo=$('option[value="'+areaIdTwo+'"]').text();
		var areaIdThree=$('select#areaIdThree').val();
		var areaNameThree=$('option[value="'+areaIdThree+'"]').text();
		areaName+=areaNameTwo+areaNameThree;
 		postData.realName = realName;
 		postData.areaName=areaName;
 		postData.areaId=areaIdThree;
 		postData.wxAreaFirstId=areaId;
 		postData.wxAreaSecondId=areaIdTwo;
 		postData.wxAreaThirdId=areaIdThree;
 		postData.mobile = mobile;
 		postData.time = time;
 		postData.address = address;
 		postData.orderChannel=7;
 		postData.isReg='yes';
 		postData.id=paramJson.customerId;
 		postData.customerId = paramJson.customerId;
 		postData.cardId = paramJson.cardId;
 		postData.serviceId = paramJson.serviceId;
    	apply(postData);

    });
	$.ajax({
		url:'/yangchebao-weixin-ws/ws/0.1/weixinV2/getWxArea?parentId=-1',
		type:'get',
		async:false,
		contentType:'application/json;charset=utf-8',
		success:function(data){
			var areaOptionStr='';
			$.each(data,function(i){
				areaOptionStr+='<option value="'+this.areaId+'">'+this.areaName+'</option>'
			});
			$('select#areaId').html(areaOptionStr);
			var areaIdOne=$('select#areaId').val();
			$.ajax({
				url:'/yangchebao-weixin-ws/ws/0.1/weixinV2/getWxArea?parentId='+areaIdOne,
				type:'get',
				async:false,
				contentType:'application/json;charset=utf-8',
				success:function(data2){
					var areaOptionStrTwo='<option value="">请选择</option>';
					$.each(data2,function(i){
						areaOptionStrTwo+='<option value="'+this.areaId+'">'+this.areaName+'</option>'
					});
					$('select#areaIdTwo').html(areaOptionStrTwo);
					$('select#areaIdTwo').change(function(){
						var areaIdTwo=$(this).val();
						if($(this).val()!=''){
							document.getElementById('areaIdThree').style.display='inline-block';
							$.ajax({
								url:'/yangchebao-weixin-ws/ws/0.1/weixinV2/getWxArea?parentId='+areaIdTwo,
								type:'get',
								async:false,
								contentType:'application/json;charset=utf-8',
								success:function(data3){
									var areaOptionStrThree='<option value="">请选择</option>';
									$.each(data3,function(i){
										areaOptionStrThree+='<option value="'+this.areaId+'">'+this.areaName+'</option>'
									});
									$('select#areaIdThree').html(areaOptionStrThree)
								}
							})
						}else{
							$('select#areaIdThree').html('<option value="">请选择</option>')
						}
					})
				}
			});
			$('select#areaId').change(function(){
				var areaId=$(this).val();
				if($(this).val()!=''){
					$.ajax({
						url:'/yangchebao-weixin-ws/ws/0.1/weixinV2/getWxArea?parentId='+areaId,
						type:'get',
						async:false,
						contentType:'application/json;charset=utf-8',
						success:function(data2){
							var areaOptionStrTwo='<option value="">请选择</option>';
							$.each(data2,function(i){
								areaOptionStrTwo+='<option value="'+this.areaId+'">'+this.areaName+'</option>'
							});
							$('select#areaIdTwo').html(areaOptionStrTwo);
							$('select#areaIdThree').html('<option value="">请选择</option>');
							$('select#areaIdTwo').change(function(){
								var areaIdTwo=$(this).val();
								if($(this).val()!=''){
									$.ajax({
										url:'/yangchebao-weixin-ws/ws/0.1/weixinV2/getWxArea?parentId='+areaIdTwo,
										type:'get',
										async:false,
										contentType:'application/json;charset=utf-8',
										success:function(data3){
											var areaOptionStrThree='<option value="">请选择</option>';
											$.each(data3,function(i){
												areaOptionStrThree+='<option value="'+this.areaId+'">'+this.areaName+'</option>'
											});
											$('select#areaIdThree').html(areaOptionStrThree)
										}
									})
								}else{
									$('select#areaIdThree').html('<option value="">请选择</option>')
								}
							})
						}
					})
				}else{
					$('select#areaIdTwo').html('<option value="">请选择</option>');
					$('select#areaIdThree').html('<option value="">请选择</option>')
				}
				

			})
		},error:function(xhr){
			var mes = eval('('+xhr.responseText+')'); 
			alert(mes[0].message);
		}
	});
	function apply(postData){ 
        $.ajax({
            url: '/yangchebao-weixin-ws/ws/0.1/weixinV2/canMakeOrderV2?id='+paramJson.customerId+'&channelId=2&'+parseInt(Math.random()*100000),
            type: 'get',
            async: false,
            contentType:'application/json;charset=utf-8',
            success:function(data){
                $.ajax({
					url: '/yangchebao-weixin-ws/ws/0.1/weixinV2/workOrderV2',
					type: 'post',
					async: false,
					data:$.toJSON(postData),
					dataType: 'json',
					contentType:'application/json;charset=utf-8',
					success:function(){
					 	 $(".edit_form_wrap").hide();
					 	 $("header").hide();
					 	 $(".success_wrap").show();  
					},error:function(xhr){ 
						 var mes = eval('('+xhr.responseText+')'); 
						 $(".error").html(mes[0].message).attr("etype","tError").show()
					} 
				})
            }
        })
	 	 	
	 	 }
});



</script>
</body>
</html>
