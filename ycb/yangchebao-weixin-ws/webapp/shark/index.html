<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<title>摇一摇抽奖</title>
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery-1.9.1.min.00000000000000.js"></script>
<script src="http://app.yangchebao.com.cn/group1/M00/00/9F/jquery.json-2.2.000000000000000.js"></script>
<script type="text/javascript" src="js/zepto.min.js"></script>

<style>
/* 公共css */
html {
	font-size: 62.5%;
}
body {
	font-family:'Hiragino Sans GB',Helvetica,Arial,sans-serif;
	font-weight: normal;
	font-style: normal;
	line-height: normal;
	margin: 0 auto;
	background-color: #2fa73b;
}
a {
	text-decoration: none;
}
ul {
	list-style: none;
}
li{ list-style-type:none;}
img {
	border: none;
}
* {
	margin: 0;
	padding: 0;
}
em{
	font-style: normal;
}
.clearfix {
 *zoom: 1;
}
.clearfix:before, .clearfix:after {
	display: table;
	line-height: 0;
	content: "";
}
.clearfix:after {
	clear: both;
}
section,article{
	width: 100%;
	display: block;
	margin: 0 auto;
	position: relative;
}
article img{
	width: 100%;
	display: block;
}
.active-notes{
	width: 90%;
	display: block;
	padding: 0.5rem;
	box-sizing: border-box;
	border: 1px dashed #fff;
	margin: 0 auto 20px auto;
	color: #fff;
}
.active-notes h3{
	height: 1.5rem;
	line-height: 1.5rem;
	background: url(images/y_04.png) no-repeat;
	background-size: 8px 15px;
	padding-left: 9px;
	box-sizing: border-box;
	font-size: 1.3rem;
	margin-bottom: 0.5rem;
}
.active-notes h3 span{
	font-weight:normal;
	font-size: 1rem;
	margin-left: 1%;
}
.active-notes p{
	font-size: 1.2rem;
	line-height: 1.8rem;
}
.active-notes p span{
	width: 50%;
	display: block;
	float: left;
}
/*弹窗*/
.tasat-wrap{
    position: fixed;
    text-align: center;
    bottom: 50%;
    width: 100%; 
}
.tasat{
    background-color: #000;
    border-radius: 8px;
    color: #fff;
    font-size: 1.6em; 
    opacity: 0.8;
    padding: 0.5em; 
    display: inline-block;
    margin: 0 20px;
} 
/*弹窗*/
div.popup{
	width: 90%;
	display: none;
	position:fixed;
	top: 50%;
	left: 5%;
	z-index: 1000;
	padding: 2.2rem 1.5rem  2rem 1.5rem;
	box-sizing: border-box;
	background-color:rgba(255,255,255,0.9); 
	border-radius: 10px;
	box-shadow: 3px 3px 15px #000;
 }
 div.two-dimension{
 	margin-top: -149px;
 }
 div.suc{
	margin-top: -82px;
}
div.fail{
	margin-top: -41.5px;
}
 div.popup p{
 	width: 100%;
 	text-align: center;
 	font-size: 1.4rem;
 	line-height: 2.5rem;
 	color: #298c31;
 }
  div.popup p em{
  	color: red;
  }
 div.popup p a{
 	width: 45%;
 	line-height: 3.5rem;
 	border-radius: 5px;
 	background-color: #d24241;
 	display:inline-block;
 	margin-top: 10px;
 	color: #fff;
 }
 .download{
 	float: left;
 }
 .download{
 	float: left;
 }
 .share{
 	float: right;
 }
 .two-dimension p{
 	color: #000 !important;
 }
  .two-dimension img{
  	width: 12.9rem;
  	height: 12.9rem;
  	display: block;
  	margin: 0 auto;
  }
  #did-not-draw{
	z-index:0;
  }
  #fail,#suc{
  	position: absolute;
  	top: 0;
  	left: 0;
  	display: none;
  	z-index:100;
  }
  /* 隐藏弹出层 */
  #sharecover {
    background-color: rgba(0, 0, 0, 0.5);
    bottom: 0; 
    height: 100%;
    left: 0; 
    position: fixed;
    right: 0;
    text-align: left;
    top: 0;
    width: 100%;
	z-index:10002;
}
#sharecover img{
	width:100%;
}
.regret-img{
	 position: relative;
}
.regret-text{
	position:absolute;
	width: 80%;
	bottom:16%;
	left: 11%;
	text-align: center;
	font-size: 1.8rem;
	color: #fff;
	transform: skew(-30deg);
	font-weight: bold;
} 
.regret-text p{
	margin-top: 5px;

}
/* 摇一摇动画 */
.hand-bj{
position: relative;
z-index: 0;
}
.hand-animate{
	width: 65%;
	display: block;
	z-index: 50;
	position:absolute;
	top: 12.5%;
	left: 18.6%;
}
.hand-animate img { 
	width: 100%;
	display: block;
	border-radius: 50%;
	-webkit-animation: hand_move 1s infinite linear; }
   @-webkit-keyframes hand_move {
        0% {
            -webkit-transform: rotate(0);
               -moz-transform: rotate(0);
                -ms-transform: rotate(0);
                 -o-transform: rotate(0);
                    transform: rotate(0); 
                    transform-origin: center;}
        25% {
            -webkit-transform: rotate(15deg);
               -moz-transform: rotate(15deg);
                -ms-transform: rotate(15deg);
                 -o-transform: rotate(15deg);
                    transform: rotate(15deg); 
                transform-origin: center;}
          50% {
            -webkit-transform: rotate(0deg);
               -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                 -o-transform: rotate(0deg);
                    transform: rotate(0deg); 
                transform-origin: center;}

        75% {
            -webkit-transform: rotate(-15deg);
               -moz-transform: rotate(-15deg);
                -ms-transform: rotate(-15deg);
                 -o-transform: rotate(-15deg);
                    transform: rotate(-15deg);
                    transform-origin: center; }
    100% {
            -webkit-transform: rotate(0deg);
               -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                 -o-transform: rotate(0deg);
                    transform: rotate(0deg); 
                transform-origin: center;}
            }
.hand-dz{
	width: 100%;
	position: absolute;
	top: 0;
	left: 0;
	bottom: 0;
	z-index: 90;
}
.hand-dz img{
	width: 100%;
}
/* 失败按钮
.fail-img{
	position: relative;
	z-index: 10;
}
.fail-from{
	width: 100%;
	position: absolute;
	top: 26px;
	z-index: 100;
	display: block;

}
.fail-from  p{
	width: 80%;
	margin: 15px auto;
}
 .draw{
	width: 50%;
	background-color: #f6e833;
	height: 42px;
	line-height: 42px;
	text-align: center;
	border-radius: 5px;
	display: block;
	margin: 0 auto;
	font-size: 1.4rem;
}
.fail{
	display:none;
	position:fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	z-index: 10009;
} */
</style>
</head>
<body>

<section id="did-not-draw" class='did-not-draw'>
	<article>
		<img src="images/y_01.jpg"/>
	</article>
	<article>
		<div class="hand-bj">
			<img src="images/dz_bj.png">
		</div>
		<div class="hand-animate">
			<img src="images/yaoyiyao.png">
		</div>
		<div class="hand-dz">
			<img src="images/dianzhui.png">
		</div>
	</article>
	<article>
		<img src="images/y_03.jpg" />
	</article>
	<article>
		<div class="active-notes">
			<h3>活动说明<span>进入活动页面，摇一摇即可参与活动。</span></h3>
			<p><span>一等奖： iphone6s 1台 </span>     <span>二等奖：  现金50元       50个</span></p>
			<p class="clearfix"></p>
			<p><span>三等奖： 现金5元  100个 </span>   <span>四等奖： 现金2元         500个</span></p>
			<p class="clearfix"></p>
			<p>参与奖： 养车宝10元代金券  1000个 </p>
			<p class="clearfix"></p>
			<p>凡在2016中国（郑州）国际汽车后市场博览会当天，现场参与活动均获得精美礼品一份，奖品有限，送完为止，让我们摇起来吧！</p>
			<p class="clearfix"></p>
			<p>本活动最终解释权归养车宝所有。</p>
		</div>
	</article>
</section>
<!-- 红包音乐 -->
<audio id="shakemusic" src="music/red-01.mp3" style="display: none;"></audio>
<audio id="openmusic" src="music/red-02.mp3" style="display: none;"></audio>
<!-- End 红包音乐 -->
<div class="popup suc">
	<p>您已获得奖品！</p>
	<p>每个用户只能获得一次奖品</p>
	<p><a class="download-btn" id="ycb">立即领取</a><a class="share">分享好友</a></p>
</div>
<div class="popup fail">
	<p>活动已结束，请关注养车宝其他活动</p>
</div>
<div class="popup two-dimension">
	<p>您和现金大奖只差一步</p>
	<img src="images/two-code.png"/>
	<p>长按二维码，关注养车宝公众号</p>
	<p>点击有奖活动-摇一摇，立即参与活动</p>
</div>
<!-- <section class='fail'>
	<article><img src="images/yh_001.jpg"/></article>
	<article>
	<div  class="regret-img">
		<img src="images/yh_02.jpg"/>
	</div>
	<div  class="regret-text">
		<p>真遗憾！</p>
		<p>换个姿势   再摇一次吧</p>
	</div>
	</article>
	<article>
	<div class="fail-img">
		<img src="images/yh_03.jpg" />
	</div>
	<div class="fail-from">
		<p><span class="draw">立即返回</span></p>
	</div>
	</article>
</section> -->
<div id="sharecover" style="display: none;"><img src="http://app.yangchebao.com.cn/group1/M00/05/00/ChUBl1SOrkCAV_1UAABSgg_DsAY434.png" /></div>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript" src="js/share.js"></script>
<script>
//下载养车宝app
	function  is_weixin(){
		var ua = navigator.userAgent.toLowerCase();
	    /**if(ua.match(/mqqbrowser/i)=="mqqbrowser") {
     		$("#sharecover img").attr("src","http://app.yangchebao.com.cn/group1/M00/05/00/ChUBl1SOrkCAV_1UAABSgg_DsAY434.png");
		}else{
	        $("#sharecover img").attr("src","http://app.yangchebao.com.cn/group1/M00/05/00/ChUBl1SOrM2AGgatAABTszyk_9M207.png");
		}**/
		if(ua.match(/MicroMessenger/i)=="micromessenger") {
			$('.download-btn').attr('href','http://a.app.qq.com/o/simple.jsp?pkgname=com.carsmart.emaintain');
		}else{
			var sUserAgent = navigator.userAgent.toLowerCase(); 
			var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
			var bIsIphone = sUserAgent.match(/iphone/i) == "iphone";
			var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
			var bIsAndroid = sUserAgent.match(/android/i) == "android"; 
			if(bIsIpad || bIsIphone || bIsIphoneOs){
				$('.download-btn').attr('href','YangCheBao://1');
			function applink(){  
		                return function(){  
		                    var clickedAt = +new Date;  
		                     setTimeout(function(){
		                         !window.document.webkitHidden && setTimeout(function(){ 
		                               if (+new Date - clickedAt < 2000){  
		                                   window.location = 'https://itunes.apple.com/us/app/yang-che-bao/id736543893';  
		                               }  
		                         }, 500);       
		                     }, 500)   
		                };  
		            }  
            document.getElementById("ycb").onclick = applink();   
				//window.location.href = "https://itunes.apple.com/us/app/yang-che-bao/id736543893"; 
				
			}else{   
			    $('.download-btn').attr('href','http://d.yangchebao.com.cn/down.myapp.com/yangchebao2.8.0.apk');
			}
		}
	} 
 var paramJson = {};
 var isyao=false;//控制强烈摇动，连续触发事件  

$(function(){
// 获取参数
//alert(window.location.href)
            var url = window.location.search;
            if (url != '') {
                var paramsArr = (url.split("?")[1]).split("&");
                $.each(paramsArr, function(i) {
                    var item = paramsArr[i].split("=");
                    paramJson[item[0]] = item[1];
                });
            }
           /*设置错误弹出层*/
	function alertTasat(msg){
	var _html = $("<div>").addClass("tasat-wrap")
             var _span = $("<span>").addClass("tasat").html(msg);
			$("body").append(_html.append(_span));
			_html.fadeIn();
			window.setTimeout(function(){
				_html.fadeOut(function(){
					_html.remove();
				});
			}, 1500);
	}
	if(store.get('openid') == 'undefined' || store.get('openid')=='null' || store.get('openid')==null || store.get('openid')=='' || store.get('openid')==undefined){
		//获取openId
            $.ajax({
            	url:'/yangchebao-weixin-ws/ws/0.1/salesman/getWxUserBaseInfo?code='+paramJson.code+'&'+(new Date()).getTime(),
            	async: false,
             dataType: 'json',
             contentType: 'application/json;charset=utf-8',
             success: function(data) {
             		$('#did-not-draw').attr('openid',data.openid);
		$.ajax({
             		url:'/yangchebao-app-ws/ws/0.1/weixinLotteryActivity/getWeixinBasicInfo?openId='+data.openid+'&lotteryActivityId=2'+'&'+(new Date()).getTime(),
             		async:false,
             		dataType:'json',
             		contentType:'application/json;charset=utf-8',
             		success:function(data2){
             			//alert(data2.status)
	             		if(data2.status=='用户已中奖，已领奖'){
	             		$('.suc').show();
	             		is_weixin()
	             		/*设置分享弹出层*/
			            $(".share").click(function(){
					$("#sharecover").show();
				}); 
				$('#sharecover').click(function(e){
					$("#sharecover").hide(); 
				});

	             		}else if(data2.status=='用户未抽奖或未中奖'){
					
	             		 if (window.DeviceMotionEvent) {                  
			                window.addEventListener('devicemotion', deviceMotionHandler, false);                                  
			            } else {  
			                alert('本设备不支持devicemotion事件');  
			            }  
			            var speed = 23;  
			            var x = y = z = lastX = lastY = lastZ = 0;  
			            var audio = document.getElementById("shakemusic");
				var openAudio = document.getElementById("openmusic");
			            function deviceMotionHandler(event) {  
			                if(isyao==true){  
			                    return;  
			                }  
			                var acceleration = event.accelerationIncludingGravity;  
			                //var openid = $('#did-not-draw').attr('openid');
			                x = acceleration.x;  
			                y = acceleration.y;  
			                z = acceleration.z;  
			                if (Math.abs(x - lastX) > speed || Math.abs(y - lastY) > speed || Math.abs(z - lastZ) > speed) {  
			                    //摇动成功执行的代码在此处  
			                    	audio.play();
			                    	audio.pause();
					openAudio.play();
			                    	setTimeout(function(){
					var postData = {}
					postData.lotteryActivityId = 2;
					postData.cityCode = 0;
					postData.uniqueCode=$('#did-not-draw').attr('openid');
					$.ajax({
						url:"/yangchebao-app-ws/ws/0.1/weixinLotteryActivity/lotteryDraw",
						type:"post",
						async: false,
						data:$.toJSON(postData),
						dataType:'json',
						contentType:'application/json;charset=utf-8',
						success:function(data){
							if(data.prizeName == "5元现金"){
								window.location.href="suc.html?prizeName="+data.prizeName+"&lotteryRecordId="+data.lotteryRecordId
							}else if(data.prizeName == "2元现金"){
								window.location.href="suc.html?prizeName="+data.prizeName+"&lotteryRecordId="+data.lotteryRecordId
							}else if(data.prizeName == "10元代金券"){
								window.location.href="suc.html?prizeName="+data.prizeName+"&lotteryRecordId="+data.lotteryRecordId
							}else{
								window.location.href="fail.html";
							}
						},error:function(xhr){  
							//var mes = eval('('+xhr.responseText+')'); 
							//alertTasat(mes[0].message);
							$('div.fail').fadeIn();
						}
					})
					},1000)
           					 isyao=true;  
			                }  
			                lastX = x;  
			                lastY = y;  
			                lastZ = z;  
			            }    
	             		}else if(data2.status=='用户已中奖，未领奖'){
	             			window.location.href="suc.html?prizeName="+data2.prizeName+"&lotteryRecordId="+data2.lotteryRecordId
	             		}
             		}
             		})
             		
             },error:function(xhr){
		var mes = eval('('+xhr.responseText+')'); 
		alertTasat(mes[0].message)
             }
            })
		
	}else{
		//alert(222)
		$('#did-not-draw').attr('openid',store.get('openid'));
			$.ajax({
             		url:'/yangchebao-app-ws/ws/0.1/weixinLotteryActivity/getWeixinBasicInfo?openId='+store.get('openid')+'&lotteryActivityId=2'+'&'+(new Date()).getTime(),
             		async:false,
             		dataType:'json',
             		contentType:'application/json;charset=utf-8',
             		success:function(data2){
             			//alert(data2.status)
	             		if(data2.status=='用户已中奖，已领奖'){
	             		$('.suc').show();
	             		is_weixin()
	             		/*设置分享弹出层*/
			            $(".share").click(function(){
					$("#sharecover").show();
				}); 
				$('#sharecover').click(function(e){
					$("#sharecover").hide(); 
				});

	             		}else if(data2.status=='用户未抽奖或未中奖'){
					
	             		 if (window.DeviceMotionEvent) {                  
			                window.addEventListener('devicemotion', deviceMotionHandler, false);                                  
			            } else {  
			                alert('本设备不支持devicemotion事件');  
			            }  
			            var speed = 23;  
			            var x = y = z = lastX = lastY = lastZ = 0;  
			            var audio = document.getElementById("shakemusic");
				var openAudio = document.getElementById("openmusic");
			            function deviceMotionHandler(event) {  
			                if(isyao==true){  
			                    return;  
			                }  
			                var acceleration = event.accelerationIncludingGravity;  
			                //var openid = $('#did-not-draw').attr('openid');
			                x = acceleration.x;  
			                y = acceleration.y;  
			                z = acceleration.z;  
			                if (Math.abs(x - lastX) > speed || Math.abs(y - lastY) > speed || Math.abs(z - lastZ) > speed) {  
			                    //摇动成功执行的代码在此处  
			                    	audio.play();
			                    	audio.pause();
					openAudio.play();
			                    	setTimeout(function(){
					var postData = {}
					postData.lotteryActivityId = 2;
					postData.cityCode = 0;
					postData.uniqueCode=$('#did-not-draw').attr('openid');
					$.ajax({
						url:"/yangchebao-app-ws/ws/0.1/weixinLotteryActivity/lotteryDraw",
						type:"post",
						async: false,
						data:$.toJSON(postData),
						dataType:'json',
						contentType:'application/json;charset=utf-8',
						success:function(data){
							if(data.prizeName == "5元现金"){
								window.location.href="suc.html?prizeName="+data.prizeName+"&lotteryRecordId="+data.lotteryRecordId
							}else if(data.prizeName == "2元现金"){
								window.location.href="suc.html?prizeName="+data.prizeName+"&lotteryRecordId="+data.lotteryRecordId
							}else if(data.prizeName == "10元代金券"){
								window.location.href="suc.html?prizeName="+data.prizeName+"&lotteryRecordId="+data.lotteryRecordId
							}else{
								window.location.href="fail.html";
							}
						},error:function(xhr){  
							//var mes = eval('('+xhr.responseText+')'); 
							//alertTasat(mes[0].message);
							$('div.fail').fadeIn();
						}
					})
					},1000)
           					 isyao=true;  
			                }  
			                lastX = x;  
			                lastY = y;  
			                lastZ = z;  
			            }    
	             		}else if(data2.status=='用户已中奖，未领奖'){
	             			window.location.href="suc.html?prizeName="+data2.prizeName+"&lotteryRecordId="+data2.lotteryRecordId
	             		}
             		}
             		})
	}
	
store.set('openid', $('#did-not-draw').attr('openid'));
})
//本地存储
		var store = {
			set: function(key, value) {
				if (window.localStorage) {
					localStorage.setItem(key, JSON.stringify(value))
				} else {
					var name = key;
					document.cookie = name + '=' + escape(JSON.stringify(value))
				}
			},
			get: function(key) {
				if (window.localStorage) {
					try {
						return JSON.parse(localStorage.getItem(key))
					} catch (e) {
						return localStorage.getItem(key)
					}
				} else {
					var name = key;
					var arr = document.cookie.match(new RegExp("(^|)" + name + "=([^;]*)(;|$)"));
					if (arr != null) {
						try {
							return JSON.parse(unescape(arr[2]))
						} catch (e) {
							return unescape(arr[2])
						}
					} else {
						return null
					}
				}
			},
			remove: function(key) {
				if (window.localStorage) {
					localStorage.removeItem(key)
				} else {
					var name = key;
					var exp = new Date();
					exp.setTime(exp.getTime() - 1);
					var cval = getCookie(name);
					if (cval != null)
						document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString();
				}
			},
			clear: function() {
				if (window.localStorage) {
					localStorage.clear()
				} else {
					var keys = document.cookie.match(/[^ =;]+(?=\=)/g);
					if (keys) {
						for (var i = keys.length; i--;) {
							document.cookie = keys[i] + '=0;expires=' + new Date(0).toUTCString()
						}
					}
				}
			}
		};
</script>
</body>
</html>