<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=yes" />
	<meta content="yes" name="apple-mobile-web-app-capable"/>
	<meta content="black" name="apple-mobile-web-app-status-bar-style"/> 
	<meta name="format-detection" content="telephone=no" />
	<title>五折车险限时抢购！</title>
	<script src="./js/jquery-1.10.1.min.js"></script>
	<script src="./js/jquery.json-2.2.js"></script>
	<script src="./js/commen.js"></script>
	<style>
		*{
			margin: 0;
			padding: 0;
			list-style: none;
		}
		html,body{
			width: 100%;
		}
		html{
			font-size: 62.5%;
		}
		body{
			background-color: #f4f7f8;
			font-family: 'Hiragino Sans GB',Helvetica,Arial,sans-serif;
			color: #1e1e1e;
		}
		img{
			border: none;
			vertical-align: middle;
		}
		a{
			text-decoration: none;
			outline:none;
			blr:expression(this.onFocus=this.blur());
		}
		input{
			border: none;
			background-color: #fff;
		}

		section{
			position: relative;
			/*min-width: 320px;
			max-width: 640px;*/
			height: 600px;
			margin: 0 auto;
			background-color: #f4f7f8;
			padding-bottom: 5rem;
		}
		p.please,p.lastTip{
			font-size: 1rem;
			color: #555;
		}
		
		input{
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
			border-bottom: 1px solid #D9D9E2;
			padding: 15px;
			font-size: 1.8rem;
			line-height: 20px;
			color: #1e1e1e;
		}
		div.qrCode{  
			overflow: hidden;
		}
		div.userName input{
			width: 100%;
		}
		div.mobileNo input{  
			width: 100%;
		}
		div.qrCode input{  
			float: left;
			width: 70%;
		}
		span.getQrcodeBtn{
			background-color: #88B8E2;
			color: #fff;
			font-size: 1.6rem;
			line-height: 51px;
			cursor: pointer;
			display: inline-block;
			text-align: center;
			width: 5rem;
			width: 30%;
		}
		div.row{
			overflow: hidden;
		}
		div.btn p{
			width: 95%;
			text-align: center;
			background-color: #FF6138;
			color: #fff;
			font-size: 1.8rem;
			line-height: 40px;
			cursor: pointer;
			margin: 2rem auto 0;
			color: #fff;
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px;
		}
		p.lastTip{
			width: 95%;
			margin: 0.6rem auto;
			color: #6EAADE;
			font-size: 1.3rem;
			text-align: right;
		}
		/*dialog*/
		.dialog {
		    background-color: rgba(0, 0, 0, 0.4);
		    bottom: 0;
		    height: 100%;
		    position: fixed;
		    top: 0;
		    width: 100%;
		    z-index: 100;
		    
		}
		.dialog > div {
		    background-color: #fff;
		    height: auto;
		    margin: 20% 10px 0;
		    overflow: auto;
		}
		.dialog h1 {
		    border-bottom: 1px solid #fb451f;
		    color: #fb451f;
		    font-size: 1.7em;
		    font-weight: normal;
		    height: 33px;
		    line-height: 33px;
		    text-align: center;
		}
		.dialog h1 {
		    border-bottom: 1px solid #fb451f;
		    color: #fb451f;
		    font-size: 1.7em;
		    font-weight: normal;
		    height: 33px;
		    line-height: 33px;
		    text-align: center;
		}
		.dialog p {
		    font-size: 1.6em;
		    font-weight: normal;
		    line-height: 150%;
		    padding: 20px;
		}
		.dialog .btn-wrap > div {
		    float: left;
		    width: 50%;
		}
		.dialog .dialog-btn {
		    background-color: #fb451f;
		    color: #fff;
		    cursor: pointer;
		    display: block;
		    font-size: 1.6em;
		    height: 34px;
		    line-height: 34px;
		    text-align: center;
		}
		.dialog .left {
		    margin: 0 9px 17px 27px;
		}
		.dialog .right {
		    background-color: #c2c2c6;
		    margin: 0 27px 17px 9px;
		} 
		.getQrcodeBtn.disabled{
			background-color: #ccc;
			color: #fff;
			cursor: default;
		}

		div.errorLog{
			position: fixed;
			top: 0;
			z-index: 500;
			height: 100%;
			width: 100%;
			background-color: rgba(0,0,0,0);
		}
		div.errorLog p{
			position: relative;
			width: 90%;
			margin: 10rem auto;
			background-color: rgba(0,0,0,0.5);
			font-size: 1.6rem;
			color: #fff;
			text-align: center;
			padding: 1rem 0;
			border-radius: 8px;
		}
	</style>
</head>
<body>
	<div class="dialog" style="display: none;">
	  <div>
	    <h1>提示</h1>
	    <p>您已经是养车宝用户，点击下一步继续。</p>
	    <div class="btn-wrap">
	        <div><div class="dialog-btn left">下一步</div></div>
	        <div><div class="dialog-btn right">关闭</div></div>
	    </div>
	  </div>
	</div>
	<section>
		<article>
			<div class="userName row">
				<input type="text" placeholder='请输入姓名' name="userName" id="userName">
			</div>
			<div class="mobileNo row">
				<input type="text" placeholder='请输入手机号' name="mobileNo" id="mobileNo">
			</div>
			<div class="qrCode row">
				<input type="text" placeholder='请输入验证码' name="qrCode" id="qrCode"><span class="getQrcodeBtn">获取验证码</span>
			</div>
			<p class="lastTip">短信收不到？拨打400-607-1222</p>
			<div class="btn row">
				<p>点击报名</p>
			</div>
		</article>
	</section>
</body>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">
	var waiter=30;
	// 获取验证码
	function timer(){
		var $getQrcodeBtn=$('span.getQrcodeBtn');
		if(waiter==0){
			$getQrcodeBtn.html('获取验证码').removeClass('disabled');
			$('span.getQrcodeBtn').on('click',codeClick)
			waiter=30;
			return false
		}else{
			$getQrcodeBtn.html(waiter+'S').addClass('disabled',true);
			$('span.getQrcodeBtn').off('click')
		}
		waiter--;
		setTimeout(function() {
		timer();//循环调用
		},
		1000)
	};
	// 点击报名参加
	$('div.btn p').unbind('click').bind('click',function(){
		var mobile=$.trim($('input[name="mobileNo"]').val());
		var userName=$.trim($('input[name="userName"]').val());
		var code=$.trim($('input[name="qrCode"]').val());
		if(userName==''){
			errorLog('姓名不能为空');
			return false
		}
		if(!(/^[\u4e00-\u9faf]{2,10}$/.test(userName))){
			errorLog('请输入2-10个汉字的姓名');
			return false
		}
		if(mobile==''){
			errorLog('手机号不能为空');
			return false
		}
		if(!(/^1[0-9]{10}$/.test(mobile))){
			errorLog('手机号格式不正确');
			return false
		}
		if(code==''){
			errorLog('请输入验证码');
			return false
		}
		$.ajax({
			url:'/yangchebao-weixin-ws/ws/0.1/renbao/getMobileCode?mobile='+mobile,
			type:'get',
			async:false,
			dataType:'json',
			contentType:'application/json;charset=utf-8',
			success:function(data){
				if(data.isReg=='no'){
					var postData={};
					var postData2={};
					postData.mobile=mobile;
					postData.code=code;

					postData2.userName=userName;
					postData2.mobile=mobile;
					$.ajax({
						url:'/yangchebao-weixin-ws/ws/0.1/renbao/userFastReg',
						type:'post',
						dataType:'json',
						data:$.toJSON(postData),
						contentType:'application/json;charset=utf-8',
						success:function(data2){
							postData2.userInfoId=data2.userInfoId;
							$.ajax({
								url:'/yangchebao-weixin-ws/ws/0.1/renbao/userSignUp',
								type:'post',
								dataType:'json',
								data:$.toJSON(postData2),
								contentType:'application/json;charset=utf-8',
								success:function(data3){
									window.location.href="result.html"
								},
								error:function(xhr){
									var error=eval('('+xhr.responseText+')');
									errorLog(error[0].message)
								}
							})
						},
						error:function(xhr){
							var error=eval('('+xhr.responseText+')');
							errorLog(error[0].message)
						}
					})
				}else{
					$('div.dialog').show();
					var postData2={};
					postData2.userName=userName;
					postData2.mobile=mobile;
					postData2.userInfoId=data.userInfoId;
					// 跳转保险
					$('div.dialog div.left').unbind('click').bind('click',function(){
						$.ajax({
							url:'/yangchebao-weixin-ws/ws/0.1/renbao/userSignUp',
							type:'post',
							dataType:'json',
							data:$.toJSON(postData2),
							contentType:'application/json;charset=utf-8',
							success:function(data3){
								window.location.href="result.html"
							},
							error:function(xhr){
								var error=eval('('+xhr.responseText+')');
								errorLog(error[0].message)
							}
						})
					});
					$('div.dialog div.right').unbind('click').bind('click',function(){
						$('div.dialog').hide()
					})
				}
			},
			error:function(xhr){
				var error=eval('('+xhr.responseText+')');
				errorLog(error[0].message)
			}
		})
	});
	function codeClick(){
		if(!($(this).hasClass('disable'))){
			var mobile=$.trim($('input[name="mobileNo"]').val());
			var userName=$.trim($('input[name="userName"]').val());
			if(userName==''){
				errorLog('姓名不能为空');
				return false
			}
			if(!(/^[\u4e00-\u9faf]{2,10}$/.test(userName))){
				errorLog('请输入2-10个汉字的姓名');
				return false
			}
			if(mobile==''){
				errorLog('手机号不能为空');
				return false
			}
			if(!(/^1[0-9]{10}$/.test(mobile))){
				errorLog('手机号格式不正确');
				return false
			}
			$.ajax({
				url:'/yangchebao-weixin-ws/ws/0.1/renbao/getMobileCode?mobile='+mobile,
				type:'get',
				async:false,
				dataType:'json',
				contentType:'application/json;charset=utf-8',
				success:function(data){
					if(data.isReg=='no'){
						timer();
						// 点击报名参加
						$('div.btn p').unbind('click').bind('click',function(){
							var code=$.trim($('input[name="qrCode"]').val());
							userName=$.trim($('input[name="userName"]').val());
							mobile=$.trim($('input[name="mobileNo"]').val());
							if(userName==''){
								errorLog('姓名不能为空');
								return false
							}
							if(!(/^[\u4e00-\u9faf]{2,10}$/.test(userName))){
								errorLog('请输入2-10个汉字的姓名');
								return false
							}
							if(!(/^1[0-9]{10}$/.test(mobile))){
								errorLog('手机号格式不正确');
								return false
							}
							if(code==''){
								errorLog('请输入验证码');
								return false
							}
							var postData={};
							var postData2={};
							postData.mobile=mobile;
							postData.code=code;

							postData2.userName=userName;
							postData2.mobile=mobile;
							if(code){
								$.ajax({
									url:'/yangchebao-weixin-ws/ws/0.1/renbao/userFastReg',
									type:'post',
									dataType:'json',
									data:$.toJSON(postData),
									contentType:'application/json;charset=utf-8',
									success:function(data2){
										postData2.userInfoId=data2.userInfoId;
										$.ajax({
											url:'/yangchebao-weixin-ws/ws/0.1/renbao/userSignUp',
											type:'post',
											dataType:'json',
											data:$.toJSON(postData2),
											contentType:'application/json;charset=utf-8',
											success:function(data3){
												window.location.href="result.html"
											},
											error:function(xhr){
												var error=eval('('+xhr.responseText+')');
												errorLog(error[0].message)
											}
										})
									},
									error:function(xhr){
										var error=eval('('+xhr.responseText+')');
										errorLog(error[0].message)
									}
								})
							}
						})
					}else{
						if(userName==''){
							errorLog('姓名不能为空');
							return false
						}
						if(!(/^[\u4e00-\u9faf]{2,10}$/.test(userName))){
							errorLog('请输入2-10个汉字的姓名');
							return false
						}
						if(mobile==''){
							errorLog('手机号不能为空');
							return false
						}
						if(!(/^1[0-9]{10}$/.test(mobile))){
							errorLog('手机号格式不正确');
							return false
						}
						$('div.dialog').show();
						var postData2={};
						postData2.userName=userName;
						postData2.mobile=mobile;
						postData2.userInfoId=data.userInfoId;
						// 跳转保险
						$('div.dialog div.left').unbind('click').bind('click',function(){
							$.ajax({
								url:'/yangchebao-weixin-ws/ws/0.1/renbao/userSignUp',
								type:'post',
								dataType:'json',
								data:$.toJSON(postData2),
								contentType:'application/json;charset=utf-8',
								success:function(data3){
									window.location.href="result.html"
								},
								error:function(xhr){
									var error=eval('('+xhr.responseText+')');
									errorLog(error[0].message)
								}
							})
						});
						$('div.dialog div.right').unbind('click').bind('click',function(){
							$('div.dialog').hide()
						})
					}
				},
				error:function(xhr){
					var error=eval('('+xhr.responseText+')');
					errorLog(error[0].message)
				}
			})
		}
	};
	$('span.getQrcodeBtn').on('click',codeClick);
	// 分享
	var sharedata={};
	sharedata.title="五折车险限时抢购！";
	sharedata.shareUrl="http://"+urlIp()+'/yangchebao-weixin-ws/renbao/index.html';
	sharedata.headImgUrl="http://"+urlIp()+'/yangchebao-weixin-ws/renbao/img/logo.png';
	share(sharedata);
</script>
</html>