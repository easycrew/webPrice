<!Doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>上门检测报告单</title>  
    <link href="favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/idangerous.swiper.css"> 
</head>
<style type="text/css"> 
.activity_comment{  
    color: #36545F;   
    text-align: left;  
    margin: 30px 0; 
} 
.activity_comment p{ 
   font-size: 24px;
   line-height: 150%;
}
div.nextTest{
    padding: 0.5em 0;
    border-bottom: 2px solid #EDEDF1;
    margin: 0 1em;
    text-align: left;
    overflow: hidden;
}
div.nextTest p{
    float: left;
}
div.nextTest a{
    float: right;
    color: #6EAADE;
}
h1.testListTitle{
    font-size: 2em;
    color: #FF825F;
    text-align: center;
    margin: 0.6em 0 1em 0;
}
div.basicTestResult{
    overflow: hidden;
    padding: 0 10%;
    text-align: left;
}
p.testPerson{
    margin-right: 1em;
}
div.basicTestResult p.testPerson,div.basicTestResult div.testResult{
    float: left;
}
div.carComment{
    margin: 1.5em 1em 0;
    border: 1px solid #DCDBE3;
}
div.carComment div.carComment-top{
    border: 1px solid #DCDBE3;
    background-color: #FEF9E3;
    -webkit-border-radius:5px;
    -moz-border-radius:5px;
    border-radius:5px;
    text-align: center;
}
p.carComment-top-one{
    font-size: 1.6em;
    color: #FB451F;
    padding: 0.5em 0 0.5em 0;
}
p.carComment-top-two{
    color: #333;
    font-size: 1.2em;
    padding-bottom: 0.8em;
    padding-top: 0.8em;
}
div.carComment-bottom{
    padding: 1em 0.6em;
    background-color: #FFFDF4;
}
div.carComment-bottom p.p-perQ{
    text-align: left;
}
div.carComment-bottom p.p-perQ span{
    display: inline-block;
    margin-right: 0.5em;
    color: #333;
    padding-bottom: 0.2em;
}
div.carComment-bottom p.p-perQ span span{
    margin-right: 0;
}
p.testBtn span{
    display: inline-block;
    padding: 0.3em 0;
    width: 42%;
    color: #fff;
    font-size: 1.2em;
    background-color: #6EAADE;
    -webkit-border-radius: 6px;
    -moz-border-radius: 6px;
    border-radius: 6px;
    margin-top: 1.8em;
    cursor: pointer;
}
p.testBtn span.test-pingjiaBtn{
    margin-left:6%;
    background-color: #FF825F;
}
div.problem-title-wraper{
    position: relative;
    margin: 6em 2em 0;
    text-align: center;
}
div.problem-title-wraper ul{
    overflow: hidden;
    border-top: 1px solid #71ACDF;
    border-right: 1px solid #71ACDF;
    color: #A2A2A2;
    font-size: 1.6em;
    font-family: 'microsoft yahei';
    list-style: none;
}
div.problem-title-wraper ul li.now{
    float: left;
    width:33.333%;
}
div.problem-title-wraper ul li.now a{
    display: block;
    font-size: 1.5em;
    color: #A2A2A2;
    border-bottom: 1px solid #71ACDF;
    border-left: 1px solid #71ACDF;
    padding: 0.4em 0;
}
li.Qcurrent{
    width: 33.5%;
    position: absolute;
    z-index: 100;
    background-color: #fff;
}
li.Qcurrent a{
    display: block;
    font-size: 1.5em;
    color: #A2A2A2;
    padding: 0.8em 0 0.4em;
    border: 1px solid #FF825F;
    -webkit-border-top-left-radius:0.5em;
    -moz-border-top-left-radius:0.5em;
    border-top-left-radius:0.5em;
    -webkit-border-top-right-radius:0.5em;
    -moz-border-top-right-radius:0.5em;
    border-top-right-radius:0.5em;
}
div.isEvaluate{
    margin-top: 1.5em;
    font-size: 1.2em;
    text-align: center;
    color: #333;
}
div.isEvaluate span{
    font-size: 1em;
    color: #6EAADE;
}
.problem-module th{
	color:#6EAADE;
}
.showSolution{
	text-align:center;
	color:#6EAADE;
	font-size:1.23em;
}
.dialog{
  position: fixed;
  width: 100%;
  height: 100%; 
  background-color: rgba(0,0,0,0.4);
  top:0;
  bottom: 0;
  z-index:100;
}
.dialog>div{ 
  margin: 100px 32px 0;
  background-color: #F4F7F8; 
  height: auto;
  overflow: auto;
  position:relative;
}
.dialog h1{
  height: 68px; 
  border-bottom: 2px solid #fb451f;
  font-size: 30px;
  line-height: 68px; 
  color: #1E1E1E;
  font-weight: normal;
  padding:0 20px;
} 
.dialog p{
  padding: 20px;  
  font-size: 24px;
  line-height: 150%;
  color:#1E1E1E;
  font-weight: normal;
}
.dialog .btn-wrap>div{
  width: 50%;
  float: left;
}
.dialog .dialog-btn{
  font-size: 36px;
  color: #fff;
  background-color: #fb451f;
  display: block;
  height: 56px;
  line-height: 56px;
  text-align: center;
  cursor: pointer;
  margin:0 170px 20px;
}
.dialog .left{
  margin: 0 9px 17px 27px;
}
.dialog .right{
  margin: 0 27px 17px 9px;
  background-color: #c2c2c6;
}
.dialog ul li{
	background-color:#fff;
	margin-bottom:20px;
	border-bottom:1px solid #D9D9E2;
}
.close {
    cursor: pointer;
    display: inline-block;
    height: 40px;
    position: absolute;
    right: 10px;
    top: 15px;
    width: 40px;
    z-index: 10;
}
.close label {
    display: inline-block;
    margin-left: 10px;
}
.close label::before {
    border-right: 2px solid #fc5d3c;
    content: "";
    display: inline-block;
    height: 40px;
    transform: rotate(45deg);
    -ms-transform:rotate(45deg);   
    -moz-transform:rotate(45deg); 
    -webkit-transform:rotate(45deg);  
    -o-transform:rotate(45deg); 
    width: 1px;
}
.close label::after {
    border-left: 2px solid #fc5d3c;
    content: "";
    display: inline-block;
    height: 40px;
    transform: rotate(-45deg);
    -ms-transform:rotate(-45deg);   
    -moz-transform:rotate(-45deg); 
    -webkit-transform:rotate(-45deg);  
    -o-transform:rotate(-45deg); 
    width: 1px;
}
.apply-btn{
    background-color: #34cc89;
    border-radius: 6px;
    color: #fff;
    cursor: pointer;
    display:block;
    font-size: 36px;
    margin-top: 1.8em;
    padding: 0.3em 0; 
	text-align:center;
	margin:44px 6% 0;
}
.desc{
   font-size:24px;
   margin:20px;
   text-align:center;
   color:#1E1E1E;
}
.blue{
	color:#A2D1F0;
}
.org{
    color:#FB5F2F;
}
</style>
<body>  
<!-- 检测申请中！-->
    <div class="main examining-report"> 
            <div class="content-wrap">
                <div class="user-info">    
                    <div class="nextTest"><p>下次检测时间：<span class="nextTestTime">2015.03.15</span></p><!--a href="javascript:" class="testAgain">再次免费检测 ></a--></div> 
                    <h1 class="testListTitle">上门检测报告单</h1>
                    <div class="basicTestResult">
                        <p class="testPerson"><img src="img/testPerson.jpg" id="person" height="148px" width="148px"></p>
                        <div class="testResult">
                            <p>检测得分：<span class="score"></span></p>
                            <p>检测车主：<span class="carHolder">疯狂的橙子</span></p>
                            <p>检测时间：<span class="testTime"></span></p>
                        </div>
                    </div>
                    <div class="carComment">
                        <div class="carComment-top">
                            <!-- <p class="carComment-top-one">车况严重</p> -->
                            <p class="carComment-top-two">你的车车上路也太危险了吧！</p>
                        </div>
                        <div class="carComment-bottom">
                            <p class="p-count">本次检测共检查出<span id="totalNumQ">6</span>个问题</p>
                            <p class="p-perQ">
                                <span>常规类：<span id="routineNumQ">0</span>个</span>
                                <span>安全类：<span id="safeNumQ">2</span>个</span>
                                <span>寿命类：<span id="lifeNumQ">2</span>个</span>
                                <span>舒适度类：<span id="comfortNumQ">2</span>个</span>
                                <span>美观类：<span id="maintainNumQ">2</span>个</span>
                            </p>
                        </div>
                    </div>
                    <div class="isEvaluate"></div>
                    <a class="apply-btn" href="javascript:void(0);">马上获得价值200元上门检测</a>
					<p class="desc">包括<span class="blue">45项</span>全车检测 价值<span class="org">180元</span>空调清洗一次</p>
                </div>   
            </div>   
    </div> 
    <div id="sharecover" style="display: none;">
        <img src="http://app.yangchebao.com.cn/group1/M00/05/00/ChUBl1SOrkCAV_1UAABSgg_DsAY434.png">
    </div>
	<div class="dialog" style="display:none;">
		  <div>
			<h1>解决方案推荐</h1>
			<span class="close"><label></label></span>
			<ul>
				<!-- <li>
					<p>划痕小的时候，划痕小的时候，划痕小的时候，划痕小的时候，划痕小的时候，划痕小的。</p>
					<a class="dialog-btn">打蜡</a> 
				</li> --> 
			</ul>
		  </div>
	</div>  
<script language="javascript" src="./js/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>  
<script language="javascript" src="./js/share.js"></script>
<script language="javascript"> 
$(function(){  
    var paramJson={};
     var url = window.location.search; 
     var paramsArr = (url.split("?")[1]).split("&"); 
     $.each(paramsArr,function(i){
       var item = paramsArr[i].split("=");
           paramJson[item[0]] = item[1]
     }); 
     var workOrderId='';
     $(".test-shareBtn").unbind('click').bind('click',function(){
        window.location.href =  "http://w2l/?shareType=1&shareTitle=养车宝免费检测！&shareContent=我在这免费领取200元上门全车检测啦，再也不用担心4S店保养欺诈！&shareUrl=http://weixin.yangchebao.com.cn/yangchebao-weixin-ws/index.html?"+paramJson.share_serl_num+"&shareImageUrl=http://weixin.yangchebao.com.cn/yangchebao-weixin-ws/img/crayz.png"
    });
    $('.testAgain').unbind('click').bind('click',function(){
        $.ajax({
            url: '/yangchebao-weixin-ws/ws/0.1/weixinV2/canMakeOrderV2?id='+paramJson.customerId+'&channelId=2&status='+paramJson.status+'&'+parseInt(Math.random()*100000),
            type: 'get',
            async: false,
            contentType:'application/json;charset=utf-8',
            success:function(data){
                if(data.status == '5'){
                    window.open("apply-fail.html?customerId="+paramJson.customerId+'&'+parseInt(Math.random()*100000));
                }else if(data.status == '6'){
                    window.open("apply.html?customerId="+paramJson.customerId+'&'+parseInt(Math.random()*100000))
                }
            },error:function(xhr){
                var error=eval('('+xhr.responseText+')');
                alert(error[0].message)
            }
        })
    });
    $('span.test-pingjiaBtn').unbind('click').bind('click',function(){
        window.open('evaluate.html?customerId='+paramJson.customerId+'&workOrderId='+workOrderId)
    });
    try{
        var phoneWidth = parseInt(window.screen.width);
        var phoneHeight = parseInt(window.screen.height);
        var phoneScale = phoneWidth / 640;
        var ua = navigator.userAgent; 
        if (/Android (\d+\.\d+)/.test(ua)) {
            var version = parseFloat(RegExp.$1);
            // andriod 2.3
                $('[name="viewport"]').attr('content', 'width=640, initial-scale=' + phoneScale + ', minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi');
            if (version >= 2.3) {
                // andriod 2.3以上
            } else {
                $('[name="viewport"]').attr('content', 'width=640, initial-scale= 1.0, minimum-scale = 1.0, maximum-scale = 1.0, user-scalable=no, target-densitydpi=device-dpi');
            }
        // 其他系统
        } else {
            $('[name="viewport"]').attr('content', 'width=640, initial-scale= 0.5, minimum-scale = 0.5, maximum-scale = 0.5, user-scalable=no, target-densitydpi=device-dpi');
        }
    }catch(e){} 
    // $(".apply").click(function(){
    //      window.open("apply.html"); 
    // });
    getResult(); 
    $('div.problem-title-wraper ul li.now').unbind('click').bind('click',function(){
        var thisId=$(this).attr('id');
        $(this).next().show().siblings('li.Qcurrent').hide();
        $('div.problem-detail-wraper div#'+thisId).show().siblings('div').hide()
    });
	$(".problem-module").on("click",".showSolution",function(){
        var service = $(this).parent("tr").data("service");
        if(service.length>1){
            var str = "";
            $.each(service,function(i){
               var item = service[i];
               var desc = item.serviceDesc;
               if(desc==undefined||desc==""){
               desc = item.serviceName;
               }
               str+='<li><p>'+desc+'</p>'
                    +'<a class="dialog-btn" href="http://w2l/?presentType=1&needLogin=0&androidName=5&iosName=ShopListViewController&service='+item.firstServiceId+'&subService='+item.serviceId+'">'+service[i].serviceName+'</a>'
                    +'</li>';
            });
            $(".dialog ul").html(str);
            $(".dialog").show();
        }else{
            window.location.href = "http://w2l/?presentType=1&needLogin=0&androidName=5&iosName=ShopListViewController&service="+service[0].firstServiceId+"&subService="+service[0].serviceId;
        }
        
    });
	$(".dialog .close").click(function(){
		$(".dialog").hide();
	});
    function getResult(){  
         $.ajax({
            url: '/yangchebao-weixin-ws/ws/0.1/weixinV2/getTestingResultV2?id='+paramJson.sponsorId+'&channelId=1&'+parseInt(Math.random()*100000),
            type: 'get',
            async: false,
            dataType: 'json',
            success: function(data) { 
               // document.title = "豪夺"+data.score+"分，我的养车宝免费车辆检测成绩单！";
               data.score = data.score||100;
                paramJson.score = data.score;
				        workOrderId=data.workOrderId;
				        $("#person").attr("src",data.headImgUrl);
                if(data.score<=59){
                    $("p.carComment-top-two").html("你的车车上路也太危险了吧！"); 
                }else if(data.score<=69){
                    $("p.carComment-top-two").html("你确定不是这车的后妈吧！"); 
                }else if(data.score<=79){
                    $("p.carComment-top-two").html("主人求求你多爱我一点！"); 
                }else if(data.score<=89){
                    $("p.carComment-top-two").html("加油哦，养车达人就差一步啦！"); 
                }else{
                    $("p.carComment-top-two").html("原来我就是传说中的养车达人"); 
                }
                if(new Date()>new Date(data.nextInspectionTime.replace(/-/g, "/"))){
                    $("span.nextTestTime").parent().html('距离您上次检测都好久啦！')
                }else{
                    $("span.nextTestTime").html(data.nextInspectionTime)
                }
                $("span.score").html(data.score+"分");  
                $("span.testTime").html(data.time);
                $("span.carHolder").html(data.realName);
                $("#totalNumQ").html(data.needDealIssues.needDealRoutineIssuesList.length+data.needDealIssues.needDealSafeIssuesList.length+data.needDealIssues.needDealLifeIssuesList.length+data.needDealIssues.needDealComfortIssuesList.length+data.needDealIssues.needDealBeauIssuesList.length);
                $("#routineNumQ").html(data.needDealIssues.needDealRoutineIssuesList.length);
                $("#safeNumQ").html(data.needDealIssues.needDealSafeIssuesList.length);
                $("#lifeNumQ").html(data.needDealIssues.needDealLifeIssuesList.length);
                $("#comfortNumQ").html(data.needDealIssues.needDealComfortIssuesList.length);   
                $("#maintainNumQ").html(data.needDealIssues.needDealBeauIssuesList.length); 
                if(data.isGetVoucher=='yes'){
                    $('div.isEvaluate').html('已评价！30元代金券已放入<span>养车宝个人中心</span>');
                    $('span.test-pingjiaBtn').hide();
                }
	
                $("#needDealRoutineIssuesList .tips").html(data.routineIssuesDescription);
                $("#needDealSafeIssuesList .tips").html(data.safeIssuesDescription);
                $("#needDealLifeIssuesList .tips").html(data.lifeIssuesDescription);
                $("#needDealComfortIssuesList .tips").html(data.comfortIssuesDescription);  
                $("#needDealBeauIssuesList .tips").html(data.beauIssuesDescription); 
                XIssues("needDealRoutineIssues",data.needDealIssues.needDealRoutineIssuesList);
                XIssues("needDealSafeIssues",data.needDealIssues.needDealSafeIssuesList);
                XIssues("needDealLifeIssues",data.needDealIssues.needDealLifeIssuesList);
                XIssues("needDealComfortIssues",data.needDealIssues.needDealComfortIssuesList);
                XIssues("needDealBeauIssues",data.needDealIssues.needDealBeauIssuesList);
                XIssues("noNeedDealRoutineIssues",data.noNeedDealIssues.noNeedDealRoutineIssuesList);
                XIssues("noNeedDealSafeIssues",data.noNeedDealIssues.noNeedDealSafeIssuesList);
                XIssues("noNeedDealLifeIssues",data.noNeedDealIssues.noNeedDealLifeIssuesList);
                XIssues("noNeedDealComfortIssues",data.noNeedDealIssues.noNeedDealComfortIssuesList);
                XIssues("noNeedDealBeauIssues",data.noNeedDealIssues.noNeedDealBeauIssuesList); 
                $(".apply-btn").attr("href",data.getTestUrl);
            },
            error:function(xhr){
                var msg =eval('('+xhr.responseText+')');
                //alert(msg[0].message)
            }
        }); 
        }
        function getShareInfo(){  
		 //channel	1,查询车险报价页面；2，获取助战结果页面
		  $.ajax({
			  url: '/yangchebao-weixin-ws/ws/0.1/weixinV2/genShareMsg?openid='+paramJson.sponsorId+'&score='+paramJson.score+"&"+(new Date()).getTime(),
			  type: 'get', 
			  async:false,
			  dataType: 'json',
			  success: function(data) {   
				share(data);
			  },error:function(xhr){  
				  var mes = eval('('+xhr.responseText+')'); 
				  alertTasat(mes[0].message);
			  }
		  });  
	   }
        function XIssues(issuesName,items){ 
            var _wrap = $("#"+issuesName+"List"); 
            if(items!=undefined&&items.length!=0){ 
                 _wrap.show(); 
                $.each(items,function(i){
                     var item = items[i]; 
                     if(item.solution==''||item.solution==undefined||item.solution==null){
                        item.solution='无'
                     }
                    
                     var _module = $("<div>").addClass("problem-module");
                     var _num = $("<span>").addClass("num").html(i+1);
                     var _table = $("<table>");
                     var str ='<caption>'+ item.itemName +'</caption>'
                            +'<tr>'
                            +'<th>问题</th>'
                            +'<td>'+ item.description +'</td>'
                            +'</tr>'
                            +'<tr>'
                            +'<th>建议</th>'
                            +'<td>'+ item.solution +'</td>'
                            +'</tr>';
                    _table.append(str);
                    
                     if(item.isHaveService=="yes"){
                       var _service = $("<tr>").html('<td colspan="2" class="showSolution">查看解决方案 ></td>').data("service",item.service);
                       _table.append(_service);
                     }      
                     _module.append(_num).append(_table);
                    // var str = '<div class="problem-module">'
                    //         +'<span class="num">'+(i+1)+'</span>'
                    //         +'<table>'
                    //         +'<caption>'+ item.itemName +'</caption>'
                    //         +'<tr>'
                    //         +'<th>问题</th>'
                    //         +'<td>'+ item.description +'</td>'
                    //         +'</tr>'
                    //         +'<tr>'
                    //         +'<th>建议</th>'
                    //         +'<td>'+ item.solution +'</td>'
                    //         +'</tr>'
                    //         +'</table>'
                    //         +'</div>';
                    _wrap.append(_module); 
                });   
            } 
        } 
        // var shareTitle = '上门检测免费啦';
        // var descContent = "上门检测免费啦 45项专业检测 价值200元";
        // var imgUrl = 'http://10.23.101.4:8080/crayz/img/01_02.png';
        // var lineLink = "http://10.23.101.4:8080/crayz/report.html?openid="+paramJson.openid;
        // var redirectUrl = "http://10.23.101.4:8080/crayz/report.html?openid="+paramJson.openid;  
        // var appid = 'wx9f69650fc31578c1';  
		getShareInfo();
    
}) ;
</script>
</body>
</html> 
