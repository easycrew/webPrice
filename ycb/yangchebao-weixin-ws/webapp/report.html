<!Doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>上门检测报告单</title>  
    <link href="favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/idangerous.swiper.css"> 
</head>
<style type="text/css"> 
.activity_comment{  
    color: #36545F;   
    text-align: left;  
    margin: 30px 0; 
} 
.activity_comment p{ 
   font-size: 24px;
   line-height: 150%;
}
div.nextTest{
    padding: 0.5em 0;
    border-bottom: 2px solid #EDEDF1;
    margin: 0 1em;
    text-align: left;
    overflow: hidden;
}
div.nextTest p{
    float: left;
}
div.nextTest a{
    float: right;
    color: #6EAADE;
}
h1.testListTitle{
    font-size: 2em;
    color: #FF825F;
    text-align: center;
    margin: 0.6em 0 1em 0;
}
div.basicTestResult{
    overflow: hidden;
    padding: 0 10%;
    text-align: left;
}
p.testPerson{
    margin-right: 1em;
}
div.basicTestResult p.testPerson,div.basicTestResult div.testResult{
    float: left;
}
div.carComment{
    margin: 1.5em 1em 0;
    border: 1px solid #DCDBE3;
}
div.carComment div.carComment-top{
    border: 1px solid #DCDBE3;
    background-color: #FEF9E3;
    -webkit-border-radius:5px;
    -moz-border-radius:5px;
    border-radius:5px;
    text-align: center;
}
p.carComment-top-one{
    font-size: 1.6em;
    color: #FB451F;
    padding: 0.5em 0 0.5em 0;
}
p.carComment-top-two{
    color: #333;
    font-size: 1.2em;
    padding-bottom: 0.8em;
    padding-top: 0.8em;
}
div.carComment-bottom{
    padding: 1em 0.6em;
    background-color: #FFFDF4;
}
div.carComment-bottom p.p-perQ{
    text-align: left;
}
div.carComment-bottom p.p-perQ span{
    display: inline-block;
    margin-right: 0.5em;
    color: #333;
    padding-bottom: 0.2em;
}
div.carComment-bottom p.p-perQ span span{
    margin-right: 0;
}
p.testBtn span{
    display: inline-block;
    padding: 0.3em 0;
    width: 42%;
    color: #fff;
    font-size: 1.2em;
    background-color: #6EAADE;
    -webkit-border-radius: 6px;
    -moz-border-radius: 6px;
    border-radius: 6px;
    margin-top: 1.8em;
    cursor: pointer;
}
p.testBtn span.test-pingjiaBtn{
    margin-left:6%;
    background-color: #FF825F;
}
div.problem-title-wraper{
    position: relative;
    margin: 6em 2em 0;
    text-align: center;
}
div.problem-title-wraper ul{
    overflow: hidden;
    border-top: 1px solid #71ACDF;
    border-right: 1px solid #71ACDF;
    color: #A2A2A2;
    font-size: 1.6em;
    font-family: 'microsoft yahei';
    list-style: none;
}
div.problem-title-wraper ul li.now{
    float: left;
    width:33.333%;
}
div.problem-title-wraper ul li.now a{
    display: block;
    font-size: 1.5em;
    color: #A2A2A2;
    border-bottom: 1px solid #71ACDF;
    border-left: 1px solid #71ACDF;
    padding: 0.4em 0;
}
li.Qcurrent{
    width: 33.5%;
    position: absolute;
    z-index: 100;
    background-color: #fff;
}
li.Qcurrent a{
    display: block;
    font-size: 1.5em;
    color: #A2A2A2;
    padding: 0.8em 0 0.4em;
    border: 1px solid #FF825F;
    -webkit-border-top-left-radius:0.5em;
    -moz-border-top-left-radius:0.5em;
    border-top-left-radius:0.5em;
    -webkit-border-top-right-radius:0.5em;
    -moz-border-top-right-radius:0.5em;
    border-top-right-radius:0.5em;
}
div.isEvaluate{
    margin-top: 1.5em;
    font-size: 1.2em;
    text-align: center;
    color: #333;
}
div.isEvaluate span{
    font-size: 1em;
    color: #6EAADE;
}
.problem-module th{
	color:#6EAADE;
}
.showSolution{
	text-align:center;
	color:#6EAADE;
	font-size:1.23em;
}
.dialog{
  position: fixed;
  width: 100%;
  height: 100%; 
  background-color: rgba(0,0,0,0.4);
  top:0;
  bottom: 0;
  z-index:100;
}
.dialog>div{ 
  margin: 100px 32px 0;
  background-color: #F4F7F8; 
  height: auto;
  overflow: auto;
  position:relative;
}
.dialog h1{
  height: 68px; 
  border-bottom: 2px solid #fb451f;
  font-size: 30px;
  line-height: 68px; 
  color: #1E1E1E;
  font-weight: normal;
  padding:0 20px;
} 
.dialog p{
  padding: 20px;  
  font-size: 24px;
  line-height: 150%;
  color:#1E1E1E;
  font-weight: normal;
}
.dialog .btn-wrap>div{
  width: 50%;
  float: left;
}
.dialog .dialog-btn{
  font-size: 36px;
  color: #fff;
  background-color: #fb451f;
  display: block;
  height: 56px;
  line-height: 56px;
  text-align: center;
  cursor: pointer;
  margin:0 170px 20px;
}
.dialog .left{
  margin: 0 9px 17px 27px;
}
.dialog .right{
  margin: 0 27px 17px 9px;
  background-color: #c2c2c6;
}
.dialog ul li{
	background-color:#fff;
	margin-bottom:20px;
	border-bottom:1px solid #D9D9E2;
}
.close {
    cursor: pointer;
    display: inline-block;
    height: 40px;
    position: absolute;
    right: 10px;
    top: 15px;
    width: 40px;
    z-index: 10;
}
.close label {
    display: inline-block;
    margin-left: 10px;
}
.close label::before {
    border-right: 2px solid #fc5d3c;
    content: "";
    display: inline-block;
    height: 40px;
    transform: rotate(45deg);
    -ms-transform:rotate(45deg);   
    -moz-transform:rotate(45deg); 
    -webkit-transform:rotate(45deg);  
    -o-transform:rotate(45deg); 
    width: 1px;
}
.close label::after {
    border-left: 2px solid #fc5d3c;
    content: "";
    display: inline-block;
    height: 40px;
    transform: rotate(-45deg);
    -ms-transform:rotate(-45deg);   
    -moz-transform:rotate(-45deg); 
    -webkit-transform:rotate(-45deg);  
    -o-transform:rotate(-45deg); 
    width: 1px;
}
.download-btn{
    background-color: #34cc89;
    border-radius: 6px;
    color: #fff;
    cursor: pointer;
    display:block;
    font-size: 2.33em;
    margin-top: 1.8em;
    padding: 0.3em 0; 
	text-align:center;
	margin:44px 6% 0;
}
</style>
<body>  
<!-- 检测申请中！-->
    <div class="main examining-report"> 
            <div class="content-wrap">
                <div class="user-info">    
                    <div class="nextTest"><p>下次检测时间：<span class="nextTestTime">2015.03.15</span></p><a href="javascript:" class="testAgain">再次免费检测 ></a></div> 
                    <h1 class="testListTitle">上门检测报告单</h1>
                    <div class="basicTestResult">
                        <p class="testPerson"><img src="img/testPerson.jpg" id="person" height="148px" width="148px"></p>
                        <div class="testResult">
                            <p>检测得分：<span class="score"></span></p>
                            <p>检测车主：<span class="carHolder">疯狂的橙子</span></p>
                            <p>检测时间：<span class="testTime"></span></p>
                        </div>
                    </div>
                    <div class="carComment">
                        <div class="carComment-top">
                            <!-- <p class="carComment-top-one">车况严重</p> -->
                            <p class="carComment-top-two">你的车车上路也太危险了吧！</p>
                        </div>
                        <div class="carComment-bottom">
                            <p class="p-count">本次检测共检查出<span id="totalNumQ">6</span>个问题</p>
                            <p class="p-perQ">
                                <span>常规类：<span id="routineNumQ">0</span>个</span>
                                <span>安全类：<span id="safeNumQ">2</span>个</span>
                                <span>寿命类：<span id="lifeNumQ">2</span>个</span>
                                <span>舒适度类：<span id="comfortNumQ">2</span>个</span>
                                <span>美观类：<span id="maintainNumQ">2</span>个</span>
                            </p>
                        </div>
                    </div>
                    <div class="isEvaluate"></div>
                    <p class="testBtn"><span class="test-shareBtn">分享朋友圈</span><span class="test-pingjiaBtn">评价领代金券</span></p>
                </div>  
                <div class="problem-title-wraper">
                    <ul>
                        <li class="now" id="needDealProblem"><a href="javascript:">需要处理</a></li>
                        <li class="Qcurrent" style="bottom:0;left:0;"><a href="javascript:">需要处理</a></li>
                        <li class="now" id="noNeedDealProblem"><a href="javascript:">不需要处理</a></li>
                        <li class="Qcurrent" style="display:none;bottom:0;left:33.3%;"><a href="javascript:">不需要处理</a></li>
                        <li class="now" id="carOwnerProblem"><a href="javascript:">车主问题</a></li>
                        <li class="Qcurrent" style="display:none;bottom:0;right:0;"><a href="javascript:">车主问题</a></li>
                    </ul>
                </div>
                <div class="problem-detail-wraper">
				    <a href="javascript:void(0);" class="download-btn" style="display:none;">马上下载养车宝解决问题</a>
                    <div id='needDealProblem' class="problem-wrap" style="height:auto;padding-bottom:50px;">
                        <div class="problem-list" id="needDealRoutineIssuesList">
                            <h2><span>常规类</span></h2>
                            <p class="tips"></p> 
							<!-- <div class="problem-module"><span class="num">1</span>
							   <table><caption>玻璃水</caption><tbody><tr><th>问题</th><td>冰点零下(℃):1213</td></tr><tr><th>建议</th><td>为保证冬季正常清洁玻璃，建议更换为耐低温玻璃水</td></tr>
							   <tr><td colspan="2" class="showSolution">查看解决方案 > </td></tr>
							   </tbody></table></div> -->
                        </div> 
                        <div class="problem-list" id="needDealSafeIssuesList">
                            <h2><span>安全类</span></h2>
                            <p class="tips"></p> 
                        </div> 
                        <div class="problem-list" id="needDealLifeIssuesList">
                            <h2><span>寿命类</span></h2>
                            <p class="tips"></p> 
                        </div> 
                        <div class="problem-list" id="needDealComfortIssuesList">
                            <h2><span>舒适度类</span></h2>
                            <p class="tips"></p> 
                        </div>     
                        <div class="problem-list" id="needDealBeauIssuesList">
                            <h2><span>美观类</span></h2>
                            <p class="tips"></p> 
                        </div>    
                    </div>
                    <div id='noNeedDealProblem' class="problem-wrap" style="height:auto;padding-bottom:50px;display:none;">
                        <div class="problem-list" id="noNeedDealRoutineIssuesList">
                            <h2><span>常规类</span></h2>
                        </div> 
                        <div class="problem-list" id="noNeedDealSafeIssuesList">
                            <h2><span>安全类</span></h2>
                        </div> 
                        <div class="problem-list" id="noNeedDealLifeIssuesList">
                            <h2><span>寿命类</span></h2>
                        </div> 
                        <div class="problem-list" id="noNeedDealComfortIssuesList">
                            <h2><span>舒适度类</span></h2>
                        </div>     
                        <div class="problem-list" id="noNeedDealBeauIssuesList">
                            <h2><span>美观类</span></h2>
                        </div>    
                    </div>
                    <div id='carOwnerProblem' class="problem-wrap" style="height:auto;padding-bottom:50px;display:none;">
                        <div class="problem-list" id="carOwnerProblemList">
                        </div>     
                    </div>
                </div>
            </div>   
    </div> 
    <div id="sharecover" style="display: none;">
        <img src="http://app.yangchebao.com.cn/group1/M00/05/00/ChUBl1SOrkCAV_1UAABSgg_DsAY434.png">
    </div>
	<div class="dialog" style="display:none;">
		  <div>
			<h1>解决方案推荐</h1>
			<span class="close"><label></label></span>
			<ul>
				<!-- <li>
					<p>划痕小的时候，划痕小的时候，划痕小的时候，划痕小的时候，划痕小的时候，划痕小的。</p>
					<a class="dialog-btn">打蜡</a> 
				</li> --> 
			</ul>
		  </div>
	</div>  
 
<script language="javascript" src="./js/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>  
<script language="javascript" src="./js/share.js"></script>
<script language="javascript">
var paramJson={};
var workOrderId='',customerId='';  
$(function(){    
     var url = window.location.search; 
     var paramsArr = (url.split("?")[1]).split("&"); 
     $.each(paramsArr,function(i){
       var item = paramsArr[i].split("=");
           paramJson[item[0]] = item[1]
     }); 
	 screen();//屏幕适配  
     
     $('#sharecover').click(function(e){
        $("#sharecover").hide(); 
     });
     $(".test-shareBtn").unbind('click').bind('click',function(){
        if(is_weixin()){
		  $("#sharecover").show();
		}else{ 
		  window.location.href =  "http://w2l/?shareType=1&shareTitle=养车宝免费检测！&shareContent=我在这免费领取200元上门全车检测啦，再也不用担心4S店保养欺诈！&shareUrl=http://weixin.yangchebao.com.cn/yangchebao-weixin-ws/index.html?"+paramJson.share_serl_num+"&shareImageUrl=http://weixin.yangchebao.com.cn/yangchebao-weixin-ws/img/crayz.png";
		}
    });
    $('.testAgain').unbind('click').bind('click',function(){
	    if(is_weixin()){//weixin里
			$.ajax({
				url: '/yangchebao-weixin-ws/ws/0.1/weixinV2/canMakeOrderV2?id='+paramJson.openid+'&channelId=1&status='+paramJson.status+'&'+parseInt(Math.random()*100000),
				type: 'get',
				async: false,
				contentType:'application/json;charset=utf-8',
				success:function(data){
					if(data.status == '5'){
						window.open("apply-fail.html?openid="+paramJson.openid+'&'+parseInt(Math.random()*100000));
					}else if(data.status == '6'){
						window.open("apply.html?openid="+paramJson.openid+'&'+parseInt(Math.random()*100000))
					}
				},error:function(xhr){
					var error=eval('('+xhr.responseText+')');
					alert(error[0].message)
				}
			})
		}else{//app 里
			$.ajax({
				url: '/yangchebao-weixin-ws/ws/0.1/weixinV2/canMakeOrderV2?id='+paramJson.customerId+'&channelId=2&status='+paramJson.status+'&'+parseInt(Math.random()*100000),
				type: 'get',
				async: false,
				contentType:'application/json;charset=utf-8',
				success:function(data){
					if(data.status == '5'){
						window.open("apply-fail.html?customerId="+paramJson.customerId+'&'+parseInt(Math.random()*100000));
					}else if(data.status == '6'){
						window.open("apply.html?customerId="+paramJson.customerId+'&'+parseInt(Math.random()*100000))
					}
				},error:function(xhr){
					var error=eval('('+xhr.responseText+')');
					alert(error[0].message)
				}
			})
		}
    });
    $('.test-pingjiaBtn').unbind('click').bind('click',function(){
        window.open('evaluate.html?customerId='+customerId+'&workOrderId='+workOrderId)
    });  
    $('div.problem-title-wraper ul li.now').unbind('click').bind('click',function(){
        var thisId=$(this).attr('id');
        $(this).next().show().siblings('li.Qcurrent').hide();
        $('div.problem-detail-wraper div#'+thisId).show().siblings('div').hide()
    });
	$(".problem-list").on("click",".showSolution",function(){
        var service = $(this).parent("tr").data("service"); 
        if(service.length>1){
            var str = "";
            $.each(service,function(i){
               var item = service[i];
               var desc = item.serviceDesc;
               if(desc==undefined||desc==""){
               desc = item.serviceName;
               }
               str+='<li><p>'+desc+'</p>'
                    +'<a class="dialog-btn" href="http://w2l/?presentType=1&needLogin=0&androidName=5&iosName=ShopListViewController&service='+item.firstServiceId+'&subService='+item.serviceId+'">'+service[i].serviceName+'</a>'
                    +'</li>';
            });
            $(".dialog ul").html(str);
            $(".dialog").show();
        }else{
            window.location.href = "http://w2l/?presentType=1&needLogin=0&androidName=5&iosName=ShopListViewController&service="+service[0].firstServiceId+"&subService="+service[0].serviceId;
        } 
    });
	$(".dialog .close").click(function(){
		$(".dialog").hide();
	});
	getResult();
	if(is_weixin()){ 
		download();
		getShareInfo();
	}
}) ;
function getResult(){  
     var request = "";
	 if(is_weixin()){
	 request = '/yangchebao-weixin-ws/ws/0.1/weixinV2/getTestingResultV2?id='+paramJson.openid+'&channelId=1&'+parseInt(Math.random()*100000);
	 }else{
	 request = '/yangchebao-weixin-ws/ws/0.1/weixinV2/getTestingResultV2?id='+paramJson.customerId+'&channelId=2&'+parseInt(Math.random()*100000);
	 }
	 $.ajax({
		url: request,
		type: 'get',
		async: false,
		dataType: 'json',
		success: function(data) { 
		   // document.title = "豪夺"+data.score+"分，我的养车宝免费车辆检测成绩单！";
		    data.score = data.score||100;
			paramJson.score = data.score;
            workOrderId = data.workOrderId;
            customerId = data.customerId;
			if(is_weixin()){
				$("#person").attr("src",data.headImgUrl);
			} 
			if(data.score<=59){
				$("p.carComment-top-two").html("你的车车上路也太危险了吧！"); 
			}else if(data.score<=69){
				$("p.carComment-top-two").html("你确定不是这车的后妈吧！"); 
			}else if(data.score<=79){
				$("p.carComment-top-two").html("主人求求你多爱我一点！"); 
			}else if(data.score<=89){
				$("p.carComment-top-two").html("加油哦，养车达人就差一步啦！"); 
			}else{
				$("p.carComment-top-two").html("原来我就是传说中的养车达人"); 
			}
			if(new Date()>new Date(data.nextInspectionTime.replace(/-/g, "/"))){
				$("span.nextTestTime").parent().html('距离您上次检测都好久啦！')
			}else{
				$("span.nextTestTime").html(data.nextInspectionTime)
			}
			$("span.score").html(data.score+"分");  
			$("span.testTime").html(data.time);
			$("span.carHolder").html(data.realName);
			$("#totalNumQ").html(data.needDealIssues.needDealRoutineIssuesList.length+data.needDealIssues.needDealSafeIssuesList.length+data.needDealIssues.needDealLifeIssuesList.length+data.needDealIssues.needDealComfortIssuesList.length+data.needDealIssues.needDealBeauIssuesList.length);
			$("#routineNumQ").html(data.needDealIssues.needDealRoutineIssuesList.length);
			$("#safeNumQ").html(data.needDealIssues.needDealSafeIssuesList.length);
			$("#lifeNumQ").html(data.needDealIssues.needDealLifeIssuesList.length);
			$("#comfortNumQ").html(data.needDealIssues.needDealComfortIssuesList.length);   
			$("#maintainNumQ").html(data.needDealIssues.needDealBeauIssuesList.length); 

			if(data.isGetVoucher=='yes'){
			    if(is_weixin()){
					$('div.isEvaluate').html('已评价！30元代金券已放入<a href="http://d.yangchebao.com.cn"><span>养车宝个人中心</span></a>');
				}else{
					$('div.isEvaluate').html('已评价！30元代金券已放入<span>养车宝个人中心</span>');
				}
				$('span.test-pingjiaBtn').hide();
			} 
			
			$("#needDealRoutineIssuesList .tips").html(data.routineIssuesDescription);
			$("#needDealSafeIssuesList .tips").html(data.safeIssuesDescription);
			$("#needDealLifeIssuesList .tips").html(data.lifeIssuesDescription);
			$("#needDealComfortIssuesList .tips").html(data.comfortIssuesDescription);  
			$("#needDealBeauIssuesList .tips").html(data.beauIssuesDescription); 

			XIssues("needDealRoutineIssues",data.needDealIssues.needDealRoutineIssuesList);
			XIssues("needDealSafeIssues",data.needDealIssues.needDealSafeIssuesList);
			XIssues("needDealLifeIssues",data.needDealIssues.needDealLifeIssuesList);
			XIssues("needDealComfortIssues",data.needDealIssues.needDealComfortIssuesList);
			XIssues("needDealBeauIssues",data.needDealIssues.needDealBeauIssuesList);

			XIssues("noNeedDealRoutineIssues",data.noNeedDealIssues.noNeedDealRoutineIssuesList);
			XIssues("noNeedDealSafeIssues",data.noNeedDealIssues.noNeedDealSafeIssuesList);
			XIssues("noNeedDealLifeIssues",data.noNeedDealIssues.noNeedDealLifeIssuesList);
			XIssues("noNeedDealComfortIssues",data.noNeedDealIssues.noNeedDealComfortIssuesList);
			XIssues("noNeedDealBeauIssues",data.noNeedDealIssues.noNeedDealBeauIssuesList);  
		},
		error:function(xhr){
			var msg =eval('('+xhr.responseText+')');
			//alert(msg[0].message)
		}
	}); 
}  
function XIssues(issuesName,items){ 
	var _wrap = $("#"+issuesName+"List"); 
	if(items!=undefined&&items.length!=0){ 
		 _wrap.show(); 
		$.each(items,function(i){
			 var item = items[i]; 
			 if(item.solution==''||item.solution==undefined||item.solution==null){
				item.solution='无'
			 } 
			 var _module = $("<div>").addClass("problem-module");
			 var _num = $("<span>").addClass("num").html(i+1);
			 var _table = $("<table>");
			 var str ='<caption>'+ item.itemName +'</caption>'
					+'<tr>'
					+'<th>问题</th>'
					+'<td>'+ item.description +'</td>'
					+'</tr>'
					+'<tr>'
					+'<th>建议</th>'
					+'<td>'+ item.solution +'</td>'
					+'</tr>';
			_table.append(str);
			
			if(!is_weixin()&&item.isHaveService=="yes"){
			   var _service = $("<tr>").html('<td colspan="2" class="showSolution">查看解决方案 ></td>').data("service",item.service);
			   _table.append(_service);
			 }      
			 _module.append(_num).append(_table); 
			_wrap.append(_module); 
		});   
	} 
}  
function getShareInfo(){  
 	 //channel	1,查询车险报价页面；2，获取助战结果页面
      $.ajax({
          url: '/yangchebao-weixin-ws/ws/0.1/weixinV2/genShareMsg?openid='+paramJson.openid+'&score='+paramJson.score+"&"+(new Date()).getTime(),
          type: 'get', 
          async:false,
          dataType: 'json',
          success: function(data) {   
			share(data);
          },error:function(xhr){  
		      var mes = eval('('+xhr.responseText+')'); 
		      alertTasat(mes[0].message);
          }
      });  
 }
function  download(){
        $('.download-btn').show();
		var ua = navigator.userAgent.toLowerCase();
		if(ua.match(/MicroMessenger/i)=="micromessenger") {
			$('.download-btn').attr('href','http://a.app.qq.com/o/simple.jsp?pkgname=com.carsmart.emaintain');
		}else{
			var sUserAgent = navigator.userAgent.toLowerCase(); 
			var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
			var bIsIphone = sUserAgent.match(/iphone/i) == "iphone";
			var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
			var bIsAndroid = sUserAgent.match(/android/i) == "android"; 
			if(bIsIpad || bIsIphone || bIsIphoneOs){
				$('.download-btn').attr('href','https://itunes.apple.com/us/app/yang-che-bao/id736543893');
				window.location.href = "https://itunes.apple.com/us/app/yang-che-bao/id736543893"; 
			}else{   
			$('.download-btn').attr('href','http://yangchebao.com.cn/website-ws/ws/0.1/app/download');
			}
		}
	} 
</script>
</body>
</html> 