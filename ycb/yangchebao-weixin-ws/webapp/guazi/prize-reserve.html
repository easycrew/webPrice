<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>欢迎瓜子二手车用户</title>  
    <script language="javascript" src="../js/jquery-1.10.1.min.js"></script>
    <script language="javascript" src="../js/jquery.json-2.2.js"></script>
    <script language="javascript" src="./js/screen.js"></script> 
    <link rel="stylesheet" href="./css/index.css">
</head>
<style type="text/css">  
.unable {
   background-color:#ccc;
}
.overlay-wrap{
	background-color:rgba(0,0,0,0.6);
	width:100%;
	position:fixed;
	top:0;
	bottom:0;
	z-index:100;
	display:none;
	left: 0;
    padding-top: 40%;
	text-align:center; 
}
</style>
<body>   
<div class="coke-wrapper step-wrapper">
    <ul class="step-tab">
        <li><span><em>1</em>输入手机号</span></li>
        <li><span><span><em>2</em>确认分店</span></li>
        <li class="current"><span><em>3</em>确认时间</span></li>
    </ul>
    <div class="step-content">
        <div class="step-title">请选择服务时间</div>
        <div class="step-content-inner padding0">
            <ul class="time-list">
                <!--li>
                    <span class="status">已约满</span>
                    <span class="time">3月11日</span>               
                </li>
                <li>
                    <span class="status"><a href="javascript:void(0);" class="btn">点击预约</a></span>
                    <span class="time">3月11日</span>               
                </li-->
            </ul>
        </div>
    </div>
</div> 
<div class="overlay-wrap">正在领取中，请稍候...</div>
<div></div>
<script type="text/javascript">
    $(document).ready(function(){
        var url =window.location.href; 
        var paramsArr = (url.split("?")[1]).split("&");
        var paramJson = {};
        $.each(paramsArr,function(i){
            var item = paramsArr[i].split("=");
            paramJson[item[0]] = item[1];
        });  
        if(url.split("?").length==3){
            var paramsArr2 = (url.split("?")[2]).split("&"); 
            $.each(paramsArr2,function(i){
                var item = paramsArr2[i].split("=");
                paramJson[item[0]] = item[1];
            });  
        }   
        $(".time-list").on('click','.reserveBtn',function(){ 
			$(".overlay-wrap").show(); 
            reserve($(this).attr("time")); 
       }); 
       getShopList(); 
       function getShopList(){  
          $.ajax({
                url: '/yangchebao-weixin-ws/ws/0.1/coco/getServerTimeList?businessInfoId='+paramJson.businessInfoId+"&channelId=4",
                type: 'get', 
                dataType: 'json',
                success:function(data){   
                     $.each(data,function(i){
                        var item = data[i];
                        var spanStr = "";
                        if(item.isOrder=="yes"){
                            spanStr= '<span class="status"><a href="javascript:void(0);" class="btn reserveBtn" time="'+item.serviceDate1+'">点击预约</a></span>';
                        }else{
                            spanStr = '<span class="status">已约满</span>';
                        }
                        var str = '<li>'+spanStr
                               +'<span class="time">'+ item.serviceDate2 +'</span>'
                               +'</li>';
                        $(".time-list").append(str);
                     }); 
                },error:function(xhr){
                    var mes = eval('('+xhr.responseText+')'); 
                    alertTasat(mes[0].message);
                } 
            });  
       }
       function reserve(serviceDate){
             var postData = {};
            postData.userInfoId = paramJson.userInfoId;
            postData.serviceDate = serviceDate;
            postData.businessInfoId = paramJson.businessInfoId;
            postData.cocoCode = paramJson.cocoCode;
            postData.mobile = paramJson.mobile;
            postData.busiDinnerRelId = paramJson.busiDinnerRelId; 
			postData.channelId = "4"; 
             $.ajax({
                    url: '/yangchebao-weixin-ws/ws/0.1/coco/appointment',
                    type: 'post', 
                    data:$.toJSON(postData),
                    dataType: 'json',
                    contentType:'application/json;charset=utf-8',
                    success:function(data){ 
					    $(".overlay-wrap").hide();
                        window.location.href = "prize-success.html";  
                    },error:function(xhr){
                        var mes = eval('('+xhr.responseText+')'); 
                        $(".overlay-wrap").hide();
						alertTasat(mes[0].message);
                    } 
                });  

       }
    }); 
</script>
</body>
</html>
