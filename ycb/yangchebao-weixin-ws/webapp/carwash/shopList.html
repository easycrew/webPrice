<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<script type="text/javascript" src="./js/jquery-1.9.1.min.js"></script> 
<link rel="stylesheet" href="./css/index.css">
<title>商家列表</title>
</head> 
<body>   
    <ul class="list-module-pic"> 
    </ul>
    <p class="null-tip">暂无商家</p>
    <p class="tip">点击查看更多</p>  
<script type="text/javascript">
   $(document).ready(function(){ 
      var url =window.location.search;    
      var paramJson = {};
      if(url!=undefined&&url!=""){
        var paramsArr = (url.split("?")[1]).split("&"); 
        $.each(paramsArr,function(i){
         var item = paramsArr[i].split("=");
         paramJson[item[0]] = item[1];
        });    
      }   
      $("ul").on('click','li',function(){
         var id = $(this).attr("shopId"); 
         window.location.href = "shop-detail.html?businessInfoId="+id+"&openid="+paramJson.openid+"&customerId="+paramJson.customerId 
      });
      $(".tip").click(function(){
        getShopList();
      });
      var pageindex = 0;
      getShopList();
      function getShopList(){ 
          $.ajax({
              url: '/yangchebao-weixin-ws/ws/0.1/carwash/getShopList?openid='+paramJson.openid+'&pagesize=10&pageindex='+pageindex,
              type: 'get', 
              dataType: 'json',
              success: function(data) {   
                  if((data.shopList.page+1)<data.shopList.totalPages){
                    $(".tip").show();
                  } else{
                    $(".tip").hide();
                  } 
                  pageindex++; 
                  var items = data.shopList.items;
                  if(items.length>0){
                  $.each(items,function(i){
                    var item = items[i];
                    var _li = '<li style="margin-top:0;" shopId="'+item.id+'"> '
                        +'<div class="clearfix">'
                        +'<div class="pic"><img src="'+item.logo+'"/></div>'
                        +'<div>'
                        +'<h3><span class="tit">'+item.name+'</span><span class="distanceLabel">'+item.distance+'</span></h3> '
                        +'<p class="info">'+item.address+'</p> '
                        +'<p class="notice">关注：'+item.attentionNumber+'<span class="price">￥'+item.totalPrivilegePrice+'</span></p> '
                        +'</div>'
                        +'</div>'
                        +'</li>';
                    $(".list-module-pic").append(_li);
                  });
                }else{
                   $(".null-tip").show();
                }
              },error:function(xhr){  
              }
          });  
      } 
   });
</script> 
</body>
</html>