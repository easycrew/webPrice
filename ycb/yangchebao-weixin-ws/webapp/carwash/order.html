<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script> 
<link rel="stylesheet" href="./css/index.css">
<title>我的订单</title>
</head> 
<body style="background-color:#f4f7f8;">   
    <p class="msg-tip">订单更多详情，请点击<a href="javascript:void(0);" id="download">下载客户端</a>！</p>
    <ul class="list-module"> 
    </ul> 
    <p class="null-tip">暂无订单</p>
    <p class="tip">点击查看更多</p>  
<script type="text/javascript">
	function  is_weixin(){
        var ua = navigator.userAgent.toLowerCase();
        if(ua.match(/MicroMessenger/i)=="micromessenger") {
            $('#download').attr('path','http://a.app.qq.com/o/simple.jsp?pkgname=com.carsmart.emaintain');
        }else{
            var sUserAgent = navigator.userAgent.toLowerCase(); 
            var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
            var bIsIphone = sUserAgent.match(/iphone/i) == "iphone";
            var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
            var bIsAndroid = sUserAgent.match(/android/i) == "android"; 
            if(bIsIpad || bIsIphone || bIsIphoneOs){
                $('#download').attr('path','https://itunes.apple.com/us/app/yang-che-bao/id736543893');
            }else{   
                $('#download').attr('path','http://yangchebao.com.cn/website-ws/ws/0.1/app/download');
            }
        } 
    } 
   $(document).ready(function(){
      var url =window.location.search;    
      var paramJson = {};
      if(url!=undefined&&url!=""){
        var paramsArr = (url.split("?")[1]).split("&"); 
        $.each(paramsArr,function(i){
         var item = paramsArr[i].split("=");
         paramJson[item[0]] = item[1];
        });    
      }   
	   is_weixin();    
       $("#download").click(function(){ 
            window.location.href = $(this).attr("path");
       });
      $("ul").on('click','li',function(){
         var id = $(this).attr("orderid"); 
         window.location.href = "order-detail.html?orderId="+id+"&customerId="+paramJson.customerId;   
      });
      $(".tip").click(function(){
        getOrderList();
      });
      var pageindex = 0;
      getOrderList(); 
      function getOrderList(){ 
          $.ajax({
              url: '/yangchebao-weixin-ws/ws/0.1/carwash/getOrderList?customerId='+paramJson.customerId+'&pagesize=10&pageindex='+pageindex,
              type: 'get', 
              dataType: 'json',
              success: function(data) {  
                  var data = data.shopList;
                  if((data.page+1)<data.totalPages){
                    $(".tip").show();
                  } else{
                    $(".tip").hide();
                  } 
                  pageindex++;  
                  var items = data.items;
                  if(items.length>0){
                  $.each(items,function(i){
                    var item = items[i];   
                    var _li = '<li orderid="'+item.orderId+'">'
                            +'<h1>'+item.businessName+'<label class="arrow"></label></h1>'
                            +'<h2>'+item.extraName+'<span class="price">¥'+item.payment+'</span></h2>'
                            +'<p>状&nbsp;&nbsp;&nbsp;&nbsp;态：<span class="org">'+ item.orderStatusName+'</span><br>订单号：'+item.orderNumber+'</p>'
                            +'</li>';
                    $("ul").append(_li);
                  });
                }else{
                   $(".null-tip").show();
                }
              },error:function(xhr){  
              }
          });  
      } 
   });
</script>  
</body>
</html>