<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<script type="text/javascript" src="./js/jquery-1.9.1.min.js"></script>  
<script type="text/javascript" src="./js/jquery.json-2.2.js"></script> 
<link rel="stylesheet" href="css/index.css">
<title>违章查询</title>
</head> 
<style type="text/css">  
.traffic-list .title{
  padding: 0 0.67em 0 2.6em;
  height: 52px;
  line-height: 52px;
  font-size: 1.5em;
  font-weight: normal;
  background-color: #fff;
  border-bottom: 1px solid #d9d9e2;
  background-image: url(css/images/wz-icon.png);
  background-position: 10px center;
  background-repeat: no-repeat;
  background-size: 22px auto;
}
.traffic-list a{
  float: right;
  display: block;
  height: 52px;
  color: #a9c5da;
}
.traffic-list ul{
  margin: 0 1em;
} 
.traffic-list li{
  border: 1px solid #d9d9e2;
  font-weight: 1.4em;
  padding: 1em 2em;
  border-radius: 1px;
  background-color: #fff; 
  margin-top: 1em;
  position: relative;
}
.traffic-list li h1{
   font-weight: normal;
   height: 40px;
   line-height: 40px;
} 
.traffic-list .year{
   color: #fb451f;
   font-size: 1.1em;
   display: inline-block;
   margin-right: 10px;
}
.traffic-list p{ 
  font-size: 1.4em; 
  line-height: 150%;
}
.traffic-list .money{ 
  text-align: right;
  border-top: 1px solid #d9d9e2;
  margin-top: 10px;
  padding-top: 8px;
  color: #fb451f;
}
.traffic-list .money span{ 
  float: left;
}
.traffic-list .money.gray{ 
  color: #aeaeac;
}
.traffic-list .icon{
   background-image: url(css/images/punish.png);
   width: 64px;
   height: 59px;
   display: block;
   background-size: 64px auto;
   position: absolute;
   right: -10px;
   top: -10px;
} 
</style>
<body style="background-color:#f4f7f8;">  
  <section class="traffic-list">
  <h1 class="title"><span id="carNumber"></span><a href="javascript:void(0)" id="editBtn">修改车辆信息 ></a></h1>
    <ul> 
    <!--<li> 
          <span class="icon"></span>
          <h1><span class="year">2013-06-20</span> 13:56:32</h1>
          <p>违章详情：闯红灯</p>
          <p>地点：东新街十字路口</p>
          <p class="money">罚款：200 &nbsp;&nbsp;&nbsp;&nbsp;  扣分：2</p>
        </li> -->
    </ul>  
  </section>
  <p class="null-tip">暂无违章信息</p>
  <p class="tip">点击查看更多</p>   
<script type="text/javascript">
   $(document).ready(function(){
      var url =window.location.search;    
      var paramJson = {};
      if(url!=undefined&&url!=""){
        var paramsArr = (url.split("?")[1]).split("&"); 
        $.each(paramsArr,function(i){
         var item = paramsArr[i].split("=");
         paramJson[item[0]] = item[1];
        });    
      }     
      $(".tip").click(function(){
        getTrafficMsg();
      });
      $("#editBtn").click(function(){
        window.location.href = "trafficCar.html?openid="+paramJson.openid+"&type=edit"
      }); 
      var pageindex = 0;
      getTrafficMsg();
      function getTrafficMsg(){  
          $.ajax({
              url: '/yangchebao-weixin-ws/ws/0.1/traffic/getTrafficMsg?openid='+paramJson.openid+'&pagesize=10&pageindex='+pageindex,
              type: 'get', 
              dataType: 'json',
              success: function(data) {   
                  $("#carNumber").html(data.carNumber);
                  if(data.trafficMsg==undefined){
				      $(".null-tip").show();
                      return;
                  } 
                  if((data.trafficMsg.page+1)<data.trafficMsg.totalPages){
                    $(".tip").show();
                  } else{
                    $(".tip").hide();
                  } 
                  pageindex++; 
                  var items = data.trafficMsg.items; 
                  if(items.length>0){
                  $.each(items,function(i){
                    var item = items[i];
                    var time = item.offenceTime.split(" ");  
                    if(item.offencePoint==""){
                      item.offencePoint="暂未取到";
                    }
                    if(item.offenceAmount==""){
                      item.offenceAmount="暂未取到";
                    }
                    var p = "";
                    var icon = "";
                    if(item.isHandled){
                      p='<p class="money gray"><span>已处理</span>罚款:'+item.offenceAmount+' &nbsp;  扣分:'+item.offencePoint+'</p>';
                    }else{
                      p='<p class="money"><span>未处理</span>罚款:'+item.offenceAmount+' &nbsp;扣分:'+item.offencePoint+'</p>';
                      icon = '<span class="icon"></span>';
                    }
                    var _li = '<li>' 
                          + icon
                          +'<h1><span class="year">'+time[0]+'</span> '+time[1]+'</h1>'
                          +'<p>违章详情：'+item.offenceReason+'</p>'
                          +'<p>地点：'+item.offenceLocation+'</p>'
                          + p
                          +'</li>';
                    $("ul").append(_li);
                  });
                }else{
                   $(".null-tip").show();
                }
              },error:function(xhr){  
              }
          });  
      }  
   });
</script>  
</body>
</html>