<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<script type="text/javascript" src="./js/jquery-1.9.1.min.js"></script>  
<script type="text/javascript" src="./js/jquery.json-2.2.js"></script> 
<script type="text/javascript" src="./js/index.js"></script> 
<link rel="stylesheet" href="css/index.css">
<title>选择车系</title>
</head> 
<style type="text/css">  
.h-overflow {
    height:100%;
	overflow:hidden;
}
.close{
    position: absolute;
    right: 20px;
    top: 10px;
}
</style>
<body style="background-color:#f4f7f8;">   
  <section class="brand-wrap">
    <div class="brandList"> 
    </div>
    <div class="car-overlay" style="display:none;"></div>
    <article class="car-wrap" style="display:none;">   
       <span class="close"><label></label></span>
    </article> 
  </section>
  <div class="overlay-wrap"></div> 
<script type="text/javascript">
$(document).ready(function(){  
      var url = window.location.search;  
      var paramJson = {};
      if(url!=undefined&&url!=""){
        var paramsArr = (url.split("?")[1]).split("&"); 
        $.each(paramsArr,function(i){
         var item = paramsArr[i].split("=");
         paramJson[item[0]] = item[1];
        });    
      }     
      $(".car-wrap").on('click','.close',function(){
          $(".car-wrap").fadeOut();
          $(".car-wrap").html('<span class="close"><label></label></span>');
          $(".car-overlay").fadeOut();
		  //$('.brand-wrap').removeClass("h-overflow");
      }); 
      $(".brandList").on('click','li',function(){ 
           var brandid = $(this).attr("brandid");
           paramJson.brandid =brandid;
           getCarList(brandid);
           //$('.brand-wrap').addClass("h-overflow");
		   $(document).scrollTop(0); 
		   $(".car-overlay").fadeIn();
           $(".car-wrap").fadeIn();  
      }); 
     $(".car-wrap").on('click','li',function(){  
           paramJson.modelId=$(this).attr("modelid");
           var modelName = $(this).html(); 
           $(".carCheckBtn span").html(modelName); 
           $(".brand-wrap").fadeOut();
		   //$('.brand-wrap').removeClass("h-overflow");
		   $(".car-wrap").html('<span class="close"><label></label></span>');
           $(".car-wrap").hide();
           $(".car-overlay").hide();
           $(".regist-wrap").fadeIn();
           if(paramJson.userId!=undefined&&paramJson.userId!=""){
              modifyModel(); 
           } 
    });    
      getBrandMsg();
      function getBrandMsg(){ 
          $.ajax({
              url: '/shopmanage-ws/ws/0.1/support/brand/list',
              type: 'get', 
              dataType: 'json',
              success: function(data) {  
                 $.each(data,function(k,v){
                    var _h1 = '<h1 class="word">'+k+'</h1>'; 
                    $(".brandList").append(_h1);
                    var _ul = $("<ul>");
                    var items = v;
                    $.each(items,function(i){
                    var item = items[i];
                    var _li = $("<li>").html(item.name).attr("brandid",item.id); 
                    _ul.append(_li); 
                    }); 
                    $(".brandList").append(_ul);
                 });  
              },error:function(xhr){  
              }
          });  
      }
      function getCarList(brandid){ 
          $.ajax({
              url: '/shopmanage-ws/ws/0.1/support/model/list?brandId='+brandid,
              type: 'get', 
              dataType: 'json',
              success: function(data) {    
                 $.each(data,function(i){
                    var item = data[i];
                    var _h1 = '<h1 class="word">'+item.name+'</h1>';  
                    $(".car-wrap").append(_h1);
                    var _ul = $("<ul>").attr("class","carList");
                    var models = item.models;
                    $.each(models,function(i){
                    var model = models[i];
                    var _li = $("<li>").html(model.name).attr("modelid",model.id); 
                    _ul.append(_li); 
                    }); 
                    $(".car-wrap").append(_ul);
                 });  
              },error:function(xhr){  
              }
          });  
      }     
      function modifyModel(){ 
          var postData = {};
          postData.brandId= paramJson.brandid;
          postData.modelId= paramJson.modelId;
          postData.userId= paramJson.userId;
          $.ajax({  
              url: '/yangchebao-weixin-ws/ws/0.1/carwash/boundCarInfo',
              type: 'post', 
              data:$.toJSON(postData),
              dataType: 'json',
              async:'false',
              contentType:'application/json;charset=utf-8', 
              success: function(data) {    
                 window.location.href = "carwash.html"+url; 
              },error:function(xhr){  
              }
          });  
      } 
}); 
</script>  
</body>
</html>