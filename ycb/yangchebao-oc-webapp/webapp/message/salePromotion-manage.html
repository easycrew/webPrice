 <div class="urlContentWraper" id="Wraper_salePromotion_manage">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>业务员工资流水表</strong><bottom class="all-work-info numb914">页面说明</bottom></h2>
        <!-- 列表显示 -->
        <div class="pic-grid">
			<table id="Table_salePromotion_manage"></table>
		</div>
    </div>
    <div id="Form_auditReject" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <input name="salesmanSalaryReviewId" type="hidden"> 
            <div class="row">
	             <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>驳回原因：</label>
	             <div class="span5 grid-layout-content">
	                   <div name="reviewRejectReason" class="jrad-textarea-container"></div>
	             </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div> 
    <div id="Form_salary" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
        <div class="row">
             <label class="span4 grid-layout-label">注册工资（元）：</label>
             <div class="span5 grid-layout-content">
                   <div name="registSalary" class="jrad-input-container"></div>
             </div>
        </div>      
        <div class="row">
             <label class="span4 grid-layout-label">首单工资（元）：</label>
             <div class="span5 grid-layout-content">
                   <div name="firstOrderSalary" class="jrad-input-container"></div>
             </div>
        </div>
        <div class="row">
             <label class="span4 grid-layout-label">最小提现金额（支付宝）：</label>
             <div class="span5 grid-layout-content">
                   <div name="minAlipayCash" class="jrad-input-container"></div>
             </div>
        </div>
        <div class="row">
             <label class="span4 grid-layout-label">最小提现金额（银行卡）：</label>
             <div class="span5 grid-layout-content">
                   <div name="minBankCash" class="jrad-input-container"></div>
             </div>
        </div>
             	<p class="ui-note"><label class="span2 grid-layout-label"></label>注册工资：用户注册时发给业务员工资；<br>首单工资：注册用户当天完成首单发给用户的工资。</p>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
    <div id="Form_explain_eg914" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>在咱们养车宝微信公众号，有个“轻松兼职”的版块，可以在上面推荐用户注册和使用服务，然后得到工资，此功能包含对工资金额的设置，用户具体获得工资的列表。</div>
                    <div><strong>重要功能说明：</strong>①审核通过：用户每天获得工资次数超过30次时，是需要审核的，只有审核通过后，才能获得30次以后的工资；
              ②审核驳回：超过30次的工资，驳回后，就不能获得此工资了；
              ③工资金额设置：获得工资的金额设置。</div>
                    <div><strong>注意事项：</strong>无。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>     
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_salePromotion_manage');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();
	// var jRad = $.jRad('/radsample-ws','ent','Menu');	
	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});  

    // 省市区select值
	jRad.params['provinceCodeSearch'] = {
			urlData:{
				url:'/euc/ws/0.1/user/provinces?userId='+carsmart_config.userId
			},
			unshiftData: {id:'',name:'请选择'},
			onchange: function(){
				var provinceCode = $('.searchContent div[name=provinceId]',wraper).select('val');
				if(provinceCode==''){
					$('.searchContent div[name=cityId]',wraper).select({
																urlData:{url:''},
																data:[{id:'',name:'请选择'}],
																val: ''});
				}else{
				$('.searchContent div[name=cityId]',wraper).select({
					urlData:{
						url: '/euc/ws/0.1/user/cities?provinceId='+provinceCode+'&userId='+carsmart_config.userId
					},
					unshiftData: {id:'',name:'请选择'},
					val:''
				});
				} 
			}
		};
	jRad.params['cityIdSearch'] = {
		data: [{id:'',name:'请选择'}]
	};

	jRad.validators['reviewRejectReason']=[{msg:'请填写原因',type:'min',value:'1'},{msg:'字数不能超过20',type:'max',value:'20'}];

	$('#Form_auditReject div[name="reviewRejectReason"]',wraper).textarea({
		grid:10,
		rows:5
	});

    $('#Form_auditReject').form({
		title: '审核驳回', 
		validators:jRad.validators,
		grid:14,
		fluid: true,
		autobinding:true  
	});
	$('#Form_salary').form({
		title: '工资金额设置', 
		grid:12,
		fluid: true,
		autobinding:true  
	});
	page_column_model.push({display: 'ID', name : 'salesmanSalaryReviewId'});
    page_column_model.push({display: '数据生成时间', name : 'createDate'});
    page_column_model.push({display: '用户ID', name : 'userInfoId'});
    page_column_model.push({display: '业务员ID', name : 'salesmanInfoId'});
    page_column_model.push({display: '城市', name : 'city'});
    page_column_model.push({display: '累计工资（元）', name : 'salesmanTotleSalary'});
	page_column_model.push({display: '剩余工资（元）', name : 'salesmanRestSalary'});
	page_column_model.push({display: '工资变动', name : 'realSalary',diy:function(item,$div){
		if(item.realSalary>0||item.realSalary==0){
			$div.html('+'+item.realSalary)
		}
	}});
	page_column_model.push({display: '是否转账', name : 'withdrawStatus'});
	page_column_model.push({display: '当天次数', name : 'applyNumber'});
	page_column_model.push({display: '变动原因', name : 'changeReason'});
	page_column_model.push({display: '备注', name : 'remarks'});
	page_column_model.push({display: '审核状态', name : 'reviewStatus',diy:function(item,$div){
		if(item.reviewStatus=='审核驳回'){
			$div.html(item.reviewStatus+'<br><a class="rejectReason">驳回原因</a>');
			$("a.rejectReason",$div).click(function(){
				$.jRadAlert(item.reviewRejectReason,'info')
			})
		}else{
			$div.html(item.reviewStatus)
		}
	}
});
	page_column_model.push({display: '审核时间', name : 'reviewDate'});
	page_column_model.push({display: '审核人', name : 'reviewPeople'});
      
	page_search_items.push({row:'1',type:'jrad-input',display:'ID',name:'salesmanSalaryReviewId'});
	page_search_items.push({row:'1',type:'jrad-input',display:'用户ID',name:'userInfoId'});
	page_search_items.push({row:'1',type:'jrad-input',display:'用户手机号',name:'mobile'});
	page_search_items.push({row:'2',type:'jrad-input',display:'业务员ID',name:'salesmanInfoId'});
	page_search_items.push({row:'2',type:'jrad-select',display:'省',name:'provinceId',params:jRad.params['provinceCodeSearch']});
	page_search_items.push({row:'2',type:'jrad-select',display:'市',name:'cityId',params:jRad.params['cityIdSearch']});
	page_search_items.push({row:'3',type:'jrad-select',display:'变动原因',name:'changeReason',params:{data:[
		{id:'',name:'全部'},
		{id:'1',name:'注册工资'},
		{id:'2',name:'注册工资审核中'},
		{id:'3',name:'首单工资'},
		{id:'4',name:'首单工资审核中'},
		{id:'5',name:'注册工资驳回'},
		{id:'6',name:'首单工资驳回'}
		]}});
	page_search_items.push({row:'3',type:'jrad-dateinput',display:'数据生成时间始',name:'createDateStart'});
	page_search_items.push({row:'3',type:'jrad-dateinput',display:'数据生成时间终',name:'createDateEnd'});
	page_search_items.push({row:'4',type:'jrad-select',display:'审核状态',name:'reviewStatus',params:{data:[
		{id:'',name:'全部'},
		{id:'1',name:'审核中'},
		{id:'2',name:'审核通过'},
		{id:'3',name:'审核驳回'}
		]}});
	page_search_items.push({row:'4',type:'jrad-dateinput',display:'审核时间始',name:'reviewDateStart'});
	page_search_items.push({row:'4',type:'jrad-dateinput',display:'审核时间终',name:'reviewDateEnd'});
	page_search_items.push({row:'5',type:'jrad-select',display:'是否转账',name:'withdrawStatus',params:{data:[
		{id:'',name:'全部'},
		{id:'3',name:'是'},
		{id:'2',name:'否'}
		]}});
	 
    page_list_buttons.push({displayname: '审核通过',title:'审核通过',name:'pass',bclass: 'pass',prefunc:function(){
            var checked = $('#Table_salePromotion_manage').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
	    	var checked = $('#Table_salePromotion_manage').getCheckedTrs();
			$.jRadConfirm('确认审核通过吗？',1,function(){
				var postData={};
				postData.salesmanSalaryReviewId=checked[0].salesmanSalaryReviewId;
				postData.reviewPeople=carsmart_config.operatorName;
				$.jRadAjax({
					type:'post',
					data:postData,
					url:'/shopmanage-ws/ws/0.1/salesman/changeReviewStatusToOk',
					success:function(){
						$('#Table_salePromotion_manage').flexMessage('审核通过成功!', 'success');
           	    		$('#Table_salePromotion_manage').flexReloadCurrentPage();
					},
					error:function(xhr){
						var errormsg = eval("(" + xhr.responseText + ")"); 
						if (errormsg != undefined) {
							$('#Table_salePromotion_manage').flexMessage(errormsg[0].message, 'error');
						}
					}
				})
			})
		}
	});
 	page_list_buttons.push({displayname: '审核驳回',title:'审核驳回',name:'reject',bclass: 'pass',prefunc:function(){
            var checked = $('#Table_salePromotion_manage').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
	    	var checked = $('#Table_salePromotion_manage').getCheckedTrs();
	    	if(checked[0].reviewStatus=="审核通过"){
	    		$.jRadAlert('“审核通过”后无法驳回！','error')
	    	}else{
	    		$('#Form_auditReject').form({
					title: '审核驳回', 
					height:120,
					item:{},
					url:'/shopmanage-ws/ws/0.1/salesman/changeReviewStatusToFalse',
					before_submit:function(json){
						json.salesmanSalaryReviewId=checked[0].salesmanSalaryReviewId;
						json.reviewPeople=carsmart_config.operatorName;
						return json
					},
					success_callback:function(){ 
						$('#Table_salePromotion_manage').flexMessage('驳回成功', 'success');
						$('#Table_salePromotion_manage').flexReloadCurrentPage();
					}
				}).form('open');
	    	}	
		}
	});
	page_list_buttons.push({displayname: '工资金额设置',title:'工资金额设置',name:'salary',bclass: 'salary',onpress : function(){
	    	var checked = $('#Table_salePromotion_manage').getCheckedTrs();
	    	var _item=$.jRadGet({'url':'/shopmanage-ws/ws/0.1/salesman/getConfigMessage'});
			$('#Form_salary').form({
				title: '工资金额设置', 
				height:180,
				item:_item,
				url:'/shopmanage-ws/ws/0.1/salesman/setSystemConfig',
				success_callback:function(){ 
					$('#Table_salePromotion_manage').flexMessage('设置成功', 'success');
					$('#Table_salePromotion_manage').flexReloadCurrentPage();
				}
			}).form('open');
		}
	});
	page_list_buttons.push({displayname: '导出EXCEL',name:'excel', bclass: 'excel',onpress : function(){ 
		 $ .jRadConfirm('确认导出吗？',1,function(){
				 var param = {};
				 var salesmanSalaryReviewId = $.trim($(".searchContent div[name='salesmanSalaryReviewId']",wraper).input('val'));
				 if(salesmanSalaryReviewId!=""){
					param['salesmanSalaryReviewId'] = salesmanSalaryReviewId;
				 }; 
				 var userInfoId = $.trim($(".searchContent div[name='userInfoId']",wraper).input('val'));
				 if(userInfoId!=""){
					param['userInfoId'] = userInfoId;
				 };
				 var salesmanInfoId = $.trim($(".searchContent div[name='salesmanInfoId']",wraper).input('val'));
				 if(salesmanInfoId!=""){
					param['salesmanInfoId'] = salesmanInfoId;
				 }; 
				 var provinceId = $.trim($(".searchContent div[name='provinceId']",wraper).select('val'));
				 if(provinceId!=""){
					param['provinceId'] = provinceId;
				 };
				 var cityId = $.trim($(".searchContent div[name='cityId']",wraper).select('val'));
				 if(cityId!=""){
					param['cityId'] = cityId;
				 }; 
				 var changeReason = $.trim($(".searchContent div[name='changeReason']",wraper).select('val'));
				 if(changeReason!=""){
					param['changeReason'] = changeReason;
				 }; 
				 var createDateStart = $.trim($(".searchContent div[name='createDateStart']",wraper).dateinput('val'));
				 if(createDateStart!=""){
					param['createDateStart'] = createDateStart;
				 };
				 var createDateEnd = $.trim($(".searchContent div[name='createDateEnd']",wraper).dateinput('val'));
				 if(createDateEnd!=""){
					param['createDateEnd'] = createDateEnd;
				 };
				 var reviewStatus = $.trim($(".searchContent div[name='reviewStatus']",wraper).select('val'));
				 if(reviewStatus!=""){
					param['reviewStatus'] = reviewStatus;
				 }; 
				 var reviewDateStart = $.trim($(".searchContent div[name='reviewDateStart']",wraper).dateinput('val'));
				 if(reviewDateStart!=""){
					param['reviewDateStart'] = reviewDateStart;
				 }; 
				 var reviewDateEnd = $.trim($(".searchContent div[name='reviewDateEnd']",wraper).dateinput('val'));
				 if(reviewDateEnd!=""){
					param['reviewDateEnd'] = reviewDateEnd;
				 };  
				 var withdrawStatus = $.trim($(".searchContent div[name='withdrawStatus']",wraper).select('val'));
				 if(withdrawStatus!=""){
					param['withdrawStatus'] = withdrawStatus;
				 };
				 
				 var paramUrl = "";
				 if(param!={}){   
				 paramUrl+="?"
				 $.each(param,function(k,v){ 
						paramUrl+="&"+k+"="+v; 
				 });
				 }
				 window.open('/shopmanage-ws/ws/0.1/salesman/exportReviewDate'+paramUrl);
			}); 
        }
    });
  
    page_list_buttons.push({separator: true});

	$('#Table_salePromotion_manage').flexigrid({
			reload:true,
			method:'get',
			colModel : page_column_model,
			searchitems :page_search_items,
			buttons: page_list_buttons,
			showSearch:true,
			pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			},
			url:'/shopmanage-ws/ws/0.1/salesman/querySalaryReview',
			// queryUrl:'/shopmanage-ws/ws/0.1/salesman/getToalChangeSalary',
			onError:showRemarkError,
			checkBoxType:'single',
			overflow:true 
	}); 
	
	var total=$.jRadGet({url:'/shopmanage-ws/ws/0.1/salesman/getToalChangeSalary'});
	$('.hDivBox th:eq(8)',wraper).html('&nbsp;&nbsp;&nbsp;工资变动<br>（合计'+total.totalCash+'元）');  
	$('.ui-btn-icon:first',wraper).click(function(){
		var param = {};
				 var salesmanSalaryReviewId = $.trim($(".searchContent div[name='salesmanSalaryReviewId']",wraper).input('val'));
				 if(salesmanSalaryReviewId!=""){
					param['salesmanSalaryReviewId'] = salesmanSalaryReviewId;
				 }; 
				 var userInfoId = $.trim($(".searchContent div[name='userInfoId']",wraper).input('val'));
				 if(userInfoId!=""){
					param['userInfoId'] = userInfoId;
				 };
				 var salesmanInfoId = $.trim($(".searchContent div[name='salesmanInfoId']",wraper).input('val'));
				 if(salesmanInfoId!=""){
					param['salesmanInfoId'] = salesmanInfoId;
				 }; 
				 var provinceId = $.trim($(".searchContent div[name='provinceId']",wraper).select('val'));
				 if(provinceId!=""){
					param['provinceId'] = provinceId;
				 };
				 var cityId = $.trim($(".searchContent div[name='cityId']",wraper).select('val'));
				 if(cityId!=""){
					param['cityId'] = cityId;
				 }; 
				 var changeReason = $.trim($(".searchContent div[name='changeReason']",wraper).select('val'));
				 if(changeReason!=""){
					param['changeReason'] = changeReason;
				 }; 
				 var createDateStart = $.trim($(".searchContent div[name='createDateStart']",wraper).dateinput('val'));
				 if(createDateStart!=""){
					param['createDateStart'] = createDateStart;
				 };
				 var createDateEnd = $.trim($(".searchContent div[name='createDateEnd']",wraper).dateinput('val'));
				 if(createDateEnd!=""){
					param['createDateEnd'] = createDateEnd;
				 };
				 var reviewStatus = $.trim($(".searchContent div[name='reviewStatus']",wraper).select('val'));
				 if(reviewStatus!=""){
					param['reviewStatus'] = reviewStatus;
				 }; 
				 var reviewDateStart = $.trim($(".searchContent div[name='reviewDateStart']",wraper).dateinput('val'));
				 if(reviewDateStart!=""){
					param['reviewDateStart'] = reviewDateStart;
				 }; 
				 var reviewDateEnd = $.trim($(".searchContent div[name='reviewDateEnd']",wraper).dateinput('val'));
				 if(reviewDateEnd!=""){
					param['reviewDateEnd'] = reviewDateEnd;
				 };  
				 var withdrawStatus = $.trim($(".searchContent div[name='withdrawStatus']",wraper).select('val'));
				 if(withdrawStatus!=""){
					param['withdrawStatus'] = withdrawStatus;
				 };
				 var mobile = $.trim($(".searchContent div[name='mobile']",wraper).input('val'));
				 if(mobile!=""){
					param['mobile'] = mobile;
				 };
				 
				 var paramUrl = "";
				 if(param!={}){   
				 paramUrl+="?"
				 $.each(param,function(k,v){ 
						paramUrl+="&"+k+"="+v; 
				 });
				 } 
				 var _total=$.jRadGet({url:'/shopmanage-ws/ws/0.1/salesman/getToalChangeSalary'+paramUrl});
				$('.hDivBox th:eq(8)',wraper).html('&nbsp;&nbsp;&nbsp;工资变动<br>（合计'+_total.totalCash+'元）'); 
	})
	
    $(".numb914").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg914").form({}).form('close');
        $("#Form_explain_eg914").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
            submit:function(){
                var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg914 div[name='remark']").textarea("val")
                $.jRadPost({
                    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
                    data:postData,
                    success:function(){
                        $("#Form_explain_eg914").form('close')
                        $('.overcurtainDiv').hide();
                    }
                });
            }, 
            cancel:function(){
                $("#Form_explain_eg914").form('close')
                $('.overcurtainDiv').hide();
            }
        }).form('open')
        $("#Form_explain_eg914 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
 });
	function showRemarkError(xhr){
			 var errormsg = eval("(" + xhr.responseText + ")");
			  var cDiv = $("#Wraper_salePromotion_manage .cDiv");
			  $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
	}
 </script> 
 
