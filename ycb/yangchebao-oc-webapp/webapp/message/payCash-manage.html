 <div class="urlContentWraper" id="Wraper_payCash_manage">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>提现列表</strong><bottom class="all-work-info numb915">页面说明</bottom></h2>
        <!-- 列表显示 -->
        <div class="pic-grid">
			<table id="Table_payCash_manage"></table>
		</div>
		<h2 class="ui-tit" style="margin-top:12px;"><strong>提现详情列表</strong></h2>
        <!-- 列表显示 -->
        <div class="pic-grid">
			<table id="Table_payCash_detail"></table>
		</div>
    </div> 
    <div id="Form_explain_eg915" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>用户在轻松兼职获取工资后，提现申请将在这里展示。</div>
                    <div><strong>重要功能说明：</strong>①设为已转账：若此工资已线下转账，设为已转账即可。</div>
                    <div><strong>注意事项：</strong>无。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>     
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_payCash_manage');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();
    var page_column_model_c = new Array();
    var page_search_items_c = new Array();
    var page_list_buttons_c = new Array();
	// var jRad = $.jRad('/radsample-ws','ent','Menu');	
	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});  

    // 省市区select值
	jRad.params['provinceCodeSearch'] = {
			urlData:{
				url:'/euc/ws/0.1/user/provinces?userId='+carsmart_config.userId
			},
			unshiftData: {id:'',name:'请选择'},
			onchange: function(){
				var provinceCode = $('.searchContent div[name=provinceId]',wraper).select('val');
				if(provinceCode==''){
					$('.searchContent div[name=cityId]',wraper).select({
																urlData:{url:''},
																data:[{id:'',name:'请选择'}],
																val: ''});
				}else{
				$('.searchContent div[name=cityId]',wraper).select({
					urlData:{
						url: '/euc/ws/0.1/user/cities?provinceId='+provinceCode+'&userId='+carsmart_config.userId
					},
					unshiftData: {id:'',name:'请选择'},
					val:''
				});
				} 
			}
		};
	jRad.params['cityIdSearch'] = {
		data: [{id:'',name:'请选择'}]
	};

	page_column_model.push({display: 'ID', name : 'salesmanWithdrawId'});
    page_column_model.push({display: '业务员姓名', name : 'realName'});
    page_column_model.push({display: '手机号码', name : 'mobile'});
    page_column_model.push({display: '所属商家', name : 'ownedBusiness'});
    page_column_model.push({display: '城市', name : 'city'});
    page_column_model.push({display: '申请提现金额', name : 'cash'});
	page_column_model.push({display: '提现方式', name : 'payType'});
	page_column_model.push({display: '是否转账', name : 'isWithdraw'});
	page_column_model.push({display: '申请提现时间', name : 'applyWithdrawDate'});
	page_column_model.push({display: '转账时间', name : 'withdrawDate'});
	page_column_model.push({display: '最后操作人', name : 'lastModifyPeople'});
      
	page_search_items.push({row:'1',type:'jrad-input',display:'ID',name:'salesmanWithdrawId'});
	page_search_items.push({row:'1',type:'jrad-input',display:'业务员姓名',name:'realName'});
	page_search_items.push({row:'1',type:'jrad-input',display:'手机号码',name:'mobile'});
	page_search_items.push({row:'2',type:'jrad-input',display:'所属商家',name:'ownedBusiness'});
	page_search_items.push({row:'2',type:'jrad-select',display:'省',name:'provinceId',params:jRad.params['provinceCodeSearch']});
	page_search_items.push({row:'2',type:'jrad-select',display:'市',name:'cityId',params:jRad.params['cityIdSearch']});
	page_search_items.push({row:'3',type:'jrad-select',display:'提现方式',name:'payType',params:{data:[
		{id:'',name:'全部'},
		{id:'0',name:'支付宝'},
		{id:'1',name:'银行卡'}
		]}});
	page_search_items.push({row:'3',type:'jrad-select',display:'是否转账',name:'withdrawStatus',params:{data:[
		{id:'',name:'全部'},
		{id:'0',name:'否'},
		{id:'1',name:'是'}
		]}});
	page_search_items.push({row:'4',type:'jrad-dateinput',display:'申请提现时间始',name:'applyWithdrawDateStart'});
	page_search_items.push({row:'4',type:'jrad-dateinput',display:'申请提现时间终',name:'applyWithdrawDateEnd'});
	page_search_items.push({row:'5',type:'jrad-dateinput',display:'转账时间始',name:'withdrawDateStart'});
	page_search_items.push({row:'5',type:'jrad-dateinput',display:'转账时间终',name:'withdrawDateEnd'});
	 
    page_list_buttons.push({displayname: '设为已转账',title:'设为已转账',name:'transaction',bclass: 'transaction',prefunc:function(){
            var checked = $('#Table_payCash_manage').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
	    	var checked = $('#Table_payCash_manage').getCheckedTrs();
			$.jRadConfirm('确认已转账？',1,function(){
				var postData={};
				postData.salesmanWithdrawId=checked[0].salesmanWithdrawId;
				postData.lastModifyPeople=carsmart_config.operatorName;
				$.jRadAjax({
					type:'post',
					data:postData,
					url:'/shopmanage-ws/ws/0.1/salesman/setSalesmanSalaryToOk',
					success:function(){
						$('#Table_payCash_manage').flexMessage('设置成功!', 'success');
           	    		$('#Table_payCash_manage').flexReloadCurrentPage();
					},
					error:function(xhr){
						var errormsg = eval("(" + xhr.responseText + ")"); 
						if (errormsg != undefined) {
							$('#Table_payCash_manage').flexMessage(errormsg[0].message, 'error');
						}
					}
				})
			})
		}
	});

	page_list_buttons.push({displayname: '导出EXCEL',name:'excel', bclass: 'excel',onpress : function(){ 
		 $ .jRadConfirm('确认导出吗？',1,function(){
				 var param = {};
				 var salesmanWithdrawId = $.trim($(".searchContent div[name='salesmanWithdrawId']",wraper).input('val'));
				 if(salesmanWithdrawId!=""){
					param['salesmanWithdrawId'] = salesmanWithdrawId;
				 }; 
				 var realName = $.trim($(".searchContent div[name='realName']",wraper).input('val'));
				 if(realName!=""){
					param['realName'] = realName;
				 };
				 var mobile = $.trim($(".searchContent div[name='mobile']",wraper).input('val'));
				 if(mobile!=""){
					param['mobile'] = mobile;
				 }; 
				 var ownedBusiness = $.trim($(".searchContent div[name='ownedBusiness']",wraper).input('val'));
				 if(ownedBusiness!=""){
					param['ownedBusiness'] = ownedBusiness;
				 };
				 var provinceId = $.trim($(".searchContent div[name='provinceId']",wraper).select('val'));
				 if(provinceId!=""){
					param['provinceId'] = provinceId;
				 };
				 var cityId = $.trim($(".searchContent div[name='cityId']",wraper).select('val'));
				 if(cityId!=""){
					param['cityId'] = cityId;
				 }; 
				 var payType = $.trim($(".searchContent div[name='payType']",wraper).select('val'));
				 if(payType!=""){
					param['payType'] = payType;
				 }; 
				 var withdrawStatus = $.trim($(".searchContent div[name='withdrawStatus']",wraper).select('val'));
				 if(withdrawStatus!=""){
					param['withdrawStatus'] = withdrawStatus;
				 };
				 var applyWithdrawDateStart = $.trim($(".searchContent div[name='applyWithdrawDateStart']",wraper).dateinput('val'));
				 if(applyWithdrawDateStart!=""){
					param['applyWithdrawDateStart'] = applyWithdrawDateStart;
				 };
				 var applyWithdrawDateEnd = $.trim($(".searchContent div[name='applyWithdrawDateEnd']",wraper).dateinput('val'));
				 if(applyWithdrawDateEnd!=""){
					param['applyWithdrawDateEnd'] = applyWithdrawDateEnd;
				 }; 
				 var withdrawDateStart = $.trim($(".searchContent div[name='withdrawDateStart']",wraper).dateinput('val'));
				 if(withdrawDateStart!=""){
					param['withdrawDateStart'] = withdrawDateStart;
				 }; 
				 var withdrawDateEnd = $.trim($(".searchContent div[name='withdrawDateEnd']",wraper).dateinput('val'));
				 if(withdrawDateEnd!=""){
					param['withdrawDateEnd'] = withdrawDateEnd;
				 }; 
				 
				 var paramUrl = "";
				 if(param!={}){   
				 paramUrl+="?"
				 $.each(param,function(k,v){ 
						paramUrl+="&"+k+"="+v; 
				 });
				 }
				 window.open('/shopmanage-ws/ws/0.1/salesman/exportWithDrawDate'+paramUrl);
			}); 
        }
    });
  
    page_list_buttons.push({separator: true});


    page_column_model_c.push({display: 'ID', name : 'salesmanSalaryReviewId'});
    page_column_model_c.push({display: '工资变动', name : 'realSalary',diy:function(item,$div){
    	if(item.realSalary>0){
    		$div.html('+'+item.realSalary)
    	}
    }});
    page_column_model_c.push({display: '变动原因', name : 'changeReason'});
    page_column_model_c.push({display: '用户手机', name : 'mobile'});
    page_column_model_c.push({display: '此用户订单所属商家数',name : 'businessCnt'});
    page_column_model_c.push({display: '备注', name : 'remarks'});

	$('#Table_payCash_manage').flexigrid({
			reload:true,
			method:'get',
			colModel : page_column_model,
			searchitems :page_search_items,
			buttons: page_list_buttons,
			showSearch:true,
			pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			},
			url:'/shopmanage-ws/ws/0.1/salesman/queryWithDraw',
			// onError:showRemarkError,
			checkBoxType:'single',
			overflow:true,
			trEvent:function(){
				var checked=$('#Table_payCash_manage').getCheckedTrs();
				var _total=$.jRadGet({url:'/shopmanage-ws/ws/0.1/salesman/getTotalWithdrawSalary?salesmanWithdrawId='+checked[0].salesmanWithdrawId});
				$('#Table_payCash_detail').flexOptions({
					extParam:{
						salesmanWithdrawId:checked[0].salesmanWithdrawId
					}
				}).flexReload();
				$('.hDivBox:eq(1) th:eq(1)',wraper).html('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;工资变动<br>（合计'+_total.totalCash+'元）')
			}
	}); 
	var total=$.jRadGet({url:'/shopmanage-ws/ws/0.1/salesman/getTotalWithdrawSalary'});
	$('.hDivBox:eq(0) th:eq(6)',wraper).html('&nbsp;&nbsp;申请提现金额<br>（合计'+total.totalCash+'元）');
	$('.ui-btn-icon:first',wraper).click(function(){
		var param = {};
				 var salesmanWithdrawId = $.trim($(".searchContent div[name='salesmanWithdrawId']",wraper).input('val'));
				 if(salesmanWithdrawId!=""){
					param['salesmanWithdrawId'] = salesmanWithdrawId;
				 }; 
				 var realName = $.trim($(".searchContent div[name='realName']",wraper).input('val'));
				 if(realName!=""){
					param['realName'] = realName;
				 };
				 var mobile = $.trim($(".searchContent div[name='mobile']",wraper).input('val'));
				 if(mobile!=""){
					param['mobile'] = mobile;
				 }; 
				 var ownedBusiness = $.trim($(".searchContent div[name='ownedBusiness']",wraper).input('val'));
				 if(ownedBusiness!=""){
					param['ownedBusiness'] = ownedBusiness;
				 };
				 var provinceId = $.trim($(".searchContent div[name='provinceId']",wraper).select('val'));
				 if(provinceId!=""){
					param['provinceId'] = provinceId;
				 };
				 var cityId = $.trim($(".searchContent div[name='cityId']",wraper).select('val'));
				 if(cityId!=""){
					param['cityId'] = cityId;
				 }; 
				 var payType = $.trim($(".searchContent div[name='payType']",wraper).select('val'));
				 if(payType!=""){
					param['payType'] = payType;
				 }; 
				 var withdrawStatus = $.trim($(".searchContent div[name='withdrawStatus']",wraper).select('val'));
				 if(withdrawStatus!=""){
					param['withdrawStatus'] = withdrawStatus;
				 };
				 var applyWithdrawDateStart = $.trim($(".searchContent div[name='applyWithdrawDateStart']",wraper).dateinput('val'));
				 if(applyWithdrawDateStart!=""){
					param['applyWithdrawDateStart'] = applyWithdrawDateStart;
				 };
				 var applyWithdrawDateEnd = $.trim($(".searchContent div[name='applyWithdrawDateEnd']",wraper).dateinput('val'));
				 if(applyWithdrawDateEnd!=""){
					param['applyWithdrawDateEnd'] = applyWithdrawDateEnd;
				 }; 
				 var withdrawDateStart = $.trim($(".searchContent div[name='withdrawDateStart']",wraper).dateinput('val'));
				 if(withdrawDateStart!=""){
					param['withdrawDateStart'] = withdrawDateStart;
				 }; 
				 var withdrawDateEnd = $.trim($(".searchContent div[name='withdrawDateEnd']",wraper).dateinput('val'));
				 if(withdrawDateEnd!=""){
					param['withdrawDateEnd'] = withdrawDateEnd;
				 }; 
				 
				 var paramUrl = "";
				 if(param!={}){   
				 paramUrl+="?"
				 $.each(param,function(k,v){ 
						paramUrl+="&"+k+"="+v; 
				 })
				 };
				 var total_two=$.jRadGet({url:'/shopmanage-ws/ws/0.1/salesman/getTotalWithdrawSalary'+paramUrl});
				 $('.hDivBox:eq(0) th:eq(6)',wraper).html('申请提现金额<br>（合计'+total_two.totalCash+'元）')
				 // $("#Wraper_payCash_manage .cDiv:eq(0) .message-tips:eq(0)").hide()
				 // var phoneReg = /^((\+86)|(86)){0,}1\d{10}$/;
				 // if(phoneReg.test(mobile)){
		   //            var total_two=$.jRadGet({url:'/shopmanage-ws/ws/0.1/salesman/getTotalWithdrawSalary'+paramUrl});
				 // 	  $('.hDivBox:eq(0) th:eq(6)',wraper).html('申请提现金额<br>（合计'+total_two.totalCash+'元）')
	    //          }  
				 // var total_two=$.jRadGet({
				 // 	url:'/shopmanage-ws/ws/0.1/salesman/getTotalWithdrawSalary'+paramUrl,
				 // 	success:function(){
				 // 		$('.hDivBox:eq(0) th:eq(6)',wraper).html('申请提现金额<br>（合计'+total_two.totalCash+'元）');
				 // 	},
				 // 	error:function(){
				 // 		// $("#Wraper_payCash_manage .cDiv:eq(0) .message-tips:eq(0)").hide()
				 // 	}
				 // })
				 
	});  
	$('#Table_payCash_detail').flexigrid({
		    autoload: false,
			reload:true,
			method:'get',
			colModel : page_column_model_c,
			searchitems :page_search_items_c,
			buttons: page_list_buttons_c,
			showSearch:true,
			pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			},
			url:'/shopmanage-ws/ws/0.1/salesman/getSalesmanSalaryReviewDetail',
			showCheckbox: false,
			onError:showError,
			overflow:true 
	});
    $(".numb915").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg915").form({}).form('close');
        $("#Form_explain_eg915").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
            submit:function(){
                var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg915 div[name='remark']").textarea("val")
                $.jRadPost({
                    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
                    data:postData,
                    success:function(){
                        $("#Form_explain_eg915").form('close')
                        $('.overcurtainDiv').hide();
                    }
                });
            }, 
            cancel:function(){
                $("#Form_explain_eg915").form('close')
                $('.overcurtainDiv').hide();
            }
        }).form('open')
        $("#Form_explain_eg915 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
	
 });
	// function showRemarkError(xhr){
	// 		 var errormsg = eval("(" + xhr.responseText + ")");
	// 		  var cDiv = $("#Wraper_payCash_manage .cDiv:eq(0)");
	// 		  $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
	// }
	function showError(){
		      var cDiv = $("#Wraper_payCash_manage .cDiv:eq(1)");
			  $.jRadMessage({level:'error',message:'请先选择业务员',selector:cDiv});
	}
 </script> 
 
