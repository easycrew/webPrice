<style>
	.citybtn{ 
		background-color: #508ae8;
    	border-color: #4178d2;
    	color: #ffffff;
    	float: left;
    	padding: 5px 8px;
    	border-radius: 3px;
    	cursor: pointer;
	}
	.citybtn:hover{
		background-color: #508ae8;
	}
	.vouTable {border-collapse:collapse;margin:0 10px;width:98%;} 
	.vouTable td{padding: 3px;}
	.styleVou{background:#508ae8;color:#fff;padding:5px 0;text-align:center;border:none;border-radius: 5px;cursor: pointer;margin:0 10px;}
    .ycb_vou_id em{display:block}

    .ui-file-pic p.ui-note {margin-bottom:0px;}
    .ui-file-pic p {margin-top:0px;}
    .ui-note {margin-bottom:0px;}
</style>
<div class="urlContentWraper" id="Wraper_marketActive_pages">
	<div class="row-fluid ui-data-show"> 
		<div class="xDiv">
			 <h2 class="ui-tit"><strong>活动渠道管理</strong></h2>
			 <table id="Table_activeChanel_manage"></table>
		</div> 
		<div class="zDiv">
			<br/>
			 <h2 class="ui-tit"><strong>活动页面管理</strong></h2> 
			<table id="Table_activePage_manage"></table>
		</div> 
		<div class="yDiv">
			<br/>
			 <h2 class="ui-tit"><strong>兑换码二维码功能支撑</strong></h2> 
			<table id="Table_Qcode_cash"></table>
		</div> 
    </div> 

    <div id="Form_activeChannel_manage" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="row ischannel">
                <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>渠道编码：</label>
                <div class="span6 grid-layout-content">
                    <div name="code" class="jrad-input-container"></div>
				</div>
            </div>
            <div class="row">
                <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>渠道名称：</label>
                <div class="span4 grid-layout-content">
                    <div name="name" class="jrad-input-container"></div>  
                </div>
            </div>
            <div class="row">
                <label class="span3 grid-layout-label">渠道备注：</label>
                <div class="span4 grid-layout-content">
                    <div name="remark" class="jrad-textarea-container"></div>  
                </div>
            </div>
            <div class="row channelStaut">
                <label class="span3 grid-layout-label">是否启用：</label>
                <div class="span4 grid-layout-content">
                    <div name="status" class="jrad-select-container"></div>  
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div> 

    <div id="Form_activePage_manage" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="row">
                <label class="span4 grid-layout-label"><span class="ui-form-required">*</span>活动名称：</label>
                <div class="span6 grid-layout-content">
                    <div name="name" class="jrad-input-container"></div>
				</div>
            </div>
            <div class="row">
                <label class="span4 grid-layout-label"><span class="ui-form-required">*</span>活动有效时间起始：</label>
                <div class="span4 grid-layout-content">
                    <div name="startDate" class="jrad-dateinput-container"></div>  
                </div>
            </div>
            <div class="row">
                <label class="span4 grid-layout-label"><span class="ui-form-required">*</span>活动有效时间截止：</label>
                <div class="span4 grid-layout-content">
                    <div name="endDate" class="jrad-dateinput-container"></div>  
                </div>
            </div>
            <div class="row">
                <label class="span4 grid-layout-label">活动备注：</label>
                <div class="span4 grid-layout-content">
                    <div name="remark" class="jrad-textarea-container"></div>  
                </div>
            </div>
            <div class="row">
                <label class="span4 grid-layout-label">活动URL：</label>
                <div class="span8 grid-layout-content">
                    <div name="url" class="jrad-input-container"></div>  
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>

    <div id="Form_Qcode_cash" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <input type="hidden" name="itemHomeUrl">
            <input type="hidden" name="itemAdvertiseUrl">
            <input type="hidden" name="itemActiveUrl">
            <div class="row noshow ycb">
                <label class="span4 grid-layout-label">活动名称：</label>
                <div class="span5 grid-layout-content">
                    <div name="activityId" class="jrad-autocomplete-container"></div>
				</div> 
            </div>
            <div class="row noshow ycb">
                <label class="span4 grid-layout-label">渠道名称：</label>
                <div class="span5 grid-layout-content">
                    <div name="trenchId" class="jrad-autocomplete-container"></div>  
                </div>
            </div>
            <div class="row noshow">
                <label class="span4 grid-layout-label">是否用养车宝扫一扫打开：</label>
                <div class="span5 grid-layout-content">
                    <div name="openInternalApp" class="jrad-select-container"></div>  
                </div>
            </div>
            <div class="row noshow">
                <label class="span4 grid-layout-label">是否有兑换码页面：</label>
                <div class="span5 grid-layout-content">
                    <div name="isCodePage" class="jrad-select-container"></div>  
                </div>
            </div>
            <div class="row">
                <label class="span4 grid-layout-label"></label>
                <div class="span5 grid-layout-content">
                    <p class="ui-note">如果不上传页面图片，则自动使用默认页面，使用默认页面页面时，请填写页面标题</p>
                </div>
            </div>
            <div class="row activeShow">
                <label class="span4 grid-layout-label"></label>
                <div class="span5 grid-layout-content">
                    <div name="isDefault" class="jrad-radio-container"></div>  
                </div>
            </div>
            <div class="row activeShow firstShow">
                <label class="span4 grid-layout-label">默认页面标题：</label>
                <div class="span5 grid-layout-content">
                    <div name="pageTitle" class="jrad-input-container"></div>  
                </div>
            </div>
            <div class="row activeShow twoShow">
                <label class="span4 grid-layout-label">自定义title：</label>
                <div class="span5 grid-layout-content">
                    <div name="customTitle" class="jrad-input-container"></div>  
                </div>
            </div>
            <div class="row activeShow twoShow">
                <label class="span4 grid-layout-label">自定义页面图1：</label>
                <div class="span4 grid-layout-content">
                    <div name="customTopImage" class="jrad-uploadimg-container"></div>  
                </div>
                <label class="span3 grid-layout-label">自定义页面图2：</label>
                <div class="span4 grid-layout-content">
                    <div name="customMiddleImage" class="jrad-uploadimg-container"></div>  
                </div>
                <label class="span3 grid-layout-label">自定义页面图3：</label>
                <div class="span4 grid-layout-content">
                    <div name="customBottomImage" class="jrad-uploadimg-container"></div>  
                </div>
            </div>
            <!-- <div class="row activeShow twoShow">
                <label class="span4 grid-layout-label">自定义页面图2：</label>
                <div class="span5 grid-layout-content">
                    <div name="customBottomImage" class="jrad-uploadimg-container"></div>  
                </div>
            </div>
            <div class="row activeShow twoShow">
                <label class="span4 grid-layout-label">自定义页面图3：</label>
                <div class="span5 grid-layout-content">
                    <div name="img3" class="jrad-uploadimg-container"></div>  
                </div>
            </div> -->
            <div class="row activeShow twoShow">
                <label class="span4 grid-layout-label">查看预览图：</label>
                <div class="span5 grid-layout-content">
                    <span id="jrad-button-area" class="citybtn">点击查看</span>
                </div>
            </div>
            <div class="row">
                <label class="span4 grid-layout-label">兑换码类型：</label>
                <div class="span5 grid-layout-content">
                    <div name="codeType" class="jrad-select-container"></div>  
                </div>
            </div>
            <div class="row">
                <label class="span4 grid-layout-label">兑换码数量：</label>
                <div class="span5 grid-layout-content">
                    <div name="codeNum" class="jrad-input-container"></div>  
                </div>
            </div>
            <div class="row">
                <label class="span4 grid-layout-label">绑定代金券ID：</label>
				<div class="span5 grid-layout-content">
                    <div name="voucherTopicId" class="jrad-input-container"></div>  
                    <p class="ui-note">多个ID用英文逗号隔开</p>
				</div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>

    <div id="Form_add_QRcode" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="row">
                <label class="span4 grid-layout-label">增发兑换码数量：</label>
                <div class="span5 grid-layout-content">
                    <div name="codeNum" class="jrad-input-container"></div>
                    <p class="ui-note">若该兑换码为代金券兑换码，请在代金券管理中先追加该代金券的数量后，再来增发兑换码。</p>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_marketActive_pages');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();
    var page_column_model_b = new Array();
    var page_search_items_b = new Array();
    var page_list_buttons_b = new Array();
    var page_column_model_c = new Array();
    var page_search_items_c = new Array();
    var page_list_buttons_c = new Array();
	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});

	jRad.validators['codeNum'] = [{"msg":'请填写非负整数',"type":"regex","value":/^[0-9]+$/}];
    jRad.validators['voucherTopicId'] = [{"msg":'代金券ID不能为空','type':'min',value:'1'}];
    jRad.validators['activityId'] = [{"msg":'活动名称不能为空','type':'min',value:'1'}];
    jRad.validators['trenchId'] = [{"msg":'渠道名称不能为空','type':'min',value:'1'}];

    jRad.params['status'] = {data:[{id:'',name:'全部'},{id:'1',name:'启用'},{id:'0',name:'停用'}]}
    jRad.params['status2'] = {data:[{id:'',name:'全部'},{id:'1',name:'有效'},{id:'0',name:'无效'}]}
    jRad.params['status3'] = {data:[{id:'',name:'全部'},{id:'1',name:'有效'},{id:'0',name:'无效'}]}

    var fields_params={}; 
    fields_params['status'] = {data:[{id:'1',name:'启用'},{id:'0',name:'停用'}]};
    fields_params['status'] = {data:[{id:'1',name:'启用'},{id:'0',name:'停用'}]};
    fields_params['url'] = {grid: 9};  

    fields_params['openInternalApp'] = {data:[{id:'1',name:'是'},{id:'0',name:'否'}]};
    fields_params['isCodePage'] = {data:[{id:'1',name:'是'},{id:'0',name:'否'}]};
    fields_params['codeType'] = {data:[{id:'3',name:'请选择'},{id:'0',name:'非代金券兑换码'},{id:'1',name:'代金券兑换码'}]};

    fields_params['isDefault']={
        data:[{id:'1',name:'默认页面'},{id:'0',name:'自定义页面'}],
        onclick:function(item){  
            if($("div[name='isDefault']").radio('val')=='1'){ 
               $(".firstShow").show();
               $(".twoShow").hide();
            }
            else{
               $(".firstShow").hide();
               $(".twoShow").show();
            } 
        }
    }; 
    var _form = $('#Form_Qcode_cash')

    // 上传图片
    fields_params['customTopImage'] = {
        url:'/shopmanage-ws/ws/0.1/file/disposePic',
        delFunc: function(item){
           item.list.remove();
           $("input[name='itemHomeUrl']",_form).val("");
        },
        fileName:"file",
        note: '仅支持 JPG图片文件。',
        show: false,
        params: {type:"1"},
        success: function(data){ 
            if(data[0]&&data[0].code=="400"){
                $.jRadMessage({level:'error',message:data[0].message});
            }else{
                $("input[name='itemHomeUrl']",_form).val(data.large);
            }
        },
        beforeSubmit: function(obj){
            var re = /^.*\.(jpg|JPG)$/;
            if(re.test(obj.val())){
                return true;
            }else{  
                $.jRadAlert("只能上传jpg文件", "error");
                return false;
            }
        },
        single: true,
        showInfo:false
        //,
        //prev:'smallUrl'
    };
    fields_params['customMiddleImage'] = {
        url:'/shopmanage-ws/ws/0.1/file/disposePic',
        delFunc: function(item){
            item.list.remove();
            $("input[name='itemAdvertiseUrl']",_form).val("");
        },
        fileName:"file",
        note: '仅支持 JPG图片文件。',
        show: false,
        params: {type:"1"},
        success: function(data){ 
            if(data[0]&&data[0].code=="400"){
                $.jRadMessage({level:'error',message:data[0].message});
            }else{
                $("input[name='itemAdvertiseUrl']",_form).val(data.large);
            }
        },
        beforeSubmit: function(obj){
            var re = /^.*\.(jpg|JPG)$/;
            if(re.test(obj.val())){
                return true;
            }else{  
                $.jRadAlert("只能上传jpg文件", "error");
                return false;
            }
        },
        single: true,
        showInfo:false
        // ,
        // prev:'smallUrl'
    };
    fields_params['customBottomImage'] = {
        url:'/shopmanage-ws/ws/0.1/file/disposePic',
        delFunc: function(item){
            item.list.remove();
            $("input[name='itemActiveUrl']",_form).val("");
        },
        fileName:"file",
        note: '仅支持 JPG图片文件。',
        show: false,
        params: {type:"1"},
        success: function(data){ 
            if(data[0]&&data[0].code=="400"){
                $.jRadMessage({level:'error',message:data[0].message});
            }else{
                $("input[name='itemActiveUrl']",_form).val(data.large);
            }
        },
        beforeSubmit: function(obj){
            var re = /^.*\.(jpg|JPG)$/;
            if(re.test(obj.val())){
                return true;
            }else{  
                $.jRadAlert("只能上传jpg文件", "error");
                return false;
            }
        },
        single: true,
        showInfo:false
        // ,
        // prev:'smallUrl'
    };

    fields_params['activityId'] = {
        grid:5,
        url: '/shopmanage-ws/ws/0.1/activity/getActivityList', 
        queryParam:'name',
        fl: 'name',
        displayField:'name',
        valueField:'id',
        defaultValue: '',
        response: function(data){
          return data;
        },
        query: function(value){
            if(value == '*'){
                return value = '';
            }else{
                return value;
            }
        }
    };
    fields_params['trenchId'] = {
        grid:5,
        url: '/shopmanage-ws/ws/0.1/trench/getTrenchList',  
        //url: '/shopmanage-ws/ws/0.1/busiSubsidyForGlass/cityList', 
        queryParam:'name',
        fl: 'name',
        displayField:'name',
        valueField:'id',
        defaultValue: '',
        response: function(data){
          return data;
        },
        query: function(value){
            if(value == '*'){
                return value = '';
            }else{
                return value;
            }
        }
    };

    page_column_model.push({display: '渠道ID', name : 'id'});
    page_column_model.push({display: '渠道编码', name : 'code'});
    page_column_model.push({display: '渠道名称', name : 'name'});
    page_column_model.push({display: '渠道备注', name : 'remark',width:150});
    page_column_model.push({display: '创建时间', name : 'createDate'});
    page_column_model.push({display: '渠道状态', name : 'statusName'});
    page_column_model.push({display: '最后操作人', name : 'operator'});

	page_column_model_b.push({display: '活动id', name : 'id',hidden:true});
    page_column_model_b.push({display: '活动名称', name : 'name'});
	page_column_model_b.push({display: '活动备注', name : 'remark',width:150});
	page_column_model_b.push({display: '活动url', name : 'url',width:450});
	page_column_model_b.push({display: '创建时间', name : 'createDate'});
	page_column_model_b.push({display: '有效时间起始', name : 'startDate'});
    page_column_model_b.push({display: '有效时间截止', name : 'endDate'});
    page_column_model_b.push({display: '状态', name : 'statusName'});

	page_column_model_c.push({display: '活动渠道ID', name : 'id',hidden:true});
    page_column_model_c.push({display: '活动名称', name : 'activityName'});
	page_column_model_c.push({display: '活动备注', name : 'activityRemark',width:150});
	page_column_model_c.push({display: '渠道名称', name : 'trenchName'});
	page_column_model_c.push({display: '渠道备注', name : 'trenchRemark',width:150});
	page_column_model_c.push({display: '兑换码状态', name : 'companyName',diy:function($item,$div){
        $div.html($item.receiveCode+'/'+$item.totalCode)
    }});    
    page_column_model_c.push({display: '已创建兑换码数量', name : 'createExchangeCodeCount'});
	page_column_model_c.push({display: '创建时间', name : 'createDate'});
	page_column_model_c.push({display: '是否在APP内打开', name : 'openInternalApp',diy:function($item,$div){
        if($item.openInternalApp == 1){
            $div.html("是")
        }else{
            $div.html("否")
        }
    }});
	page_column_model_c.push({display: '是否有兑换码页面', name : 'isCodePage',diy:function($item,$div){
        if($item.isCodePage == 1){
            $div.html("是")
        }else{
            $div.html("否")
        }
    }});
	page_column_model_c.push({display: '是否有效', name : 'status',diy:function($item,$div){
        if($item.status == 1){
            $div.html("是")
        }else{
            $div.html("否")
        }
    }});
	page_column_model_c.push({display: '最终URL  ', name : 'qrcodeUrl',width:450});
    
    page_search_items.push({row:'1',type:'jrad-input',display:'渠道名称',name:'name'}); 
    page_search_items.push({row:'1',type:'jrad-input',display:'渠道编码',name:'code'}); 
    page_search_items.push({row:'1',type:'jrad-select',display:'渠道状态',name:'status',params:jRad.params['status']});
    page_search_items.push({row:'2',type:'jrad-dateinput',display:'创建时间起始',name:'createStartDate'}); 
    page_search_items.push({row:'2',type:'jrad-dateinput',display:'创建时间截止',name:'createEndDate'}); 

    page_search_items_b.push({row:'1',type:'jrad-input',display:'活动名称',name:'name'}); 
    page_search_items_b.push({row:'1',type:'jrad-dateinput',display:'创建时间开始',name:'createStartDate'}); 
    page_search_items_b.push({row:'1',type:'jrad-dateinput',display:'创建时间截止',name:'createEndDate'}); 
	page_search_items_b.push({row:'2',type:'jrad-select',display:'活动状态',name:'status',params:jRad.params['status2']}); 
	page_search_items_b.push({row:'2',type:'jrad-dateinput',display:'有效起始开始',name:'activityStartDate'});
	page_search_items_b.push({row:'2',type:'jrad-dateinput',display:'有效起始截止',name:'activityEndDate'}); 

    page_search_items_c.push({row:'1',type:'jrad-input',display:'活动名称',name:'activityName'}); 
    page_search_items_c.push({row:'1',type:'jrad-input',display:'渠道名称',name:'trenchName'}); 
    page_search_items_c.push({row:'1',type:'jrad-select',display:'是否有效',name:'status',params:jRad.params['status3']});
    page_search_items_c.push({row:'2',type:'jrad-dateinput',display:'创建时间起始',name:'createStartDate'}); 
    page_search_items_c.push({row:'2',type:'jrad-dateinput',display:'创建时间截止',name:'createEndDate'});  

    page_list_buttons.push({title: '创建',name:'Add', bclass: 'add',
    	onpress : function(){ 
    		$("#Form_activeChannel_manage").form({
    			title:'渠道创建',
    			url:'/shopmanage-ws/ws/0.1/trench/addTrench',
    			grid: 10, 
    			item:{},		
                before_submit:function(json){
                    json.operator = carsmart_config.operatorName;
                    return json
                },  		
				success_callback:function(){ 
                    $('#Table_activeChanel_manage').flexMessage('创建成功', 'success');
                    $('#Table_activeChanel_manage').flexReloadCurrentPage()
                }
    		}).form('open')
            $("#Form_activeChannel_manage div[name='code']").input("readonly",false)
            $(".ischannel").hide();
            $(".channelStaut").hide();
        }
    });    
	page_list_buttons.push({title: '修改状态',displayname:'修改状态',name:'edit',bclass: 'edit',
		prefunc:function(){
            var checked = $('#Table_activeChanel_manage').getCheckedTrs();
            if (checked.length == 0) {return false;}else{return true;}
        },
    	onpress : function(){ 
            var checked = $('#Table_activeChanel_manage').getCheckedTrs();
            var _item = $.jRadGet({url:'/shopmanage-ws/ws/0.1/trench/getTrenchById?id='+checked[0].id});
    		$("#Form_activeChannel_manage").form({
    			title:'渠道修改',
    			url:'/shopmanage-ws/ws/0.1/trench/updateTrench',
    			grid: 10, 
                fields_params:fields_params,
                item:_item,
    			before_submit:function(json){
                    json.operator = carsmart_config.operatorName;
                    json.id = checked[0].id
    				return json
    			},				
				success_callback:function(){ 
                    $('#Table_activeChanel_manage').flexMessage('修改成功', 'success');
                    $('#Table_activeChanel_manage').flexReloadCurrentPage()
                }
    		}).form('open')
            $("#Form_activeChannel_manage div[name='code']").input("readonly",true)
            $(".ischannel").show();
    		$(".channelStaut").show();
        }
    });

    page_list_buttons_b.push({title: '创建',name:'Add', bclass: 'add',
    	onpress : function(){ 
    		$("#Form_activePage_manage").form({
    			title:'活动创建',
    			url:'/shopmanage-ws/ws/0.1/activity/addActivity',
                fields_params:fields_params,
    			item:{},
                before_submit:function(json){
                    json.operator = carsmart_config.operatorName;
                    return json
                },  				
				success_callback:function(){ 
                    $('#Table_activePage_manage').flexMessage('创建成功', 'success');
                    $('#Table_activePage_manage').flexReloadCurrentPage()
                }
    		}).form('open')
            $("#Form_activePage_manage div[name='url']").input('readonly',false)
        }
    });    
	page_list_buttons_b.push({title: '修改状态',displayname:'修改状态',name:'edit',bclass: 'edit',
		prefunc:function(){
            var checked = $('#Table_activePage_manage').getCheckedTrs();
            if (checked.length == 0) {return false;}else{return true;}
        },
    	onpress : function(){ 
            var checked = $('#Table_activePage_manage').getCheckedTrs();
            var _item = $.jRadGet({url:'/shopmanage-ws/ws/0.1/activity/getActivityById?id='+checked[0].id});
    		$("#Form_activePage_manage").form({
    			title:'活动修改',
    			url:'/shopmanage-ws/ws/0.1/activity/updateActivity',
    			fields_params:fields_params,
    			item:_item,
    			before_submit:function(json){
    				json.id = checked[0].id;
    				return json
    			},				
				success_callback:function(){ 
                    $('#Table_activePage_manage').flexMessage('修改成功', 'success');
                    $('#Table_activePage_manage').flexReloadCurrentPage()
                }
    		}).form('open')
            $("#Form_activePage_manage div[name='url']").input('readonly',true)
        }
    });

    page_list_buttons_c.push({title: '创建',name:'Add', bclass: 'add',
        onpress : function(){ 
            var _ul = $("div[name='itemHomeUrl']",wraper).children(".pic-show"); 
            _ul.html(""); 
            var _ul2 = $("div[name='itemAdvertiseUrl']",wraper).children(".pic-show"); 
            _ul2.html(""); 
            $("#Form_Qcode_cash").form({
                title:'兑换码与二维码创建',
                grid: 24,
                fields_params: fields_params,
                validators: jRad.validators,
                url:'/shopmanage-ws/ws/0.1/conversioncode/addCode',
                item:{'isDefault':'1'},  
                before_submit:function(json){
                    json.operator = carsmart_config.operatorName;
                    json.customTopImage = $("#Form_Qcode_cash input[name='itemHomeUrl']").val()
                    json.customMiddleImage = $("#Form_Qcode_cash input[name='itemAdvertiseUrl']").val()
                    json.customBottomImage = $("#Form_Qcode_cash input[name='itemActiveUrl']").val()
                    return json
                },           
                success_callback:function(data){ 
                    $.jRadAlert("兑换码正在创建中，请耐心等待！稍后请刷新再操作", "warning", '' ,600000);
                    $('#Table_Qcode_cash').flexMessage('创建成功', 'success');
                    $('#Table_Qcode_cash').flexReloadCurrentPage()

                }
            }).form('open')
            $(".activeShow").show();
            $(".ycb").show();
            $("#Form_Qcode_cash div[name='activityId']").autocomplete('readonly',false)
            $("#Form_Qcode_cash div[name='trenchId']").autocomplete('readonly',false)
            $("#Form_Qcode_cash div[name='openInternalApp']").select('readonly',false)
            $("#Form_Qcode_cash div[name='isCodePage']").select('readonly',false)
            $("#Form_Qcode_cash div[name='isDefault']").radio('readonly',false)
            $("#Form_Qcode_cash div[name='codeType']").select('readonly',false)
            $("#Form_Qcode_cash div[name='codeNum']").input('readonly',true)
            $("#Form_Qcode_cash div[name='voucherTopicId']").input('readonly',true)

            if($("div[name='isDefault']").radio('val')=='1'){ 
               $(".firstShow").show();
               $(".twoShow").hide();
            }else{
               $(".firstShow").hide();
               $(".twoShow").show();
            }

            $('.firstShow').show()
            $('.twoShow').hide()
            $("#Form_Qcode_cash div[name='isCodePage']").select({
                onclick:function(){
                    if($("#Form_Qcode_cash div[name='isCodePage']").select('val') == 0){
                        $(".activeShow").hide(); 
                    }else{
                        $(".activeShow").show();
                        if($("div[name='isDefault']").radio('val')=='1'){ 
                           $(".firstShow").show();
                           $(".twoShow").hide();
                        }
                        else{
                           $(".firstShow").hide();
                           $(".twoShow").show();
                        }
                    }
                }
            });
            $("#Form_Qcode_cash div[name='codeType']").select({
                onclick:function(){
                    var codeTypeVal = $("#Form_Qcode_cash div[name='codeType']").select('val')
                    if(codeTypeVal == 0){
                        $('#Form_Qcode_cash div[name="voucherTopicId"]').input('readonly',true);
                        $('#Form_Qcode_cash div[name="codeNum"]').input('readonly',false);
                    }else if(codeTypeVal == 3){
                        $('#Form_Qcode_cash div[name="codeNum"]').input('readonly',true);
                        $('#Form_Qcode_cash div[name="voucherTopicId"]').input('readonly',true);
                    }else{
                        $('#Form_Qcode_cash div[name="codeNum"]').input('readonly',false);
                        $('#Form_Qcode_cash div[name="voucherTopicId"]').input('readonly',false);
                    }
                }
            }); 
            $(".citybtn").click(function(){
                var isOpenApp = $("#Form_Qcode_cash div[name='openInternalApp']").select("val")
                var isDiy = $("#Form_Qcode_cash div[name='isDefault']").radio("val")
                var img1 = decodeURI($("#Form_Qcode_cash input[name='itemHomeUrl']").val());
                var img2 = decodeURI($("#Form_Qcode_cash input[name='itemAdvertiseUrl']").val());
                var img3 = decodeURI($("#Form_Qcode_cash input[name='itemActiveUrl']").val());
                var customTitle = $("#Form_Qcode_cash div[name='customTitle']").input('val');
                $.jRadGet({
                    url:'/shopmanage-ws/ws/0.1/conversioncode/previewImage?openInternalApp='+isOpenApp+'&isDefault='+isDiy,
                    success:function(data){
                         window.open(data+'?title='+customTitle+'&img1='+img1+'&img2='+img2+'&img3='+img3);
                    }
                })
            })

        }
    });

    page_list_buttons_c.push({title: '修改',displayname:'修改',name:'edit',bclass: 'edit',
        prefunc:function(){
            var checked = $('#Table_Qcode_cash').getCheckedTrs();
            if (checked.length == 0 || checked[0].status == 0 || checked[0].isCodePage == 0) {return false;}else{return true;}
        },
        onpress : function(){ 
            var checked = $('#Table_Qcode_cash').getCheckedTrs();
            var _item = $.jRadGet({url:'/shopmanage-ws/ws/0.1/conversioncode/getActivityAndTrenchById?id='+checked[0].id})
            $("#Form_Qcode_cash").form({
                title:'兑换码与二维码修改',
                url:'/shopmanage-ws/ws/0.1/conversioncode/updateCode',
                validators: false,
                grid: 24,
                fields_params: fields_params, 
                item:_item,
                before_submit:function(json){
                    json.rActivityTrenchId = checked[0].id;
                    json.activityId = _item.activityId;
                    json.trenchId = _item.trenchId;
                    json.activityName = _item.activityName;
                    json.trenchName = _item.trenchName;
                    json.activityRemark = _item.activityRemark;
                    json.trenchRemark = _item.trenchRemark;
                    json.customTopImage = $("#Form_Qcode_cash input[name='itemHomeUrl']").val()
                    json.customMiddleImage = $("#Form_Qcode_cash input[name='itemAdvertiseUrl']").val()
                    json.customBottomImage = $("#Form_Qcode_cash input[name='itemActiveUrl']").val()
                    return json
                },              
                success_callback:function(){ 
                    //$.jRadAlert("兑换码正在创建中，请耐心等待！稍后请刷新再操作", "warning", '' ,600000);
                    $('#Table_Qcode_cash').flexMessage('修改成功', 'success');
                    $('#Table_Qcode_cash').flexReloadCurrentPage()
                }
            }).form('open')
            $("#Form_Qcode_cash input[name='itemHomeUrl']").val(_item.customTopImage)
            $("#Form_Qcode_cash input[name='itemAdvertiseUrl']").val(_item.customMiddleImage)
            $("#Form_Qcode_cash input[name='itemActiveUrl']").val(_item.customBottomImage)
            $(".ycb").hide();
            $("#Form_Qcode_cash div[name='openInternalApp']").select('readonly',true)
            $("#Form_Qcode_cash div[name='isCodePage']").select('readonly',true)
            $("#Form_Qcode_cash div[name='isDefault']").radio('readonly',true)
            $("#Form_Qcode_cash div[name='codeType']").select('readonly',true)
            $("#Form_Qcode_cash div[name='codeNum']").input('readonly',true)
            $("#Form_Qcode_cash div[name='voucherTopicId']").input('readonly',true)

            if($("div[name='isDefault']").radio('val')=='1'){ 
               $(".firstShow").show();
               $(".twoShow").hide();
            }else{
               $(".firstShow").hide();
               $(".twoShow").show();
            }

            editPic(wraper,_item)

            $(".citybtn").click(function(){
                var isOpenApp = $("#Form_Qcode_cash div[name='openInternalApp']").select("val")
                var isDiy = $("#Form_Qcode_cash div[name='isDefault']").radio("val")
                var img1 = decodeURI($("#Form_Qcode_cash input[name='itemHomeUrl']").val());
                var img2 = decodeURI($("#Form_Qcode_cash input[name='itemAdvertiseUrl']").val());
                var img3 = decodeURI($("#Form_Qcode_cash input[name='itemActiveUrl']").val());
                var customTitle = $("#Form_Qcode_cash div[name='customTitle']").input('val');
                $.jRadGet({
                    url:'/shopmanage-ws/ws/0.1/conversioncode/previewImage?openInternalApp='+isOpenApp+'&isDefault='+isDiy,
                    success:function(data){
                         window.open(data+'?title='+customTitle+'&img1='+img1+'&img2='+img2+'&img3='+img3);
                    }
                })
            })
        }
    });

    page_list_buttons_c.push({displayname: '增发活动兑换码',name:'updatacode',bclass: 'updatacode',
        prefunc:function(){
            var checked = $('#Table_Qcode_cash').getCheckedTrs();
            if (checked.length != 1 || checked[0].status == 0 ) {return false;}else{return true;}
        },
        onpress : function(){ 
            var checked = $('#Table_Qcode_cash').getCheckedTrs();
            $("#Form_add_QRcode").form({
                title:'增发活动兑换码',
                url:'/shopmanage-ws/ws/0.1/conversioncode/addCDkeyCnt',
                item:{},  
                before_submit:function(json){
                    json.rActivityTrenchId = checked[0].id;
                    json.operator = carsmart_config.operatorName;
                    return json
                },        
                success_callback:function(){ 
                    $.jRadAlert("兑换码正在增发中，请耐心等待！稍后请刷新再操作", "warning", '' ,600000);
                    $('#Table_Qcode_cash').flexMessage('增发成功', 'success');
                    $('#Table_Qcode_cash').flexReloadCurrentPage()
                }
            }).form('open')
        }
    });

    page_list_buttons_c.push({displayname: '导出兑换码',name:'downcode',bclass: 'downcode',
        prefunc:function(){
            var checked = $('#Table_Qcode_cash').getCheckedTrs();
            if (checked.length != 1 || checked[0].status == 0 ) {return false;}else{return true;}
        },
        onpress : function(){
            var checked = $('#Table_Qcode_cash').getCheckedTrs();
            $.jRadConfirm('确认导出兑换码？',1,function(){
                window.open('/shopmanage-ws/ws/0.1/conversioncode/exportCodeList?rActivityTrenchId='+checked[0].id);
            })
        }
    });

    page_list_buttons.push({separator: true});
    page_list_buttons_b.push({separator: true});
    page_list_buttons_c.push({separator: true});

	$('#Table_activeChanel_manage').flexigrid({
		reload:true,
		method:'get', 
		colModel : page_column_model,
		buttons : page_list_buttons,
		searchitems :page_search_items,
		showSearch:true,
		pagination: {
			diaplay_pages: 5,
			align: 'bottom' 
		},
        overflow:true,
		url:'/shopmanage-ws/ws/0.1/trench/queryTrenchList',
		onError:showRemarkError1,
		checkBoxType:'single'
	})
	$('#Table_activePage_manage').flexigrid({
		reload:true,
		method:'get', 
		colModel : page_column_model_b,
		buttons : page_list_buttons_b,
		searchitems :page_search_items_b,
		showSearch:true,
		pagination: {
			diaplay_pages: 5,
			align: 'bottom' 
		},
        overflow:true,
		url:'/shopmanage-ws/ws/0.1/activity/queryActivityList',
		onError:showRemarkError1,
		checkBoxType:'single'
	})
	$('#Table_Qcode_cash').flexigrid({
		reload:true,
		method:'get', 
		colModel : page_column_model_c,
		buttons : page_list_buttons_c,
		searchitems :page_search_items_c,
		showSearch:true,
		pagination: {
			diaplay_pages: 5,
			align: 'bottom' 
		},
        overflow:true,
		url:'/shopmanage-ws/ws/0.1/conversioncode/queryExchangeCodeList',
		onError:showRemarkError1,
		checkBoxType:'single'
	})

    //修改时赋值图片
    function editPic(wraper,_item){ 
        var _ul = $("div[name='customTopImage']",wraper).children(".pic-show"); 
        var _ul2 = $("div[name='customMiddleImage']",wraper).children(".pic-show"); 
        var _ul3 = $("div[name='customBottomImage']",wraper).children(".pic-show"); 
        var src = _item.customTopImage;
        var src2 = _item.customMiddleImage;
        var src3 = _item.customBottomImage;
        $("#Form_Qcode_cash input[name='itemHomeUrl']").val(src);
        $("#Form_Qcode_cash input[name='itemAdvertiseUrl']").val(src2);
        $("#Form_Qcode_cash input[name='itemActiveUrl']").val(src3);
        if(src!=undefined&&src!=""){ 
            var _li = '<li name="" class="adPicBoxli1"><div class="large-pic"><div class="pic-box"><div class="pic-content"><div class="pic-vc">'
              +'<img src="'+src+'">'
              +'</div></div><span name="small" class="del-btn"></span></div></div></li>'
            _ul.html(_li); 
            $(".adPicBoxli1 .del-btn",wraper).click(function(){
                var small = $(this).prev(".pic-content").find("img").attr("src");
                $(this).parents(".adPicBoxli1").remove();  
                $("#Form_Qcode_cash input[name='itemHomeUrl']").val('');
            });
        } 

        if(src2!=undefined&&src2!=""){ 
            var _li2 = '<li name="" class="adPicBoxli2"><div class="large-pic"><div class="pic-box"><div class="pic-content"><div class="pic-vc">'
              +'<img src="'+src2+'">'
              +'</div></div><span name="small" class="del-btn"></span></div></div></li>'
            _ul2.html(_li2); 
            $(".adPicBoxli2 .del-btn",wraper).click(function(){
                var small = $(this).prev(".pic-content").find("img").attr("src");
                $(this).parents(".adPicBoxli2").remove();  
                $("#Form_Qcode_cash input[name='itemAdvertiseUrl']").val('');
            });
        } 

        if(src3!=undefined&&src3!=""){ 
            var _li3 = '<li name="" class="adPicBoxli3"><div class="large-pic"><div class="pic-box"><div class="pic-content"><div class="pic-vc">'
              +'<img src="'+src3+'">'
              +'</div></div><span name="small" class="del-btn"></span></div></div></li>'
            _ul3.html(_li3); 
            $(".adPicBoxli3 .del-btn",wraper).click(function(){
                var small = $(this).prev(".pic-content").find("img").attr("src");
                $(this).parents(".adPicBoxli3").remove();  
                $("#Form_Qcode_cash input[name='itemActiveUrl']").val('');
            });
        } 
    }
});
function showRemarkError1(xhr){
 	var errormsg = eval("(" + xhr.responseText + ")");
  	var cDiv1 = $("#Wraper_marketActive_pages .xDiv .cDiv");
    //$('.scroll-up-btn').click();
  	$.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv1});
    //$('#Table_activeChanel_manage').flexMessage(errormsg[0].message, 'error');
}

</script>
