<style>
	table#Table_detail th,table#Table_detail td{
		text-align: center;
	}
  .creatinput{
    height:18px;
    line-height:18px;
    padding:2px 5px;
    background-color:#fcfcfc;
    border:1px solid #b8bcc6;
    border-radius: 2px;
  }
  .inputclass{margin:3px 10px 0 175px;float:left;font-size:14px;}
  .labclasss{float:left;font-size:14px}

</style>
<div class="urlContentWraper" id="Wraper_thirdParty_sendCard">
    <div class="ui-info-layout">
      <div class="cdiv">
           <h2 class="ui-tit"><strong>第三方赠送车主卡</strong><bottom class="all-work-info numb77">页面说明</bottom></h2>
           <!-- 列表显示 -->
           <table id="Table_thirdParty_sendCard"></table>
      </div>
    </div>
    <div id="Form_thirdParty_sendCard" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
        	  <input type="hidden" name="bizDocumentId">
        	  <div class="row">
                 <label class="span4 grid-layout-label">保费金额：</label>
                 <div class="span6 grid-layout-content fluid-wrap">
                       <div class="jrad-input-container" name="billAmount"></div>
                 </div>
            </div>
            <div class="row">
                 <label class="span4 grid-layout-label">用户车辆价值：</label>
                 <div class="span6 grid-layout-content">
                       <div class="jrad-select-container" name="bizCategoryId"></div>
                 </div>
            </div>
            <div class="row">
                 <label class="span4 grid-layout-label">保单号：</label>
                 <div class="span6 grid-layout-content fluid-wrap">
						          <div class="jrad-input-container" name="documentNo"></div>
				         </div>
            </div>
			      <div class="row">
                 <label class="span4 grid-layout-label">是否二选一：</label>
                 <div class="span6 grid-layout-content fluid-wrap">
                       <div class="jrad-radio-container" name="chooseType"></div>
                 </div>
            </div>
            <div class="row twocheck" style="display:none">
            </div>
            <div class="row times">
            </div>
            <input type="hidden" name="time1"/>
            <input type="hidden" name="time2"/> 
            <input type="hidden" name="time3"/>  
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span>
			      <span class="jrad-btn-normal">取消</span>
        </div>
    </div>

    <div id="Form_service_count" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
          <input type="hidden" name="cardPicture">
          <div class="row">
                 <label class="span3 grid-layout-label">统计时间：</label>
                 <div class="span4 grid-layout-content fluid-wrap">
                       <div class="jrad-dateinput-container" name="createStartDate"></div>
                 </div>
                 <div style="float:left;margin:3px 0 0 5px">—</div>
                 <div class="span4 grid-layout-content fluid-wrap">
                       <div class="jrad-dateinput-container" name="createEndDate"></div>
                 </div>
                 <span class="jrad-btn-primary" style="margin:0 25px;">查询</span>
          </div>
        <table class="countTable"></table>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <!-- <span class="jrad-btn-primary">确定</span> -->
            <span class="jrad-btn-normal">取消</span>
        </div>
      </div>
    </div>
    <div id="Form_explain_eg77" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>过去第三方合作的功能，已停用。</div>
                    <div><strong>重要功能说明：</strong>无。</div>
                    <div><strong>注意事项：</strong>无。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_thirdParty_sendCard');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();
	  var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel}); 

    jRad.validators['serviceId']=[{msg:'请填写',type:'min',value:1},{msg:'请填写最多10位的正整数',type:'regex',value:/^\s*([0-9]*[1-9][0-9]*){1,9}\s*$/}];
    jRad.params['isBindUser'] = {
     data: [{id:' ',name:'全部'},{id:'1',name:'是'},{id:'0',name:'否'}] 
    }; 
    jRad.params['chooseType'] = {
     data: [{id:'1',name:'否'},{id:'2',name:'是'}] 
    }; 
	  var fields_params = {}; 
	  //fields_params['isBindUser'] = {data: [{id:'',name:'全部'},{id:'1',name:'是'},{id:'0',name:'否'}]};

    fields_params['chooseType']={
        data:[{id:'1',name:'否'},{id:'2',name:'是'}],
        onclick:function(item){  
            if($("div[data-name='chooseType']",wraper).radio('val')=='1'){ 
               $(".twocheck",wraper).hide();
            }
            else{
                $(".twocheck",wraper).show();
            } 
        }
    }; 
    // 车辆价格列表
    var categoryList = [];
    var _result = $.jRadGet({url: '/shopmanage-ws/ws/0.1/bizPartnerManager/categoryList'});
    $.each(_result,function(index, vo){
      var __id = vo['bizCategoryId'];
      var __name = vo['bizCategoryName'];
      var __tm = {'id': __id,'name': __name};
      categoryList.push(__tm);
    });

    fields_params['bizCategoryId'] = {
       data:categoryList,
       onclick:function(item){  
            var urlstr = '/shopmanage-ws/ws/0.1/bizPartnerManager/getServiceList?bizCategoryId='+item.id;
            var data2 = $.jRadGet({url:urlstr});
            var che = $('.twocheck');
            var box = $('.times');
            var checkboxArr = [];
            var chooseType;
            var serviceTimes;
            che.html("");
            box.html("");
            $.each(data2,function(i,val){
              var item = data2[i];
              var json2 = {};
              json2.serviceId = val.serviceId;
              json2.displayName= val.displayName;
              var box2 =$('<div style="overflow:hidden;margin-bottom:5px;">');
              var _label2 = $('<label class="span4 grid-layout-label">'+'</label>');
              var input2 = $('<input class="span6 creatinput" placeholder="次" />');
              var che2 =$('<div style="overflow:hidden;margin-bottom:5px;">');
              var _label = $('<label class="labclasss">'+'</label>');
              var checked = $('<input type="checkbox" class="inputclass">');
              $(_label).html(val.displayName);
              $(_label2).html(val.displayName);
              $('.twocheck').append(che2.append(checked).append(_label))
              $('.times').append(box2.append(_label2).append(input2))
              if($("div[data-name='chooseType']",wraper).radio('val')=='1'){
                json2.chooseType= 1
              }else{
                if($('.twocheck input').attr("checked")=='checked'){
                    json2.chooseType = 2
                }else{json2.chooseType = 1}
              }
              json2.serviceTimes = $('.times input').attr("value");
              checkboxArr.push(json2);
            })
      }
    };

    $('#Form_thirdParty_sendCard').form({ 
        validators: jRad.validators,
        fields_params: fields_params
    });
    page_column_model.push({display: 'ID', name : 'bizDocumentId'});
    page_column_model.push({display: '用户ID', name : 'userId'});
    page_column_model.push({display: '用户手机号', name : 'mobilePhone'});  
    page_column_model.push({display: '合作方公司名称', name : 'bizPartnerName'});  
    page_column_model.push({display: '保单号', name : 'documentNo'});  
    page_column_model.push({display: '保费金额(元)', name : 'billAmount'}); 
    page_column_model.push({display: '赠送服务', name : 'serviceName'});
    page_column_model.push({display: '对应车主卡', name : 'cardId'});
    page_column_model.push({display: '数据生成时间', name : 'createDate'});
  	page_column_model.push({display: '用户绑定时间', name : 'bindDate'});
  	page_column_model.push({display: '最后操作时间', name : 'updateDate'});
  	page_column_model.push({display: '最后操作人', name : 'operator'});
    
   page_search_items.push({row:'1',type:'jrad-input',display:'用户ID',name:'userId'}); 
   page_search_items.push({row:'1',type:'jrad-input',display:'用户手机号',name:'mobilePhone'}); 
   page_search_items.push({row:'1',type:'jrad-select',display:'是否绑定用户',name:'isBindUser',params:jRad.params['isBindUser']}); 
   page_search_items.push({row:'2',type:'jrad-input',display:'保单号',name:'documentNo'}); 
   page_search_items.push({row:'2',type:'jrad-input',display:'车主卡ID',name:'cardId'}); 
   page_search_items.push({row:'2',type:'jrad-input',display:'最后操作人',name:'operator'}); 
   page_search_items.push({row:'3',type:'jrad-dateinput',display:'数据生成时间始',name:'createStartDate'}); 
   page_search_items.push({row:'3',type:'jrad-dateinput',display:'数据生成时间终',name:'createEndDate'}); 
   page_search_items.push({row:'3',type:'jrad-dateinput',display:'用户绑定时间始',name:'bindStartDate'}); 
   page_search_items.push({row:'4',type:'jrad-dateinput',display:'用户绑定时间终',name:'bindEndDate'}); 

  page_list_buttons.push({title: '创建',name:'Add', bclass: 'add',onpress : function(){
		$('#Form_thirdParty_sendCard',wraper).form({
			    title:'创建', 
          item:{'chooseType':'1'},
	        url:'/shopmanage-ws/ws/0.1/bizPartnerManager/saveDocumentNo',
	        before_submit:function(json){
            var bizCategoryId = $("div[name='bizCategoryId']",wraper).select('val');
            var urlstr = '/shopmanage-ws/ws/0.1/bizPartnerManager/getServiceList?bizCategoryId='+bizCategoryId;
            var data2 = $.jRadGet({url:urlstr});

            var checkboxArr=[];
            $.each(data2,function(i,vals){
              var item = data2[i];
              var json2 = {};
              json2.serviceId = vals.serviceId;
              json2.displayName= vals.displayName;
              if($("div[data-name='chooseType']",wraper).radio('val')=='1'){
                json2.chooseType= 1
              }
              else{
                if($('.twocheck input').eq(i).attr("checked")=='checked'){
                    json2.chooseType = 2
                }else{
                  json2.chooseType = 1
                }
              }
              json2.serviceTimes = $('.times input').eq(i).attr("value");
              checkboxArr.push(json2); 
            });
            
            json.operator=carsmart_config.operatorName;
            json.serviceList = checkboxArr;
            return json
          },
	        success_callback:function(){ 
				    $('#Table_thirdParty_sendCard').flexMessage('创建成功', 'success');
				    $('#Table_thirdParty_sendCard').flexReload()
				  }  
          }).form('open');
			      var bizCategoryId = $("div[name='bizCategoryId']",wraper).select('val');
            var urlstr = '/shopmanage-ws/ws/0.1/bizPartnerManager/getServiceList?bizCategoryId='+bizCategoryId;
            var data2 = $.jRadGet({url:urlstr});
            var che = $('.twocheck');
            var box = $('.times');
            var checkboxArr = [];
            che.html("");
            box.html("");
            $.each(data2,function(i,vals){
              var box2 =$('<div style="overflow:hidden;margin-bottom:5px;">');
              var _label2 = $('<label class="span4 grid-layout-label">'+'</label>');
              var input2 = $('<input class="span6 creatinput" placeholder="次" value="" >');
              var che2 =$('<div style="overflow:hidden;margin-bottom:5px;">');
              var _label = $('<label class="labclasss">'+'</label>');
              var checked = $('<input type="checkbox" class="inputclass">');
              $(_label).html(vals.displayName);
              $(_label2).html(vals.displayName);
              $('.twocheck').append(che2.append(checked).append(_label));
              $('.times').append(box2.append(_label2).append(input2));
            });
            
            if($("div[data-name='chooseType']",wraper).radio('val')=='1'){ 
               $(".twocheck",wraper).hide();
            }
            else{
                $(".twocheck",wraper).show();
            }

		    }
	});

	page_list_buttons.push({title: '修改',name:'Edit', bclass: 'edit',prefunc:function(){
            var checked = $('#Table_thirdParty_sendCard').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
	    	var checked = $('#Table_thirdParty_sendCard').getCheckedTrs(); 
			  var item = $ .jRadGet({url : '/shopmanage-ws/ws/0.1/bizPartnerManager/documentDetail?bizDocumentId='+checked[0].bizDocumentId}); 
         $('#Form_thirdParty_sendCard div[name="billAmount"]').input("readonly",false);
          $('#Form_thirdParty_sendCard div[name="bizCategoryId"]').select("readonly",false);
          $('#Form_thirdParty_sendCard div[name="chooseType"]').radio("readonly",false);
          $('#Form_thirdParty_sendCard div[name="documentNo"]').input("readonly",false);
          $('.twocheck input').attr("disabled",false);
          $('.times input').attr("disabled",false);
			  if(checked[0].mobilePhone  =="" || checked[0].mobilePhone =="undefined") {          
				    $('#Form_thirdParty_sendCard',wraper).form({
					     title:'修改', 
	             item:item,
	             url:'/shopmanage-ws/ws/0.1/bizPartnerManager/saveDocumentNo',
	             before_submit:function(json){
                    var bizCategoryId = $("div[name='bizCategoryId']",wraper).select('val');
                    var urlstr = '/shopmanage-ws/ws/0.1/bizPartnerManager/getServiceList?bizCategoryId='+bizCategoryId;
                    var data2 = $.jRadGet({url:urlstr});
                    var checkboxArr=[];
                    $.each(data2,function(i,vals){
                      var item = data2[i];
                      var json2 = {};
                      json2.serviceId = vals.serviceId;
                      json2.displayName= vals.displayName;
                      if($("div[data-name='chooseType']",wraper).radio('val')=='1'){
                        json2.chooseType= 1
                      }
                      else{
                        if($('.twocheck input').eq(i).attr("checked")=='checked'){
                            json2.chooseType = 2
                        }else{
                          json2.chooseType = 1
                        }
                      }
                      json2.serviceTimes = $('.times input').eq(i).attr("value");
                      checkboxArr.push(json2); 
                    });
                    json.serviceList = checkboxArr;
	                	json.operator = carsmart_config.operatorName;
	                	return json
	                },
	             success_callback:function(){
	                	$('#Table_thirdParty_sendCard').flexMessage('修改成功','success');
	                	$('#Table_thirdParty_sendCard').flexReload()
	                }
            }).form('open');
            var bizCategoryId = $("div[name='bizCategoryId']",wraper).select('val');
            var urlstr = '/shopmanage-ws/ws/0.1/bizPartnerManager/getServiceList?bizCategoryId='+bizCategoryId;
            var data2 = $.jRadGet({url:urlstr});
            var che = $('.twocheck');
            var box = $('.times');
            var checkboxArr = [];
            che.html("");
            box.html("");
            $.each(data2,function(i,vals){
              var serviceList = item.serviceList;
              var box2 =$('<div style="overflow:hidden;margin-bottom:5px;">');
              var _label2 = $('<label class="span4 grid-layout-label">'+'</label>');
              var input2 = $('<input class="span6 creatinput" placeholder="次" value="" >');
              var che2 =$('<div style="overflow:hidden;margin-bottom:5px;">');
              var _label = $('<label class="labclasss">'+'</label>');
              var checked = $('<input type="checkbox" class="inputclass">');

              $(_label).html(vals.displayName);
              $(_label2).html(vals.displayName);
              $.each(serviceList,function(j,ser){
                if(vals.serviceId == ser.serviceId){
                  $(input2).val(ser.serviceTimes)
                 }
                 if(vals.serviceId == ser.serviceId ){
                  if(ser.chooseType == 2){
                    $(checked).attr("checked",'checked');
                  }
                 }
              });
              $('.twocheck').append(che2.append(checked).append(_label));
              $('.times').append(box2.append(_label2).append(input2));

              if($("div[data-name='chooseType']",wraper).radio('val')=='1'){ 
                 $(".twocheck",wraper).hide();
              }
              else{
                  $(".twocheck",wraper).show();
              }

            });
				}else{
          $('#Form_thirdParty_sendCard',wraper).form({
               title:'修改', 
               item:item,
               url:'/shopmanage-ws/ws/0.1/bizPartnerManager/saveDocumentNo',
               before_submit:function(json){
                    var checkboxArr=[];
                    $.each(data2,function(i,vals){
                      var item = data2[i];
                      var json2 = {};
                      json2.serviceId = vals.serviceId;
                      json2.displayName= vals.displayName;
                      if($("div[data-name='chooseType']",wraper).radio('val')=='1'){
                        json2.chooseType= 1
                      }
                      else{
                        if($('.twocheck input').eq(i).attr("checked")=='checked'){
                            json2.chooseType = 2
                        }else{
                          json2.chooseType = 1
                        }
                      }
                      json2.serviceTimes = $('.times input').eq(i).attr("value");
                      checkboxArr.push(json2); 
                    });
                    json.serviceList = checkboxArr;
                    json.operator = carsmart_config.operatorName;
                    return json
                  },
               success_callback:function(){
                    $('#Table_thirdParty_sendCard').flexMessage('修改成功','success');
                    $('#Table_thirdParty_sendCard').flexReload()
                  }
            }).form('open');
            var bizCategoryId = $("div[name='bizCategoryId']",wraper).select('val');
            var urlstr = '/shopmanage-ws/ws/0.1/bizPartnerManager/getServiceList?bizCategoryId='+bizCategoryId;
            var data2 = $.jRadGet({url:urlstr});
            var che = $('.twocheck');
            var box = $('.times');
            var checkboxArr = [];
            che.html("");
            box.html("");
            $.each(data2,function(i,vals){
              var serviceList = item.serviceList;
              var box2 =$('<div style="overflow:hidden;margin-bottom:5px;">');
              var _label2 = $('<label class="span4 grid-layout-label">'+'</label>');
              var input2 = $('<input class="span6 creatinput" placeholder="次" value="" >');
              var che2 =$('<div style="overflow:hidden;margin-bottom:5px;">');
              var _label = $('<label class="labclasss">'+'</label>');
              var checked = $('<input type="checkbox" class="inputclass">');

              $(_label).html(vals.displayName);
              $(_label2).html(vals.displayName);
              $.each(serviceList,function(j,ser){
                if(vals.serviceId == ser.serviceId){
                  $(input2).val(ser.serviceTimes)
                 }
                 if(vals.serviceId == ser.serviceId ){
                  if(ser.chooseType == 2){
                    $(checked).attr("checked",'checked');
                  }
                 }
              });
              $('.twocheck').append(che2.append(checked).append(_label));
              $('.times').append(box2.append(_label2).append(input2));

              if($("div[data-name='chooseType']",wraper).radio('val')=='1'){ 
                 $(".twocheck",wraper).hide();
              }
              else{
                  $(".twocheck",wraper).show();
              }

            });
          $('#Form_thirdParty_sendCard div[name="billAmount"]').input("readonly",true);
          $('#Form_thirdParty_sendCard div[name="bizCategoryId"]').select("readonly",true);
          $('#Form_thirdParty_sendCard div[name="chooseType"]').radio("readonly",true);
          $('#Form_thirdParty_sendCard div[name="documentNo"]').input("readonly",true);
          $('.twocheck input').attr("disabled",true);
          $('.times input').attr("disabled",true);

        }
			}
	}); 
  // 删除是因为 批量删除 绑定时 提示语需要判断
	// page_list_buttons.push({title: '删除',name:'Delete', bclass: 'delete',prefunc:function(){
 //            var checked = $('#Table_thirdParty_sendCard').getCheckedTrs();
 //            if (checked.length == 0) {return false;}else{return true;}
 //        },onpress : function(){
 //        	var checked = $('#Table_thirdParty_sendCard').getCheckedTrs();
 //        	var ids = [];
 //        	$.each(checked,function(){
 //        		ids.push(this.bizDocumentId)
 //        	});
 //        	$.jRadConfirm('确认删除？',1,function(){
 //        		var postData={};
 //        		postData.bizDocumentIds=ids.join(',');
            
 //        		$.jRadAjax({
 //        			url:'/shopmanage-ws/ws/0.1/bizPartnerManager/delDocumentNo',
 //        			data:postData,
 //        			success:function(){
 //        				$('#Table_thirdParty_sendCard').flexMessage('删除成功!', 'success');
	// 	           	    $('#Table_thirdParty_sendCard').flexReloadSearch(); 
 //        			},
 //              error:function(xhr){
 //  					    var errormsg = eval("(" + xhr.responseText + ")"); 
 //      						if (errormsg != undefined) {
 //      							$('#Table_thirdParty_sendCard').flexMessage(errormsg[0].message, 'error');
 //      					}
	// 				    }
 //        	  })
 //        	})
	// 	}
	// });
	page_list_buttons.push({title: '导出Excel',displayname:'导出EXCEL',name:'excel', bclass: 'excel',prefunc:function(){
            var checked = $('#Table_thirdParty_sendCard').getCheckedTrs();
            if (checked.length != 0) {return false;}else{return true;}
        },onpress : function(){
        	var checked = $('#Table_thirdParty_sendCard').getCheckedTrs();
        	$.jRadConfirm('确认导出吗？',1,function(){
         var param = {};
         var userId = $.trim($(".searchContent div[name='userId']",wraper).input('val'));
         if(userId!=""){
          param['userId'] = userId;
         }; 
         var mobilePhone = $.trim($(".searchContent div[name='mobilePhone']",wraper).input('val'));
         if(mobilePhone!=""){
          param['mobilePhone'] = mobilePhone;
         };
         var isBindUser = $.trim($(".searchContent div[name='isBindUser']",wraper).select('val'));
         if(isBindUser!=""){
          param['isBindUser'] = isBindUser;
         }; 
         var documentNo = $.trim($(".searchContent div[name='documentNo']",wraper).input('val'));
         if(documentNo!=""){
          param['documentNo'] = documentNo;
         };
         var cardId = $.trim($(".searchContent div[name='cardId']",wraper).input('val'));
         if(cardId!=""){
          param['cardId'] = cardId;
         }; 
         var operator = $.trim($(".searchContent div[name='operator']",wraper).input('val'));
         if(operator!=""){
          param['operator'] = operator;
         }; 
         var createStartDate = $.trim($(".searchContent div[name='createStartDate']",wraper).dateinput('val'));
         if(createStartDate!=""){
          param['createStartDate'] = createStartDate;
         };
         var createEndDate = $.trim($(".searchContent div[name='createEndDate']",wraper).dateinput('val'));
         if(createEndDate!=""){
          param['createEndDate'] = createEndDate;
         };
         var bindStartDate = $.trim($(".searchContent div[name='bindStartDate']",wraper).dateinput('val'));
         if(bindStartDate!=""){
          param['bindStartDate'] = bindStartDate;
         };
         var bindEndDate = $.trim($(".searchContent div[name='bindEndDate']",wraper).dateinput('val'));
         if(bindEndDate!=""){
          param['bindEndDate'] = bindEndDate;
         };
         
         var paramUrl = "";
         if(param!={}){   
         paramUrl+="?"
         $.each(param,function(k,v){ 
            paramUrl+="&"+k+"="+v; 
         });
         }
         window.open('/shopmanage-ws/ws/0.1/bizPartnerManager/exportDocumentList'+paramUrl);
      });
		}
	});
  $('#Form_service_count .jrad-btn-primary',wraper).button({
    click:function(){
        var createStartDate = $("#Form_service_count div[name='createStartDate']").dateinput('val');
        var createEndDate = $("#Form_service_count div[name='createEndDate']").dateinput('val');;
        var urlstr = '/shopmanage-ws/ws/0.1/bizPartnerManager/sendServiceStatic?createStartDate='+createStartDate+'&createEndDate='+createEndDate;
            var data = $.jRadGet({url:urlstr});  
            $(".countTable",wraper).html('')
            $.each(data,function(k,v){ 
              var _title;
              var price = [];  
              var _first = $("<tr>");
              var _second = $("<tr>"); 
              $.each(v,function(i){
                  var item = v[i];
                  _first.append('<td>'+item.displayName+'</td>');
                  _second.append('<td style="border-bottom:1px solid #ccc">'+item.serviceTime+'</td>');
                  if(i==(v.length-1)){
                    _second.append('<td style="border-bottom:1px solid #ccc">'+item.totalServiceValue+'</td>');
                  }
                  price.push(item.unitPrice+"元/次"); 
              }) ;  
              var tableName = ""; 
              if(k=="washCar"){
                tableName = "洗车";
              }else if(k=="maintainService"){
                tableName = "小保养";
              }else if(k=="paintRepair"){
                tableName = "车漆修复";
              }
              _table = $("<table>");
              var str = "";
              if(price.length>0){
                str = "("+ price.join(',')+")";
              }
              if(k=="washCar"){
                _title = $("<tr>").html('<td colspan="'+v.length+'">'+tableName+str+'</td><td>总计</td>');  
              }else{
                _title = $("<tr>").html('<td colspan="'+v.length+'">'+tableName+str);  
              } 
              $(".countTable",wraper).append(_title).append(_first).append(_second);
            });       
    }
            
  });
    $('#Form_service_count .jrad-btn-normal',wraper).button({
    click:function(){
               $('#Form_service_count',wraper).form('close') 
    }
            
  });
  page_list_buttons.push({title: '赠送服务统计',displayname:'赠送服务统计',name:'exchangeCodes', bclass: 'exchangeCodes',onpress : function(){
          var checked = $('#Table_thirdParty_sendCard').getCheckedTrs();
          $('#Form_service_count').form({
            title:'赠送服务统计',
            item:{},
            autobinding: false
          }).form('open')
            var now = new Date();
            var currentdate = now.getFullYear()+"-"+((now.getMonth()+1)<10?"0":"")+(now.getMonth()+1)+"-"+(now.getDate()<10?"0":"")+now.getDate();
            $("#Form_service_count div[name='createStartDate']").dateinput('val',currentdate);
            $("#Form_service_count div[name='createEndDate']").dateinput('val',currentdate);

            var urlstr = '/shopmanage-ws/ws/0.1/bizPartnerManager/sendServiceStatic?createStartDate='+currentdate+'&createEndDate='+currentdate;
            var data = $.jRadGet({url:urlstr});  
            $(".countTable",wraper).html('')
            $.each(data,function(k,v){ 
              var _title;
              var price = [];  
              var _first = $("<tr>");
              var _second = $("<tr>"); 
              $.each(v,function(i){
                  var item = v[i];
                  _first.append('<td>'+item.displayName+'</td>');
                  _second.append('<td style="border-bottom:1px solid #ccc">'+item.serviceTime+'</td>');
                  if(i==(v.length-1)){
                    _second.append('<td style="border-bottom:1px solid #ccc">'+item.totalServiceValue+'</td>');
                  }
                  price.push(item.unitPrice+"元/次"); 
              }) ;  
              var tableName = ""; 
              if(k=="washCar"){
                tableName = "洗车";
              }else if(k=="maintainService"){
                tableName = "小保养";
              }else if(k=="paintRepair"){
                tableName = "车漆修复";
              }
              _table = $("<table>");
              var str = "";
              if(price.length>0){
                str = "("+ price.join(',')+")";
              }
              if(k=="washCar"){
                _title = $("<tr>").html('<td colspan="'+v.length+'">'+tableName+str+'</td><td>总计</td>');  
              }else{
                _title = $("<tr>").html('<td colspan="'+v.length+'">'+tableName+str);  
              }
              
              $(".countTable",wraper).append(_title).append(_first).append(_second);
            });       
    }
  });

    page_list_buttons.push({separator: true});

    $('#Table_thirdParty_sendCard').flexigrid({
            reload:true,
      			method:'get',
                  colModel : page_column_model,
                  buttons : page_list_buttons,
                  searchitems :page_search_items,
                  pagination: {
      				diaplay_pages: 5,
      				align: 'bottom' 
      			},
			      showSearch:true,  
            url:'/shopmanage-ws/ws/0.1/bizPartnerManager/documentList', //此时userId为当前登录用户的ID 
			      onError:showError, 
			      //checkBoxType:'single',
			      overflow:true
    });
	 $(".numb77").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg77").form({}).form('close');
        $("#Form_explain_eg77").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
      submit:function(){
              var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg77 div[name='remark']").textarea("val")
        $.jRadPost({
            url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
            data:postData,
            success:function(){
            $("#Form_explain_eg77").form('close')
                $('.overcurtainDiv').hide();
            }
        });
      }, 
      cancel:function(){
        $("#Form_explain_eg77").form('close')
            $('.overcurtainDiv').hide();
      }
        }).form('open')
        $("#Form_explain_eg77 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
    function showError(xhr){
      var errormsg = eval("(" + xhr.responseText + ")");
      var cDiv = $("#Wraper_thirdParty_sendCard .cDiv");
      $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
    }
});
</script>
