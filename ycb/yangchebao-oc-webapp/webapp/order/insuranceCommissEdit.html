
<div class="urlContentWraper" id="Wraper_busInsurance_commiss"> 
	<div class="row-fluid ui-data-show"> 
		<div class="hDiv">
			<h2 class="ui-tit"><strong>商家保险提成设置</strong></h2>
			<table id="Table_busInsurance_commiss"></table>
		</div> 
    </div> 

    <div id="Form_busInsurance_commiss" style="display:none;">
        <div class="grid-layout-main jrad-form">  
			<div class="row"> 
				<label class="span2 grid-layout-label">省：</label>
				 <div class="span7 grid-layout-content">
					   <div name="provinceId" class="jrad-select-container"></div>
				 </div>
			</div>    
			<div class="row"> 
				<label class="span2 grid-layout-label">市：</label>
				 <div class="span7 grid-layout-content">
					   <div name="areaCodeId" class="jrad-select-container"></div>
				 </div>
			</div>
			<div class="row"> 
				<label class="span2 grid-layout-label">商家ID：</label>
				 <div class="span7 grid-layout-content">
					   <div name="businessInfoId" class="jrad-input-container"></div>
				 </div>
			</div>
			<div class="row"> 
				<label class="span2 grid-layout-label">保险公司：</label>
				 <div class="span7 grid-layout-content">
					   <div name="companyId" class="jrad-select-container"></div>
				 </div>
			</div>
			<div class="row isstatus"> 
				<label class="span2 grid-layout-label">是否有效：</label>
				 <div class="span7 grid-layout-content">
					   <div name="status" class="jrad-select-container"></div>
				 </div>
			</div>

			<div class="row"> 
				<label class="span2 grid-layout-label"> 
					<strong>交强险</strong>
				</label>
			</div>
			<div class="row-fluid r-jqx">
				 <label class="span3 grid-layout-label"></label>
				 <div class="span18 grid-layout-content">
					   <div name="efcType" class="jrad-radio-container"></div>
				 </div>
			</div>
			<div class="row jqx">
				<label class="span3 grid-layout-label"><span class="ui-form-required">*</span>提成金额(元)：</label>
				<div class="span5 grid-layout-content fluid-wrap">
					<div name="efcRate" class="jrad-input-container">
					</div>
				</div>
				<p class="span1 grid-layout-label bfb" style="display:none;margin-left:0;width:10px">%</p>
			</div>


			<div class="row"> 
				<label class="span2 grid-layout-label"> 
					<strong>商业险</strong>
				</label>
			</div>
			<div class="row-fluid r-syx">
				 <label class="span3 grid-layout-label"></label>
				 <div class="span18 grid-layout-content">
					   <div name="bizType" class="jrad-radio-container"></div>
				 </div>
			</div>

			<div class="row syx">
				<label class="span3 grid-layout-label"><span class="ui-form-required">*</span>提成金额(元)：</label>
				<div class="span5 grid-layout-content fluid-wrap">
					<div  name="bizRate" class="jrad-input-container">
					</div>
				</div>
				<p class="span1 grid-layout-label bfb" style="display:none;margin-left:0;width:10px">%</p>
			</div>

			<div class="row"> 
				<label class="span2 grid-layout-label"> 
					<strong>车船税</strong>
				</label>
			</div>

			<div class="row-fluid r-ccs">
				 <label class="span3 grid-layout-label"></label>
				 <div class="span18 grid-layout-content">
					   <div name="taxType" class="jrad-radio-container"></div>
				 </div>
			</div>
			<div class="row ccs">
				<label class="span3 grid-layout-label"><span class="ui-form-required">*</span>提成金额(元)：</label>
				<div class="span5 grid-layout-content fluid-wrap">
					<div name="taxRate" class="jrad-input-container">
					</div>
				</div>
				<p class="span1 grid-layout-label bfb" style="display:none;margin-left:0;width:10px">%</p>
			</div>

        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span>
			<span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function(){ 
    var wraper = $('#Wraper_busInsurance_commiss');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array(); 

	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});  

	jRad.validators['efcRate'] = [{msg:"交强险不能为空",type:'min',value:'1'}];
	jRad.validators['bizRate'] = [{msg:"商业险不能为空",type:'min',value:'1'}];
	jRad.validators['taxRate'] = [{msg:"车船税不能为空",type:'min',value:'1'}];

    jRad.params['companyId'] = {
		urlData:{
			url:'/shopmanage-ws/ws/0.1/insureCompany/list',
			id:'insureCompanyId',
			name:'companyName'
		},
		unshiftData: {id:'',name:'请选择'},
	};
	//省市
	jRad.params['provinceId'] = {
		urlData:{
			url:'/shopmanage-ws/ws/0.1/userInfoCms/provinceAll'
		},
		unshiftData: {id:'',name:'请选择'},
		onchange: function(){
			var provinceCode = $('.searchContent div[name=provinceId]',wraper).select('val'); 
			if(provinceCode==''){ 
				$('.searchContent div[name=areaCodeId]',wraper).select({
					urlData:{url:''},
					data:[{id:'',name:'请选择'}],
					val:''});
			}else{  
				$('.searchContent div[name=areaCodeId]',wraper).select({ 
					urlData:{
						url: '/shopmanage-ws/ws/0.1/userInfoCms/municipalities?provinceId=' + provinceCode 
					},
					unshiftData: {id:'',name:'请选择'}
				}).select('val','');
			}
		}
	};
	jRad.params['areaCodeId'] = {
		data: [{id:'',name:'请选择'}] 
	};


	var fields_params = {};
	fields_params['companyId'] = {
		urlData:{
			url:'/shopmanage-ws/ws/0.1/insureCompany/list',
			id:'insureCompanyId',
			name:'companyName'
		},
		unshiftData: {id:'0',name:'全部'}
	};
	fields_params['efcType'] = {data:[
		{id:'1',name:'固定金额'},
	    {id:'2',name:'金额百分比'}
	]}
	fields_params['bizType'] = {data:[
		{id:'1',name:'固定金额'},
	    {id:'2',name:'金额百分比'}
	]}
	fields_params['taxType'] = {data:[
		{id:'1',name:'固定金额'},
	    {id:'2',name:'金额百分比'}
	]}	

	fields_params['efcType']={
        data:[{id:'1',name:'固定金额'},{id:'2',name:'订单百分比'}],
        onclick:function(){  
            if($(".r-jqx div[data-name='efcType']",wraper).radio('val')=='1'){ 
               $(".jqx label",wraper).html('<span class="ui-form-required">*</span>提成金额(元)：');
               $("div[name='efcRate']").input("val",'');
			   $(".jqx .bfb",wraper).hide();
            }
            else{
               $(".jqx label",wraper).html('<span class="ui-form-required">*</span>订单百分比：');
               $("div[name='efcRate']").input("val",'');
			   $(".jqx .bfb",wraper).show();
            }
        }
    };	
	fields_params['bizType']={
        data:[{id:'1',name:'固定金额'},{id:'2',name:'订单百分比'}],
        onclick:function(){  
            if($(".r-syx div[data-name='bizType']",wraper).radio('val')=='1'){ 
               $(".syx label",wraper).html('<span class="ui-form-required">*</span>提成金额(元)：');
               $("div[name='bizRate']").input("val",'');
			   $(".syx .bfb",wraper).hide();
            }
            else{
               $(".syx label",wraper).html('<span class="ui-form-required">*</span>订单百分比：');
               $("div[name='bizRate']").input("val",'');
			   $(".syx .bfb",wraper).show();
            }
        }
    };
	fields_params['taxType']={
        data:[{id:'1',name:'固定金额'},{id:'2',name:'订单百分比'}],
        onclick:function(){  
            if($(".r-ccs div[data-name='taxType']",wraper).radio('val')=='1'){ 
               $(".ccs label",wraper).html('<span class="ui-form-required">*</span>提成金额(元)：');
               $("div[name='taxRate']").input("val",'');
			   $(".ccs .bfb",wraper).hide();
            }
            else{
               $(".ccs label",wraper).html('<span class="ui-form-required">*</span>订单百分比：');
               $("div[name='taxRate']").input("val",'');
			   $(".ccs .bfb",wraper).show();
            }
        }
    };

	fields_params['status'] = {data:[
		{id:'1',name:'有效'},
	    {id:'0',name:'无效'}
	]}

	fields_params['provinceId'] = {
		urlData:{
			url:'/shopmanage-ws/ws/0.1/userInfoCms/provinceAll'
		},
		unshiftData: {id:'0',name:'全部'},
		onchange: function(){
			var provinceCode = $('#Form_busInsurance_commiss div[name=provinceId]').select('val'); 
			if(provinceCode==''){ 
				$('#Form_busInsurance_commiss div[name=areaCodeId]').select({
					urlData:{url:''},
					data:[{id:'0',name:'全部'}]});
			}else{ 
				$('#Form_busInsurance_commiss div[name=areaCodeId]').select({
					urlData:{
						url: '/shopmanage-ws/ws/0.1/userInfoCms/municipalities?provinceId=' + provinceCode 
					},
					unshiftData: {id:'0',name:'全部'} 
				});
			} 			
		}
	};
	fields_params['areaCodeId'] = {
		data: [{id:'0',name:'全部'}]
	}; 

    page_column_model.push({display: '商家保险补贴ID', name : 'busiInsureCommissionId'}); 
    page_column_model.push({display: '商家ID', name : 'businessInfoId'}); 
	page_column_model.push({display: '商家名称', name : 'businessRegName'}); 
	page_column_model.push({display: '保险公司', name : 'insureCompanyName'});
    page_column_model.push({display: '省', name : 'provinceName'}); 
    page_column_model.push({display: '市', name : 'areaCodeName'}); 
    page_column_model.push({display: '交强险提成', name : 'efcPrice'});
    page_column_model.push({display: '商业险提成', name : 'bizPrice'});
    page_column_model.push({display: '车船税提成',name : 'taxPrice'});   
    page_column_model.push({display: '是否有效', name : 'status'});

	page_search_items.push({row:'1',type:'jrad-input',display:'商家ID',name:'businessInfoId'});  
	page_search_items.push({row:'1',type:'jrad-select',display:'保险公司',name:'companyId',params:jRad.params['companyId']});  
	page_search_items.push({row:'2',type:'jrad-select',display:'省',name:'provinceId',params:jRad.params['provinceId']}); 
	page_search_items.push({row:'2',type:'jrad-select',display:'市',name:'areaCodeId',params:jRad.params['areaCodeId']});   
     
    page_list_buttons.push({displayname: '创建',name:'创建', bclass: 'add',
    	onpress : function(){  
			$('#Form_busInsurance_commiss').form({
                title: '提成金额设置',
                grid: 10, 
                item:{},
                fields_params:fields_params,
				validators:jRad.validators,
               	url:'/shopmanage-ws/ws/0.1/insureCommission/addCommission',
				before_submit:function(json){  
					json.operator = carsmart_config.operatorName;
					json.efcType = $('#Form_busInsurance_commiss div[name="efcType"]').radio('val')
					json.bizType = $('#Form_busInsurance_commiss div[name="bizType"]').radio('val')
					json.taxType = $('#Form_busInsurance_commiss div[name="taxType"]').radio('val')
					return json
				},				
				success_callback:function(){ 
                    $('#Table_busInsurance_commiss').flexMessage('创建成功', 'success');
                    $('#Table_busInsurance_commiss').flexReloadCurrentPage()
                } 
            }).form('open'); 
            $(".isstatus").hide();

            $('#Form_busInsurance_commiss div[name="provinceId"]').select('readonly',false)
            $('#Form_busInsurance_commiss div[name="areaCodeId"]').select('readonly',false)
            $('#Form_busInsurance_commiss div[name="businessInfoId"]').input('readonly',false)
            $('#Form_busInsurance_commiss div[name="companyId"]').select('readonly',false)

            $('#Form_busInsurance_commiss div[name="efcType"]').radio('val',1)
            $('#Form_busInsurance_commiss div[name="bizType"]').radio('val',1)
            $('#Form_busInsurance_commiss div[name="taxType"]').radio('val',1)
            
        	if($(".r-jqx div[data-name='efcType']",wraper).radio('val')==1){
				$(".jqx label",wraper).html('<span class="ui-form-required">*</span>提成金额(元)：');
				$(".jqx .bfb",wraper).hide();
			}else{
				$(".jqx label",wraper).html('<span class="ui-form-required">*</span>订单百分比：');
				$(".jqx .bfb",wraper).show();
			}
			if($(".r-syx div[data-name='bizType']",wraper).radio('val')==1){
				$(".syx label",wraper).html('<span class="ui-form-required">*</span>提成金额(元)：');
				$(".syx .bfb",wraper).hide();
			}else{
				$(".syx label",wraper).html('<span class="ui-form-required">*</span>订单百分比：');
				$(".syx .bfb",wraper).show();
			}
			if($(".r-ccs div[data-name='taxType']",wraper).radio('val')==1){
				$(".ccs label",wraper).html('<span class="ui-form-required">*</span>提成金额(元)：');
				$(".ccs .bfb",wraper).hide();
			}else{
				$(".ccs label",wraper).html('<span class="ui-form-required">*</span>订单百分比：');
				$(".ccs .bfb",wraper).show();
			}
        }
    }); 

    page_list_buttons.push({displayname: '修改',name:'修改', bclass: 'edit',
		prefunc:function(){
            var checked = $('#Table_busInsurance_commiss').getCheckedTrs();
            if (checked.length == 0) {return false;}else{return true;}
        },
    	onpress : function(){  

        	var checked=$('#Table_busInsurance_commiss').getCheckedTrs();
        	var commissData = $.jRadGet({url:'/shopmanage-ws/ws/0.1/insureCommission/getCommissionById?busiInsureCommissionId='+checked[0].busiInsureCommissionId})
			$('#Form_busInsurance_commiss').form({
                title: '提成金额修改',
                grid: 10, 
                item:commissData,
				validators:jRad.validators,
                fields_params:fields_params,
               	url:'/shopmanage-ws/ws/0.1/insureCommission/updateCommission',
				before_submit:function(json){  
					json.busiInsureCommissionId = checked[0].busiInsureCommissionId
					json.operator = carsmart_config.operatorName;
					return json
				},				
				success_callback:function(){ 
                    $('#Table_busInsurance_commiss').flexMessage('编辑成功', 'success');
                    $('#Table_busInsurance_commiss').flexReloadCurrentPage()
                } 
            }).form('open'); 
            $(".isstatus").show();
            $('#Form_busInsurance_commiss div[name="provinceId"]').select('readonly',true)
            $('#Form_busInsurance_commiss div[name="areaCodeId"]').select('readonly',true)
            $('#Form_busInsurance_commiss div[name="businessInfoId"]').input('readonly',true)
            $('#Form_busInsurance_commiss div[name="companyId"]').select('readonly',true)
            if($(".r-jqx div[data-name='efcType']",wraper).radio('val')==1){
				$(".jqx label",wraper).html('<span class="ui-form-required">*</span>提成金额(元)：');
				$(".jqx .bfb",wraper).hide();
			}else{
				$(".jqx label",wraper).html('<span class="ui-form-required">*</span>订单百分比：');
				$(".jqx .bfb",wraper).show();
			}
			if($(".r-syx div[data-name='bizType']",wraper).radio('val')==1){
				$(".syx label",wraper).html('<span class="ui-form-required">*</span>提成金额(元)：');
				$(".syx .bfb",wraper).hide();
			}else{
				$(".syx label",wraper).html('<span class="ui-form-required">*</span>订单百分比：');
				$(".syx .bfb",wraper).show();
			}
			if($(".r-ccs div[data-name='taxType']",wraper).radio('val')==1){
				$(".ccs label",wraper).html('<span class="ui-form-required">*</span>提成金额(元)：');
				$(".ccs .bfb",wraper).hide();
			}else{
				$(".ccs label",wraper).html('<span class="ui-form-required">*</span>订单百分比：');
				$(".ccs .bfb",wraper).show();
			}
        }
    }); 

    page_list_buttons.push({title: '删除',name:'Delete', bclass: 'delete',
		prefunc:function(){
            var checked = $('#Table_busInsurance_commiss').getCheckedTrs();
            if (checked.length == 0) {return false;}else{return true;}
        },
        onpress : function(){
        	var checked = $('#Table_busInsurance_commiss').getCheckedTrs();
        	$.jRadConfirm('确认删除？',1,function(){
        		var postData={};
        		postData.busiInsureCommissionId=checked[0].busiInsureCommissionId;
        		$.jRadAjax({
        			url:'/shopmanage-ws/ws/0.1/insureCommission/delCommission',
        			data:postData,
        			success:function(){
        				$('#Table_busInsurance_commiss').flexMessage('删除成功!', 'success');
		           	    $('#Table_busInsurance_commiss').flexReloadSearch(); 
        			},
              		error:function(xhr){
  					    var errormsg = eval("(" + xhr.responseText + ")"); 
      					if (errormsg != undefined) {
      						$('#Table_busInsurance_commiss').flexMessage(errormsg[0].message, 'error');
      					}
					}
        	  	})
        	})
		}
	});
    page_list_buttons.push({separator: true});
    
    $('#Table_busInsurance_commiss').flexigrid({
        reload:true,
		method:'get',
        colModel : page_column_model,
        buttons : page_list_buttons,
        searchitems :page_search_items,
		pagination: {
			diaplay_pages: 5,
			align: 'bottom' 
		},
		showSearch:true, 
		overflow:true,
        url:'/shopmanage-ws/ws/0.1/insureCommission/getList', 
		onError:showError
    });

	function showError(xhr){
		var errormsg = eval("(" + xhr.responseText + ")"); 
		$.jRadMessage({level:'error',message:errormsg[0].message});
	} 
});
</script>

