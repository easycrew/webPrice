
<div class="urlContentWraper" id="Wraper_oil_order">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>加油卡订单列表</strong><bottom class="all-work-info numb56">页面说明</bottom></h2>
        <!-- 列表显示 -->
		<div class="pic-grid">
			<table id="Table_oil_order"></table>
		</div>
    </div>
    <div id="Form_explain_eg56" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>APP上外接的欧飞加油卡的订单列表。</div>
                    <div><strong>重要功能说明：</strong>无。</div>
                    <div><strong>注意事项：</strong>无。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_oil_order');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array(); 
	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel}); 
	
	jRad.params['orderStatus'] = { 
		data: [{id:'',name:'全部'},{id:'0',name:'待付款'},{id:'1',name:'充值中'},{id:'2',name:'充值成功'},{id:'3',name:'充值失败'},{id:'4',name:'已取消'}] 
	};
	jRad.params['cardType'] = {
		data: [{id:'',name:'全部'},{id:'1',name:'中石油'},{id:'2',name:'中石化'}] 
	};
	jRad.params['amount'] = {
		data: [{id:'',name:'全部'},{id:'50',name:'50'},{id:'100',name:'100'},{id:'200',name:'200'},{id:'1000',name:'1000'},{id:'2000',name:'2000'},{id:'3000',name:'3000'}] 
	};

	var payChannelId = [];
	var _result = $.jRadGet({
		url: '/shopmanage-ws/ws/0.1/orders/payChannels'
	});
	$.each(_result.payChannels,
	function(index, vo) {
		var __id = vo['payChannelId'];
		var __name = vo['payChannelName'];
		var __tm = {
			'id': __id,
			'name': __name
		};
		payChannelId.push(__tm);
	});
	payChannelId.unshift({'id':'','name':'全部'});

    page_column_model.push({display: '订单ID', name : 'id'});
    page_column_model.push({display: '用户手机', name : 'mobile'});
    page_column_model.push({display: '订单编号', name : 'orderNum'});
    page_column_model.push({display: '加油卡号', name : 'oilCardNum'});
    page_column_model.push({display: '油卡类型', name : 'cardType'});
	page_column_model.push({display: '加油卡面值', name : 'amount'});
	page_column_model.push({display: '用户支付金额', name : 'userPayAmount'}); 
	page_column_model.push({display: '养车宝支付金额', name : 'ycbPayAmount'});
	page_column_model.push({display: '最后更新时间', name : 'updateDate'});
	page_column_model.push({display: '订单状态', name : 'orderStatus'});
	page_column_model.push({display: '支付渠道', name : 'payChannelName'});
    
    page_search_items.push({row:'1',type:'jrad-input',display:'用户手机',name:'mobile'});
    page_search_items.push({row:'1',type:'jrad-input',display:'订单编号',name:'orderNum'});
    page_search_items.push({row:'1',type:'jrad-input',display:'加油卡号',name:'oilCardNum'});
	page_search_items.push({row:'2',type:'jrad-select',display:'油卡类型',name:'cardType',params:jRad.params['cardType']});
	page_search_items.push({row:'2',type:'jrad-select',display:'充值金额',name:'amount',params:jRad.params['amount']}); 
	page_search_items.push({row:'2',type:'jrad-select',display:'订单状态',name:'orderStatus',params:jRad.params['orderStatus']});
	page_search_items.push({row:'3',type:'jrad-dateinput',display:'最后更新时间始',name:'updateDateStart'});
	page_search_items.push({row:'3',type:'jrad-dateinput',display:'最后更新时间终',name:'updateDateEnd'});
	page_search_items.push({row:'3',type:'jrad-select',display:'支付渠道',name:'payChannelId',params:{
	 	data:payChannelId
	}});

	page_list_buttons.push({displayname: '导出EXCEL',name:'excel', bclass: 'excel',onpress : function(){ 
		 $ .jRadConfirm('确认导出吗？',1,function(){
				 var param = {};
				 var mobile = $.trim($(".searchContent div[name='mobile']",wraper).input('val'));
				 if(mobile!=""){
					param['mobile'] = mobile;
				 };
				 var orderNum = $.trim($(".searchContent div[name='orderNum']",wraper).input('val'));
				 if(orderNum!=""){
					param['orderNum'] = orderNum;
				 }; 
				 var oilCardNum = $.trim($(".searchContent div[name='oilCardNum']",wraper).input('val'));
				 if(oilCardNum!=""){
					param['oilCardNum'] = oilCardNum;
				 };
				 var cardType = $.trim($(".searchContent div[name='cardType']",wraper).select('val'));
				 if(cardType!=""){
					param['cardType'] = cardType;
				 }; 
				 var amount = $.trim($(".searchContent div[name='amount']",wraper).select('val'));
				 if(amount!=""){
					param['amount'] = amount;
				 };
				 var orderStatus = $.trim($(".searchContent div[name='orderStatus']",wraper).select('val'));
				 if(orderStatus!=""){
					param['orderStatus'] = orderStatus;
				 };
				 var updateDateStart = $.trim($(".searchContent div[name='updateDateStart']",wraper).dateinput('val'));
				 if(updateDateStart!=""){
					param['updateDateStart'] = updateDateStart;
				 }; 
				 var updateDateEnd = $.trim($(".searchContent div[name='updateDateEnd']",wraper).dateinput('val'));
				 if(updateDateEnd!=""){
					param['updateDateEnd'] = updateDateEnd;
				 };
				 var payChannelId = $.trim($(".searchContent div[name='payChannelId']",wraper).select('val'));
				 if(payChannelId!=""){
					param['payChannelId'] = payChannelId;
				 }; 
				 var paramUrl = "";
				 if(param!={}){   
				 paramUrl+="?"
				 $.each(param,function(k,v){ 
						paramUrl+="&"+k+"="+v; 
				 });
				 }
				 window.open('/shopmanage-ws/ws/0.1/oilCardOrder/exportList'+paramUrl);
			}); 
        }
    });
    page_list_buttons.push({separator: true});

    $('#Table_oil_order').flexigrid({
            reload:true,
			method:'get',
            colModel : page_column_model,
            buttons : page_list_buttons,
            searchitems :page_search_items,
			showSearch:true,
            pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			},
			overflow:true,
			checkBoxType:'single',
            url:'/shopmanage-ws/ws/0.1/oilCardOrder/list', 
			onError:showUserError
    }); 
		
	function showUserError(xhr){
		var errormsg = eval("(" + xhr.responseText + ")");
		var cDiv = $("#Wraper_oil_order .cDiv");
		$.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
	}
	$(".numb56").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg56").form({}).form('close');
        $("#Form_explain_eg56").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
			submit:function(){
            	var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg56 div[name='remark']").textarea("val")
				$.jRadPost({
				    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
				    data:postData,
				    success:function(){
						$("#Form_explain_eg56").form('close')
      					$('.overcurtainDiv').hide();
				   	}
				});
			}, 
			cancel:function(){
				$("#Form_explain_eg56").form('close')
      			$('.overcurtainDiv').hide();
			}
        }).form('open')
        $("#Form_explain_eg56 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })

});
</script>
