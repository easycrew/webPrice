<div class="urlContentWraper" id="Wraper_category_message">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>资讯分类列表</strong><bottom class="all-work-info numb101">页面说明</bottom></h2>
        <!-- 列表显示 -->
        <table id="Table_category_message"></table>
    </div>
    <div id="Form_category_message" style="display:none;"> 
		<div class="grid-layout-main jrad-form">
            <input name="messageId" type="hidden">  
			 <div class="row">
                 <label class="span3 grid-layout-label">分类名：</label>
                 <div class="span5 grid-layout-content">
                       <div name="name" class="jrad-input-container"></div>
                                    </div>
            </div>
			 <div class="row">
                 <label class="span3 grid-layout-label">状态：</label>
                 <div class="span5 grid-layout-content">
                       <div name="status" class="jrad-select-container"></div>
                                    </div>
            </div> 
        </div> 
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span>
			<span class="jrad-btn-normal">取消</span> 
        </div>
    </div>
    <div id="Form_explain_eg101" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>客户端每日早读课的分类管理。</div>
                    <div><strong>重要功能说明：</strong>无。</div>
                    <div><strong>注意事项：</strong>1、客户端是按创建时间倒序排列的，所以修改排序时，现在是找开发修改创建时间完成的。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).ready(function(){ 
    var wraper = $('#Wraper_category_message');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();
	 	
	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});  
	jRad.validators['name'] = [{msg:"分类名不能为空",type:'min',value:'1'}];
	var fields_params = {};   
	fields_params['status'] = {data:[{"id":"0",name:"无效"},{"id":"1",name:"有效"}]};  
	
	page_column_model.push({display: '分类ID', name : 'id'});
    page_column_model.push({display: '分类名', name : 'name'});
    page_column_model.push({display: '状态', name : 'statusName'});
	page_column_model.push({display: '创建时间', name : 'createDate'});  
     
	 
	page_list_buttons.push({title: '创建',name:'Add', bclass: 'add',onpress : function(){
            $('#Form_category_message').form({
                title: '创建', 
                fields_params: fields_params,
                item:{"status":"1"},  
                url: '/shopmanage-ws/ws/0.1/informationTypeCms/addInformationType',
				success_callback:function(){ 
					$('#Table_category_message').flexMessage('创建成功', 'success');
					$('#Table_category_message').flexReload();
				}
            }).form('open'); 
        }
    });
	 
	page_list_buttons.push({title: '修改',name:'Edit', bclass: 'edit',prefunc:function(){
            var checked = $('#Table_category_message').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
            var checked = $('#Table_category_message').getCheckedTrs(); 
            if(checked[0]){ 
				  var item = $.jRadGet({url:'/shopmanage-ws/ws/0.1/informationTypeCms/detailInformationType?id='+checked[0].id});  
				  $('#Form_category_message').form({
					title: '修改', 
					fields_params: fields_params,
					item:item,  
					url: '/shopmanage-ws/ws/0.1/informationTypeCms/editInformationType',
					success_callback:function(){ 
						$('#Table_category_message').flexMessage('修改成功', 'success');
						$('#Table_category_message').flexReload();
					}
				}).form('open');
            }
        }
    }); 
  
	page_list_buttons.push({name:'delete',bclass: 'delete',prefunc:function(){
            var checked = $('#Table_category_message').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
	    	var checked = $('#Table_category_message').getCheckedTrs();
			$.jRadConfirm('确认删除吗？',1,function(){
				var id =  checked[0].id; 
				$.jRadAjax({
				    type:'post',
					url:'/shopmanage-ws/ws/0.1/informationTypeCms/deleteInformationType?id='+id, 
					success: function(){
						$('#Table_category_message').flexMessage('删除成功!', 'success');
           	    		$('#Table_category_message').flexReload();
					},
					error:function(xhr){
					    var errormsg = eval("(" + xhr.responseText + ")"); 
						if (errormsg != undefined) {
							$('#Table_category_message').flexMessage(errormsg[0].message, 'error');
						}
					}
				});
			});
		}
	});
 	
    page_list_buttons.push({separator: true});
    
    $('#Table_category_message').flexigrid({
            reload:true,
			method:'get',
            colModel : page_column_model,
            buttons : page_list_buttons,
            searchitems :page_search_items,
            pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			},
			checkBoxType:'single',
			showSearch:true,
            url:'/shopmanage-ws/ws/0.1/informationTypeCms/queryInformationType',
			onError:showCategoryError,
			overflow:true
    });  

    $(".numb101").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg101").form({}).form('close');
        $("#Form_explain_eg101").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
            submit:function(){
                var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg101 div[name='remark']").textarea("val")
                $.jRadPost({
                    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
                    data:postData,
                    success:function(){
                        $("#Form_explain_eg101").form('close')
                        $('.overcurtainDiv').hide();
                    }
                });
            }, 
            cancel:function(){
                $("#Form_explain_eg101").form('close')
                $('.overcurtainDiv').hide();
            }
        }).form('open')
        $("#Form_explain_eg101 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
}); 

function showCategoryError(xhr){
			 var errormsg = eval("(" + xhr.responseText + ")");
			  var cDiv = $("#Wraper_category_message .cDiv");
			  $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
			} 
</script>
