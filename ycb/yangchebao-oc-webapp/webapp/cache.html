<div class="urlContentWraper" id="Wraper_cache">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>清空缓存管理</strong><bottom class="all-work-info numb161">页面说明</bottom></h2>
        <div class="grid-layout ui-form" id="cacheform" style="position:relative;top:60px;left:30px;">
            <div class="grid-layout-main jrad-form">
                <div class="row">
                    <label class="span2 grid-layout-label">服务城市：</label>
                    <div class="span7 grid-layout-content">
                         <div id="serviceCitys"></div>
                    </div>
                    <span id="clear" class="ui-btn-primary">清空缓存</span>
                </div> 
                <p style="color:red;margin-left:10px;">注：清空全部商家缓存时，可能需要更多时间，请耐心等待！<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;每个商家大概需要0.8秒。
</p> 
            </div>
        </div>
    </div>
    <div id="Form_explain_eg161" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>修改商家的数据后，需要在这里清空一下缓存，APP那边的商家信息才能相应修改。</div>
                    <div><strong>重要功能说明：</strong>无。</div>
                    <div><strong>注意事项：</strong>清空缓存的数据速度较慢，操作后，需要等半个小时左右才能更新过来。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        var wraper=$("#Wraper_cache");
        var citySource=$.jRadGet({url:'/shopmanage-ws/ws/0.1/cacheManager/getServiceAreaList'});
        var serviceCitys=[];
        $.each(citySource.serviceCitys,function(index,vo){
            var city={};
            city.id=vo['areaCodeId'];
            city.name=vo['areaName'];
            serviceCitys.push(city)
        });
        serviceCitys.unshift({id:'',name:'全部'});
        $("#serviceCitys").select({
            data:serviceCitys
        });
        $('div.ui-select-content',wraper).removeClass('span4').addClass('span6');

        $("#clear").button({
            click:function(){
                var postData={};
                var id=$("#serviceCitys").select("val");
                postData.areaCodeId=id;
                $.jRadPost({
                    url:"/shopmanage-ws/ws/0.1/cacheManager/updateBusiDetail",
                    data:postData, 
                    success:function(){ 
                                $.jRadMessage('缓存正在更新，请耐心等待……'); 
                         
                    }
                });
            }
        })
        
        $(".numb161").click(function(){
            $('.overcurtainDiv').hide();
            var menuId = $(".tabs-selected").attr("menuId")
            var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
            $("#Form_explain_eg161").form({}).form('close');
            $("#Form_explain_eg161").form({
                title:'页面说明',
                item:data,
                autobinding: true, 
                submit:function(){
                    var postData = {};
                    postData.operator = carsmart_config.operatorName;
                    postData.menuName = $(".tabs-selected").attr("menuName");
                    postData.menuId = $(".tabs-selected").attr("menuId");
                    postData.remark = $("#Form_explain_eg161 div[name='remark']").textarea("val")
                    $.jRadPost({
                        url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
                        data:postData,
                        success:function(){
                            $("#Form_explain_eg161").form('close')
                            $('.overcurtainDiv').hide();
                        }
                    });
                }, 
                cancel:function(){
                    $("#Form_explain_eg161").form('close')
                    $('.overcurtainDiv').hide();
                }
            }).form('open')
            $("#Form_explain_eg161 .textarea-content").removeClass("span4").addClass("span12")
            $('.overcurtainDiv').hide();
            $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
        })
    })
</script>
