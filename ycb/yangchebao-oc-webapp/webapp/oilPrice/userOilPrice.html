<style>
    #Wraper_userOilPrice_manage div.hDivBox colgroup col.col_106{
        width:110px!important;
    }
    #Table_userOilPrice_manage colgroup col.col_106{
        width:110px!important;
    }
    #Wraper_userOilPrice_manage div.hDivBox colgroup col.col_104{
        width:170px!important;
    }
    #Table_userOilPrice_manage colgroup col.col_104{
        width:170px!important;
    }
   /* div.t-content{
        height: auto!important;
        text-overflow: inherit!important;
        -o-text-overflow: inherit!important;
        white-space: inherit!important;
        word-break: break-all!important;
    }*/
   .p_detail{
        position:absolute;
        border:1px #aaa solid;
        background-color:#fff;
        color:#4b515d;
        border-radius:3px;
        padding:0 5px;
        white-space:normal;
        word-break: normal;
        word-wrap: break-word;
        max-width:40%;
        height:auto;
        overflow:auto;
   }
</style>
<div class="urlContentWraper" id="Wraper_userOilPrice_manage">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>用户反馈油价列表</strong><bottom class="all-work-info numb122">页面说明</bottom></h2>
        <!-- 列表显示 -->
        <table id="Table_userOilPrice_manage"></table>
    </div>
    <div id="Form_reward_manage" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span1 grid-layout-label"></label>
                 <div class="span6 grid-layout-content">
                        <h3>更新油价金额设置</h3>
                                    </div>
            </div>
            <div class="row">
                 <label class="span3 grid-layout-label">现金：</label>
                 <div class="span5 grid-layout-content">
                       <div name="updateOilPriceCash" class="jrad-input-container"></div>
                                    </div>
            </div>
            <div class="row">
                 <label class="span3 grid-layout-label">积分：</label>
                 <div class="span5 grid-layout-content">
                       <div name="updateOilPriceIntegral" class="jrad-textarea-container"></div>
                                    </div>
            </div>  
            <div class="row">
                 <label class="span3 grid-layout-label">代金券ID：</label>
                 <div class="span5 grid-layout-content">
                       <div name="updateOilPriceVoucherTopic" class="jrad-input-container"></div>
                       <p class="ui-note">多个代金券ID用英文逗号隔开</p>
                                    </div>
            </div>
            <div class="row">
                <label class="span1 grid-layout-label"></label>
                 <div class="span6 grid-layout-content">
                        <h3>确认油价金额设置</h3>
                                    </div>
            </div>
            <div class="row">
                 <label class="span3 grid-layout-label">现金：</label>
                 <div class="span5 grid-layout-content">
                       <div name="conOilPriceCash" class="jrad-input-container"></div>
                                    </div>
            </div> 
            <div class="row">
                 <label class="span3 grid-layout-label">积分：</label>
                 <div class="span5 grid-layout-content">
                       <div name="conOilPriceIntegral" class="jrad-input-container"></div>
                                    </div>
            </div> 
            <div class="row">
                 <label class="span3 grid-layout-label">代金券ID：</label>
                 <div class="span5 grid-layout-content">
                       <div name="conOilPriceVoucherTopic" class="jrad-input-container"></div>
                        <p class="ui-note">多个代金券ID用英文逗号隔开</p>
                                    </div>
            </div> 
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span>
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
    <div id="Form_reject" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>驳回原因：</label>
                 <div class="span5 grid-layout-content">
                       <div name="reason" class="jrad-textarea-container"></div>
                                    </div>
            </div> 
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span>
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
    <div id="Form_explain_eg122" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>用户可以在APP反馈油价变动，会有奖励，奖励详情和审核功能都在此页面。</div>
                    <div><strong>重要功能说明：</strong>①驳回：若用户的反馈有误，可通过此功能驳回，驳回后会扣除对应奖励，若奖励已使用，可以扣为负值。
              ②奖励金额设置：用户反馈获得的具体金额在此设置；
              ③加入黑名单：若此用户有刷奖励的嫌疑，可把此用户拉入黑名单，拉入后，此用户将不能反馈油价。</div>
                    <div><strong>注意事项：</strong>1、用户反馈油价后，会立即给用户发放奖励，驳回后，会扣除对应的奖励。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div> 
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_userOilPrice_manage');
    var page_column_model = new Array();
    var page_list_buttons = new Array();
    var page_search_items = new Array();
    var entityModel={};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});
	jRad.validators['stationName']=[{msg:'请填写加油站名称',type:'min',value:'1'},{msg:'最多100字',type:'max',value:'300'}];
    jRad.validators['stationAddress']=[{msg:'请填写加油站名称',type:'min',value:'1'},{msg:'最多100字',type:'max',value:'300'}];
    jRad.validators['updateOilPriceCash']=[{msg:'请填写小于100最多保留两位小数的正数',type:'regex',value:/^[0]*[1-9]{1}[0-9]{0,1}(.{1}\d{1,2}){0,1}$/}];
    jRad.validators['updateOilPriceIntegral']=[{msg:'请填写最多四位数的正整数',type:'regex',value:/^[1-9]{1}[0-9]{0,3}$/}];
    jRad.validators['conOilPriceCash']=[{msg:'请填写小于100最多保留两位小数的正数',type:'regex',value:/^[0]*[1-9]{1}[0-9]{0,1}(.{1}\d{1,2}){0,1}$/}];
    jRad.validators['conOilPriceIntegral']=[{msg:'请填写最多四位数的正整数',type:'regex',value:/^[1-9]{1}[0-9]{0,3}$/}];
    jRad.validators['updateOilPriceVoucherTopic']=[{msg:'代金券ID格式不对',type:'regex',value:/^([0-9]+)(,{1}[0-9]+)*$/}];
    jRad.validators['conOilPriceVoucherTopic']=[{msg:'代金券ID格式不对',type:'regex',value:/^([0-9]+)(,{1}[0-9]+)*$/}];
    var fields_params={};
    var colorbox_params = {
                        reposition:true,
                        scalePhotos:true,
                        scrolling:false,
                        previous:'<i class="icon-arrow-left"></i>',
                        next:'<i class="icon-arrow-right"></i>',
                        close:'&times;',
                        current:'{current} of {total}',
                        maxWidth:'100%',
                        maxHeight:'100%',
                        onOpen:function(){
                            document.body.style.overflow = 'hidden';
                        },
                        onClosed:function(){
                            document.body.style.overflow = 'auto';
                        },
                        onComplete:function(){
                            $.colorbox.resize();
                        }
                    };
    $("#Form_reward_manage").form({
        title:"驳回",
        grids:12,
        fields_params:fields_params
    });
    $("#Form_reward_manage").form({
        title:"奖励金额设置",
        grids:12,
        fields_params:fields_params
    });
	page_column_model.push({display: 'ID', name : 'id',width:50}); 
	page_column_model.push({display: '用户ID', name : 'userId',width:70}); 
    page_column_model.push({display: '加油站ID',name:'oilStationId',width:80}); 
    page_column_model.push({display: '加油站名称', name:'name',width:140});
    page_column_model.push({display: '城市', name:'cityName',width:180});
    page_column_model.push({display: '图片', width:80,diy:function(item,$div){
        var pic=$('<a>').attr('href',item.picAddress).addClass('pic').html('查看');
        $div.append(pic);
        if(item.picAddress == ""){
            $div.find('a').attr('href','javascript:').css({'color':'#888','cursor':'default','text-decoration':'none'})
        }else{
            $('a.pic',$div).colorbox(colorbox_params)
        }
        
    }});
    page_column_model.push({display: '原油价信息类型/油价（元）',width:100,diy:function(item,$div){
        $div.css('height','auto').html('<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0#&nbsp;&nbsp;'+item.preZero+'</p><p>92/93#&nbsp;&nbsp;'+item.preNinetyThree+'</p><p>95/97#&nbsp;&nbsp;'+item.preNinetySeven+'</p>')
    }});
    page_column_model.push({display: '原免费洗车信息',width:190,diy:function(item,$div){
        var p_preFree="提供免费洗车："+item.preFreeWashRemarks+"。<br>";
        var p_prePrivileg="提供优惠洗车："+item.prePrivilegeWashRemarks+"。";
        if(item.preFreeWashStatus==1){
            $div.append(p_preFree);
        }
        if(item.prePrivilegeWashStatus==1){
            $div.css('height','auto').append(p_prePrivileg);
        }
        var p_detail=$("<p>").addClass('p_detail').hide();
        if(item.preFreeWashStatus==1){
            p_detail.append(p_preFree);
        }
        if(item.prePrivilegeWashStatus==1){
            p_detail.append(p_prePrivileg);
        }
        $div.append(p_detail);
        $div.hover(function(){
            $('p.p_detail',$div).show();
        },function(){
            $('p.p_detail',$div).hide()
        })
    }}); 
    page_column_model.push({display: '新反馈油价', width:100,diy:function(item,$div){
        $div.css({height:'auto'}).html('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0#&nbsp;&nbsp;'+item.curZero+'<br>92/93#&nbsp;&nbsp;'+item.curNinetyThree+'<br>95/97#&nbsp;&nbsp;'+item.curNinetySeven)
    }}); 
    page_column_model.push({display: '新免费洗车信息', width:190,diy:function(item,$div){
        var p_curFree="提供免费洗车："+item.curFreeWashRemarks+"。<br>";
        var p_curPrivileg="提供优惠洗车："+item.curPrivilegeWashRemarks+"。";
        if(item.curFreeWashStatus==1){
            $div.append(p_curFree);
        }
        if(item.curPrivilegeWashStatus==1){
            $div.css('height','auto').append(p_curPrivileg);
        }
        var p_Detail=$("<p>").addClass('p_detail').hide();
        if(item.curFreeWashStatus==1){
            p_Detail.append(p_curFree);
        }
        if(item.curPrivilegeWashStatus==1){
            p_Detail.append(p_curPrivileg);
        }
        $div.append(p_Detail);
        $div.hover(function(){
            $('p.p_detail',$div).show();
        },function(){
            $('p.p_detail',$div).hide()
        })
    }});
    page_column_model.push({display: '反馈时间', name : 'created',width:135});
    page_column_model.push({display: '奖励', diy:function(item,$div){
        if(item.cash!=""){
            item.cash=item.cash+'元'
        }
        if(item.integral!=''){
            item.integral='+'+item.integral+'积分'
        }
        if(item.vouchers!=''){
            item.vouchers='+代金券'+item.vouchers
        }
        $div.html(item.cash+item.integral+item.vouchers)
    },width:200}); 
    page_column_model.push({display: '状态', name : 'status',diy:function(item,$div){
            if(item.status==2){
                var $p=$('<p>').html('审核驳回');
                var $a=$('<a>').html('驳回原因');
                $p.after($a);
                $div.css('height','auto').append($p);
                $a.click(function(){
                    $.jRadAlert(item.reason,'','',-1)
                })
            }
            if(item.status==1){
                $div.html('审核通过')
            }
        },width:80}); 
    page_column_model.push({display: '审核时间', name : 'updated',width:135});
    page_column_model.push({display: '审核人', name : 'operatorPerson',width:70});

    page_search_items.push({row:'1',type:'jrad-input',display:'用户ID',name:'userId'});
    page_search_items.push({row:'1',type:'jrad-input',display:'用户手机号',name:'userMobile'});
	page_search_items.push({row:'1',type:'jrad-input',display:'加油站ID',name:'oilStationId'}); 
    page_search_items.push({row:'2',type:'jrad-input',display:'加油站名称',name:'name'});
	page_search_items.push({row:'2',type:'jrad-select',display:'奖励类型',name:'rewardType',params:{
        data:[
            {id:'',name:'全部'},
            {id:'1',name:'现金'},
            {id:'2',name:'积分'},
            {id:'4',name:'代金券'}
        ]
    }});
    page_search_items.push({row:'2',type:'jrad-select',display:'状态',name:'auditStatus',params:{
        data:[
            {id:'',name:'全部'},
            {id:'1',name:'审核通过'},
            {id:'2',name:'审核驳回'}
        ]
    }});
	page_search_items.push({row:'3',type:'jrad-input',display:'审核人',name:'auditPerson'});  
    page_search_items.push({row:'3',type:'jrad-dateinput',display:'反馈时间开始',name:'feedBackStrarTime'});
    page_search_items.push({row:'3',type:'jrad-dateinput',display:'反馈时间结束',name:'feedBackEndTime'});
    page_search_items.push({row:'4',type:'jrad-input',display:'城市或地址',name:'cityName'});
    page_search_items.push({row:'4',type:'jrad-dateinput',display:'审核时间开始',name:'auditStartTime'});
    page_search_items.push({row:'4',type:'jrad-dateinput',display:'审核时间结束',name:'auditEndTime'});

    page_list_buttons.push({displayname:'驳回',title: '驳回',name:'reject', bclass: 'reject',prefunc:function(){
            var checked = $('#Table_userOilPrice_manage').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
            var checked = $('#Table_userOilPrice_manage').getCheckedTrs(); 
            $("#Form_reject").form({
                title:'驳回',
                item:{},
                url:'/shopmanage-ws/ws/0.1/oilPrice/reject',
                before_submit:function(json){
                    json.id=checked[0].id;
                    json.operator=carsmart_config.operatorName;
                    return json
                },
                success_callback:function(){
                    $('#Table_userOilPrice_manage').flexMessage('已驳回', 'success');
                    $('#Table_userOilPrice_manage').flexReloadSearch();
                },
                error:function(xhr){
                    var errormsg = eval("(" + xhr.responseText + ")"); 
                    if (errormsg != undefined) {
                        $('#Table_userOilPrice_manage').flexMessage(errormsg[0].message, 'error');
                    }
                }
            }).form('open');
            
        }
    }); 
    page_list_buttons.push({displayname:'奖励金额设置',title: '奖励金额设置',name:'reward', bclass: 'reward',onpress : function(){
            var item=$.jRadGet({url:'/shopmanage-ws/ws/0.1/oilPrice/getRewardSettingDetail'});
            $('#Form_reward_manage').form({
                item:item,
                validators:jRad.validators,
                url:'/shopmanage-ws/ws/0.1/oilPrice/rewardSetting',
                before_submit:function(json){
                    json.operator = carsmart_config.operatorName;
                    return json
                },
                success_callback:function(){
                    $('#Table_userOilPrice_manage').flexMessage('设置成功!', 'success');
                    $('#Table_userOilPrice_manage').flexReloadSearch();
                }
            }).form('open')
        }
    });
    page_list_buttons.push({displayname:'加入黑名单',title: '加入黑名单',name:'blackList', bclass: 'blackList',prefunc:function(){
            var checked = $('#Table_userOilPrice_manage').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
            var checked = $('#Table_userOilPrice_manage').getCheckedTrs();
            var postData={};
            postData.userId = checked[0].userId;
            postData.id = checked[0].id;
            $.jRadConfirm('确认将该用户加入黑名单？',1,function(){
                $.jRadPost({
                    url:'/shopmanage-ws/ws/0.1/user/addBlack',
                    data:postData,
                    success:function(){
                        $('#Table_userOilPrice_manage').flexMessage('已加入黑名单!', 'success');
                        $('#Table_userOilPrice_manage').flexReloadSearch()
                    }
                })
            })
        }
    }); 
   
    page_list_buttons.push({separator: true});
    
    $('#Table_userOilPrice_manage').flexigrid({
            reload:true,
			method:'get',
            colModel : page_column_model,
            buttons : page_list_buttons,
            searchitems :page_search_items,
            pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			}, 
			showSearch:true,
            // popover: true,
            url:'/shopmanage-ws/ws/0.1/oilPrice/feedBackList', 
            overflow:true,
            checkBoxType: 'single',
			onError:showError
    });
    $('div.checkAll',wraper).hide()
    
    $(".numb122").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg122").form({}).form('close');
        $("#Form_explain_eg122").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
            submit:function(){
                var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg122 div[name='remark']").textarea("val")
                $.jRadPost({
                    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
                    data:postData,
                    success:function(){
                        $("#Form_explain_eg122").form('close')
                        $('.overcurtainDiv').hide();
                    }
                });
            }, 
            cancel:function(){
                $("#Form_explain_eg122").form('close')
                $('.overcurtainDiv').hide();
            }
        }).form('open')
        $("#Form_explain_eg122 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
});
function showError(xhr){
		 var errormsg = eval("(" + xhr.responseText + ")"); 
		 $.jRadMessage({level:'error',message:errormsg[0].message});
		} 
</script>
