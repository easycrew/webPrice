<style>
    /*div.t-content{
        height: auto!important;
        text-overflow: inherit!important;
        -o-text-overflow: inherit!important;
        white-space: inherit!important;
        word-break: break-all!important;
    }*/
    #Wraper_oilStation_manage div.hDivBox colgroup col.col_103{
        width:130px!important;
    }
    #Table_oilStation_manage colgroup col.col_103{
        width:130px!important;
    }
    #Wraper_oilStation_manage div.hDivBox colgroup col.col_104{
        width:170px!important;
    }
    #Table_oilStation_manage colgroup col.col_104{
        width:170px!important;
    }
    #Wraper_oilStation_manage div.hDivBox colgroup col.col_105{
        width:80px!important;
    }
    #Table_oilStation_manage colgroup col.col_105{
        width:80px!important;
    }
    .p_detail{
        position:absolute;
        border:1px #aaa solid;
        background-color:#fff;
        color:#4b515d;
        border-radius:3px;
        padding:0 5px;
        white-space:normal;
        word-break: normal;
        word-wrap: break-word;
        max-width:40%;
        height:auto;
        overflow:auto;
    }
</style>
<div class="urlContentWraper" id="Wraper_oilStation_manage">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>加油站管理列表</strong><bottom class="all-work-info numb121">页面说明</bottom></h2>
        <!-- 列表显示 -->
        <table id="Table_oilStation_manage"></table>
    </div>
    <div id="Form_oilStation_manage" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>加油站名称：</label>
                 <div class="span5 grid-layout-content">
                       <div name="name" class="jrad-input-container"></div>
                                    </div>
            </div>
            <div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>地址：</label>
                 <div class="span5 grid-layout-content">
                       <div name="address" class="jrad-textarea-container"></div>
                                    </div>
            </div>  
            <!-- <div class="row">
                 <label class="span3 grid-layout-label">运营商类型：</label>
                 <div class="span5 grid-layout-content">
                       <div name="companyType" class="jrad-select-container"></div>
                                    </div>
            </div> -->
            <div class="row">
                 <label class="span3 grid-layout-label">金额（0#）：</label>
                 <div class="span5 grid-layout-content">
                       <div name="zero" class="jrad-input-container"></div>
                                    </div>
            </div> 
            <div class="row">
                 <label class="span3 grid-layout-label">金额（92/93#）：</label>
                 <div class="span5 grid-layout-content">
                       <div name="ninetyThree" class="jrad-input-container"></div>
                                    </div>
            </div> 
            <div class="row">
                 <label class="span3 grid-layout-label">金额（95/97#）：</label>
                 <div class="span5 grid-layout-content">
                       <div name="ninetySeven" class="jrad-input-container"></div>
                                    </div>
            </div> 
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span>
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
    <div id="Form_explain_eg121" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>APP上附近加油站的数据源就在这里，是通过第三方接口获取的数据。</div>
                    <div><strong>重要功能说明：</strong>修改：可以在获取数据上进行修改，同时用户也可在APP修改加油站数据。</div>
                    <div><strong>注意事项：</strong>无。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div> 
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_oilStation_manage');
    var page_column_model = new Array();
    var page_list_buttons = new Array();
    var page_search_items = new Array();
    var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});
	jRad.validators['stationName']=[{msg:'请填写加油站名称',type:'min',value:'1'},{msg:'最多100字',type:'max',value:'300'}];
    jRad.validators['stationAddress']=[{msg:'请填写加油站名称',type:'min',value:'1'},{msg:'最多100字',type:'max',value:'300'}];
    var fields_params={};
    // fields_params["companyType"]={data:[{id:'1',name:'中石油'},{id:'2',name:'中石化'},{id:'3',name:'其他'}]};
	page_column_model.push({display: '加油站ID', name : 'id',width:80}); 
	page_column_model.push({display: '原始ID', name : 'originalId',width:80}); 
    page_column_model.push({display: '加油站名称',name:'name',width:140}); 
    page_column_model.push({display: '油价信息类型/油价（元）', diy:function(item,$div){
        $div.css('height','auto').html('<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0#&nbsp;&nbsp;'+item.zero+'</p><p>92/93#&nbsp;&nbsp;'+item.ninetyThree+'</p><p>95/97#&nbsp;&nbsp;'+item.ninetySeven+'</p>')
    }});
    page_column_model.push({display: '免费洗车信息',width:200,diy:function(item,$div){
        var p_free="提供免费洗车："+item.freeWashRemarks+'。<br>';
        var p_privileg="提供优惠洗车："+item.privilegWashRemarks+'。';
        if(item.freeWashStatus==1){
            $div.append(p_free);
        }
        if(item.privilegeWashStatus==1){
            $div.css('height','auto').append(p_privileg);
        }
        var p_detail=$("<p>").addClass('p_detail').hide();
        if(item.freeWashStatus==1){
            p_detail.append(p_free);
        }
        if(item.privilegeWashStatus==1){
            p_detail.append(p_privileg);
        }
        $div.append(p_detail);
        $div.hover(function(){
            $('p.p_detail',$div).show();
        },function(){
            $('p.p_detail',$div).hide()
        })
    }});
    page_column_model.push({display: '是否打折', name : 'discount',diy:function(item,$div){
        if(item.discount=="非打折加油站"){
            $div.html('否')
        }else if(item.discount=="打折加油站"){
            $div.html('是')
        }
    }}); 
    page_column_model.push({display: '城市', name : 'cityName',width:140}); 
    page_column_model.push({display: '地址', name : 'address',width:160});
    // page_column_model.push({display: '运营商类型', name : 'companyType'});
    page_column_model.push({display: '加油站类型', name : 'oillStationType',width:100}); 
    page_column_model.push({display: '最后更新时间', name : 'updateTime',width:150}); 
    page_column_model.push({display: '最后更新人', name : 'lastOperator',width:80});

    page_search_items.push({row:'1',type:'jrad-input',display:'原始ID',name:'originalId'});
	page_search_items.push({row:'1',type:'jrad-input',display:'加油站ID',name:'id'}); 
	page_search_items.push({row:'1',type:'jrad-input',display:'加油站名称',name:'name'});
	page_search_items.push({row:'2',type:'jrad-select',display:'是否打折',name:'discount',params:{
        data:[
            {id:'',name:'全部'},
            {id:'0',name:'否'},
            {id:'1',name:'是'}
        ]
    }});
    page_search_items.push({row:'2',type:'jrad-input',display:'城市或地址',name:'cityName'});
    // page_search_items.push({row:'2',type:'jrad-select',display:'运营商类型',name:'companyType',params:{
    //     data:[
    //         {id:'',name:'全部'},
    //         {id:'1',name:'中石油'},
    //         {id:'2',name:'中石化'},
    //         {id:'3',name:'其他'}
    //     ]
    // }}); 
    page_search_items.push({row:'2',type:'jrad-select',display:'加油站类型',name:'oillStationType',params:{
        data:[
            {id:'',name:'全部'},
            {id:'1',name:'加盟店'},
            {id:'2',name:'特许'},
            {id:'3',name:'直营店'},
            {id:'4',name:'联营'},
            {id:'5',name:'其他'}
        ]
    }}); 
    page_search_items.push({row:'3',type:'jrad-dateinput',display:'更新时间开始',name:'updateStartTime'});
    page_search_items.push({row:'3',type:'jrad-dateinput',display:'更新时间结束',name:'updateEndTime'});

    page_list_buttons.push({title: '修改',name:'Edit', bclass: 'edit',
        prefunc:function(){
            var checked = $('#Table_oilStation_manage').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
            var checked = $('#Table_oilStation_manage').getCheckedTrs(); 
            if(checked[0]){ 
                  $('#Form_oilStation_manage').form({
                    title: '修改', 
                    fields_params: fields_params,  
                    validators: jRad.validators,
                    url: '/shopmanage-ws/ws/0.1/oillStationManage/modify',
                    before_submit:function(json){
                        json.id = checked[0].id; 
                        json.originalId = checked[0].originalId; 
                        json.lastOperator = carsmart_config.operatorName; 
                        return json;
                    },
                    success_callback:function(){ 
                        $('#Table_oilStation_manage').flexMessage('修改成功', 'success');
                        $('#Table_oilStation_manage').flexReloadSearch();
                    }
                }).form('open');
                  $('#Form_oilStation_manage div[name="name"]').input('val',checked[0].name);
                  $('#Form_oilStation_manage div[name="address"]').textarea('val',checked[0].address);
                  // $('#Form_oilStation_manage div[name="companyType"]').select('val',checked[0].companyTypeId);
                  $('#Form_oilStation_manage div[name="zero"]').input('val',checked[0].zero);
                  $('#Form_oilStation_manage div[name="ninetyThree"]').input('val',checked[0].ninetyThree);
                  $('#Form_oilStation_manage div[name="ninetySeven"]').input('val',checked[0].ninetySeven)
            }
        }
    }); 
   
    page_list_buttons.push({separator: true});
    
    $('#Table_oilStation_manage').flexigrid({
            reload:true,
			method:'get',
            colModel : page_column_model,
            buttons : page_list_buttons,
            searchitems :page_search_items,
            pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			}, 
			showSearch:true,
            url:'/shopmanage-ws/ws/0.1/oillStationManage/list', 
            overflow:true,
			onError:showError
    });
    
    $(".numb121").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg121").form({}).form('close');
        $("#Form_explain_eg121").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
            submit:function(){
                var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg121 div[name='remark']").textarea("val")
                $.jRadPost({
                    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
                    data:postData,
                    success:function(){
                        $("#Form_explain_eg121").form('close')
                        $('.overcurtainDiv').hide();
                    }
                });
            }, 
            cancel:function(){
                $("#Form_explain_eg121").form('close')
                $('.overcurtainDiv').hide();
            }
        }).form('open')
        $("#Form_explain_eg121 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
});
function showError(xhr){
		 var errormsg = eval("(" + xhr.responseText + ")"); 
		  $.jRadMessage({level:'error',message:errormsg[0].message});
		} 
</script>
