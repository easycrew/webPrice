<div class="urlContentWraper" id="cms-greateBusiness-wrapper">
	<div class="ui-info-layout">
		<div class="ui-info-layout-subbox ">
			<div class="jrad-table">
				<h2 class="ui-tit"><strong></strong><bottom class="all-work-info numb195">页面说明</bottom></h2>
				<table class="cms-table"></table>
			</div>
			<div class="details-box" style="display: none;">
				<ul class="details-tab">
					<li class="tab-cur tab-cur-first f-left"><span class="cms-title"></span></li>
					<li><span class="return"></span></li>
				</ul>
				<div class="details-content">
					<div class="details-scroll">
						<div class="details-content-inner">
							<div class="grid-layout ui-form cms-form">
								<div class="jrad-form">
									<div class="grid-layout-main">
										<input name="id" type="hidden"> 
										<div class="row-fluid">
											<label class="span3 grid-layout-label"><span class="ui-form-required">*</span>商家ID:：</label>
											<div class="span5 grid-layout-content">
												<div name="businessId" class="jrad-input-container"></div>
											</div>
										</div>
										<div class="row-fluid">
											<label class="span3 grid-layout-label"><span class="ui-form-required">*</span>排序：</label>
											<div class="span18 grid-layout-content">
												<div name="orderNumber" class="jrad-select-container"></div>
											</div>
										</div>
										<div class="row-fluid">
											<label class="span3 grid-layout-label"><span class="ui-form-required">*</span>状态：</label>
											<div class="span5 grid-layout-content">
												<div name="state" class="jrad-select-container"></div>
											</div>
										</div>
									</div>
								</div>
								<div class="jrad-buttons-container ui-buttons-container">
									<span class="jrad-btn-primary">确定</span> 
									<span class="jrad-btn-normal">取消</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
    <div id="Form_explain_eg195" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>官网首页优质商家的管理功能。</div>
                    <div><strong>重要功能说明：</strong>无。</div>
                    <div><strong>注意事项：</strong>1、同时最多存在3个有效的数据；2、官网按“排序”字段顺序排列。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>
<script type="text/javascript">
	
	$(document).ready(function() {
		var config = {
			url: {
				base: "/websitemanager-ws/ws/0.1",
				cms: "/greateBusinessCms"
			},
			model: {
				displayName: "优质商家"	
			}
		};
		
		var URL = {
				"page": getUrl("/page"),
				"add": getUrl("/add"),
				"edit": getUrl("/edit"),
				"detail": getUrl("/detail"),
				"remove": getUrl("/remove"),
				"changeState": getUrl("/change/state")
		};
		
		var wrapper = $("#cms-greateBusiness-wrapper");
		var table = $(".cms-table", wrapper);
		var submitForm = $(".cms-form", wrapper);
		var title = $(".cms-title", wrapper);
		
		$(".jrad-table strong").html(config.model.displayName + "列表");
		
		var submitValidators = {
			businessId: 		[{msg : "商家ID不能为空", type : "min", value : "1"}]
		};
		
		var submitParams = {
			businessId: 	{
				grid : 4
			},
			orderNumber: {
				data : [
					{id : "1", name : "1"}, 
					{id : "2", name : "2"}, 
					{id : "3", name : "3"}
				]
			},
			state: {
				data : [
					{id : "1", name : "有效"},
					{id : "0", name : "无效"}
				]
			}
		};
		
		var pageSearchItems = [
       	];
		
		var pageColumnModel = [
			{name : 'id', display : 'ID', width : 50}, 
			{name : 'businessId', display : '商家ID'},
			{name : 'businessName', display : '商家名称'},
			{name : 'orderNumber', display : '排序'}, 
			{name : 'createTime', display : '创建时间'}, 
			{name : 'stateName', display : '状态'},
			{name : 'createOperator', display : '创建人'}
		];
		
		submitForm.form({
			validators : submitValidators,
			fields_params : submitParams,
			layout : 'grid',
			autobinding : false
		});
		
		$(".ui-buttons-container .jrad-btn-normal", wrapper).button({
			click : function() {
				boxUp();
			}
		});

		$(".ui-buttons-container .jrad-btn-primary", wrapper).button({
			click : function() {
				
				if (!submitForm.form('validateAll')) {
					return;
				}

				var json = submitForm.form('getValue');
				json.createOperator = getOperator();

				console.log(json);

				$.jRadPost({
					
					url : title.html() == config.model.displayName + "添加" ? URL.add : URL.edit,
					data : json,
					success : function() {
						boxUp();
						table.flexMessage('创建成功','success');
						table.flexReload();
					},
					error : onSubmitError
				});
			}
		});

		var pageListButtons = [];

		pageListButtons.push({
			title : '创建',
			name : 'Add',
			bclass : 'add',
			onpress : function() {
				
				clearForm();
				boxDown();
				title.html(config.model.displayName + "添加");
			}
		});
	
				pageListButtons.push({
					title : '修改',
					name : 'Edit',
					bclass : 'edit',
					prefunc : function() {
						return table.getCheckedTrs().length == 1;
					},
					onpress : function() {
						var checked = table.getCheckedTrs();
						if (checked[0]) {
							var id = checked[0].id;
							fillEditForm(id);
						}
					}
				});

		pageListButtons.push({
			
			name : 'delete',
			bclass : 'delete',
			prefunc : function() {
				return table.getCheckedTrs().length != 0;
			},
			onpress : function() {
				var checked = table.getCheckedTrs();
				$.jRadConfirm('确认删除吗？', 1, function() {
					var idArr = [];
					$.each(checked, function() {
						idArr.push(this.id);
					});
					idArr.join(",");
					$.jRadAjax({
						type : 'post',
						url : URL.remove + "?idString="+ idArr,
						success : function() {
							table.flexMessage('删除成功!', 'success');
							table.flexReload();
						},
						error : onTableError
					});
				});
			}
		});

		pageListButtons.push({
			displayname : "设为无效",
			name : "unUse",
			bclass : "unUse",
			prefunc : function() {
				return table.getCheckedTrs().length != 0;
			},
			onpress : function() {
				var checked = table.getCheckedTrs();
				$.jRadConfirm("确认设置为无效吗？", 1, function() {
					var idArr = [];
					$.each(checked, function() {
						idArr.push(this.id);
					});
					idArr.join(",");
					$.jRadAjax({
						type : "post",
						url : URL.changeState + "?idString=" + idArr + "&state=0",
						success : function() {
							table.flexMessage("操作成功!", "success");
							table.flexReload();
						},
						error : onTableError
					});
				});
			}
		});

		pageListButtons.push({
			separator : true
		});
		
				table.flexigrid({
			reload : true,
			method : "get",
			colModel : pageColumnModel,
			buttons : pageListButtons,
			searchitems : pageSearchItems,
			pagination : {
				diaplay_pages : 5,
				align : "bottom"
			},
			showSearch : true,
			url : URL.page,
			onError : showError,
			overflow : true
		});

		$(".searchButtons .ui-btn-icon:first", wrapper).unbind("click");
		$(".searchButtons .ui-btn-icon:first", wrapper).click(function() {
			table.flexOptions({
				url : URL.page
			});
			table.flexReloadSearch();
		});
		$(".searchButtons .ui-btn-icon:nth-child(2)", wrapper).unbind("click");
		$(".searchButtons .ui-btn-icon:nth-child(2)", wrapper).click(function() {
			
			var sDiv = $(".searchContent", wrapper);
			$(".jrad-select", sDiv).select("val", "");
			$(".jrad-autocomplete", sDiv).autocomplete("val", "");
			$(".jrad-input", sDiv).input("val","");
			$(".jrad-dateinput", sDiv).dateinput("val", "");
			$(".jrad-autocombo", sDiv).autocombo("val", "");
			$(".jrad-checkbox", sDiv).checkbox("val", "");
			table.flexOptions({
				url : URL.page,
				queryParam : {},
				page : 0
			});
			table.flexReloadSearch();
		});

		$(".details-tab .return", wrapper).click(function() {
			boxUp();
		});
		
		function getUrl(method) {
			return config.url.base + config.url.cms + method;
		}
	
		function clearForm() {
			
			submitForm.form({
				item : {}
			});
		}
		
		function fillEditForm(id) {
			
			var item = $.jRadGet({
				url : URL.detail + "?id=" + id
			});
			title.html(config.model.displayName + "修改");
			
			clearForm();
			boxDown();
			
			submitForm.form({
				item : item
			});
		}
		
		function showError(xhr) {
			var msg = getErrorMessage(xhr);
			var cDiv = $(".cDiv", wrapper);
			$.jRadMessage({
				level : "error",
				message : msg,
				selector : cDiv
			});
		}
		
		function onSubmitError(xhr) {
			var msg = getErrorMessage(xhr);
			if (!!msg) {
				$.jRadMessage({
					level : "error",
					message : msg
				});
			}
		}
		
		function onTableError(xhr) {
			var msg = getErrorMessage(xhr);
			if (!!msg) {
				table.flexMessage(msg, "error");
			}
		}
		
		function getErrorMessage(xhr) {
			var msg = eval("(" + xhr.responseText + ")");
			return !!msg ? msg[0].message : null;
		}
		
		function getOperator() {
			var operator = carsmart_config.operatorName;
			return operator;
		}
		
		function boxUp() {
			$(".details-box", wrapper).slideUp();
			$(".jrad-table", wrapper).slideDown();
			$(".scroll-up-btn").click();
		}
		
		function boxDown() {
			$(".jrad-table", wrapper).slideUp();
			$(".details-box", wrapper).slideDown();
			$(".scroll-up-btn").click();
		}
		$(".numb195").click(function(){
            $('.overcurtainDiv').hide();
            var menuId = $(".tabs-selected").attr("menuId")
            var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
            $("#Form_explain_eg195").form({}).form('close');
            $("#Form_explain_eg195").form({
                title:'页面说明',
                item:data,
                autobinding: true, 
				submit:function(){
                	var postData = {};
                    postData.operator = carsmart_config.operatorName;
                    postData.menuName = $(".tabs-selected").attr("menuName");
                    postData.menuId = $(".tabs-selected").attr("menuId");
                    postData.remark = $("#Form_explain_eg195 div[name='remark']").textarea("val")
					$.jRadPost({
					    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
					    data:postData,
					    success:function(){
							$("#Form_explain_eg195").form('close')
          					$('.overcurtainDiv').hide();
					   	}
					});
				}, 
				cancel:function(){
					$("#Form_explain_eg195").form('close')
          			$('.overcurtainDiv').hide();
				}
            }).form('open')
            $("#Form_explain_eg195 .textarea-content").removeClass("span4").addClass("span12")
            $('.overcurtainDiv').hide();
            $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
        })
	});

</script>
