 <div class="urlContentWraper" id="Wraper_account_manage">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>商家账户管理</strong><bottom class="all-work-info numb34">页面说明</bottom></h2>
        <div class="pic-grid">
			<table id="Table_account_manage"></table>
		</div>
    </div>
    <div id="Form_account_manage" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <input name="operator" type="hidden"> 
            <div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>商家ID：</label>
                 <div class="span6 grid-layout-content">
                       <div name="businessId" class="jrad-input-container"></div>
				 </div> 
            </div>  
			<div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>增减值：</label>
                 <div class="span6 grid-layout-content">
                       <div name="changeMoney" class="jrad-input-container"></div>
					   <p class="ui-note">最多支持两位小数，负数代表减少余额。</p>
				 </div> 
            </div>  
            <div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>类别</label>
                 <div class="span5 grid-layout-content">
                       <div name="type" class="jrad-select-container"></div>
                 </div>
            </div>
            <div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>账户类别</label>
                 <div class="span5 grid-layout-content">
                       <div name="accountType" class="jrad-select-container"></div>
                 </div>
            </div>
            <div class="row">
                 <label class="span3 grid-layout-label">备注：</label>
                 <div class="span5 grid-layout-content">
                       <div name="remark" class="jrad-textarea-container"></div>
                                    </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
    <div id="Form_explain_eg34" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>商家账户的管理，包括商家的进账入账都在这里查看。</div>
                    <div><strong>重要功能说明：</strong>1、增减余额：可手动给商家增减余额。</div>
                    <div><strong>注意事项：</strong>无。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_account_manage');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();

	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});  
	jRad.params['accountType'] = {data:[{id:'1',name:'现金账户'},{id:'2',name:'理财账户'}]}; 
	jRad.params['typeFlag'] = {data:[{id:'',name:'全部'},{id:'1',name:'收入'},{id:'2',name:'支出'}]};
	jRad.params['type'] = {data:[{id:'',name:'全部'},{id:'1',name:'账期自动结算'},{id:'2',name:'主动提现'},{id:'3',name:'提现驳回'},{id:'4',name:'转账失败'},{id:'5',name:'完成订单'},{id:'6',name:'订单补贴'},{id:'7',name:'车主卡整卡结算'},{id:'8',name:'保险订单提成'},{id:'9',name:'后台添加'},{id:'10',name:'后台减少'},{id:'11',name:'其他'},{id:'12',name:'配件商城退款'},{id:'13',name:'理财主动转入余额'},{id:'14',name:'理财账户增加余额'},{id:'15',name:'余额转入理财账户'},{id:'16',name:'理财余额利息'},{id:'17',name:'余额增加本息'},{id:'18',name:'车主卡补贴'},{id:'19',name:'配件商城消费'},{id:'20',name:'理财自动转入余额'}]}; 

	var fields_params={};
	fields_params['type']={
	  data:[{id:'9',name:'后台添加'},{id:'10',name:'后台减少'},{id:'11',name:'其他'}]
	}	
	fields_params['accountType']={
	  data:[{id:'1',name:'现金账户'},{id:'2',name:'理财账户'}]
	}
    page_column_model.push({display: '时间', name : 'changeData'});
    page_column_model.push({display: '商家ID', name : 'businessId'});
    page_column_model.push({display: '商家简称', name : 'businessRegName'});
    page_column_model.push({display: '类别', name : 'type'});
    page_column_model.push({display: '类别明细', name : 'changeInfo'}); 
    page_column_model.push({display: '可提现余额变动', name : 'changeMoney'});
    //page_column_model.push({display: '不可提现余额变动', name : ''});
	page_column_model.push({display: '可提现余额', name : 'aBalance'});
	//page_column_model.push({display: '不可提现余额', name : 'uaBalance'});
	page_column_model.push({display: '操作人', name : 'operator'});
	page_column_model.push({display: '备注', name : 'remark'});  

	page_search_items.push({row:'1',type:'jrad-input',display:'商家ID',name:'businessId'});
	page_search_items.push({row:'1',type:'jrad-input',display:'商家简称',name:'busiRegName'});
	page_search_items.push({row:'1',type:'jrad-select',display:'类别',name:'type',params:jRad.params['type']});
    page_search_items.push({row:'2',type:'jrad-dateinput',display:'时间始',name:'startDate'});
    page_search_items.push({row:'2',type:'jrad-dateinput',display:'时间终',name:'endDate'}); 
	page_search_items.push({row:'2',type:'jrad-input',display:'类别明细',name:'typeDetail'});
	page_search_items.push({row:'3',type:'jrad-select',display:'收入/支出',name:'typeFlag',params:jRad.params['typeFlag']});
	page_search_items.push({row:'3',type:'jrad-input',display:'操作人',name:'operator'});
	page_search_items.push({row:'3',type:'jrad-select',display:'账户类别',name:'accountType',params:jRad.params['accountType']});
	 	 
    page_list_buttons.push({displayname: '增减余额',name:'AddOrMinus', bclass: 'AddOrMinus',onpress : function(){ 
		   $('#Form_account_manage').form({
		   		title: '增减余额',
				fields_params:fields_params,
				item:{}, 
				grid: 16,
				url:'/shopmanage-ws/ws/0.1/businessAccountManager/saveAccountTrail',
				before_submit:function(json){
					json.operator = carsmart_config.operatorName;
					var val = $('#Form_account_manage div[name="type"]').select('val')
					var val2 = $('#Form_account_manage div[name="changeMoney"]').input('val')
					if(val == '10' && val2 > 0){
						alert('类别为后台减少时，增减值应为负数');
						return false;
					}else{
						return json;
					}
				},
				success_callback:function(){ 
					$('#Table_account_manage').flexMessage('操作成功', 'success');
					$('#Table_account_manage').flexReload();
				}
		   }).form('open');
        }
    }); 
    function excelplus(){
		 var param = {};
		 var startDate = $.trim($(".searchContent div[name='startDate']",wraper).dateinput('val'));
		 if(startDate!=""){
			param['startDate'] = startDate;
		 };
		 var endDate = $.trim($(".searchContent div[name='endDate']",wraper).dateinput('val'));
		 if(endDate!=""){
			param['endDate'] = endDate;
		 };
		 var businessId = $.trim($(".searchContent div[name='businessId']",wraper).input('val'));
		 if(businessId!=""){
			param['businessId'] = businessId;
		 };
		 var type = $.trim($(".searchContent div[name='type']",wraper).select('val'));
		 if(type!=""){
			param['type'] = type;
		 };
		 var busiRegName = $.trim($(".searchContent div[name='busiRegName']",wraper).input('val'));
		 if(busiRegName!=""){
			param['busiRegName'] = busiRegName;
		 };
		 var typeDetail = $.trim($(".searchContent div[name='typeDetail']",wraper).input('val'));
		 if(typeDetail!=""){
			param['typeDetail'] = typeDetail;
		 };
		 var typeFlag = $.trim($(".searchContent div[name='typeFlag']",wraper).select('val'));
		 if(typeFlag!=""){
			param['typeFlag'] = typeFlag;
		 };
		 var operator = $.trim($(".searchContent div[name='operator']",wraper).input('val'));
		 if(operator!=""){
			param['operator'] = operator;
		 };
		 var accountType = $.trim($(".searchContent div[name='accountType']",wraper).select('val'));
		 if(accountType!=""){
			param['accountType'] = accountType;
		 };

		 var paramUrl = "";
		 if(param!={}){
			 paramUrl+="?"
			 $.each(param,function(k,v){paramUrl+="&"+k+"="+v;});
		 }
		 param['paramUrl'] = paramUrl;
		 return param;

    }
	page_list_buttons.push({displayname: '导出Excel',name:'excel', bclass: 'excel',onpress : function(){
			$.jRadConfirm('确认导出吗？',1,function(){
			 var paramUrl = excelplus().paramUrl;
			 window.open('/shopmanage-ws/ws/0.1/businessAccountManager/exportAccountInfo'+paramUrl);
			})
		}
	});
    page_list_buttons.push({separator: true});
    
	$('#Table_account_manage').flexigrid({
			reload:true,
			method:'get', 
			colModel : page_column_model,
			buttons : page_list_buttons,
			searchitems :page_search_items,
			showSearch:true,
			overflow:true,
			pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			},
			queryParam: {'accountType':1},
			url:'/shopmanage-ws/ws/0.1/businessAccountManager/getAccountTrail',
			onError:showIntegralsError,
			checkBoxType:'single'
	});
	total=$.jRadGet({
		url:'/shopmanage-ws/ws/0.1/businessAccountManager/getAccountTrail?accountType='+1,
		error:function(xhr){
			var errormsg = eval("(" + xhr.responseText + ")"); 
			var cDiv = $("#Wraper_account_manage .cDiv");
			$.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
			
		}
	});
	$.each(total,function(i,val){
		var obj = total.items;
		if(obj !=''&&obj !='undefined'){
			$.each(obj,function(i,k){
				$('.hDivBox:eq(0) th:eq(6)',wraper).html('&nbsp;&nbsp;可提现余额变动<br>（合计'+k.totalChange+'元）');
			})
		}else{
			$('.hDivBox:eq(0) th:eq(6)',wraper).html('可提现余额变动');
		}
	})
	$('.ui-btn-icon:first',wraper).click(function(){
			var accountType = $('#Wraper_account_manage div[name="accountType"]').select('val')
			if(accountType==2){
				$('.hDivBox:eq(0) th:eq(6)',wraper).html('理财余额变动');
				$('.hDivBox:eq(0) th:eq(7)',wraper).html('理财余额');
			}else{
				var param = excelplus();
			    total2=$.jRadGet({
			    	url:'/shopmanage-ws/ws/0.1/businessAccountManager/getAccountTrail'+param.paramUrl,
                    success:function(data){},
                    error:function(xhr){
						var errormsg = eval("(" + xhr.responseText + ")"); 
						var cDiv = $("#Wraper_account_manage .cDiv");
						$.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
					}
			    });
			    if(total2 == '' && total2 =='undefined'){
			    	return false;
			    }
				$.each(total2,function(i,val){
					var obj2 = total2.items;
					if(obj2 !=''&&obj2 !='undefined'){
						$.each(obj2,function(i,H){
							$('.hDivBox:eq(0) th:eq(6)',wraper).html('&nbsp;&nbsp;可提现余额变动<br>（合计'+H.totalChange+'元）');
						})
					}
					else{
						$('.hDivBox:eq(0) th:eq(6)',wraper).html('可提现余额变动');
					}
				}) 
				$('.hDivBox:eq(0) th:eq(7)',wraper).html('可提现余额');
			}
	}); 
	
    $(".numb34").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg34").form({}).form('close');
        $("#Form_explain_eg34").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
            submit:function(){
                var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg34 div[name='remark']").textarea("val")
                $.jRadPost({
                    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
                    data:postData,
                    success:function(){
                        $("#Form_explain_eg34").form('close')
                        $('.overcurtainDiv').hide();
                    }
                });
            }, 
            cancel:function(){
                $("#Form_explain_eg34").form('close')
                $('.overcurtainDiv').hide();
            }
        }).form('open')
        $("#Form_explain_eg34 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
});
function showIntegralsError(xhr){
	var errormsg = eval("(" + xhr.responseText + ")");
	var cDiv = $("#Wraper_account_manage .cDiv");
	$.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
}
</script>