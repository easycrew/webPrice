<div class="urlContentWraper" id="Wraper_user_response">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>用户反馈列表</strong><bottom class="all-work-info numb26">页面说明</bottom></h2>
        <!-- 列表显示 -->
		<div class="pic-grid">
			<table id="Table_user_response"></table>
		</div>
    </div>
    <div id="Form_user_response" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <input name="id" type="hidden">
            <div class="row">
                 <label class="span3 grid-layout-label">账号：</label>
                 <div class="span5 grid-layout-content">
                       <div name="name" class="jrad-input-container"></div>
                                    </div>
            </div>
            <div class="row">
                 <label class="span3 grid-layout-label">密码：</label>
                 <div class="span5 grid-layout-content">
                       <div name="password" class="jrad-input-container"></div>
                                    </div>
            </div>  
            <div class="row">
                 <label class="span3 grid-layout-label">员工姓名：</label>
                 <div class="span5 grid-layout-content">
                       <div name="dispalyName" class="jrad-input-container"></div>
                                    </div>
            </div>
            
            <div class="row">
                 <label class="span3 grid-layout-label">权限组：</label>
                 <div class="span5 grid-layout-content">
                       <div name="group" class="jrad-select-container"></div>
                                    </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
    <div id="Form_user_reply" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <div class="row">
                 <label class="span3 grid-layout-label">回复内容：</label>
                 <div class="span5 grid-layout-content">
                       <div name="replyContent" class="jrad-textarea-container"></div>
                 </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
    <div id="Form_explain_eg26" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>用户反馈内容的展示。</div>
                    <div><strong>重要功能说明：</strong>无。</div>
                    <div><strong>注意事项：</strong>1、反馈内容除APP反馈内容外，还包括官网反馈、商家后台/APP反馈、车机的反馈。2、同时，此功能经常用到一些运营活动的记录功能。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_user_response');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array(); 
	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});
    var datasources = {};
	datasources['osInfo'] = $.jRadGetDataSources('/shopmanage-ws/ws/0.1/datadictionary/dictionarylist?type=os_info','id','name'); 
    datasources['osInfo'].unshift({"id":"",name:"全部"});
    
    page_column_model.push({display: '用户ID', name : 'userInfoId',  sortable : true,width:80});
    page_column_model.push({display: '反馈内容', name : 'remarks',  sortable : true});
    page_column_model.push({display: '回复内容', name : 'replyContent',  sortable : true});
    page_column_model.push({display: '联系方式', name : 'contact',  sortable : true});
    page_column_model.push({display: '平台', name : 'osInfoName',  sortable : true,width:150});
    page_column_model.push({display: '版本', name : 'version',  sortable : true,width:80});
	page_column_model.push({display: '渠道号', name : 'channelId',  sortable : true,width:80});
	page_column_model.push({display: '反馈时间', name : 'createDate',  sortable : true,width:150});
    page_column_model.push({display: '回复时间', name : 'modifyReplyTime',  sortable : true,width:150});
    
    page_search_items.push({row:'1',type:'jrad-input',display:'用户ID',name:'userInfoId'});
	page_search_items.push({row:'1',type:'jrad-select',display:'平台',name:'osInfo',params:{
	  data:datasources['osInfo']
	}});
	page_search_items.push({row:'1',type:'jrad-input',display:'版本',name:'version'});
	page_search_items.push({row:'2',type:'jrad-input',display:'渠道号',name:'channelId'});
	page_search_items.push({row:'2',type:'jrad-input',display:'反馈内容',name:'remarks'}); 
    page_search_items.push({row:'2',type:'jrad-input',display:'回复内容',name:'replyContent'}); 
	page_search_items.push({row:'3',type:'jrad-dateinput',display:'反馈时间开始',name:'startDate'});
	page_search_items.push({row:'3',type:'jrad-dateinput',display:'反馈时间结束',name:'endDate'});
    page_search_items.push({row:'4',type:'jrad-dateinput',display:'回复时间开始',name:'replyStartDate'});
    page_search_items.push({row:'4',type:'jrad-dateinput',display:'回复时间结束',name:'replyEndDate'});
    

    $('div[name="replyContent"]',wraper).textarea({
        rows:5,
        grid:8
    });
    
    $('#Form_user_reply').form({
        fluid:true,
        autobinding:true
    });
    //page_list_buttons.push({separator: true});
    page_list_buttons.push({displayname: '回复反馈',title:'回复反馈',name:'reply',bclass: 'reply',prefunc:function(){
            var checked = $('#Table_user_response').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){ 
            var checked = $('#Table_user_response').getCheckedTrs();
            
            if(checked[0].feedBackReplyId==""){
             $('#Form_user_reply',wraper).form({
                title:'回复反馈',
                item:{},
                url:'/shopmanage-ws/ws/0.1/feedback/cms/addReply',
                before_submit:function(json){
                    var checked = $('#Table_user_response').getCheckedTrs();
                    json.feedBackId=checked[0].feedBackId;
                    json.replyNickName=carsmart_config.operatorName;
                    return json;
                },
                success_callback:function(){
                        $('#Table_user_response').flexMessage('回复成功','success');
                        $('#Table_user_response').flexReload();
                }
            }).form('open');

         }else{
            var _feedBackReplyId =checked[0].feedBackReplyId;
            var _item=$.jRadGet({url:'/shopmanage-ws/ws/0.1/feedback/cms/replyDetail?feedBackReplyId='+_feedBackReplyId});
            $('#Form_user_reply',wraper).form({
                title:'回复反馈',
                item:_item,
                url:'/shopmanage-ws/ws/0.1/feedback/cms/editReply',
                before_submit:function(json){
                    json.feedBackReplyId=checked[0].feedBackReplyId;
                    json.replyNickName=carsmart_config.operatorName;
                    return json;
                },
                success_callback:function(){
                        $('#Table_user_response').flexMessage('回复成功','success');
                        $('#Table_user_response').flexReload();
                }
            }).form('open');
         }
        }
    });
    page_list_buttons.push({displayname: '修改回复',title:'修改回复',name:'modifyReply',bclass: 'modifyreply',prefunc:function(){
            var checked = $('#Table_user_response').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
             var checked = $('#Table_user_response').getCheckedTrs();
            var _feedBackReplyId =checked[0].feedBackReplyId;
             var _item=$.jRadGet({url:'/shopmanage-ws/ws/0.1/feedback/cms/replyDetail?feedBackReplyId='+_feedBackReplyId});

             if(checked[0]){
             $('#Form_user_reply',wraper).form({
                title:'修改回复',
                item:_item,
                url:'/shopmanage-ws/ws/0.1/feedback/cms/editReply',
                before_submit:function(json){
                    json.feedBackReplyId=checked[0].feedBackReplyId;
                    json.replyNickName=carsmart_config.operatorName;
                    return json;
                },
                success_callback:function(){
                        $('#Table_user_response').flexMessage('修改成功','success');
                        $('#Table_user_response').flexReload();
                }
            }).form('open');
         }
        }
    });
    $('#Table_user_response').flexigrid({
            reload:true,
			method:'get',
            colModel : page_column_model,
            buttons : page_list_buttons,
            searchitems :page_search_items,
			showSearch:true,
            pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			},
            url:'/shopmanage-ws/ws/0.1/feedback/cms/page',
			onError:showResponseError
    });
    
    $(".numb26").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg26").form({}).form('close');
        $("#Form_explain_eg26").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
            submit:function(){
                var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg26 div[name='remark']").textarea("val")
                $.jRadPost({
                    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
                    data:postData,
                    success:function(){
                        $("#Form_explain_eg26").form('close')
                        $('.overcurtainDiv').hide();
                    }
                });
            }, 
            cancel:function(){
                $("#Form_explain_eg26").form('close')
                $('.overcurtainDiv').hide();
            }
        }).form('open')
        $("#Form_explain_eg26 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
});
function showResponseError(xhr){
			 var errormsg = eval("(" + xhr.responseText + ")");
			  var cDiv = $("#Wraper_user_response .cDiv");
			  $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
			}

</script>
