 <div class="urlContentWraper" id="Wraper_user_account2">
    <div class="ui-info-layout">
        <h2 class="ui-tit"><strong>用户账户管理</strong><bottom class="all-work-info numb211">页面说明</bottom></h2>
        <!-- 列表显示 -->
        <div class="pic-grid">
			<table id="Table_user_account2"></table>
		</div>
    </div>
    <div id="Form_user_account2" style="display:none;">
        <div class="grid-layout-main jrad-form">
            <input name="id" type="hidden"> 
            <div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>用户ID：</label>
                 <div class="span6 grid-layout-content">
                       <div name="userId" class="jrad-input-container"></div>
						</div> 
            </div>  
			<div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>增减值：</label>
                 <div class="span6 grid-layout-content">
                       <div name="changeBalance" class="jrad-input-container"></div>
						<p class="ui-note">请输入整数，负数代表减少余额。</p>
						</div> 
            </div>  
            <div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>变动原因</label>
                 <div class="span5 grid-layout-content">
                       <div name="reasonType" class="jrad-select-container"></div>
                                    </div>
            </div>
            
            <div class="row">
                 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>备注：</label>
                 <div class="span5 grid-layout-content">
                       <div name="remarks" class="jrad-textarea-container"></div>
                                    </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container">
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
    <div id="Form_explain_eg211" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>用户的账户浏览功能。</div>
                    <div><strong>重要功能说明：</strong>无。</div>
                    <div><strong>注意事项：</strong>无。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_user_account2');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();

	var reasonSelect =  $.jRadGet({url:'/shopmanage-ws/ws/0.1/datadictionary/dictionarylist?type=integral_vary_reason'});

	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel});  
	jRad.validators['userId'] = [{"msg":"用户id不能为空","type":"min","value":"1"},{msg:"用户id只能是数字",type:'regex',value:/^[ ]*\d+[ ]*$/}];
	jRad.validators['changeBalance'] = [{"msg":"增减余额不能为空","type":"min","value":"1"},{msg:"请输入整数",type:'regex',value:/^[ ]*[-]{0,1}\d+[ ]*$/}];
	jRad.validators['reasonType'] = [{"msg":"变动原因不能为空","type":"min","value":"1"}];
	jRad.validators['remarks'] = [{"msg":"备注不能为空","type":"min","value":"1"}];

	jRad.params['reasonType'] = {data:[{id:'1',name:'反馈油价奖励'},{id:'2',name:'加油站红包'},{id:'3',name:'反馈油价驳回'},{id:'4',name:'用户提现'},{id:'5',name:'用户充值'},{id:'6',name:'购买服务抵扣'},{id:'14',name:'车挣补贴'},{id:'99',name:'其它'}]};    

    page_column_model.push({display: '时间', name : 'createDateStr',width:150});
    page_column_model.push({display: '用户ID', name : 'userId',width:80});
    page_column_model.push({display: '账户余额', name : 'balance',width:100});
    page_column_model.push({display: '余额变动', name : 'changeBalance',diy:function(item,$div){
	   var score = item.changeBalance;
	   if(score > 0){
		 $div.html("+"+score); 
	   }else{
		 $div.html(score); 
	   }
	}}); 
    page_column_model.push({display: '变动原因', name : 'reasonType',datasource:[
	    	{id:'1',name:'反馈油价奖励'},{id:'2',name:'加油站红包'},{id:'3',name:'反馈油价驳回'},{id:'4',name:'用户提现'},{id:'5',name:'用户充值'},{id:'6',name:'购买服务抵扣'},{id:'7',name:'服务订单退款'},{id:'8',name:'车主卡退款'},{id:'9',name:'乐乘返利'},{id:'10',name:'1元免费洗车返现'},{id:'11',name:'订单重新支付'},{id:'12',name:'取消订单'},{id:'13',name:'订单支付失败'},{id:'14',name:'车挣补贴'},{id:'99',name:'其它'}
    	]});
	page_column_model.push({display: '备注', name : 'remarks'});
	page_column_model.push({display: '操作人', name : 'operator'});

	var allRreasonSelect = $.merge([{"id":"","name":"全部"}],reasonSelect);
    page_search_items.push({row:'1',type:'jrad-input',display:'用户ID',name:'userId'});
    page_search_items.push({row:'1',type:'jrad-input',display:'备注',name:'remarks'}); 
	page_search_items.push({row:'1',type:'jrad-select',display:'变动原因',name:'reasonType',params:{
	  data:[{id:'',name:'全部'},{id:'1',name:'反馈油价奖励'},{id:'2',name:'加油站红包'},{id:'3',name:'反馈油价驳回'},{id:'4',name:'用户提现'},{id:'5',name:'用户充值'},{id:'6',name:'购买服务抵扣'},{id:'7',name:'服务订单退款'},{id:'8',name:'车主卡退款'},{id:'9',name:'乐乘返利'},{id:'10',name:'1元免费洗车返现'},{id:'11',name:'订单重新支付'},{id:'12',name:'取消订单'},{id:'13',name:'订单支付失败'},{id:'14',name:'车挣补贴'},{id:'99',name:'其它'}]
	}});

	page_search_items.push({row:'2',type:'jrad-dateinput',display:'开始时间',name:'startTime'});
	page_search_items.push({row:'2',type:'jrad-dateinput',display:'结束时间',name:'endTime'});
	 
 //   $('#Form_user_account2').form({
	// 	title: '增减账户余额',
	// 	validators: jRad.validators,
	// 	fields_params:jRad.params,
	// 	item:{}, 
	// 	height:280,
	// 	url:'/shopmanage-ws/ws/0.1/userInfoCms/changeBalance',
	// 	before_submit:function(json){
	// 		json.operator = carsmart_config.operatorName;
	// 		return json;
	// 	},
	// 	success_callback:function(){ 
	// 		$('#Table_user_account2').flexMessage('操作成功', 'success');
	// 		$('#Table_user_account2').flexReload();
	// 	}
	// }); 
	 
 //    page_list_buttons.push({displayname: '增减余额',name:'AddOrMinus', bclass: 'AddOrMinus',onpress : function(){ 
	// 	   $('#Form_user_account2').form({item:{}}).form('open');
 //        }
 //    }); 
    page_list_buttons.push({separator: true});

	$('#Table_user_account2').flexigrid({
			reload:true,
			method:'get', 
			colModel : page_column_model,
			buttons : page_list_buttons,
			searchitems :page_search_items,
			showSearch:true,
			pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			},
			url:'/shopmanage-ws/ws/0.1/userInfoCms/balanceList',
			onError:showIntegralsError,
			checkBoxType:'single'
	});  
    
    $(".numb211").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg211").form({}).form('close');
        $("#Form_explain_eg211").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
            submit:function(){
                var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg211 div[name='remark']").textarea("val")
                $.jRadPost({
                    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
                    data:postData,
                    success:function(){
                        $("#Form_explain_eg211").form('close')
                        $('.overcurtainDiv').hide();
                    }
                });
            }, 
            cancel:function(){
                $("#Form_explain_eg211").form('close')
                $('.overcurtainDiv').hide();
            }
        }).form('open')
        $("#Form_explain_eg211 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
});
function showIntegralsError(xhr){
			 var errormsg = eval("(" + xhr.responseText + ")");
			  var cDiv = $("#Wraper_user_account2 .cDiv");
			  $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
			}
</script>
