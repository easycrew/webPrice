<div class="urlContentWraper" id="Wraper_answer_manage">
<div class="ui-info-layout">
<div class="ui-info-layout-subbox "> 
	<div class="jrad-table">
        <h2 class="ui-tit"><strong>问答管理列表</strong><bottom class="all-work-info numb111">页面说明</bottom></h2>
        <!-- 列表显示 -->
        <table id="Table_answer_manage"></table>
    </div>
	<div class="details-box" style="display:none;">
			<ul class="details-tab">
				<li class="tab-cur tab-cur-first f-left"><span name="title">创建问答</span></li>
				<li><span class="return"></span></li>
			</ul>
			<div class="details-content">
				<div class="details-scroll">
					<div class="details-content-inner">
						<div class="grid-layout ui-form" id="Form_answer_manage">
							<div class="jrad-form">  
								<div class="grid-layout-main">
								<input name="id" type="hidden"> 
								<div name="brands"></div>
								<div name="regions"></div>
								<div class="row-fluid">
								 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>标题：</label>
								 <div class="span5 grid-layout-content">
									   <div name="title" class="jrad-input-container"></div>
													</div>
								</div>
								<div class="row-fluid area">
									<label class="span3 grid-layout-label"><span class="ui-form-required">*</span>绑定地域： </label>
									<div class="span14 grid-layout-content fluid-wrap">
										<div class="jrad-buttons-container" name="area_check_btn">
											<span id="jrad-button-area" class="jrad-primary">
												点击选择 </span>
										</div>
										<div id="area_check_string" style="margin: 10px 0;"></div>
									</div>
								</div>  
								<div class="row-fluid">
									<label class="span3 grid-layout-label"><span class="ui-form-required">*</span>绑定车系： </label>
									<div class="span14 grid-layout-content fluid-wrap">
										<div class="jrad-buttons-container" name="brand_check_btn">
											<span id="jrad-button-brand" class="jrad-primary">
												点击选择 </span>
										</div>
										<p id="brand_check_string" style="margin: 10px 0;"></p>
									</div>
								</div>   
								<div class="row-fluid"> 
									 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>绑定服务ID：</label>
									 <div class="span10 grid-layout-content">
									   <div name="serviceIds" class="jrad-input-container"></div>
									   <span class="serviceNames"></span>
													</div>
								</div> 
								<div class="row-fluid">
									 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>问题描述：</label>
									 <div class="span5 grid-layout-content">
										   <div name="question" class="jrad-mediaarea-container" style="margin-left:0"></div>
														</div>
								</div>
								<div class="row-fluid">
									 <label class="span3 grid-layout-label"><span class="ui-form-required">*</span>问题解答：</label>
									 <div class="span5 grid-layout-content">
										   <div name="answer" class="jrad-mediaarea-container" style="margin-left:0"></div>
														</div>
								</div> 
								<div class="row-fluid">
									 <label class="span3 grid-layout-label">是否置顶：</label>
									 <div class="span5 grid-layout-content">
										   <div name="isTop" class="jrad-select-container"></div>
									 </div>
								</div> 
								<div class="row-fluid">
									 <label class="span3 grid-layout-label">状态：</label>
									 <div class="span5 grid-layout-content">
										   <div name="status" class="jrad-select-container"></div>
									 </div>
								</div>
								</div> 
							</div>
							<div class="jrad-buttons-container ui-buttons-container">
								<span class="jrad-btn-primary">确定</span> 
								<span class="jrad-btn-normal">取消</span>
							</div>
						</div>
					</div>
					
				</div>
			</div>
     </div>
</div>
</div>

<!--服务品牌--> 
<div id="Form_service_brand" style="display:none;">
	<div class="grid-layout-main jrad-form"> 
		 <div class="jrad-tree" id="brandsTree">
		 </div>
		 <div class="jrad-checkbox-container" name="vendor" style="position:absolute;bottom:25px;font-weight:bold;"></div>
	</div>
	<div class="jrad-buttons-container ui-buttons-container"> 
		<span class="jrad-btn-primary">确定</span> 
		<span class="jrad-btn-normal">取消</span>
	</div>
</div> 
<!-- 地区选择-->
<div id="Form_area" style="display:none;">
	<div class="grid-layout-main jrad-form"> 
		  <div class="row-fluid">
			<label class="span3 grid-layout-label"> 省：</label>
			<div class="span5 grid-layout-content">
				<div class="jrad-select-container" name="provinceId">
				</div>
			</div> 
			<label class="span3 grid-layout-label">	市：</label>
			<div class="span5 grid-layout-content">
				<div class="jrad-select-container" name="areaCodeId">
				</div>
			</div>
		</div> 
	</div>
	<div class="jrad-buttons-container ui-buttons-container"> 
		<span class="jrad-btn-primary">确定</span> 
		<span class="jrad-btn-normal">取消</span>
	</div>
</div> 

    <div id="Form_explain_eg111" style="display:none;">
        <div class="grid-layout-main jrad-form"> 
            <div class="row">
                <label class="span3 grid-layout-label">业务说明：</label>
                <div class="span12 grid-layout-content">
                    <div><strong>功能简介：</strong>此功能已停用。</div>
                    <div><strong>重要功能说明：</strong>无。</div>
                    <div><strong>注意事项：</strong>无。</div>
                </div> 
            </div> 
            <div class="row">
                <label class="span3 grid-layout-label">备注：</label>
                <div class="span12 grid-layout-content">
                    <div class="jrad-textarea-container" name="remark">
                    </div>
                </div>
            </div>
        </div>
        <div class="jrad-buttons-container ui-buttons-container"> 
            <span class="jrad-btn-primary">确定</span> 
            <span class="jrad-btn-normal">取消</span>
        </div>
    </div>								
</div>
<script type="text/javascript">
$(document).ready(function(){  
	var wraper = $('#Wraper_answer_manage');
    var page_column_model = new Array();
    var page_search_items = new Array();
    var page_list_buttons = new Array();
	 	
	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel}); 
    jRad.validators['title'] = [{"msg":"标题不能为空","type":"min","value":"1"}]; 
	jRad.validators['answer'] = [{"msg":"问题解答不能为空","type":"min","value":"1"}]; 
	jRad.validators['question'] = [{"msg":"问题描述不能为空","type":"min","value":"1"}]; 
	jRad.validators['serviceIds'] = [{"msg":"绑定服务ID不能为空","type":"min","value":"1"},{"msg":"请填写数字","type":"regex","value":/^[ ]*\d+[ ]*$/}]; 
	
	var fields_params = {}; 
	fields_params['title'] = {grid: 9}; 
	fields_params['status'] ={ data:[ 
		{"id":"1",name:"有效"},
		{"id":"0",name:"无效"}
	]};  
	fields_params['isTop'] ={ data:[ 
		{"id":"1",name:"是"},
		{"id":"0",name:"否"}
	]}; 
	fields_params['question'] = {
 			theme:"Full",
 			resizing: false, 
 			grid: 18, 
 			height: 200,
			uploadImg: { //上传图片参数
				url: '/shopmanage-ws/ws/0.1/file/uploadThree',
				fileName: 'file', 
				delFunc: function(item) { 
					item.list.remove(); 
				}, 
				validator : [{
					msg : "只能上传jpg文件",
					type : "regex",
					value : /^.*\.(jpg|JPG)$/
				}], 
				success: function(data){  
					   if(data[0]&&data[0].code=="400"){
						 $.jRadMessage({level:'error',message:data[0].message});
					   }
					},
				note: '仅支持 JPG图片文件。',
				show:true,
				showLarge:true,  
				prev:'fileUrl', 
				params: {type:"",cutPicType:''}, 
				single: true 
			}
		// 	,
		// CKOpt:{
		// 	fullPage:true,
		// 	basicEntities:false, 
		// 	startupMode:'source' 
		// } 
 	};
 	fields_params['answer'] = {
 			theme:"Full",
 			resizing: false, 
 			grid: 18, 
 			height: 200,
			uploadImg: { //上传图片参数
				url: '/shopmanage-ws/ws/0.1/file/uploadThree',
				fileName: 'file', 
				delFunc: function(item) { 
					item.list.remove(); 
				}, 
				validator : [{
					msg : "只能上传jpg文件",
					type : "regex",
					value : /^.*\.(jpg|JPG)$/
				}], 
				success: function(data){  
					   if(data[0]&&data[0].code=="400"){
						 $.jRadMessage({level:'error',message:data[0].message});
					   }
					},
				note: '仅支持 JPG图片文件。',
				show:true,
				showLarge:true,  
				prev:'fileUrl', 
				params: {type:"",cutPicType:''}, 
				single: true 
			}
		// 	,
		// CKOpt:{
		// 	fullPage:true,
		// 	basicEntities:false, 
		// 	startupMode:'source' 
		// } 
 	};
	var _form = $("#Form_answer_manage");  
	page_column_model.push({display: '问答ID', name : 'modelQaId'});
    page_column_model.push({display: '标题', name : 'title'});
    page_column_model.push({display: '绑定车系', name : 'modelNames'}); 
	page_column_model.push({display: '服务ID', name : 'serviceIds'});
    page_column_model.push({display: '最后操作人', name : 'operator'});
    page_column_model.push({display: '最后操作时间', name : 'updateDate'}); 
	page_column_model.push({display: '显示查看问题人数（人）', name : 'showViewCnt'});
    page_column_model.push({display: '显示有此问题人数（人）', name : 'showQuestionCnt'});
    page_column_model.push({display: '状态', name : 'statusDesc'});
    page_column_model.push({display: '真实看问题人数（人）', name : 'realViewCnt'}); 
    page_column_model.push({display: '真实有此问题人数（人）', name : 'realQuestionCnt'}); 
    
    
	page_search_items.push({row:'1',type:'jrad-input',display:'标题',name:'title'});
	page_search_items.push({row:'1',type:'jrad-input',display:'绑定车系',name:'modelNames'});  
	page_search_items.push({row:'1',type:'jrad-input',display:'服务ID',name:'serviceIds'});  
	page_search_items.push({row:'2',type:'jrad-input',display:'最后操作人',name:'operator'});
	page_search_items.push({row:'2',type:'jrad-dateinput',display:'最后操作时间始',name:'updateStartDate'});
	page_search_items.push({row:'2',type:'jrad-dateinput',display:'最后操作时间终',name:'updateEndDate'}); 
	page_search_items.push({row:'3',type:'jrad-select',display:'状态',name:'status',params:{
	  data:[
	    {"id":"",name:"全部"},
	    {"id":"0",name:"无效"},
	    {"id":"1",name:"有效"}
	  ]
	}});   

    $('#Form_answer_manage .jrad-btn-normal',wraper).button({
		click: function(){
			$('.details-box',wraper).slideUp();
			$('.jrad-table',wraper).slideDown(); 
			$(".scroll-up-btn").click();
		}
	});  
	$('#Form_answer_manage .jrad-btn-primary',wraper).button({
		click: function(){
			var flag = $('#Form_answer_manage',wraper).form('validateAll');
			if(!flag) {
			   return;
			}  
			var json = $('#Form_answer_manage',wraper).form('getValue');   
			var checked = $('#Table_answer_manage').getCheckedTrs();
			//绑定区域
			json.regions = []; 
			if(carsmart_config.isAgentor!=0){
				json.regions=carsmart_config.regions
			}else{
				var regions = $("div[name='regions']",wraper).data("areaList"); 
				if(regions.length==0){
				 $.jRadMessage({level:'error',message:"请选择要绑定的地域。"});
				 return;
				}else{
				$.each(regions,function(){
				  var region = {};
				  region.provinceId = this.provinceId+"";  
				  var areaList = this.areaList;
				  var areaCodeId = [];
				  for(var i=0;i<areaList.length;i++){
				  areaCodeId.push(areaList[i].areaCodeId);
				  } 
				  region.areaCodeId =  areaCodeId.join(","); 
				  json.regions.push(region);
				});  
				}
			}
			json.modelIds = [];
			var modelIds = $("div[name='brands']",wraper).data("brandIds");  
			if(modelIds!=undefined){
				json.modelIds = modelIds;  
			}   
			if(json.modelIds.length==0){ 
				$.jRadMessage({level:'error',message:"请选择要绑定的车系。"});
			    return;
			}		
			json.operator = carsmart_config.operatorName;//创建人 即为当前登录人名字 
			
			if($(".details-box .details-tab",wraper).find("span[name='title']").html()=="创建问答"){
			$.jRadPost({
				    	url:'/shopmanage-ws/ws/0.1/modelQa/save',
				    	data:json,
				    	success:function(){
				    		$('.details-box',wraper).slideUp();
							$('.jrad-table',wraper).slideDown();  
							$(".scroll-up-btn").click();
							$('#Table_answer_manage').flexMessage('创建成功', 'success');
							$('#Table_answer_manage').flexReload();
				    	},error:function(data){
				    		var mes = eval('('+data.responseText+')');
				    		 $.jRadMessage({
				    			 level:'error', 
			    				 message:mes[0].message 
				    		 });
				    	}
				    });
		 }else{
		 	json.modelQaId = checked[0].modelQaId;
			$.jRadPost({
				    	url:'/shopmanage-ws/ws/0.1/modelQa/save',
				    	data:json,
				    	success:function(){
				    		$('.details-box',wraper).slideUp();
							$('.jrad-table',wraper).slideDown();  
							$(".scroll-up-btn").click();
							$('#Table_answer_manage').flexMessage('编辑成功', 'success');
							$('#Table_answer_manage').flexReload();
				    	},error:function(data){
				    		var mes = eval('('+data.responseText+')');
				    		 $.jRadMessage({
				    			 level:'error', 
			    				 message:mes[0].message 
				    		 });
				    	}
				    });
		 }
		}	 
	}); 
	$('#Form_answer_manage',wraper).form({
		validators: jRad.validators,
		fields_params:fields_params,
		layout: 'grid', 
		autobinding: false
	 }); 
	
    
	var readonlyFields2 = {};
	readonlyFields2['users'] = false; 
	page_list_buttons.push({title: '创建',name:'Add', bclass: 'add',
		onpress : function(){
			 initInfo(wraper); 
			 $('#Form_answer_manage',wraper).form({item:{}}); 
			 $(".details-box .details-tab",wraper).find("span[name='title']").html("创建问答");
			 $('.jrad-table',wraper).slideUp();
			 $('.details-box',wraper).slideDown();
			 $('#Form_answer_manage span.serviceNames').html('');
			 $('#Form_answer_manage div[name="serviceIds"] input').keydown(function(){
			 	$(this).parents('div.row-fluid').find('div.ui-field-error').hide()
			 });
			 $(".scroll-up-btn").click()
        }
    });
	var readonlyFields = {};
	readonlyFields['users'] = true; 
	page_list_buttons.push({title: '修改',name:'Edit', bclass: 'edit',prefunc:function(){
            var checked = $('#Table_answer_manage').getCheckedTrs();
            if (checked.length != 1) {return false;}else{return true;}
        },onpress : function(){
            var checked = $('#Table_answer_manage').getCheckedTrs(); 
            if(checked[0]) {
			     var id = checked[0].modelQaId;
                 updateInfo(id,wraper)
            }
        }
    }); 
  
	page_list_buttons.push({title: '删除',name:'delete',bclass: 'delete',prefunc:function(){
            var checked = $('#Table_answer_manage').getCheckedTrs();
            if (checked.length == 0) {return false;}else{return true;}
        },onpress : function(){
	    	var checked = $('#Table_answer_manage').getCheckedTrs();
			$.jRadConfirm('确认删除吗？',1,function(){
				var idArr=[];
				var postData={};
				$.each(checked,function(i){
					idArr.push(checked[i].modelQaId)
				});
				var modelQaIds = idArr.join(',');
				postData.modelQaIds = modelQaIds;
				postData.operator = carsmart_config.operatorName;
				$.jRadAjax({
				    type:'post',
					url:'/shopmanage-ws/ws/0.1/modelQa/del', 
				    data:postData,
					success: function(){
						$('#Table_answer_manage').flexMessage('删除成功!', 'success');
           	    		$('#Table_answer_manage').flexReload();
					},
					error:function(xhr){
					    var errormsg = eval("(" + xhr.responseText + ")"); 
						if (errormsg != undefined) {
							$('#Table_answer_manage').flexMessage(errormsg[0].message, 'error');
						}
					}
				});
			});
		}
	});
	 
    page_list_buttons.push({separator: true});
    
    $('#Table_answer_manage').flexigrid({
            reload:true,
			method:'get',
            colModel : page_column_model,
            buttons : page_list_buttons,
            searchitems :page_search_items,
            pagination: {
				diaplay_pages: 5,
				align: 'bottom' 
			},
			showSearch:true,
            url:'/shopmanage-ws/ws/0.1/modelQa/list',
			onError:showInfoError,
			overflow:true
    }); 
	$(".details-tab .return",wraper).click(function(){
		$('.details-box',wraper).slideUp();
		$('.jrad-table',wraper).slideDown(); 
		$(".scroll-up-btn").click();
		$('#Table_answer_manage').flexReloadCurrentPage(); 
	}); 
	//服务品牌
	$('#Form_service_brand',wraper).form({
							title: '绑定车系选择', 
							item: {},  
							fields_params:{'vendor':{data: [{id:'全部',name:'全部'}]}},		
							height: 500,
							submit:function(){   
							var vendor = $('#Form_service_brand div[name="vendor"]',wraper).checkbox('val');  
							if(vendor.length==0||vendor[0]==""){
							 var treeObj = getZtreeObj(wraper);
							 var filter = function(node){
								return (node.level == 1 && node.checked==true);
							 }
							 var nodes = treeObj.getNodesByFilter(filter); 
							 var arr = [];
							 var modelNameList = [];
							 $.each(nodes,function(){
							   var json = {};
   							   json.brandId = this.id;
							   json.modelId = [];
							   var modelFilter = function(node){ 
								return (node.brandId ==json.brandId && node.level == 3 && node.checked==true);
							   }
								var modelNodes = treeObj.getNodesByFilter(modelFilter); 
								$.each(modelNodes,function(i){
								  json.modelId.push(modelNodes[i].id);
								  modelNameList.push(modelNodes[i].name);
								});
								json.modelId = json.modelId.join(",");
								arr.push(json);
							 }); 
							  $("#Form_answer_manage",wraper).find("div[name='brand_check_btn']").next("#brand_check_string").html("已选择："+modelNameList.join(" , "));	
							  $("div[name='brands']",wraper).data("brandIds",arr); 
							}else{
								 $("#Form_answer_manage",wraper).find("div[name='brand_check_btn']").next("#brand_check_string").html("已选择：全部");	
								  $("div[name='brands']",wraper).data("brandIds",[{"brandId":"", "modelId":"0"}]); 
							}
							$("#Form_service_brand",wraper).form('close'); 
		}
	}); 
	$("#jrad-button-brand",wraper).button({
		click : function() {
		var brandIds = $("div[name='brands']",wraper).data("brandIds");
		var data = {}
		if((brandIds.length==1&&brandIds[0].modelId=="0")||brandIds.length==0){
		 data = {"vendor":"全部"};
		}else{
		var treeObj = getZtreeObj(wraper);
		$.each(brandIds,function(i,json){   
			var modelIds = json.modelId.split(",");
			$.each(modelIds,function(i){ 
				var modelId = modelIds[i];
				var modelFilter = function(node){  
					return (node.brandId ==json.brandId && node.level == 3 && node.id == modelId);
				} 
				var modelNode = treeObj.getNodesByFilter(modelFilter,true);  
				treeObj.checkNode(modelNode, true, true);  
			}); 
		}); 
		}  		
			$('#Form_service_brand',wraper).form({
			item:data
			}).form('open');
		}
	});  
	//地区选择
    var area_fields_params = {};	
	area_fields_params['provinceId'] = {
		urlData:{
			url: '/euc/ws/0.1/user/provinces?userId='+carsmart_config.userId
		},
		unshiftData: {id:'0',name:'全部'},
		onchange: function(){
			var provinceCode = $('#Form_area div[name=provinceId]',wraper).select('val');
			if(provinceCode=='0'){
				$('#Form_area div[name=areaCodeId]',wraper).select({data:[{id:'0',name:'全部'}]});
			}else{
			$('#Form_area div[name=areaCodeId]',wraper).select("val","0");
			$('#Form_area div[name=areaCodeId]',wraper).select({
				urlData:{
					url: '/euc/ws/0.1/user/cities?provinceId='+provinceCode+'&userId='+carsmart_config.userId
				},
				unshiftData: {id:'0',name:'全部'}
			});
			}
		}
	}
	area_fields_params['areaCodeId'] = {
			data: [{id:'0',name:'全部'}]
		};
	$('#Form_area',wraper).form({
	        title:"地区", 
			fields_params:area_fields_params,
			item:{"provinceId":"0","areaCodeId":"0"},
			submit:function(){  
				var json = {};
				json.provinceId = $("#Form_area div[name='provinceId']",wraper).select('val');
				json.provinceName = $("#Form_area div[name='provinceId']",wraper).select('text');
				json.areaList = [];
				json.areaList[0] = {};
				json.areaList[0].areaCodeId = $("#Form_area div[name='areaCodeId']",wraper).select('val');
				json.areaList[0].areaCodeName = $("#Form_area div[name='areaCodeId']",wraper).select('text');  
				var array = $("div[name='regions']",wraper).data("areaList");
				var pId = json.provinceId; 
				var aId = json.areaList[0].areaCodeId;
				if(pId=="0"){
					array = []; 
					array.push(json);
				}else{
				    if(array.length==1&&array[0].provinceId=="0"){
					array = []; 
					array.push(json);
					}else{
						var flag = true;
						$.each(array,function(){
							if(this.provinceId == pId){
							  flag = false;
							  var areaList = this.areaList;
							  if(aId=="0"){
									this.areaList = json.areaList;
							  }else{ 
									var areaflag = true;
									for(var i=0;i<areaList.length;i++){
									if(areaList[i].areaCodeId==0){
									areaflag = false;
									this.areaList = json.areaList;
									break;
									}
									if(areaList[i].areaCodeId==aId){ 
									areaflag = false;
									$.jRadMessage({level:'error',message:"该地区已经选择",selector:$("#Form_area",wraper)});
									return;
									}
									
									}
									if(areaflag){
									this.areaList.push(json.areaList[0]);
									}
							  }
							}
						});
						if(flag){  
						  array.push(json);
						}  
					}
				}
				addAreaList(array,wraper); 
				$("div[name='regions']",wraper).data("areaList",array);
				$("#Form_area div[name='areaCodeId']",wraper).select('destroy');
				$("#Form_area",wraper).form("close");
			}
			});
	$("#jrad-button-area",wraper).button({
		click : function() {  
			$('#Form_area',wraper).form({ 
			fields_params:area_fields_params,
			item:{"provinceId":"0","areaCodeId":"0"},
			}).form('open');
		}
	});
	//删除地区
	$("#area_check_string .delArea",wraper).live('click',function(){
		var info = $(this).data('info'); 
		var arr = $("div[name='regions']",wraper).data("areaList");   
		$.each(arr,function(i){
			var json = this;
			if(json.provinceId==info.provinceId){
				if(info.areaId=="0"){
					arr.splice(i,1);
				}else if(json.areaList.length==1){
					arr.splice(i,1);
				}else{   
					$.each(json.areaList,function(j){
					var area = this;
					if(area.areaCodeId==info.areaId){ 
					json.areaList.splice(j,1); 
					}
					});
				}
			}
		}); 
		$(this).parent('.areaSpan').remove();
	});


	$(".numb111").click(function(){
        $('.overcurtainDiv').hide();
        var menuId = $(".tabs-selected").attr("menuId")
        var data = $.jRadGet({url:'/shopmanage-ws/ws/0.1/remark/getMenuRemark?menuId='+menuId})
        $("#Form_explain_eg111").form({}).form('close');
        $("#Form_explain_eg111").form({
            title:'页面说明',
            item:data,
            autobinding: true, 
			submit:function(){
            	var postData = {};
                postData.operator = carsmart_config.operatorName;
                postData.menuName = $(".tabs-selected").attr("menuName");
                postData.menuId = $(".tabs-selected").attr("menuId");
                postData.remark = $("#Form_explain_eg111 div[name='remark']").textarea("val")
				$.jRadPost({
				    url:'/shopmanage-ws/ws/0.1/remark/updateMenuRemark',
				    data:postData,
				    success:function(){
						$("#Form_explain_eg111").form('close')
      					$('.overcurtainDiv').hide();
				   	}
				});
			}, 
			cancel:function(){
				$("#Form_explain_eg111").form('close')
      			$('.overcurtainDiv').hide();
			}
        }).form('open')
        $("#Form_explain_eg111 .textarea-content").removeClass("span4").addClass("span12")
        $('.overcurtainDiv').hide();
        $('.overcurtainDiv').eq(0).show().attr("style","z-index:303;display:block");
    })
}); 

function showInfoError(xhr){
			 var errormsg = eval("(" + xhr.responseText + ")");
			  var cDiv = $("#Wraper_answer_manage .cDiv");
			  $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
			}


function initInfo(wraper){ 
	   //服务品牌 
	   $("#Form_answer_manage",wraper).find("div[name='brand_check_btn']").next("#brand_check_string").html("");
	   $("#Form_answer_manage #business_bind_button",wraper).parent().next("#business_bind_string").html("");
	   $("div[name='brands']",wraper).data("brandIds",[]); 
		try{
		$("#Form_service_brand .jrad-tree",wraper).tree('destroy');   
		}catch(e) {
		} 
	   var treeOption = setBrandTree(wraper); 
	   $("#Form_service_brand .jrad-tree",wraper).tree(treeOption);
	   //地区
	   $("#Form_answer_manage div[name='regions']",wraper).data("areaList",[]); 
	   $("#Form_answer_manage #area_check_string",wraper).html("");
	   $("#Form_answer_manage .nameTips",wraper).html(""); 
	   //服务ID
	   $('#Form_answer_manage div[name="serviceIds"] input',wraper).blur(function(data){
		   	var _val=$.trim($('#Form_answer_manage div[name="serviceIds"]',wraper).input('val'));
	   		var servNames=$.jRadGet({url:'/shopmanage-ws/ws/0.1/service/getServiceNames?id='+_val});
	   		if(servNames!=null){
	   			$('#Form_answer_manage span.serviceNames',wraper).html(servNames.serviceName)
	   		}else{
	   			$('#Form_answer_manage span.serviceNames',wraper).html('')
	   		}
	   		
	   });
}
//修改时赋值
function infoShow(wraper,item){ 
	//车系ids   
	if(item.modelIds.length==1&&item.modelIds[0].modelId =="0"){
	}else{
	$.each(item.modelIds,function(i,json){    
		var node = $("#brandsTree",wraper).tree('getNodeByParam','id',json.brandId); 
		var pNode = node.getParentNode();
		$("#brandsTree",wraper).tree('open',pNode,true); 
		$("#brandsTree",wraper).tree('open',node,true);  
	});  
    }	
	$("div[name='brands']",wraper).data("brandIds",item.modelIds);
    //车系名字显示
	var brandCheckString = [];
	if(item.modelNames!=undefined&&item.modelNames.length > 0){
	  $.each(item.modelNames,function(i){ 
		 if(item.modelNames[i].modelName!=undefined&&item.modelNames[i].modelName!=""){
			$.merge(brandCheckString,item.modelNames[i].modelName.split(",")); 
		 }else{
			brandCheckString.push(item.modelNames[i].brandName);
		 }
	   }); 
	}  
	$.unique(brandCheckString); 
	$("#brand_check_string",wraper).html("已选择："+brandCheckString.join(",")); 	   
   //地区
   var areaList = item.regions;
   $.each(areaList,function(i){
       if(areaList[i].areaList.length==0){
	    areaList[i].areaList=[{"areaCodeId":"0"}];
	   }
   });
   $("#Form_answer_manage div[name='regions']",wraper).data('areaList',areaList); 
   addAreaList(areaList,wraper);
} 
function updateInfo(id,wraper){ 
	 var item = $.jRadGet({url : '/shopmanage-ws/ws/0.1/modelQa/detail?modelQaId='+id}); 	 
	 $(".details-box .details-tab",wraper).find("span[name='title']").html("编辑问答"); 
	 initInfo(wraper);  
	 $('.jrad-table',wraper).slideUp();
	 $('.details-box',wraper).slideDown(); 
	 var servNames=$.jRadGet({url:'/shopmanage-ws/ws/0.1/service/getServiceNames?id='+item.serviceIds});
	 $('#Form_answer_manage span.serviceNames',wraper).html(servNames.serviceName);
	 $(".scroll-up-btn").click();  
	 item.modelQaId = id;
	 $('#Form_answer_manage',wraper).form({item: item}); 
	 infoShow(wraper,item); 
} 

 
function showAdsError(xhr){
	 var errormsg = eval("(" + xhr.responseText + ")");
	  var cDiv = $("#Wraper_answer_manage .cDiv");
	  $.jRadMessage({level:'error',message:errormsg[0].message,selector:cDiv});
}
</script>
