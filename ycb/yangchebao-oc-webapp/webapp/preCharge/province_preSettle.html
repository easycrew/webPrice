<div class="urlContentWraper" id="Wraper_provincePreSettle">
    <div class="ui-info-layout">
      <div class="cdiv">
           <h2 class="ui-tit"><strong>预付款结算列表</strong></h2>
           <table id="Table_provincePreSettle"></table>
      </div>
      <div class="sdiv" style="margin-top:10px;">
           <h2 class="ui-tit"><strong>结算详情</strong></h2>
           <table id="Table_province_preSettleDetail"></table>
      </div>
    </div>   
</div>
<script type="text/javascript">
$(document).ready(function(){
    var wraper = $('#Wraper_provincePreSettle');
    var page_column_model = new Array();
    var page_column_model_c = new Array();
    var page_list_buttons = new Array();
  	var entityModel = {};
    var jRad = $.jRad({app:'radsample-ws',entityModel:entityModel}); 
    var regions=eval('('+carsmart_config.regions+')');
    if(regions[0].provinceId==0 || (regions[0].provinceId!=0 && regions[0].areaCodeId!=0)){
      $('#Wraper_provincePreSettle').html('您不是省代理商，请到“预付款结算管理”查看相关信息！');
      return false
    };
    jRad.params['provinceCodeSearch'] = {
      urlData:{
        url:'/euc/ws/0.1/user/provinces?userId='+carsmart_config.userId
      },
      unshiftData: {id:'',name:'请选择'}
    };
    jRad.params['status'] = {data:[{id:'',name:'请选择'},{id:'0',name:'未转账'},{id:'1',name:'已转账'}]};

    page_column_model.push({display: 'ID', name : 'agentWithdrawId'});   
    page_column_model.push({display: '开户行', name : 'bankName'});
    page_column_model.push({display: '开户名', name : 'cardName'});
    page_column_model.push({display: '银行账户', name : 'cardNo'});
    page_column_model.push({display: '实际收入金额', name : 'realTransAmount'});
    page_column_model.push({display: '收款日期', name : 'transferDate'});
	

  	page_list_buttons.push({title: '导出Excel',displayname:'导出EXCEL',name:'excel', bclass: 'excel',onpress : function(){
          	var checked = $('#Table_provincePreSettle').getCheckedTrs();
          	$.jRadConfirm('确认导出？',1,function(){
          		
              window.open('/shopmanage-ws/ws/0.1/agentManager/exportCoopBusiDetai');
          	})
  		}
  	});
    page_list_buttons.push({separator: true});
    
    $('#Table_provincePreSettle').flexigrid({
            reload:true,
      			method:'get',
            colModel : page_column_model,
            buttons : page_list_buttons,
            searchitems :[],
            pagination: {
      				diaplay_pages: 5,
      				align: 'bottom' 
      			},
      			showSearch:true,  
            url:'/shopmanage-ws/ws/0.1/agentManager/coopBusiBillingStatic', //此时userId为当前登录用户的ID 
      			onError:showError, 
      			checkBoxType:'single',
      			overflow:true
,
			 trEvent:function(){		//监听行事件 
			 	var checked = $('#Table_provincePreSettle').getCheckedTrs();  
			 	$('#Table_province_preSettleDetail').flexOptions({ 
			 		extParam:{
			 			agentWithdrawId: checked[0].agentWithdrawId
			 		}
			 	}).flexReload()
			 }
    });
       sumMoney();
    function sumMoney(){
       $.jRadGet({
        url:'/shopmanage-ws/ws/0.1/agentManager/getTransAmount?agentUserId='+carsmart_config.userId,
        success:function(data){
          $('div.hDivBox:eq(0) th:eq(5) div',wraper).html('实际收入金额<br>（合计：'+data.transAmount+'元）');
        }
      })
    };
	page_column_model_c.push({display: '代理市', name : 'agentCityName',diy:function(item,$div){
      var str='';
      var area=item.agentCityName;
      $.each(area,function(i){
        //if(area[i].provinceName!=null && area[i].provinceName!=undefined){
        //  str += area[i].provinceName
        //}
        if(area[i].areaList!=null && area[i].areaList!=undefined){
          $.each(area[i].areaList,function(j){
            str += area[i].areaList[j].areaCodeName
          })
        }
        
      })
      $div.html(str)
    }});

  	page_column_model_c.push({display: '商家ID', name : 'busiId'});
  	page_column_model_c.push({display: '商家简称', name : 'busiRegName'});
  	page_column_model_c.push({display: '预付款支付', name : 'agentPayAmount'});
    page_column_model_c.push({display: '养车宝收取', name : 'ycbRecAmount'});
  	page_column_model_c.push({display: '省代理收取', name : 'parentRecAmount'});
    page_column_model_c.push({display: '购买时间', name : 'createDate'});
    page_column_model_c.push({display: '到期时间', name : 'coopEndDate'});


    $('#Table_province_preSettleDetail').flexigrid({
            reload:true,
            autoload: false,
      			method:'get',
            colModel : page_column_model_c,
            searchitems: [],
            pagination: {
      				diaplay_pages: 5,
      				align: 'bottom' 
      			},
      			showSearch:true,  
      			overflow:true,
            url:'/shopmanage-ws/ws/0.1/agentManager/coopBusiBillingDetails', 
      			onError:showError_2, 
      			checkBoxType:'single'
    });
  	function showError(xhr){
  		 var errormsg = eval("(" + xhr.responseText + ")"); 
  		 $.jRadMessage({level:'error',message:errormsg[0].message})
  	}
  	function showError_2(xhr){
  		 var errormsg = eval("(" + xhr.responseText + ")"); 
  		 $.jRadMessage({level:'error',message:'请预付款账号'})
  	}
});
</script>
