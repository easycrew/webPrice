<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<meta name="format-detection" content="telephone=no" />
<link type="text/css" href="css/index.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>  
<script type="text/javascript" src="js/jquery.json-2.2.js"></script>
<script type="text/javascript" src="js/index.js"></script> 
<style>
/* 理赔单详情 */
.posit-operation{position:fixed;bottom:0px;width:100%;height:43px;font-size:15px;}
.posit-operation span{float:left;text-align:center;line-height:43px;width:50%;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;background: #fff;}
.posit-operation .posit-left{color:#3F4968;background: #fff;}
.posit-operation .posit-right{color:#fff;background:#ff6e47;font-size:1.3em;}
.posit-operation .border-right{border-right:1px solid #f4f5f9;}
.order-detail-claims li{background:#fff;height:40px;line-height: 40px;border-bottom:1px solid #E4E6F1;font-size:15px;overflow: hidden;}
.order-detail-claims .nobord{border-bottom: none;}
.order-detail-claims .marg{margin-top: 10px;}
.order-detail-claims li span{-webkit-border-sizing:border-box;box-sizing:border-box;display:inline-block;vertical-align:middle;color:#3F4968;}
.order-detail-claims li span em{font-style: normal;}
.order-detail-claims li > span:first-child{padding-left:15px;width:33%;}
.order-detail-claims li > span:last-child{width:67%;}
.order-detail-claims li span a{float:right;padding:0 15px;border-left:1px solid #E4E6F1;}
img{vertical-align: middle;}
.bank-dialog-claims p{text-align: center;font-size:16px;line-height:30px;}
.bank-dialog-claims p span{margin-right:20px;}

.bank-dialog-claims .button-wrap{background-color: #fff;}
.bank-dialog-claims .content-claims{padding:20px 0;}

/* 选择付款方式 */
.dialog2{position: fixed;width: 100%;height: 100%; background-color: rgba(0,0,0,0.4);top:50%;bottom: 0;z-index:1000;margin-top:-220px;/**display: none;**/}
.dialog-content2{background-color: #fff;margin: 30px; position: relative;}
.dialog2 .title{font-size: 1.8em;text-align: center;height: 43px;line-height: 43px;border-bottom: 1px solid #fb451f;font-weight: normal;}
.dialog2 ul{width: 100%; -webkit-box-sizing:border-box;box-sizing:border-box; vertical-align: middle; height: 240px;overflow:auto;margin:10px 0;} 
.btn-wrap{ padding: 18px 0;border-top: 1px solid #fb451f;}
.dialog-btn{ width:100px;margin:0 auto;font-size: 1.6em;color: #fff;text-decoration: none;display: block; background-color: #fb451f;height: 30px;line-height: 30px;text-align: center;}
.close {cursor: pointer;display: inline-block;height: 28px;position: absolute;right: 10px;top: 5px;width: 28px;z-index: 10;}
.close label::before {border-right: 1px solid #fc5d3c;content: "";display: inline-block;height: 28px;transform: rotate(45deg);-ms-transform:rotate(45deg);   -moz-transform:rotate(45deg); -webkit-transform:rotate(45deg);  -o-transform:rotate(45deg); width: 1px;}
.close label::after {border-left: 1px solid #fc5d3c;content: "";display: inline-block;height: 28px;transform: rotate(-45deg);-ms-transform:rotate(-45deg);   -moz-transform:rotate(-45deg); -webkit-transform:rotate(-45deg);  -o-transform:rotate(-45deg); width: 1px;}
.close label {display: inline-block;margin-left: 10px;}
.pay-style{height:40px;line-height:40px;border-bottom:1px solid #d9d9e2;}
.pay-style span{float:left;}
.pay-style .sel{background-image: url("css/images/check.png");background-position: -19px center;background-repeat: no-repeat;background-size: 34px auto;width:15px;height:30px;margin:0.2em 1.5em;display: block; }
.pay-style .checked{background-position: 0 center;}
.zfb{margin-left: 5px;background-image: url("http://app.yangchebao.com.cn/group1/M00/0A/FA/ChUBl1VymuGAaFDRAAAMthS5nvg588.png");background-size: 58px auto;background-repeat: no-repeat;background-position:0 center;width:80px;height:36px;}
.wx{margin-left: 5px;background-image: url("http://app.yangchebao.com.cn/group1/M00/0A/FA/ChUBl1Vymx2AT9oYAAAJTkelqrs820.png");background-size: 71px auto;background-repeat: no-repeat;background-position:0 center;width:80px;height:37px;}
.pay-style label{font-size:1.2em;color:#a0a097;display: inline-block;height: 40px; line-height: 40px;border-left: 1px solid #d9d9e2;padding-left: 10px;}
.last-li{margin-top:10px;}
</style>
<title>理赔单详情</title> 
<body style="height:100%;">  
	<section class="order-detail-wrap"> 
		<article> 
			<ul class="order-detail-claims" id="orderDetail">
				<li>
					<span>客户手机号</span><span id="userMobile"></span>
				</li>
				<li class="nobord">
					<span>客户姓名</span><span id="username"></span>
				</li>

				<li class="marg">
					<span>理赔员</span><span class="clearfix"><em id="operatorName" ></em><a class="operatorMobile" href=""><img src="css/images/phone.png" width="22" height="22"></a></span>
				</li>
				<li class="nobord">
					<span>保险公司</span><span id="companyName"></span>
				</li>
				<li class="marg">
					<span>维修零件费</span><span id="partsPrice"></span>
				</li>
				<li>
					<span>维修工时费</span><span id="workPrice"></span>
				</li>
				<li class="last nobord">
					<span>合计</span><span id="sumPrice"></span>
				</li>
			</ul> 
			<div class="posit-operation clearfix">
				<span class="posit-left border-right"></span>
				<span class="posit-right" id="submit"></span>
			</div> 
		</article> 

	</section> 

	<article class="bank-dialog bank-dialog-claims" id="bank-confirm">
		<div class="content-claims">
			<p>若维修费有误，请呼叫理赔员修改。</p>
			<p><span>工时费</span><span id="workPrice2"></span></p>
			<p><span>零件费</span><span id="partsPrice2"></span></p>
			<p><span>合计</span><span class="org" id="sumPrice2"></span></p>
		</div>
		<div class="button-wrap">
			<span class="cancel">取消</span>
			<span class="submit org">确定</span>
		</div>
	</article>

	<div class="dialog2" style="display:none;">
		<div class="dialog-content2">
			<span class="close"><label></label></span>
			<h1 class="title">支付方式</h1>
			<ul>
				<li class="clearfix pay-style">	
						<span class="sel checked"></span>
						<span class="zfb"></span>
						<span class="pro-list"><label>需要拥有支付宝账号</label></span>
				</li> 
				<!-- <li class="clearfix pay-style last-li">
						<span class="sel"></span>
						<span class="wx"></span>
						<span class="pro-list"><label>需要开通微信钱包</label></span>
				</li> --> 
			</ul>
			<div class="btn-wrap"><a href="pay-success.html" class="dialog-btn">确定</a></div>
	    </div>
	</div>

	<div class="dialog-overlay" style="display:none;"></div>

	<script type="text/javascript">  
		$(document).ready(function(){
			index.init = function(userInfo,bridge){ 
	 			shopId = userInfo.shopAccountId; 
	 			qversion = userInfo.version||"";
			 	var orderNumber = (window.location.href.split("?")[1]).split("=")[1];  
			 	function getOrderDetail(shopId,orderNumber){  
					$.ajax({
						url: '/vip-app-ws/ws/0.1/orders/claimOrders?shopId='+shopId+'&orderNumber='+orderNumber,
						type: 'get',
						async: false,
						dataType: 'json',
						success: function(data) {
							var items = data.items;
							$.each(items,function(i){
								var item = items[i];  
								$("#userMobile").html(item.userMobile);
								$("#username").html(item.userName);
								$("#operatorName").html(item.operatorName);
								$(".operatorMobile").attr("href",'tel:'+item.operatorMobile);
								$("#companyName").html(item.companyName);
								$("#partsPrice").html(item.partsPrice+'元');
								$("#workPrice").html(item.workPrice+'元');
								$("#sumPrice").html(item.sumPrice+'元');
								if(item.status == 1){
									$('.posit-left').html('待支付')
									$('.posit-right').html('确认')
								}else if(item.status == 2){
									$('.posit-left').html('维修中')
									$('.posit-right').html('代客户支付')
								}else if(item.status == 3){
									$('.posit-left').html('已付款')
									$('.posit-right').html('123').attr("style","background:#fff")
								}else{
									$('.posit-left').html('已删除')
									$('.posit-right').html('456').attr("style","background:#fff")
								}
							})

			 				var claimsId = items[0].claimOrderId
							if($('.posit-right').html() == '确认'){
								$("#submit").click(function(){ 
					  				$("#bank-confirm").show(); 
					  			    $(".dialog-overlay").show();

					  			    $('#partsPrice2').html('¥'+items[0].partsPrice)
		    						$('#workPrice2').html('¥'+items[0].workPrice)
		    						$('#sumPrice2').html('&nbsp;&nbsp;&nbsp;&nbsp;'+'¥'+items[0].sumPrice)
					      		});
					      		
					      		$(".bank-dialog .cancel").click(function(){
					                $(this).parents(".bank-dialog").fadeOut();
					                $(".dialog-overlay").fadeOut();
					      		});

					      		$("#bank-confirm .submit").click(function(){
					      			$.ajax({
										url: '/vip-app-ws/ws/0.1/orders/confirmClaimOrders?shopId='+shopId+'&claimsOrderId='+claimsId,
										type: 'get',
										async: false,
										dataType: 'json',
										success: function(data) {
											if(data.result == 'success'){
						                		$(".bank-dialog").fadeOut();
						                		$(".dialog-overlay").fadeOut();
									 			location.reload()
											}else{
												$('.content-claims').html('');
							      				$('.content-claims').append($('<p>').html('该订单状态已变更！').attr('style','line-height:50px;'))
							      				$("#bank-confirm .submit").click(function(){
							                		$(this).parents(".bank-dialog").fadeOut();
							                		$(".dialog-overlay").fadeOut();
								    				$(".tab-wrap:first").show();
									 				location.reload()
							      				})
							      				$("#bank-confirm .cancel").click(function(){
							                		$(this).parents(".bank-dialog").fadeOut();
							                		$(".dialog-overlay").fadeOut();
							      				})
											}
										}
									})
			      				});
		    					return; 
				      		}
				      		
				      		if($('.posit-right').html() == '代客户支付'){
				      			$("#submit").click(function(){ 
								    var arr = qversion.split('.')  
					 				var arr0 = arr[0]
					 				var arr1 = arr[1]
					 				var arr2 = arr[2]
							 		if(arr0 > 1 || arr1 > 2 || arr2 > 0){
					 					$(".dialog2").show(); 
						    			$(".dialog-overlay").show();
										$(".dialog2").on('click','li',function(){
									        $('.sel').removeClass('checked')
									        $(this).children(".sel").addClass('checked');
									        if($('.sel').eq(0).hasClass("checked")){
												$('.dialog-btn').attr("href","http://w2l/?presentType=1&androidName=7&iosName=MyWebViewController&claimOrderId="+claimsId+"&orderChannel=claimsOrder&payChannelKey=2")
											}else{
												$('.dialog-btn').attr("href","http://w2l/?presentType=1&androidName=7&iosName=MyWebViewController&claimOrderId="+claimsId+"&orderChannel=claimsOrder&payChannelKey=1")
											}
									    }); 
								        if($('.sel').eq(0).hasClass("checked")){
											$('.dialog-btn').attr("href","http://w2l/?presentType=1&androidName=7&iosName=MyWebViewController&claimOrderId="+claimsId+"&orderChannel=claimsOrder&payChannelKey=2")
										}else{
											$('.dialog-btn').attr("href","http://w2l/?presentType=1&androidName=7&iosName=MyWebViewController&claimOrderId="+claimsId+"&orderChannel=claimsOrder&payChannelKey=1")
										}
										$('.close').click(function(){
											$('.dialog2').fadeOut()
						    				$(".dialog-overlay").fadeOut();
									        $('.sel').removeClass('checked')
									        $('.sel').eq(0).addClass('checked')
										})
										return
					 				}
					 				else{
					 					alertRe('需更新到最新版本，才能代客户支付。','提示')
					 				}
					 			})
				      		}
						},
						error:function(xhr){
							alertRe("获取数据失败");
						}
					}); 
			 	} 
			 	getOrderDetail(shopId,orderNumber);
		 	};

		}); 

	 	function androidFun(flag){
	 		if(bIsAndroid()){
	 			if(flag){ 
			 		android.setPullMode(0x1); 
			 	}else{ 
			 		android.setPullMode(0x0);
			 	}
		 	}
	 	}
	 
	</script>  
</body>

</html>

