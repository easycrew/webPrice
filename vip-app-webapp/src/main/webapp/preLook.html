<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<link type="text/css" href="css/index.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script> 
<script type="text/javascript" src="js/jquery.json-2.2.js"></script> 
<script type="text/javascript" src="js/index.js"></script>  
<title></title>
<style>
body,html{
	min-height:100%;
	background-color: #fff;
}
.btnn{
	height:2.0em;
	line-height:2.0em;
	margin: 1.2em 8em;
}
.info{height:31px;line-height:31px;text-align: center;font-size:14px;color:#fff;background: #6EAADE;}
.feedback-textarea p{font-family:"STHeitiSC-Medium"; font-size:1.4em; color:#707C92; line-height:20px}
.tuhao{max-width:100%;background: url(css/images/tuhao.png) 0 0 no-repeat;}
</style>
<body>
	<section class="feedback-wrap"> 
		<p class="info">此代金券为您店铺专属代金券，养车宝不予结算</p>
		<div class="feedback-textarea">
			<div class="tuhao"><span>10元代金券</span></div>
			<p class="canbay">可用于购买：<span></span></p>
			<div class="vou-div">
				<p class="vou-left">代金券名称</p>
				<p class="vou-right"></p>
				<p class="vou-left">代金券数量</p>
				<p class="vou-right"></p>
				<p class="vou-left">代金券金额</p>
				<p class="vou-right"></p>
				<p class="vou-left">使用有效期</p>
				<p class="vou-right"></p>
				<p class="vou-left">代金券详情</p>
				<p class="vou-right"></p>
			</div>
			<a href="javascript:void(0)" class="btnn" id="submit">确定并分享</a>
			<p style="margin-top:15px"><strong>说明：</strong></p>
			<p>1、此代金券为您店铺专属代金券，养车宝不予结算；</p>
			<p>2、代金券仅支持您选择分享的服务;</p>
			<p>3、代金券当前支持服务为：洗车-人工普洗-轿车。</p>
		</div>
		<div class="">
		</div>
	</section> 
	<script type="text/javascript"> 
		$(document).ready(function(){ 
				var url =decodeURI(window.location.href);  
				var paramsArr = (url.split("?")[1]).split("&");
				var data = {};
				$.each(paramsArr,function(i){
					var item = paramsArr[i].split("=");
					data[item[0]] = item[1];
				});
				var serviceId = data.serviceId
				var serviceName = data.serviceName
				var reservePrice = data.reservePrice
				alert(serviceName)
				$("title").html(serviceName)

				// var page = 0,pagesize=10,shopAccountId="-1",response="1"; 
			 // 	function getFeedBacks(id,pageindex,pagesize,owraper){   
				// 		$.ajax({
				// 			url: '/vip-app-ws/ws/0.1/feedback/queryFeedBacks?shopAccountId='+id+'&pageindex='+pageindex+'&pagesize='+pagesize,
				// 			type: 'get',
				// 			async: false,
				// 			dataType: 'json',
				// 			success: function(data) {  
				// 			   page++; 
				// 			   var items = data.items;
				// 			   var str = "";
				// 			   $.each(items,function(i){
				// 			   		var item = items[i];
				// 		   			var reply = "";
				// 		   			if(item.feedBackReplyId!=undefined){
				// 						reply = "reply-flag";
				// 					}
				// 			   		str +='<li feedBackId='+ item.feedBackId +' class="'+ reply +'">'
				// 						+'<p class="info wrap">'+ item.remarks +'</p>'
				// 						+'<p class="time">'+ item.createDate +'</p>'
				// 						+'</li>' ;
				// 			   });
				// 			   if(owraper!=undefined){ 
				// 					$("#feedbackList").next('.null-tip').remove();
				// 					$("#feedbackList").html(str);  
				// 					if(str==""){
				// 						$("#feedbackList").after('<p class="null-tip">您还没有提交反馈哦！</p>'); 
				// 					}  
				// 				}else{
				// 					$("#feedbackList").append(str);
				// 				} 
				// 			   if(data.page == data.totalPages-1){
				// 					response = "0";
				// 			   } 
				// 			},
				// 			error:function(xhr){
				// 				alertRe("获取数据失败");
				// 			}
				// 		}); 
				// }  
				function doReply(){ 
			 		var remarks = $("#remark").val();
			 		if($.trim(remarks)==""){
			 			alertRe("代金券详情不能为空！");
			 			return false;
			 		}
			 		if($.trim($(".name").val())==""){
			 			alertRe("代金券名称不能为空！");
			 			return false;
			 		}
			 		if($.trim($(".num").val())==""){
			 			alertRe("代金券数量不能为空！");
			 			return false;
			 		}
			 		if($.trim($(".price").val())==""){
			 			alertRe("代金券价格不能为空！");
			 			return false;
			 		}
			 		if($.trim($(".day").val())==""){
			 			alertRe("有效期不能为空！");
			 			return false;
			 		}

			 		var postData = {};
			 		postData.shopAccountId = shopAccountId;
			 		postData.serviceId = data.serviceId;
			 		postData.voucherTopic = $(".name").val();
			 		postData.issuanceNum = $(".num").val();
			 		postData.money = $(".price").val();
			 		postData.validDays = $(".day").val();
			 		postData.illustrate = remarks;
			 		postData.publisher = publisher;
			 		postData.reservePrice = data.reservePrice;
			 		postData.serviceName = data.serviceName;
					$.ajax({
						url: '/vip-app-ws/ws/0.1/voucherVip/addVoucherTopicToService',
						contentType : "application/json;charset=utf-8",
						dataType : "json",
						type : "POST",
						data : $.toJSON(postData),
						async : false,
						success: function(data) {   
						},
						error:function(xhr){  
							if(xhr.status=="200"){ 
								$("#remark").removeClass("on").val("用的不爽，吐槽两句...");
								getFeedBacks(shopAccountId,0,10,"html"); 
							}else{
								alertRe("获取数据失败。"); 		
							}
						}
					}); 
			 	}
				index.init = function(userInfo,bridge) {
					shopAccountId = userInfo.shopAccountId;
					publisher = userInfo.operatorName;
					$("textarea").focus(function(){ 
			 		$(this).addClass("on"); 
				 		if($(this).val()=="用的不爽，吐槽两句..."){
				 			$(this).val("");
				 		} 
				 	});
				 	$("textarea").blur(function(){  
				 		if($(this).val()==""){
				 			$(this).removeClass("on").val("用的不爽，吐槽两句..."); 
				 		} 
				 	}); 
				 	$("#submit").on('click',function(){
				 		doReply();
				 	});
				 	var path = getPath();
				 	$("#feedbackList").on('click','li',function(){ 
				 		var feedBackId = $(this).attr("feedBackId"); 
				 		window.location.href = "http://w2nw?"+path+"/feedback-detail.html?feedBackId="+feedBackId; 
				 	});  
				 	getFeedBacks(shopAccountId,0,10,"html");
					return response;
			};
			index.pullUpRefresh = function(bridge) {  
				getFeedBacks (shopAccountId,page,pagesize); 
				return response;
			};
		 
		});   
	</script>  
</body>

</html>

