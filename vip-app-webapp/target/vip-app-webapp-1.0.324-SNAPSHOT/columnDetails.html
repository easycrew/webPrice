<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
		<meta content="yes" name="apple-mobile-web-app-capable"/>
		<meta name="format-detection" content="telephone=no" />
		<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
		<link type="text/css" href="css/index.css" rel="stylesheet"/>
		<link rel="stylesheet" type="text/css" href="css/ycbmall/exclusive.css"/>
		<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="js/jquery.dotdotdot.min.js" ></script>
		<script src="js/jquery.urlParam.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="js/jquery.json-2.2.js"></script>
		<script type="text/javascript" src="js/index.js"></script>
		<title>个人中心</title>
		<style>
			html{
				font-size: 62.5%;
			}
		</style>
	</head>
	<body style="width: 100%;">
		<section class="top-head-wrap">
			<div class="title">
				<img src="css/ycbmall/images/exclive-tbg.png"/>
				<label>安全产品</label>
			</div>
		</section>
		<section class="content-wrap">
			<div class="goodsList">
				<ul class="goodsItem" id="goodsItem">
					
				</ul>
			</div>			
		</section>
		<script type="text/javascript">
			$(document).ready(function(){
				var userInfo_={};
				var isShowUnavailable=0,page=0,pagesize="20",response='1',commodityType='3';
				var columnName=$.getQuery('columnName')
				,columnId=$.getQuery('exclusiveColumnId');
				function getcolunmName(columnName){
					$(".top-head-wrap label").html(columnName);
				}
				function getGoodsList(userInfo,owraper){
					var postData={},length=0;
					var path =window.location.href; 
					if(path.indexOf("?")>-1){
						path = path.split("?")[0];
					}
				 	path = getPath2(path);
				 	function getPath2(path){
						var arr = path.split("/");
						var length = arr.length;
						arr.splice(length-1);
						return arr.join("/");
					}
					postData.userInfoId=userInfo.userId;
					postData.areaCodeId=userInfo.areaCodeId;
					postData.commodityType=commodityType;
					postData.columnId=columnId;
					postData.pageindex=page;
					postData.pagesize=pagesize;
					postData.isShowUnavailable=isShowUnavailable;
					$.ajax({
						type:"get",
						url:"/ycbmall-app-ws/ws/0.1/commodity/queryCommodities",
						async:false,
						data:postData,
						dataType:'json',
						success:function(data){
							page++;
							var str='',items=data.items;
							$.each(items, function(i) {
								str+='<li commodityId="'+this.commodityId+'" skuId="'+this.skuId+'">'+
									'<div class="item-l">'+
										'<img src="'+this.picUrl+'">'+
									'</div>'+
									'<div class="item-r">'+
										'<span class="Wraper">'+this.name+'</span>'+
									'</li>'
							});
							if(owraper!=undefined&&owraper!=""){
								$("#goodsItem").next('.null-tip').remove();
								if(str==""){
									showEmpty("暂无该类产品");
								}else{
									$("#goodsItem").html(str);
								}
							}else{
								$("#goodsItem").append(str);
							}
							if(data.page>=data.totalPages-1){
								response="0";
							}
							if(bIsAndroid()){
								$(".overlay-containter").css("min-height",$(window).height()-178);  
							}else{
								$(".overlay-containter").css("min-height",$(window).height()-130);  
							}
						},
						error:function(xhr){
							var error=eval('('+xhr.responseText+')');
							window.location.href = encodeURI("http://w2l?"+path+"/checkcode-error.html?message="+mes[0].message);
						}
					});
					$(".Wraper").dotdotdot();//多余字符省略号显示
					var imgElem=$("#goodsItem li .item-l img");
					var img_width=imgElem.eq(0).width();
					imgElem.height(img_width);
					return response;
				}
				
				index.init=function(userInfo,bridge){
					userInfo_=userInfo;
					var path=getPath();
					getcolunmName(columnName);
					$("#goodsItem").delegate('li','touchstart click touched',function(e){
						var that=this;
						var home=path;
						switch(e.type){
							case 'touchstart': break;
							case 'click':
								var commodityId=$(that).attr("commodityId");
								var skuId=$(that).attr("skuId");
								window.location.href='http://w2nw?'+path+'/goodsDetails.html?skuId='+skuId;
								break;
						}
					});
					getGoodsList(userInfo,"html");
					return response;
				}
				index.pullUpRefresh=function(bridge){
					getGoodsList(userInfo_,"");
					return response;
				}
			})
		</script>
	</body>
</html>
