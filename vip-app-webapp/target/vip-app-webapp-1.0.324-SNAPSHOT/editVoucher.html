<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<link type="text/css" href="css/index.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script> 
<script type="text/javascript" src="js/jquery.json-2.2.js"></script> 
<script type="text/javascript" src="js/index.js"></script>  
<title></title>
<style>
body,html{
	min-height:100%;
	background-color: #fff;
}
.feedback-textarea input{
	background-color:#ffffff;
	-webkit-border-radius:4px;
	border-radius:4px;
	border:1px #a3aecd solid;
	/*color:#cfd1db;*/
	font-family:'华文细黑','HelveticaNeue-Light';
	font-size:1.5em;
	padding:0.53em;
	width:100%;
	height:2.5em;
	line-height:2.5em;
	-webkit-box-sizing:border-box;
	box-sizing:border-box;
	margin-bottom:1em;
}
.btnn{
	height:2.0em;
	line-height:2.0em;
	margin: 1.2em 8em;
}
.info{height:31px;line-height:31px;text-align: center;font-size:14px;color:#fff;background: #6EAADE;}
.feedback-textarea p{font-family:"STHeitiSC-Medium"; font-size:1.4em; color:#707C92; line-height:20px}
.tuhao{text-align: center;}
.tuhao img{width:100%;border:none;vertical-align:middle;}
.tuhao p{text-align: center;}
.tuhao span{display:block;font-size:2.5em;color:#fff;font-weight: bold;margin-top:-63px;}
.canbay{margin:60px auto 15px;}
.canbay span{font-size:1.6em;}
.vou-table{border:1px solid #a3aecd;border-collapse: collapse;margin-bottom:30px;width:100%;}
.vou-table td{border:1px solid #a3aecd;padding:0.7em 1em;font-size:14px;}
</style>
<body>
	<section class="feedback-wrap"> 
		<p class="info">此代金券为您店铺专属代金券，养车宝不予结算</p>
		<div class="feedback-textarea">
			<div class="status-edit">
				<input class="name" maxlength="16" placeholder="代金券名称（例:养车宝30元洗车券）">
				<input class="num" maxlength="5" placeholder="代金券数量（整数）">
				<input class="price" maxlength="3" placeholder="代金券金额（元）">
				<input class="day" maxlength="4" placeholder="有效期（天）">
				<textarea id="remark" class="on" maxlength="100" placeholder="代金券详情&nbsp;&nbsp;&nbsp;&nbsp;例：亲们，为答谢您对本店的大力支持，免费向本店服务过的用户发放代金券啦！"></textarea>
			</div>
			<a href="javascript:void(0)" class="btnn" id="submit1">下一步</a>
			<div class="status-show" style="display:none;">
				<div class="tuhao">
					<img src="css/images/tuhao.png">
					<p><span></span></p>
				</div>
				<p class="canbay"><span></span></p>
				<div class="vou-div">
					<table class="vou-table">
						<tbody>
							<tr>
								<td width="35%" align="middle">代金券名称</td>
								<td width="65%"class="voucherTopic"></td>
							</tr>
							<tr>
								<td width="35%" align="middle">代金券数量</td>
								<td width="65%"class="issuanceNum"></td>
							</tr>
							<tr>
								<td width="35%" align="middle">代金券金额</td>
								<td width="65%" class="money"></td>
							</tr>
							<tr>
								<td width="35%" align="middle">使用有效期</td>
								<td width="65%" class="validDays"></td>
							</tr>
							<tr>
								<td width="35%" align="middle">代金券详情</td>
								<td width="65%" class="illustrate"></td>
							</tr>
						<tbody>
					</table>
				</div>
			</div>
			<a href="javascript:void(0)" class="btnn" id="submit2" style="display:none;">确认并分享</a>

			<p style="margin-top:15px"><strong>说明：</strong></p>
			<p>1、此代金券为您店铺专属代金券，养车宝不予结算；</p>
			<p>2、代金券仅支持您选择分享的服务;</p>
			<p>3、代金券当前支持服务为：<span class="serviceName"></span>。</p>
		</div>
		<div class="">
		</div>
	</section> 
	<script type="text/javascript"> 
		$(document).ready(function(){ 
				var response = 1;
				var url =decodeURI(window.location.href);  
				var paramsArr = (url.split("?")[1]).split("&");
				var data = {};
				$.each(paramsArr,function(i){
					var item = paramsArr[i].split("=");
					data[item[0]] = item[1];
				});
				
				var serviceId = data.serviceId
				var serviceName = data.serviceName
				var reservePrice = data.reservePrice

				$("title").html(serviceName);
				$(".serviceName").html(serviceName);

				function doReply(){ 
			 		if($.trim($(".name").val())==""){
			 			alertRe("代金券名称不能为空！");
			 			return false;
			 		}
			 		if($.trim($(".num").val())==""){
			 			alertRe("代金券数量不能为空！");
			 			return false;
			 		}
			 		if($.trim($(".price").val())==""){
			 			alertRe("代金券价格不能为空！");
			 			return false;
			 		}
			 		if($.trim($(".day").val())==""){
			 			alertRe("有效期不能为空！");
			 			return false;
			 		}
			 		var remarks = $("#remark").val();
			 		if($.trim(remarks)==""){
			 			alertRe("代金券详情不能为空！");
			 			return false;
			 		}

			 		var postData = {};
			 		postData.shopAccountId = shopAccountId;
			 		postData.serviceId = data.serviceId;
			 		postData.voucherTopic = $(".name").val();
			 		postData.issuanceNum = $(".num").val();
			 		postData.money = $(".price").val();
			 		postData.validDays = $(".day").val();
			 		postData.illustrate = remarks;
			 		postData.publisher = publisher;
			 		postData.reservePrice = data.reservePrice;
			 		postData.serviceName = data.serviceName;
					$.ajax({
						url: '/vip-app-ws/ws/0.1/voucherVip/addVoucherTopicToService',
						contentType : "application/json;charset=utf-8",
						dataType : "json",
						type : "POST",
						data : $.toJSON(postData),
						async : false,
						success: function(data) {  
							$(".status-show").slideDown();
							$(".status-edit").slideUp();
							$(".tuhao span").html(data.money+'代金券');
							$(".canbay span").html('可用于购买：'+data.serviceName);
							$(".serviceName").html(data.serviceName);
							$(".voucherTopic").html(data.voucherTopic);
							$(".issuanceNum").html(data.issuanceNum);
							$(".money").html(data.money);
							$(".validDays").html(data.validDays);
							$(".illustrate").html(data.illustrate);
							if($(".status-show").slideDown()){
								$("#submit2").show();
								$("#submit1").hide();
							}else{
								$("#submit1").show();
								$("#submit2").hide();
							}
							return data;
						},
						error:function(xhr){
	                        var errormsg = eval("(" + xhr.responseText + ")"); 
	                        if (errormsg != undefined){
								alertRe(errormsg[0].message); 	
	                        }		
						}
					}); 
			 	}
				index.init = function(userInfo,bridge) {
					var path = getPath();
					shopAccountId = userInfo.shopAccountId;
					publisher = userInfo.userId;
				 	$("#submit1").on('click',function(){
						doReply();
					});
					$("#submit2").on('click',function(){
				 		window.location.href = "http://w2nw?"+path+"/vou-share.html?serviceId="+serviceId+'&serviceName='+serviceName+'&reservePrice='+reservePrice
						return response;
					});
					// if($(".btnn").html() == "确认并分享"){
					// 	$("#submit").on('click',function(){
					// 		alert("123")
					//  		window.location.href = "http://w2nw?"+path+"/vou-share.html?serviceId="+serviceId+'&serviceName='+serviceName+'&reservePrice='+reservePrice
					// 		return response;
					// 	});
					// }
				};
		 
		});   
	</script>  
</body>

</html>

