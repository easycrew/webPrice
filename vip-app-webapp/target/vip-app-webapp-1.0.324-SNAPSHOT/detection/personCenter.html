<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<link type="text/css" href="../css/index.css" rel="stylesheet"/>
<script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script> 
<script type="text/javascript" src="../js/index.js"></script> 
<title>个人信息</title>
<style type="text/css">
	body{
		font-size: 62.5%;
	}
	li>span{
		display: inline-block;
		width: 100%;
		height: 1.7rem;
	}
</style>
</head>
<body>
	<section>
		<div class="personDetails">
			<ul>
				<li class="left"><img src="../css/images/person-portrait.png" /></li>
				<li class="center"><span class="name">Ralidls</span></li>
				<li class="right">身份认证<span>[</span><span class="job">检测技师</span><span>]</span></li>
			</ul>
		</div>
	</section>
	<section> 
		<ul class="person-center">
			<li><a href="javascript:void(0)" id="feedback"><i class="icon-feedback"></i><span>问题反馈</span></a></li>
			<li><a href="javascript:void(0)" id="about-us"><i class="icon-about"></i><span><span><span>关于我们</span></a></li>
			<li><a href="javascript:void(0)" id="login"><i class="icon-switch"></i><span><span>账户切换</span></a></li> 
		</ul>
	</section>
	<script type="text/javascript">
		$(document).ready(function(){
			function getPrivilege(userInfo){
				$.ajax({
					type:"get",
					url:"/ycbmall-app-ws/ws/0.1/user/getUserPrivilege",
					async:false,
					data:{userInfoId:userInfo.userId},
					dataType:'json',
					success:function(data){
						console.log(data);
						if(data.isExclusive){
							$(".store-4s").show();
						}
					}
				});
			}
			function getPath2(path){
					var arr = path.split("/");
					var length = arr.length;
					arr.splice(length-1);
					return arr.join("/");
			}
	    	function getMsg(id,atomic){   
				$.ajax({
					url: '/vip-app-ws/ws/0.1/common/getPersonalBaseCount?shopAccountId='+id+"&"+atomic,
					type: 'get',
					async: false,
					dataType: 'json',
					success: function(data) {   
					 	if(data.messageCount>0){
					 		$("#msg-center").append('<span class="flag"></span>');
					 	}
					 	if(data.feedBackCount>0){
					 		$("#feedback").append('<span class="flag"></span>');
					 	}
					},
					error:function(xhr){
						alertRe("获取数据失败");
					}
				}); 
		 	}  	
		 	function creatUser(shopAccountId,atomic){    
				$.ajax({
					url: '/vip-app-ws/ws/0.1/userMember/shop/isAbledToCreateMember?shopAccountId='+shopAccountId+"&"+atomic,
					type: 'get',
					async: false,
					dataType: 'json',
					success: function(data) {   
					 	 if(data.isAbled=="1"){//是否可以创建会员：0.否 1.是
						 	 $("#regist").parents("li").show();
						 }
					},
					error:function(xhr){   
                    	var mes = eval('('+xhr.responseText+')');  
						alertRe("获取数据失败");
					}
				}); 
		 	}
		 	function getEmployeeInfo(userInfo){
		 		$.ajax({
		 			type:"get",
		 			url:"/vip-app-ws/ws/0.1/common/getEmployeeInfo",
		 			async:false,
		 			data:{userId:userInfo.userId},
		 			dataType:'json',
		 			contentType:'application/json;charset=utf-8',
		 			success:function(data){
		 				$(".personDetails li.center span.name").html(data.name);
		 				$(".personDetails li.right span.job").html(data.roleName);
		 			},
		 			error:function(xhr){
		 				var error=eval('('+xhr.responseText+')');
						alertTasat(error[0].message);
		 			}
		 		});
		 	}
		 	
		 	//暂时不用
		 	function sureBtn(){
		 		var turnUrl=''
		 		if(bIsAndroid()){
		 			turnUrl="http://d.yangchebao.com.cn/bd/";
		 		}else{
		 			turnUrl="https://itunes.apple.com/us/app/yang-che-bao-shang-jia-ban/id937183920?mt=8";
		 		}
		 		window.open(turnUrl,'_blank');
		 	}
		 	//暂时不用
			index.init = function(userInfo,bridge) {
				//fBrowserRedirect();
				getEmployeeInfo(userInfo);
				getPrivilege(userInfo);
				userInfo.version = userInfo.version||"";
				$(".order-more").click(function(){
		 			var version=userInfo.version.replace(/\./g,'');
		 			if(version<130){
			 			alertRe("使用该功能需要更新升级至最新版本，重新打开客户端将提示您升级。",'');
			 			return false
		 			}else{
						window.location.href="http://w2l/?presentType=1&androidName=6&iosName=MyPayOrderListViewController&orderStatus=0";
					}
	 			});
				$(".order ul.order-ul li").on('click',function(){
		 			var version=userInfo.version.replace(/\./g,'');
		 			if(version<130){
			 			alertRe("使用该功能需要更新升级至最新版本，重新打开客户端将提示您升级。",'');
			 			return false
		 			}else{
						var thisClass=$(this).attr('class');
						var orderStatus='';
						switch(thisClass){
							case "paymenting":
							orderStatus=1;break;
							case "goods-receipt":
							orderStatus=2;break;
							case "finish":
							orderStatus=3;break;
							default:
							orderStatus='';break;
						}
						window.location.href="http://w2l/?presentType=1&androidName=6&iosName=MyPayOrderListViewController&orderStatus="+orderStatus;
					}
				})
				$(".store-4s ul li").on('click',function(){
					var url =window.location.href; 
					var urlParams={},path=url,id;
					if(url.indexOf("?")>-1){
						urlParams = (url.split("?")[1]).split("&");
						path = url.split("?")[0];
					}
				 	path = getPath2(path);
				 	path=path.replace('/detection','');
				 	alert(path)
				 	id=$(this).attr("id");
			 		window.location.href="http://w2nw?"+path+"/"+id+".html";
				})
				userInfo.userId = userInfo.userId||"";
		 		userInfo.osInfo = userInfo.osInfo||"";
		 		userInfo.version = userInfo.version||"";
		 		userInfo.imei = userInfo.imei||"";
		 		userInfo.deviceToken = userInfo.deviceToken||"";
				var atomic ="userId="+userInfo.userId+"&osInfo="+userInfo.osInfo+"&version="+userInfo.version+"&imei="+userInfo.imei+"&deviceToken="+userInfo.deviceToken;
				getMsg(userInfo.shopAccountId,atomic); 
				creatUser(userInfo.shopAccountId,atomic);
				var url =window.location.href; 
				var urlParams={},path=url;
				if(url.indexOf("?")>-1){
					urlParams = (url.split("?")[1]).split("&");
					path = url.split("?")[0];
				}
				var path=getPath();
			 	path = getPath2(path);
			 	var as = $(".person-center a");
			 	$.each(as,function(){ 
			 		var id = $(this).attr("id");
			 		if(id=='shop'){
			 			return;
			 		}
			 		if(id=="login"){
		 				$(this).attr("href","http://w2l?login");
			 		}else{
				 		$(this).attr("href","http://w2nw?"+path+"/"+id+".html");
				 	}
			 	}); 
				return "0";
				
		} 
		});

	</script>
</body>

</html>

