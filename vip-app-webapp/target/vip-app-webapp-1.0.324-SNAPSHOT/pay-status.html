<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<meta name="format-detection" content="telephone=no" />
<link type="text/css" href="css/index.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>  
<script type="text/javascript" src="js/jquery.json-2.2.js"></script>
<style>
.title{
	text-align:center;
}
.title h1{ 
	display:inline-block; 
	color:#FF6E47;
	padding-left:58px; 
	margin:45px auto 40px;  
	background-repeat: no-repeat;
	background-size: 48px auto;
	font-size:1.8em;
	font-weight:normal; 
	text-align: left;
}
.apply-success .title h1{ 
	background-image:url('css/images/paySuc.png');
}
.apply-error .title h1{ 
	background-image:url('css/images/payFail.png');
}
.title h1 span{
	display:inline-block; 
	line-height:150%;
	font-size: 0.83em;
	color:#A2A2A2;
}
.line{
	border-top:1px solid #D9D9E2;
	margin:15px 30px;
}
p.pay-after span{
    display: inline-block;
    padding: 0.5em 0;
    width: 42%;
    color: #fff;
    font-size: 1.8em;
    background-color: #A3AECD;
    -webkit-border-radius: 6px;
    -moz-border-radius: 6px;
    border-radius: 6px;
    margin-top: 1.8em;
    cursor: pointer;
}
p.pay-after span.pay-look{
    margin-left:6%;
    background-color: #FF6E47;
}
.comment{
  font-size: 1.4em;
  color: #A3AECD;
  margin:40px 25px;
  background-color: #fff;
  border: 1px solid #A3AECD;
  border-radius: 5px;
  padding:18px;
  position: relative;
  list-style: decimal inside;
  position: relative;
  margin-bottom: 64px;
} 
.comment li:last-child{
  position: absolute;
  list-style: none;
  color: #fff;
  width: 70px;
  height: 25px;
  line-height: 25px;
  text-align: center;
  border-radius: 12px;
  background-color: #A3AECD;
  top: -12px;
  left: 10px;
}
</style>
<title>支付成功</title> 
<body style="height:100%;">  
	<section class="apply-success"> 
		<article> 
			<div class="title">
				<h1>恭喜土豪!<br><span>您已经成功付款</span></h1>
				<p class="line"></p>
				<p class="pay-after"><span class="pay-colse">关闭</span><span class="pay-look">查看理赔单详情</span></p>
			</div> 
			<ol class="comment">
			    <li>获得结算金额xxx元，已添加到账户额；</li>
			    <li>详情请到个人中心或电脑后台查看。</li>
			    <li>注意</li>
			</ol>
		</article> 
	</section>  
	<section class="apply-error"> 
		<article> 
			<div class="title">
				<h1>支付失败!<br><span>钱没花出去郁闷</span></h1>
				<p class="line"></p>
				<p class="pay-after"><span class="pay-colse">关闭</span><span class="pay-look">重新支付</span></p>
			</div> 
			<ol class="comment">
			    <li>若超过支付限额支付失败，请拨打养车宝客服电话400-607-1222咨询。</li>
			    <li>注意</li>
			</ol>
		</article>  
	</section>
	<script type="text/javascript">  
		var orderId;
		$(document).ready(function(){ 
 			index.init = function(userInfo,bridge) {   
			    var url =window.location.href; 
				var paramsArr = (url.split("?")[1]).split("&");
				var paramJson = {};
				$.each(paramsArr,function(i){
					var item = paramsArr[i].split("=");
					paramJson[item[0]] = item[1];
				});  

			 	orderId = paramJson.orderId;  
				if(paramJson.orderListType!=""){
				  $("#reserveContent").show();
				}
			    $("#reserveTime").mobiscroll().datetime({
		            theme: "bootstrap",     // Specify theme like: theme: 'ios' or omit setting to use default 
		            mode: "scroller",       // Specify scroller mode like: mode: 'mixed' or omit setting to use default 
		            display: "model", // Specify display mode like: display: 'bottom' or omit setting to use default 
		            lang: "zh",       // Specify language like: lang: 'pl' or omit setting to use default
		            minDate:new Date(),  // More info about minDate: http://docs.mobiscroll.com/2-13-2/datetime#!opt-minDate
		            //maxDate: new Date(2014,7,30,15,44),   // More info about maxDate: http://docs.mobiscroll.com/2-13-2/datetime#!opt-maxDate
		            dateFormat: 'yy-mm-dd',
		            onSelect: function() {
		             	androidFun(true);
		             	upDate();
		            },
		            onCancel: function() {
		            	androidFun(true);
		            },
		            onShow:function(){
		            	androidFun(false);
		            },
		            stepMinute: 5  // More info about stepMinute: http://docs.mobiscroll.com/2-13-2/datetime#!opt-stepMinute
		        });
				$("#cancel").on('click',function(){
					confirmRe("确定要删除订单吗？",cancelOrder);
				});
			 	function getOrderDetail(id){  
					$.ajax({
						url: '/vip-app-ws/ws/0.1/orders/detail?orderId='+id,
						type: 'get',
						async: false,
						dataType: 'json',
						success: function(data) {   
							if(data.reserveDate!=""){
								$("#rtime").html(data.reserveDate);
								$(".date-wrap .btnn").html("修改预约时间");
							}else{
								$("#rtime").html("未预约");
								$(".date-wrap .btnn").html("输入预约时间");
							}
							if(data.paid=="0"){
								data.paid = "当面付款";
							}else if(data.paid=="1"){
								data.paid = "已线上支付";
							}
							var _parent = $("#orderDetail"); 
							$("#serviceName",_parent).html(data.serviceName);
							$("#paid",_parent).html(data.paid);
							$("#idlePrivStatusDesc",_parent).html(data.idlePrivStatusDesc);
							$("#reservePrice",_parent).html("¥"+data.reservePrice); 
							if(data.isCounPay=="0"){
							$("#payPrice",_parent).html("¥"+data.payPrice);
							}else{
							$("#payPrice",_parent).html("¥"+data.couponCashPrice);
							}
							$("#discount",_parent).html("¥"+data.discount);
							$("#orderNumber",_parent).html(data.orderNumber);
							$("#reserveDate",_parent).html(data.reserveDate);
							$("#serviceDate",_parent).html(data.serviceDate);
							$("#orderStatusDesc",_parent).html(data.orderStatusDesc); 
							$("#nicName",_parent).html(data.nicName);
							$("#userMobile",_parent).html(data.userMobile);
							$("#purchaseTimes",_parent).html(data.purchaseTimes);
							if(data.isSendCheZhengBox=="1"){
							 data.isSendCheZhengBox="是";
							}else{
							 data.isSendCheZhengBox="否";
							}
							if(data.transferStatus=="1"){
							 data.transferStatus="是";
							}else{
							 data.transferStatus="否";
							} 
							$("#couponPrice").html("¥"+data.couponPrice);
							$("#isSendCheZhengBox").html(data.isSendCheZhengBox);
							$("#transferStatus").html(data.transferStatus);
						},
						error:function(xhr){
							alertRe("获取数据失败");
						}
					}); 
			 	} 
		 		function upDate(){ 
			 		var date = $("#reserveTime").val();  
			 		var postData = {};
			 		postData.orderId = orderId;   
			 		postData.reserveDate = date;   
					$.ajax({
						url: '/vip-app-ws/ws/0.1/orders/editReserveDate',
						contentType : "application/json;charset=utf-8",
						dataType : "json",
						type : "POST",
						data : $.toJSON(postData),
						async : false,
						success: function(data) {   
						},
						error:function(xhr){
							if(xhr.status==200){
								$("#reserveTime").val("");
								$("#rtime").html(date+":00");
								$(".date-wrap .btnn").html("修改预约时间");
							}else{   
								var errormsg = eval("(" + xhr.responseText + ")"); 
								alertRe(errormsg[0].message); 
							}
						}
					}); 
			 	} 
			 	function cancelOrder(){    
					$.ajax({
						url: '/vip-app-ws/ws/0.1/orders/display/'+orderId,
						contentType : "application/json;charset=utf-8",
						dataType : "json",
						type : "POST", 
						async : false,
						success: function(data) {  
						},
						error:function(xhr){
						  if(xhr.status==200){
						  	alertRe("删除成功！"); 
						  }else{    
							   var errormsg = eval("(" + xhr.responseText + ")"); 
							   alertRe(errormsg[0].message); 
							}
						}
					}); 
			 	}
			 	getOrderDetail(orderId); 
			};

			$(".dialog2").on('click','li',function(){
		        //var fr2 = $(this).children(".fr2");
		        $('.sel').removeClass('checked')
		        $(this).children(".sel").addClass('checked');
			   
		    }); 
			$('.close').click(function(){
				$('.dialog2').fadeOut()
			})
			$("#submit").click(function(){ 
  				$("#bank-confirm").show(); 
  			    $(".dialog-overlay").show();
      		});
      		
      		$(".bank-dialog .cancel").click(function(){
                $(this).parents(".bank-dialog").fadeOut();
                $(".dialog-overlay").fadeOut();
      		});

      		$("#bank-confirm .submit").click(function(){
      			if(stauts){
	                $(this).parents(".bank-dialog").fadeOut();
	                $(".dialog-overlay").fadeOut();
               		apply();
      			}else{
      				$('.content-claims').html('');
      				$('.content-claims').append($('<p>').html('该订单状态已变更！').attr('style','line-height:50px;'))
      				$("#bank-confirm .submit").click(function(){
                		$(this).parents(".bank-dialog").fadeOut();
                		$(".dialog-overlay").fadeOut();
                		apply()
      				})
      				$("#bank-confirm .cancel").click(function(){
                		$(this).parents(".bank-dialog").fadeOut();
                		$(".dialog-overlay").fadeOut();
      				})
      			}
      		}); 

		}); 

	 	function androidFun(flag){
	 		if(bIsAndroid()){
	 			if(flag){ 
			 		android.setPullMode(0x1); 
			 	}else{ 
			 		android.setPullMode(0x0);
			 	}
		 	}
	 	}
	 
	</script>  
</body>

</html>

