<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<meta name="format-detection" content="telephone=no" />
<link type="text/css" href="css/index.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>  
<script type="text/javascript" src="js/jquery.json-2.2.js"></script>
<link href="date/mobiscroll.custom-2.13.2.min.css" rel="stylesheet" type="text/css" />
<script src="date/mobiscroll.custom-2.13.2.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/index.js"></script> 
<title>订单详情</title> 
<body style="height:100%;">  
	<section class="order-detail-wrap"> 
		<article> 
			<div id="reserveContent" style="display:none;margin-top:2.2em;">
				<div class="date-wrap">
					<p>预约时间：<span id="rtime"></span></p>
					<span class="btnn"></span>
					<input type="text" id="reserveTime"/>
				</div> 
				<div class="cancel-order"><a id="cancel" href="javascript:void(0)">取消订单</a></div>
			</div>
			<ul class="order-detail" id="orderDetail">
				<li>
					<span>服务名称</span><span id="serviceName"></span>
				</li>
				<li>
					<span>支付方式</span><span id="paid"></span>
				</li>
				<li>
					<span>是否闲时优惠</span><span id="idlePrivStatusDesc"></span>
				</li>
				<li>
					<span>预定价</span><span id="reservePrice"></span>
				</li>
				<li>
					<span>支付价</span><span id="payPrice"></span>
				</li>
				<li>
					<span>代金券抵价</span><span id="discount"></span>
				</li>
				<li class="last">
					<span>抵用券抵价</span><span id="couponPrice"></span>
				</li>
				<li class="sep"></li>
				<li>
					<span>订单编号</span><span id="orderNumber"></span>
				</li>
				<li>
					<span>预约时间</span><span id="reserveDate"></span>
				</li>
				<li>
					<span>服务时间</span><span id="serviceDate"></span>
				</li>
				<li>
					<span>订单状态</span><span id="orderStatusDesc"></span>
				</li>
				<li>
					<span>是否赠送盒子</span><span id="isSendCheZhengBox"></span>
				</li>
				<li class="last">
					<span>是否结算</span><span id="transferStatus"></span>
				</li>
				<li class="sep"></li>
				<li>
					<span>用户昵称</span><span id="nicName"></span>
				</li>
				<li>
					<span>手机号</span><span id="userMobile"></span>
				</li>
				<li>
					<span>到店次数</span><span id="purchaseTimes"></span>
				</li>
			</ul>  
		</article> 
	</section> 
	<div class="overlay-wrap"></div> 
	<script type="text/javascript">  
		var orderId;
		$(document).ready(function(){ 
 		 index.init = function(userInfo,bridge) {   
		    var url =window.location.href; 
			var paramsArr = (url.split("?")[1]).split("&");
			var paramJson = {};
			$.each(paramsArr,function(i){
				var item = paramsArr[i].split("=");
				paramJson[item[0]] = item[1];
			});  
		 	orderId = paramJson.orderId;  
			if(paramJson.orderListType!=""){
			  $("#reserveContent").show();
			}
		     $("#reserveTime").mobiscroll().datetime({
	            theme: "bootstrap",     // Specify theme like: theme: 'ios' or omit setting to use default 
	            mode: "scroller",       // Specify scroller mode like: mode: 'mixed' or omit setting to use default 
	            display: "model", // Specify display mode like: display: 'bottom' or omit setting to use default 
	            lang: "zh",       // Specify language like: lang: 'pl' or omit setting to use default
	            minDate:new Date(),  // More info about minDate: http://docs.mobiscroll.com/2-13-2/datetime#!opt-minDate
	            //maxDate: new Date(2014,7,30,15,44),   // More info about maxDate: http://docs.mobiscroll.com/2-13-2/datetime#!opt-maxDate
	            dateFormat: 'yy-mm-dd',
	            onSelect: function() {
	             	androidFun(true);
	             	upDate();
	            },
	            onCancel: function() {
	            	androidFun(true);
	            },
	            onShow:function(){
	            	androidFun(false);
	            },
	            stepMinute: 5  // More info about stepMinute: http://docs.mobiscroll.com/2-13-2/datetime#!opt-stepMinute
	        });
			$("#cancel").on('click',function(){
				confirmRe("确定要删除订单吗？",cancelOrder);
			});
		 	function getOrderDetail(id){  
				$.ajax({
					url: '/vip-app-ws/ws/0.1/orders/detail?orderId='+id,
					type: 'get',
					async: false,
					dataType: 'json',
					success: function(data) {   
						if(data.reserveDate!=""){
							$("#rtime").html(data.reserveDate);
							$(".date-wrap .btnn").html("修改预约时间");
						}else{
							$("#rtime").html("未预约");
							$(".date-wrap .btnn").html("输入预约时间");
						}
						if(data.paid=="0"){
							data.paid = "当面付款";
						}else if(data.paid=="1"){
							data.paid = "已线上支付";
						}
						var _parent = $("#orderDetail"); 
						$("#serviceName",_parent).html(data.serviceName);
						$("#paid",_parent).html(data.paid);
						$("#idlePrivStatusDesc",_parent).html(data.idlePrivStatusDesc);
						$("#reservePrice",_parent).html("¥"+data.reservePrice); 
						if(data.isCounPay=="0"){
						$("#payPrice",_parent).html("¥"+data.payPrice);
						}else{
						$("#payPrice",_parent).html("¥"+data.couponCashPrice);
						}
						$("#discount",_parent).html("¥"+data.discount);
						$("#orderNumber",_parent).html(data.orderNumber);
						$("#reserveDate",_parent).html(data.reserveDate);
						$("#serviceDate",_parent).html(data.serviceDate);
						$("#orderStatusDesc",_parent).html(data.orderStatusDesc); 
						$("#nicName",_parent).html(data.nicName);
						$("#userMobile",_parent).html(data.userMobile);
						$("#purchaseTimes",_parent).html(data.purchaseTimes);
						if(data.isSendCheZhengBox=="1"){
						 data.isSendCheZhengBox="是";
						}else{
						 data.isSendCheZhengBox="否";
						}
						if(data.transferStatus=="1"){
						 data.transferStatus="是";
						}else{
						 data.transferStatus="否";
						} 
						$("#couponPrice").html("¥"+data.couponPrice);
						$("#isSendCheZhengBox").html(data.isSendCheZhengBox);
						$("#transferStatus").html(data.transferStatus);
					},
					error:function(xhr){
						alertRe("获取数据失败");
					}
				}); 
		 	} 
	 		 function upDate(){ 
		 		var date = $("#reserveTime").val();  
		 		var postData = {};
		 		postData.orderId = orderId;   
		 		postData.reserveDate = date;   
				$.ajax({
					url: '/vip-app-ws/ws/0.1/orders/editReserveDate',
					contentType : "application/json;charset=utf-8",
					dataType : "json",
					type : "POST",
					data : $.toJSON(postData),
					async : false,
					success: function(data) {   
					},
					error:function(xhr){
						if(xhr.status==200){
							$("#reserveTime").val("");
							$("#rtime").html(date+":00");
							$(".date-wrap .btnn").html("修改预约时间");
						}else{   
							var errormsg = eval("(" + xhr.responseText + ")"); 
							alertRe(errormsg[0].message); 
						}
					}
				}); 
		 	} 
		 	function cancelOrder(){    
				$.ajax({
					url: '/vip-app-ws/ws/0.1/orders/display/'+orderId,
					contentType : "application/json;charset=utf-8",
					dataType : "json",
					type : "POST", 
					async : false,
					success: function(data) {  
					},
					error:function(xhr){
					  if(xhr.status==200){
					  	alertRe("删除成功！"); 
					  }else{    
						   var errormsg = eval("(" + xhr.responseText + ")"); 
						   alertRe(errormsg[0].message); 
						}
					}
				}); 
		 	}
		 	getOrderDetail(orderId); 
		 };
		}); 
	 	function androidFun(flag){
	 		if(bIsAndroid()){
	 			if(flag){ 
			 		android.setPullMode(0x1); 
			 	}else{ 
			 		android.setPullMode(0x0);
			 	}
		 	}
	 	}
	 
	</script>  
</body>

</html>

