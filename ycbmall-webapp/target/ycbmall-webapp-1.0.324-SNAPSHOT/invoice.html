<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit">
	<meta name="keywords" content="养车宝，配件商城">
	<meta name="description" content="养车宝配件商城，100%原厂品质，3M、威固、美孚、壳牌Ahell、普利司通、米其林等汽车配件，厂价直销！">
	<title>全网正品汽车配件_养车宝配件商城！</title>
	<link rel="icon" href="favicon.ico">
	<script src="js/jquery-1.10.1.min.js"></script>
	<script language="javascript" src="js/jquery.json-2.2.js"></script> 
	<script src="js/common.js"></script>
	<script src="js/jquery.urlParam.js"></script>
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/product.css">
	<link rel="stylesheet" href="css/login.css">
	<link rel="stylesheet" href="css/historyOrder.css">
	<link rel="stylesheet" type="text/css" href="css/invoice.css"/>
	<style type="text/css">
		.biaoji{
			border: 5px solid #0000FF;
		}
		.point{color: #D70000;}
		.dialogAddress{position: absolute;top: 276px;}
		.dialog-con p span.counterFee{
			color: #FD6244;
			font-size: 14px;
			font-family: "microsoft yahei";
		}
		span.lf{float: left;font-family: "microsoft yahei";font-size: 14px;}
	</style>
</head>
<body>
	<div class="deleteAlert dialog" style="display: none;z-index: 1505;">
		<div class="dialog-title"><h3></h3><img src="img/alertRe_close.png" class="dialog-close"></div>
		<div class="dialog-con">
			<p>团购订单与项目截至日期之前的7天内取消，将扣除您<span>5%</span>的手续费，是否确定取消？</p>
			<span class="dialog-sure">确定</span>
			<span class="dialog-no">取消</span>
		</div>
	</div> 
	<div class="dialog-overlay" style="display:none;"></div>
	<div class="Form-editEddrress dialog dialogAddress" style="display:none;">
		<div class="dialog-title"><h3></h3><img src="img/alertRe_close.png" class="dialog-close"></div>
		<div class="Form-editEddrress-con">
			<p class="ui-note" style="color:#f00;font-family:'microsoft yahei';font-size:14px;"></p>
			<p>
				<span>所在地区：</span>
				<select name="provinceId" id=""><option value="">请选择省份</option></select>
				<select name="areaCodeId" id=""><option value="">请选择城市</option></select>
				<select name="countyId" id=""><option value="">请选择区县</option></select>
			</p>
			<p>
				<span>详细地址：</span>
				<textarea name="postalAddress" id="postalAddress" cols="74" rows="7" placeholder="建议您如实填写详细收货地址，例如街道名称、门牌号码、楼层和房间号等信息。" style="font-family: '微软雅黑';"></textarea>
			</p>
			<p>
				<span>联系人：</span>
				<input type="text" placeholder="长度不超过25个字符" name="consigneeName">
			</p>
			<p>
				<span>联系电话：</span>
				<input type="text" placeholder="请输入您的常用号码" name="mobile">
			</p>
			<span class="Form-editEddrress-save">保存</span>
		</div>
	</div>
	<div class="editAddress-dialog-overlay" style="display: none;"></div>
	<div class="container">
		<div class="top"></div>
		<div class="main">
			<div class="mainCommen"></div>
			<div class="historyOrder-con">
				<div class="historyOrder-left">
					<div class="titleCon">我的养车宝</div>
					<div class="selfPictur">
						<p class="pictureDetail"><img src="img/Avatar.jpg" width="150"height="150" /></p>
						<p class="selfName"><span>测试用户名</span></p>
					</div>
					<div class="orderList">
						<p>订单中心</p>
						<a title="我的订单" class="allOrder" href="historyOrder.html?title=我的订单"><p class="selfOrder"><span>我的订单</span></p></a>
						<a title="团购订单" class="groupOrder" href="historyOrder.html?title=团购订单"><p class="groupPurchaseOrder"><span>团购订单</span></p></a>
					</div>
					<div class="AccountCentral">
						<p>账户中心</p>
						<a title="" class="valueAddedInvoices checked" href="invoice.html"><p class="valueAddedInvoices"><span>增票资质管理</span></p></a>
					</div>
					<div class="edit">
						<p>设置</p>
						<a title="" class="editAddress"><p class="editAddress"><span>收货地址</span></p></a>
					</div>
				</div>
				<div class="historyOrder-right">
					<h2>增票资质</h2>
					<div class="line_h2"><p></p></div><!--下划线-->
					<div class="invoice-content">
						<input type="hidden" name="vatInvoiceId" value=""/>
						<div class="mainTop">
							<div class="invoiceInfo">
								您的增票资质：<span class="stateName">未添加</span>
								<span class="ui-note">单位名称信息不全，请核对后上传</span>
							<div class="invoiceBtn">
								<!--<span class="btnAdd" style="display: block;">添加增票资质</span>-->
								<!--<span class="btnChange" style="display: block;">修改</span>-->
								<!--<span class="btnDel" style="display: block;">删除</span>-->
							</div>
							</div>
						</div>
						<div class="mainCon" style="display: none;">
							
							<h2>增票信息:</h2>
							<p><span class="mainCon-l">单位名称：</span><span class="name"></span></p>
							<p><span class="mainCon-l">纳税人识别码：</span><span class="identificationCode"></span></p>
							<p><span class="mainCon-l">注册地址：</span><span class="address"></span></p>
							<p><span class="mainCon-l">注册电话：</span><span class="tel"></span></p>
							<p><span class="mainCon-l">开户银行：</span><span class="ourBank"></span></p>
							<p><span class="mainCon-l">银行账户：</span><span class="bankAccount"></span></p>
						</div>
						<div class="mainFoot">
							<h2>温馨提示:</h2>
							<span class='lf'>1.</span><p>本商城会根据您输入的信息开具增值税专用发票，如影响认证抵扣，本商城不会受理重新开具增值税专用发票的要求，请务必认真校对所填 开票信息;</p>
							<span class='lf'>2.</span><p>下单时，收件人电话请尽量填写可以联系到您的手机号码，避免使用公司号码，以免影响您收票的时效性;</p>
							<span class='lf'>3.</span><p>一个养车宝商城账号只能关联一个增值税专用发票资质;</p>
							<span class='lf'>4.</span><p>由于中华人民共和国增值税暂行条例第二十一条规定：向消费者个人销售货物或者应税劳务的，不得开具增值税专用发票。因此，如果您使用POS刷卡、在线支付，需要开具增值税专用发票，需要提供相对应的公司委托您个人采购货物并付款的授权委托书，加盖公司公章并请您签署，公司名称要求与增票抬头一致;</p>
							<span class='lf'>5.</span><p>您在收到发票后如果发现本商城原因所致票据抬头、内容或金额错误，请在自开票日期起15日内可联系客服人员为您安排办理换发票事宜。</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="footer"></div>
	</div>
</body>
<script type="text/javascript">
if(!(document.cookie.indexOf('customerId')!=-1)){
   	location.href="index.html";
}
$(function(){
		$('div.top').load('top.html');
		$('div.mainCommen').load('searchAndNav.html');
		$('div.footer').load('footer.html');
		var username=mall.getCookie('username');
		var customerId=mall.getCookie('customerId');
		var userInfoId=mall.getCookie('customerId');
		var areaCodeId=mall.getCookie('areaCodeId');
		var provinceId="";		//省份ID
		var areaCodeId="";		//城市ID
		var countyId="";		//区县ID
		var provinceName="";	//省份名称
		var areaCodeName="";	//城市名称
		var countyName="";		//区县名称
		var postalAddress="";	//收货详细地址
		var consigneeName="";	//联系人名字
		var mobile="";
		$('p.accoutDetail').html('账号：'+username);
		$("p.selfName span").html(username);
		//增票资质
		$.ajax({
			type:'get',
			url:mall.url('/vatInvoice/get'),
			data:{userInfoId:userInfoId},
			async:false,
			dataType:'json',
			contentType:'application/json;charset=utf-8',
			success:function(data){
				var vatStatus=data.vatStatus;
				switch(vatStatus){
					case -1:
						
						$(".invoice-content div.mainTop span.stateName").html('未添加');
						$(".invoice-content div.mainTop span.ui-note").html('');
						$(".invoice-content div.mainTop .invoiceBtn").html('<span class="btnAdd">添加增票资质</span>');
						$(".invoice-content div.mainCon").hide();
						break;
					case 0:
						$(".invoice-content div.mainTop span.stateName").html('已失效');
						$(".invoice-content div.mainTop span.ui-note").html('');
						$(".invoice-content div.mainTop .invoiceBtn").html('<span class="btnAdd">重新添加</span>');
						$(".invoice-content div.mainCon").hide();
						break;
					case 1:
						$(".invoice-content div.mainTop span.stateName").html('待审核');
						$(".invoice-content div.mainTop span.ui-note").html('');
						$(".invoice-content div.mainTop .invoiceBtn").html('<span class="btnChange">修 改</span><span class="btnDel">删 除</span>');
						$(".invoice-content div.mainCon").hide();
						$(".invoice-content input[name='vatInvoiceId']").val(data.vatInvoiceId);
						break;
					case 2:
						var bankAccount=data.bankAccount;
						bankAccount=bankAccount.replace(/\s+/g,"");
						bankAccount=bankAccount.replace(/(.{4})/g,"$1 ");
						$(".invoice-content div.mainTop span.stateName").html('审核通过');
						$(".invoice-content div.mainTop span.ui-note").html('');
						$(".invoice-content div.mainTop .invoiceBtn").html('<span class="btnDel">删 除</span>');
						$(".invoice-content div.mainCon").show();
						$(".invoice-content input[name='vatInvoiceId']").val(data.vatInvoiceId);
						$(".invoice-content div.mainCon span.name").html(data.unitName);
						$(".invoice-content div.mainCon span.identificationCode").html(data.identificationCode);
						$(".invoice-content div.mainCon span.address").html(data.registeredAddress);
						$(".invoice-content div.mainCon span.tel").html(data.registeredPhone);
						$(".invoice-content div.mainCon span.ourBank").html(data.bank);
						$(".invoice-content div.mainCon span.bankAccount").html(bankAccount);
						break;
					case 3:
						$(".invoice-content div.mainTop span.stateName").html('审核未通过');
						$(".invoice-content div.mainTop span.ui-note").html(data.userDesc);
						$(".invoice-content div.mainTop .invoiceBtn").html('<span class="btnChange">修 改</span><span class="btnDel">删 除</span>');
						$(".invoice-content div.mainCon").hide();
						$(".invoice-content input[name='vatInvoiceId']").val(data.vatInvoiceId);
						break;
					default:
						break;
				}
			}
		})
		//增票操作-修改
		$(".invoice-content div.mainTop .invoiceBtn").on('click','span.btnChange',function(){
			var vatInvoiceId=$(".invoice-content input[name='vatInvoiceId']").val();
			window.location.href='invoice-add.html?vatInvoiceId='+vatInvoiceId; 
		})
		//删除
		$(".invoice-content div.mainTop .invoiceBtn").on('click','span.btnDel',function(){
			mall.alertReAndCanselFun('是否确认删除资质资料','',Del);
		})
		//添加
		$(".invoice-content div.mainTop .invoiceBtn").on('click','span.btnAdd',function(){
			window.location.href='invoice-add.html';
		})
		function Del(){
			var postData={};
			postData.userInfoId=userInfoId;
			postData.operator=username;
			$.ajax({
				type:"post",
				url:mall.url("/vatInvoice/delete"),
				async:false,
				data:$.toJSON(postData),
				dataType:'json',
				contentType:'application/json;charset=utf-8',
				success:function(data){
					window.location=location;
				}
			});
		}
		//订单类型点击
		//设置收货地址
		$('div.edit a.editAddress').unbind('click').bind('click',function(){
			var _url=mall.url('/user/delivery/detail');
			_url+='?userInfoId='+userInfoId;
			$.ajax({
				type:"get",
				url:_url+'&'+new Date().getTime(),
				async:false,
				dataType:'json',
				contentType:"application/json;charset=utf-8",
				success:function(data){
					provinceId=data.provinceId;
					provinceName=data.provinceName;
					areaCodeId=data.areaCodeId;
					areaCodeName=data.areaCodeName;
					countyId=data.countyId;
					countyName=data.countyName;
					postalAddress=data.postalAddress;
					consigneeName=data.consigneeName;
					mobile=data.mobile;
					$('div.Form-editEddrress').show();
					$('.dialog-overlay').show();
		 			$.get(mall.url('/areaCode/getOpeningProvicnes'),function(data){
						var proStr='<option value="">请选择省份</option>'
						$.each(data,function(){
							if(this.id==provinceId){
								proStr+='<option value="'+this.id+'" selected="true">'+this.provinceName+'</option>'
							}else{
								proStr+='<option value="'+this.id+'">'+this.provinceName+'</option>'
							}
						});
						$('select[name="provinceId"]').html(proStr);
						provinceId=$('select[name="provinceId"]').val();
					});
								
				$.get(mall.url('/areaCode/getOpeningCities'),{provinceId:provinceId},function(data2){
					var cityStr='<option value="">请选择城市</option>'
					$.each(data2,function(){
						if(this.id==areaCodeId){
							cityStr+='<option value="'+this.id+'" selected="true">'+this.municipalityName+'</option>'
						}else{
							cityStr+='<option value="'+this.id+'">'+this.municipalityName+'</option>'
						}
					});
					$('select[name="areaCodeId"]').html(cityStr);
					areaCodeId=$('select[name="areaCodeId"]').val();
				});
				
				$.get(mall.url('/areaCode/countries'),{cityId:areaCodeId},function(data3){
					var countyStr='<option value="">请选择区县</option>';
					$.each(data3,function(){
						if(this.id==countyId){
							countyStr+='<option value="'+this.id+'" selected="true">'+this.countyName+'</option>'
						}else{
							countyStr+='<option value="'+this.id+'">'+this.countyName+'</option>'
						}
					});
					$('select[name="countyId"]').html(countyStr)
				});
				$('select[name="provinceId"]').change(function(){
					$('select[name="areaCodeId"]').html('<option value="">请选择城市</option>');
					$('select[name="countyId"]').html('<option value="">请选择区县</option>');
					provinceId=$(this).val();
					$.get(mall.url('/areaCode/getOpeningCities'),{provinceId:provinceId},function(data2){
						var cityStr='<option value="">请选择城市</option>'
						$.each(data2,function(){
							cityStr+='<option value="'+this.id+'">'+this.municipalityName+'</option>'
						});
						$('select[name="areaCodeId"]').html(cityStr);
					});
				});
				$('select[name="areaCodeId"]').change(function(){
					$('select[name="countyId"]').html('<option value="">请选择区县</option>');
					areaCodeId=$(this).val();
					$.get(mall.url('/areaCode/countries'),{cityId:areaCodeId},function(data3){
						var countyStr='<option value="">请选择区县</option>';
						$.each(data3,function(){
							countyStr+='<option value="'+this.id+'">'+this.countyName+'</option>'
						});
						$('select[name="countyId"]').html(countyStr)
					});
				});
				$('textarea[name="postalAddress"]').val(postalAddress);
				$('input[name="consigneeName"]').val(consigneeName);
				$('input[name="mobile"]').val(mobile);
				$('span.Form-editEddrress-save').unbind('click').bind('click',function(){
					var postData={};
					postData.userInfoId=userInfoId;
					postData.consigneeName=$('input[name="consigneeName"]').val();
					postData.mobile=$('input[name="mobile"]').val();
					postData.provinceId=$('select[name="provinceId"]').val();
					postData.areaCodeId=$('select[name="areaCodeId"]').val();
					postData.countyId=$('select[name="countyId"]').val();
					postData.postalAddress=$('textarea[name="postalAddress"]').val();
					if(postData.provinceId==''||postData.areaCodeId==''||postData.countyId==''){
						$('div.Form-editEddrress-con p.ui-note').html('请选择所在省市区');
						return false
					}
					$.ajax({
						type:'post',
						url:mall.url('/user/delivery/replace'),
						data:$.toJSON(postData),
						dataType:'json',
						contentType:'application/json;charset=utf-8',
						success:function(data){
							$('p.ui-note').html('');
							$('div.Form-editEddrress').hide();
							$('div.dialog-overlay').hide();
						},
						error:function(xhr){
							var error=eval('('+xhr.responseText+')');
							$('div.Form-editEddrress-con p.ui-note').html(error[0].message)
						}
					})
				});
				$('div.Form-editEddrress img.dialog-close').unbind('click').bind('click',function(){
					$('p.ui-note').html('');
					$('div.Form-editEddrress').hide();
					$('div.dialog-overlay').hide()
				})
				}
			});
		});
		$('p.safeQuit span').unbind('click').bind('click',function(){
			$.ajax({
	            url : "/ycbmall-uc-ws/ws/0.1/logout",
	            contentType : "application/json;charset=utf-8",
	            dataType : "json",
	            type : "GET",
	            success : function(data) {
	            	delCookie('username');
	            	delCookie('customerId');
	                window.location = "index.html"
	            },
	            error: function(xhr){
	                var status = xhr.status;
	                if (status == 200) {
	                	delCookie('username');
		            	delCookie('customerId');
	                    window.location = "index.html"
	                }
	            }
	        });
		});
		$(".dialog-close").click(function(){
			$(".dialog").hide();
			$(".dialog-overlay").hide();
		});
		$(".dialog-no").click(function(){
			$(".dialog").hide();
			$(".dialog-overlay").hide();
		});
	})

</script>
</html>