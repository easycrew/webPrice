<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="renderer" content="webkit">
	<meta name="keywords" content="养车宝，配件商城">
	<meta name="description" content="养车宝配件商城，100%原厂品质，3M、威固、美孚、壳牌Ahell、普利司通、米其林等汽车配件，厂价直销！">
	<title>全网正品汽车配件_养车宝配件商城！</title>
	<link rel="icon" href="favicon.ico">
	<script src="js/jquery-1.10.1.min.js"></script>
	<script src="js/md5.js"></script>
	<script src="js/common.js"></script>
	<script src="js/jquery.urlParam.js"></script>
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/login.css">
	<link rel="stylesheet" href="css/exclusiveDetails.css">
	<link rel="stylesheet" type="text/css" href="css/video-js.css"/>
	<script src="js/video.js"></script>
	<style type="text/css">
		#itemCon{display: none;}
		.video-js .vjs-control-bar{
			background-color: rgba(43,51,63,1);
		}
	</style>
	<script>
    	videojs.options.flash.swf = "js/video-js.swf";
	</script>
	<script type="text/javascript">
		function iframeResize(iframe) {
			try {
			    //var iframe = document.getElementById("contentFrame"); //("contentFrame");
			    var idocumentElement = iframe.contentWindow.document.documentElement;
			    if (idocumentElement.scrollHeight > 560) {
			        iframe.height -= 5;
			        iframe.height = idocumentElement.scrollHeight;
			    }
//			    else {
//			        iframe.height = 560;
//			    }
			}
			catch (e) {
			    window.status = 'Error: ' + e.number + '; ' + e.description;
			}
		}
	</script>
</head>
<body>
	<div class="putShopCar-success" style="display:none;">
		<div class="hsaPutShopCarImg">
			<img src="img/has_putShopCar.png">
		</div>
		<div class="hasPutShopCarText">
			<p class="p_one">商品已成功加入购物车！</p>
			<p class="p_two">
				<span class="tocarSettle"><a href="myShopCar.html">去购物车结算</a></span>
				<span class="continueShop">您还可以<a href="javascript:">继续购物</a></span>
			</p>
		</div>
	</div>
	<input type="hidden" name="giftBagId" value="" />  <!--礼包ID-->
	<div class="login"></div>
	<div class="container">
		<div class="top"></div>
		<div class="main">
			<div class="mainCommen"></div>
			<div class="m-t">
				<div id="video" class="video-l">
					<video id="my_video" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="none" width="800" height="451"
  					poster="img/video-bg.jpg" data-setup="{}">
						<source src="" type="video/mp4"></source>
						<source src="" type="video/webm"></source>
					</video>
				</div>
				<div id="image" class="video-l" style="display: none;">
					<img src="" width="800" height="451"/>
				</div>
				<div class="video-r video-dec">
					<div class="giftBagBac">
						<span class="giftBagName"></span>
						<span class="giftBagTitle"></span>
					</div>
					<div class="giftBagDec">
						<h3>简介</h3>
						<p class="giftBagIntroduction g-b-description"></p>
						<h3>参数</h3>
						<p class="giftBagArguments g-b-description"></p>
					</div>
				</div>
			</div>
			<div class="m-m">
				<div class="giftBag-suit giftBag-detail">
					<div class="suitTitle floor-title">
						按礼包套装购买
					</div>
					<div id="suitCon">
				
					</div>
				</div>
				<div class="giftBag-item giftBag-detail">
					<div class="itemTitle floor-title">
						按单品购买
						<span class="slideDown">展开</span>
						<span class="slideUp">收起</span>
					</div>
					<div id="itemCon">
						
					</div>
				</div>
				<div class="title-H giftBag-footer">
					<span class="sumNum">
						合计数量：
						<em class="allNum">0</em>
						<span class="unit">件</span>
					</span>
					<span class="sumPrice">
						合计金额：
						<span class="allPrice">&yen;</span>
						<em class="allPrice">0</em>
						<span class="unit">元</span>
					</span>
					<a href="javascript:" class="addShopCarBtn">加入购物车</a><a href="javascript:" class="limitedBuyBtn">立即购买</a>
				</div>
			</div>
			<div class="m-b">
				<div id="detailsTitle" class="title-H detailsTitle">
					<ul>
					</ul>
				</div>
				<div id="detailsCon" class="detail-box">
				</div>
			</div>
		</div>
		<div class="footer"></div>
	</div>
</body>
</html>
<script type="text/javascript">
if(!(document.cookie.indexOf('customerId')!=-1)){
	location.href="index.html";
}
	$(function(){
		$("div.top").load('top.html');
		$("div.mainCommen").load('searchAndNav.html');
		$("div.footer").load('footer.html');
		var username=mall.getCookie('username'),
			userInfoId=mall.getCookie('customerId'),
			areaCodeId=mall.getCookie('areaCodeId'),
			giftBagId=$.getQuery('giftBagId');//礼包ID
			//购物车-继续购物
			$('div.putShopCar-success span.continueShop a').unbind('click').bind('click',function(){
				$('div.putShopCar-success').hide();
				$('div.login-dialog-overlay').hide();
			});
			//加入购物车
			$(".giftBag-footer a.addShopCarBtn").unbind('click').bind('click',function(){
				var flag=true,isZero=0;
				$('.m-m div.giftBag-detail-list input[name="selfBuyNum"]').each(function(){
					var thisElem=$(this),
						selfBuyNum=parseFloat($.trim(thisElem.val())),//数量string
						intBuyNum=parseInt(selfBuyNum),//数量int
						skuId=thisElem.parents('.giftBag-detail-list').find('input[name="skuId"]').val(),
						postData={};
					if(selfBuyNum>0){
						isZero++;
						postData.skuId=skuId;
						postData.skuNum=intBuyNum;
						postData.userInfoId=userInfoId;
						postData.areaCodeId=areaCodeId;
						if(!checkSkuNum(postData,thisElem)){
							flag=false;
							mall.alertRe_('商品信息有误，请再次核对后提交',"");
							return false;
						}
					}
				})
				if(isZero==0){
					mall.alertRe_('请选择购买商品!');
					return
				}
				if(flag){
					if(addToCart()){
						$('div.putShopCar-success').show();
						$('div.login-dialog-overlay').show();
					}
				}
			})
			//立即购买
			$(".giftBag-footer a.limitedBuyBtn").unbind('click').bind('click',function(){
				var flag=true,isZero=0;
				$('.m-m div.giftBag-detail-list input[name="selfBuyNum"]').each(function(){
					var thisElem=$(this),
						selfBuyNum=parseFloat($.trim(thisElem.val())),//数量string
						intBuyNum=parseInt(selfBuyNum),//数量int
						skuId=thisElem.parents('.giftBag-detail-list').find('input[name="skuId"]').val(),
						postData={};
					if(selfBuyNum>0){
						isZero++;
						postData.skuId=skuId;
						postData.skuNum=intBuyNum;
						postData.userInfoId=userInfoId;
						postData.areaCodeId=areaCodeId;
						if(!checkSkuNum(postData,thisElem)){
							flag=false; 
							mall.alertRe_('商品信息有误，请再次核对后提交',"");
							return false;
						};
					}
				})
				if(isZero==0){
					mall.alertRe_('请选择购买商品!');
					return
				}
				if(flag){
					if(addToCartToOrder()){
						window.location.href="order.html";
					}
				}
			})
			//商品加入购物车-数据流
			function addToCart(){
				var postData={},items=[],checkedThrough=true;
				$('.m-m div.giftBag-detail-list').each(function(){
					var realItem={},skuNum;
					skuNum=$(this).find('input[name="selfBuyNum"]').val();
					if(skuNum>0){
						realItem.skuId=$(this).find('input[name="skuId"]').val();
						realItem.skuNum=skuNum;
						items.push(realItem);
					}
				});
				postData.userInfoId=userInfoId;
				postData.items=items;
				$.ajax({
					type:"post",
					url:mall.url('/user/shoppingcard/replace'),
					async:false,
					data:$.toJSON(postData),
					dataType:'json',
					contentType:"application/json;charset='utf-8'",
					success:function(data){
						checkedThrough=true;
					},
					error:function(xhr){
						var error=eval('('+xhr.responseText+')');
						mall.alertRe(error[0].message,"");
						checkedThrough=false;
					}
				});
				return checkedThrough
			}
			//商品加入购物车直接跳转到提价订单页面
			function addToCartToOrder(){
				var postData={},items=[],checkedThrough=true;
				$('.m-m div.giftBag-detail-list').each(function(){
					var realItem={},skuNum;
					skuNum=$(this).find('input[name="selfBuyNum"]').val();
					if(skuNum>0){
						realItem.skuId=$(this).find('input[name="skuId"]').val();
						realItem.skuNum=skuNum;
						items.push(realItem);
					}
				});
				postData.userInfoId=userInfoId;
				postData.areaCodeId=areaCodeId;
				postData.items=items;
				$.ajax({
					type:"post",
					url:mall.url('/user/shoppingcard/replaceSelected'),
					async:false,
					data:$.toJSON(postData),
					dataType:'json',
					contentType:"application/json;charset='utf-8'",
					success:function(data){
						checkedThrough=true;
					},
					error:function(xhr){
						var error=eval('('+xhr.responseText+')');
						mall.alertRe(error[0].message,"");
						checkedThrough=false;
					}
				});
				return checkedThrough
			}
			
			//用户自己输入数量
			$(".m-m").on('change','div.giftBag-detail-list input[name="selfBuyNum"]',function(){
				var thisElem=$(this),
					selfBuyNum=$.trim(thisElem.val()),//数量string
					intBuyNum=parseInt(selfBuyNum),//数量int
					skuId=thisElem.parents('.giftBag-detail-list').find('input[name="skuId"]').val(),
					postData={};
				if(!/^([1-9]\d*|0)$/.test(selfBuyNum)){
					thisElem.val(0);
					showMeaasge(thisElem,'请输入正确的数量');
					return false;
				}else{
					showMeaasge(thisElem,'');
				}
				postData.skuId=skuId;
				postData.skuNum=intBuyNum;
				postData.userInfoId=userInfoId;
				postData.areaCodeId=areaCodeId;
				checkSkuNum(postData,thisElem);
				summation();//求和
			});
			//点击加号
			$(".m-m").on('click','div.giftBag-detail-list div.list-num span.buyNum_up',function(){
				var thisElem=$(this),
					thisIput=thisElem.siblings('input[name="selfBuyNum"]'),
					selfBuyNum=parseFloat($.trim(thisIput.val())),//数量string
					intBuyNum=parseInt(selfBuyNum),//数量int
					skuId=thisElem.parents('.giftBag-detail-list').find('input[name="skuId"]').val(),
					postData={};
				if(!/^(0|[1-9]\d*)$/.test(selfBuyNum)){
					return false
				}else{
					intBuyNum++;
					thisIput.val(intBuyNum);
					postData.skuId=skuId;
					postData.skuNum=intBuyNum;
					postData.userInfoId=userInfoId;
					postData.areaCodeId=areaCodeId;
					checkSkuNum(postData,thisElem);
					summation();
				}
			})
			//点击减号
			$(".m-m").on('click','div.giftBag-detail-list div.list-num span.buyNum_down',function(){
				var thisElem=$(this),
					thisIput=thisElem.siblings('input[name="selfBuyNum"]'),
					selfBuyNum=parseFloat($.trim(thisIput.val())),//数量string
					intBuyNum=parseInt(selfBuyNum),//数量int
					skuId=thisElem.parents('.giftBag-detail-list').find('input[name="skuId"]').val(),
					postData={};
				if(!/^[0-9]*[1-9][0-9]*$/.test(selfBuyNum)){
					return false
				}else{
					intBuyNum--;
					thisIput.val(intBuyNum);
					postData.skuId=skuId;
					postData.skuNum=intBuyNum;
					postData.userInfoId=userInfoId;
					postData.areaCodeId=areaCodeId;
					checkSkuNum(postData,thisElem);
					summation();
				}
			})
			//sku数量校验
			function checkSkuNum(data,e){
				var checkedThrough=true;
				if(data.skuNum==0){//数量为0是不进行库存校验，有别普通商品检验库存
					showMeaasge(e,'');
					return checkedThrough
				}
				$.ajax({
					type:"get",
					url:mall.url('/user/shoppingcard/checkInventory'),
					async:false,
					data:data,
					dataType:'json',
					contentType:"application/json;charset=utf-8",
					success:function(){
						showMeaasge(e,'');
						checkedThrough=true;
					},
					error:function(xhr){
						var error=eval('('+xhr.responseText+')');
						showMeaasge(e,error[0].message);
//						$("a.addShopCarBtn,a.limitedBuyBtn").addClass('disabled');
						checkedThrough=false;
					}
				});
				return checkedThrough
			}
			//核算总件数,总钱数,每条商品总价
			function summation(){
				var sumNum=0,sumPrice=0;
				$(".m-m div.giftBag-detail-list").each(function(){
					var thisNumber=parseInt($.trim($(this).find('div.list-num input[name="selfBuyNum"]').val()));
					var thisPrice=parseFloat($.trim($(this).find('input[name="backPrice"]').val()));
					var singlePrice=parseFloat((thisNumber*thisPrice).toFixed(2));//每条商品的总价double
					singlePrice=singlePrice?singlePrice:0;
					if(thisNumber!=0&&thisNumber!=''){
						sumNum+=thisNumber;
						sumPrice+=singlePrice;
						sumPrice=parseFloat(sumPrice.toFixed(2));
					}
					$(this).find('div.list-num em.p-sum-pricenum').text(singlePrice);
				});
				$("div.giftBag-footer span.sumNum em.allNum").text(sumNum);
				$("div.giftBag-footer span.sumPrice em.allPrice").text(sumPrice);
			}
			//提示错误
			function showMeaasge(e,message){
				var This=e;
				This.parents("div.list-num").find('p.ui-note').html(message);
				return false;
			}
			
			// 车型tab点击
			$('#detailsTitle').on('click','li',function(){
				if($(this).hasClass('checked')){
					return false
				}else{
					var id=$(this).attr('id');
					$(this).addClass('checked').siblings().removeClass('checked');
					$('div.'+id).show().siblings('div.detail-box').hide();
				}
			});
			//展开-收起
			$(".slideDown").unbind('click').bind('click',function(){
				$("#itemCon").slideDown(500);
				$(this).hide().siblings('span.slideUp').show();
			})
			$(".slideUp").unbind('click').bind('click',function(){
				$("#itemCon").slideUp(500);
				$(this).hide().siblings('span.slideDown').show();
			})
			
			getGiftBagInfo();
			//获得栏目商品列表
			function  getGiftBagInfo(){
				var isDisabled=0;
				var _url=mall.url('/giftBag/getBasicInfo')
				_url+='?giftBagId='+giftBagId+'&userInfoId='+userInfoId+'&areaCodeId='+areaCodeId;
				$.ajax({
					type:"get",
					url:_url+'&'+new Date().getTime(),
					async:false,
//					data:{giftBagId:giftBagId,userInfoId:userInfoId,areaCodeId:areaCodeId},
					dataType:"json",
					contentType:"application/json;charset=utf-8",
					success:function(data){
						if(data){
							$("input[name='giftBagId']").val(data.giftBagId);
							//礼包head-banner
							if(data.mediumType==1){
								$("#image").hide();
								$("#video").show().find('source:first').attr('src',data.mediumUrl).
								siblings().attr('src',data.mediumUrlSub);
								var myPlayer = videojs('my_video');
								myPlayer.load();
							}else{
								$("#video").hide();
								$("#image").show().find('img').attr('src',data.mediumUrl);
							}
							var thisName=mall.strFormat(data.name,25);
							var thisTitle=mall.strFormat(data.title,18);
							var thisIntroduction=mall.strFormat(data.introduction,100);
							var thisParameter=mall.strFormat(data.parameter,50);
							var suitSku=data.suitSku;
							$(".video-dec span.giftBagName").text(thisName);
							$(".video-dec span.giftBagTitle").text(thisTitle);
							$(".video-dec .giftBagDec p.giftBagIntroduction").text(thisIntroduction);
							$(".video-dec .giftBagDec p.giftBagArguments").html(thisParameter);
							var suitStr='';
							if(suitSku){
								suitStr='<div class="giftBag-suit-con giftBag-detail-list">'+
									'<input type="hidden" name="skuId" value="'+suitSku.skuId+'" />'+
									'<input type="hidden" name="commodityId" value="'+suitSku.commodityId+'" />'+
									'<input type="hidden" name="backPrice" value="'+suitSku.backPrice+'" />'+
									'<div class="list-pic">'+
										'<a href="goodsDetail.html?commodityId='+suitSku.commodityId+'&skuId='+suitSku.skuId+'" target="_blank"><img src="'+suitSku.middlePicUrl+'" width="190" height="190" /></a>'+
									'</div>'+
									'<div class="list-info">'+
										'<a href="goodsDetail.html?commodityId='+suitSku.commodityId+'&skuId='+suitSku.skuId+'" target="_blank">'+mall.strFormat(suitSku.name,40)+'</a>'+
										'<div class="list-price">'+
											'<span>市场价格：&yen;<em>'+suitSku.marketPrice+'</em></span>'+
											'<span class="price-span-r">商城价格：<span class="price-note">&yen;</span><em class="price-note">'+suitSku.sellingPrice+'</em></span>'+
										'</div>'+
									'</div>'+
									'<div class="list-num">'+
										'<p class="buyNum">'+
											'购买数量：'+
											'<span class="buyNum_down"><img src="img/buyNum_down.png" /></span><input type="text" name="selfBuyNum" class="selfBuyNum" value="0" maxlength="3"/><span class="buyNum_up"><img src="img/buyNum_up.png"></span>'+
										'</p>'+
										'<p class="prePriceSum">'+
											'小计：'+
											'<span>&yen;</span><em class="p-sum-pricenum">0</em>'+
										'</p>'+
										'<p class="ui-note"></p>'+
									'</div>'+
								'</div>';
							}else{
								suitStr+='<div class="empoty-note">本地区暂无礼包商品</div>';
								isDisabled++;
							}
							$("#suitCon").html(suitStr);
							//商品列表
							var itemStr='',
								singleSkus=data.singleSkus;
							if(singleSkus!=''){
								$.each(singleSkus, function(i) {
									itemStr+='<div class="giftBag-item-con giftBag-detail-list">'+
										'<input type="hidden" name="skuId" value="'+this.skuId+'" />'+
										'<input type="hidden" name="commodityId" value="'+this.commodityId+'">'+
										'<input type="hidden" name="backPrice" value="'+this.backPrice+'">'+
										'<div class="list-pic">'+
											'<a href="goodsDetail.html?commodityId='+this.commodityId+'&skuId='+this.skuId+'" target="_blank"><img src="'+this.middlePicUrl+'" width="190" height="190"/></a>'+
										'</div>'+
										'<div class="list-info">'+
											'<a href="goodsDetail.html?commodityId='+this.commodityId+'&skuId='+this.skuId+'" target="_blank">'+mall.strFormat(this.name,40)+'</a>'+
											'<div class="list-price">'+
												'<span>市场价格：&yen;<em>'+this.marketPrice+'</em></span>'+
												'<span class="price-span-r">商城价格：<span class="price-note">&yen;</span><em class="price-note">'+this.sellingPrice+'</em></span>'+
											'</div>'+
										'</div>'+
										'<div class="list-num">'+
											'<p class="buyNum">'+
												'购买数量：'+
												'<span class="buyNum_down"><img src="img/buyNum_down.png"></span><input type="text" name="selfBuyNum" class="selfBuyNum" value="0" maxlength="3"/><span class="buyNum_up"><img src="img/buyNum_up.png"></span>'+
											'</p>'+
											'<p class="prePriceSum">'+
												'小计：'+
												'<span>&yen;</span><em class="p-sum-pricenum">0</em>'+
											'</p>'+
											'<p class="ui-note"></p>'+
										'</div>'+
									'</div>'
								});
							}else{
								itemStr+='<div class="empoty-note">暂无礼包单品</div>';
								isDisabled++;
							}
							$("#itemCon").html(itemStr);
							//礼包不同车型介绍
							var giftIntroduces=data.giftIntroduces;
							var introduceLiStr='';
							var introuduceDivStr='';
							if(giftIntroduces==undefined||giftIntroduces.length==0){
								$(".m-b").hide();
								return false
							}
							var url_=window.location.href;
							var url_=url_.split("//")[1].split("/")[0];
							$.each(giftIntroduces, function(i) {
								var giftIntroduceId=this.giftIntroduceId;
								var introduceUrl='http://'+url_+'/group1'+(this.introduceUrl).split('/group1')[1];
								if(i==0){
									introduceLiStr+='<li class="checked" id="'+giftIntroduceId+'">'+this.name+'</li>'
									introuduceDivStr+='<div class="'+giftIntroduceId+' detail-box">'
								}else{
									introduceLiStr+='<li class="" id="'+giftIntroduceId+'">'+this.name+'</li>'
									introuduceDivStr+='<div class="'+giftIntroduceId+' detail-box" style="display:none;">'
								}
									introuduceDivStr+='<iframe name="detailIframe" id="'+giftIntroduceId+'" frameborder="0" width="100%" scrolling="no" src="'+introduceUrl+'" onload="iframeResize(this)"></iframe>'+
								'</div>'
							});
							$("#detailsTitle ul").html(introduceLiStr);
							$("#detailsCon").html(introuduceDivStr);
							if(isDisabled==2){
								$("a.addShopCarBtn").addClass('addShopCarBtn-dis').unbind('click');
								$("a.limitedBuyBtn").addClass('limitedBuyBtn-dis').unbind('click');
							}else{
								$("a.addShopCarBtn").removeClass('addShopCarBtn-dis');
								$("a.limitedBuyBtn").removeClass('limitedBuyBtn-dis');
							}
						}
					},//successEND
					error:function(xhr){
						var error=eval('('+xhr.responseText+')');
						mall.alertRe_(error[0].message,"");
					}
				});//ajaxEND
			}
	});
//	var myPlayer = videojs('my_video');
//  videojs("my_video").ready(function(){
//      var myPlayer = this;
//      myPlayer.play();
//  });
</script>