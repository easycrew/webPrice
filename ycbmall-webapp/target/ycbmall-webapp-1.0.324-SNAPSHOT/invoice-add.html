<!DOCTYPE html>
<html lang="en">
<head>
	<!--uploader.js
	upload.css
	invoice-add.html-->
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit">
	<meta name="keywords" content="养车宝，配件商城">
	<meta name="description" content="养车宝配件商城，100%原厂品质，3M、威固、美孚、壳牌Ahell、普利司通、米其林等汽车配件，厂价直销！">
	<title>全网正品汽车配件_养车宝配件商城！</title>
	<link rel="icon" href="favicon.ico">
	<script src="js/jquery-1.10.1.min.js"></script>
	<script language="javascript" src="js/jquery.json-2.2.js"></script> 
	<script src="js/common.js"></script>
	<script src="js/jquery.urlParam.js"></script>
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/product.css">
	<link rel="stylesheet" href="css/login.css">
	<link rel="stylesheet" href="css/historyOrder.css">
	<link rel="stylesheet" type="text/css" href="css/invoice.css"/>
	<link rel="stylesheet" type="text/css" href="css/webuploader.css" />
	<link rel="stylesheet" href="css/upload.css" />
	<style type="text/css">
		.biaoji{
			border: 5px solid #0000FF;
		}
		.point{color: #D70000;}
		.dialogAddress{position: absolute;top: 276px;}
		.dialog-con p span.counterFee{
			color: #FD6244;
			font-size: 14px;
			font-family: "microsoft yahei";
		}
		#Pic0,#Pic1,#Pic2,#Pic3{
			margin-bottom: 10px;
		}
		.thumbnail img{
			width: 110px;
			height: 110px;
		}
	</style>
</head>
<body>
	<div class="deleteAlert dialog" style="display: none;z-index: 1505;">
		<div class="dialog-title"><h3></h3><img src="img/alertRe_close.png" class="dialog-close"></div>
		<div class="dialog-con">
			<p>团购订单与项目截至日期之前的7天内取消，将扣除您<span>5%</span>的手续费，是否确定取消？</p>
			<span class="dialog-sure">确定</span>
			<span class="dialog-no">取消</span>
		</div>
	</div> 
	<div class="dialog-overlay" style="display:none;"></div>
	<div class="Form-editEddrress dialog dialogAddress" style="display:none;">
		<div class="dialog-title"><h3></h3><img src="img/alertRe_close.png" class="dialog-close"></div>
		<div class="Form-editEddrress-con">
			<p class="ui-note" style="color:#f00;font-family:'microsoft yahei';font-size:14px;"></p>
			<p>
				<span>所在地区：</span>
				<select name="provinceId" id=""><option value="">请选择省份</option></select>
				<select name="areaCodeId" id=""><option value="">请选择城市</option></select>
				<select name="countyId" id=""><option value="">请选择区县</option></select>
			</p>
			<p>
				<span>详细地址：</span>
				<textarea name="postalAddress" id="postalAddress" cols="74" rows="7" placeholder="建议您如实填写详细收货地址，例如街道名称、门牌号码、楼层和房间号等信息。" style="font-family: '微软雅黑';"></textarea>
			</p>
			<p>
				<span>联系人：</span>
				<input type="text" placeholder="长度不超过25个字符" name="consigneeName">
			</p>
			<p>
				<span>联系电话：</span>
				<input type="text" placeholder="请输入您的常用号码" name="mobile">
			</p>
			<span class="Form-editEddrress-save">保存</span>
		</div>
	</div>
	<div class="editAddress-dialog-overlay" style="display: none;"></div>
	<div class="container">
		<div class="top"></div>
		<div class="main">
			<div class="mainCommen"></div>
			<div class="historyOrder-con">
				<div class="historyOrder-left">
					<div class="titleCon">我的养车宝</div>
					<div class="selfPictur">
						<p class="pictureDetail"><img src="img/Avatar.jpg" width="150"height="150" /></p>
						<p class="selfName"><span>测试用户名</span></p>
					</div>
					<div class="orderList">
						<p>订单中心</p>
						<a title="我的订单" class="allOrder" href="historyOrder.html?title=我的订单"><p class="selfOrder"><span>我的订单</span></p></a>
						<a title="团购订单" class="groupOrder" href="historyOrder.html?title=团购订单"><p class="groupPurchaseOrder"><span>团购订单</span></p></a>
					</div>
					<div class="AccountCentral">
						<p>账户中心</p>
						<a title="" class="valueAddedInvoices checked" href="invoice.html"><p class="valueAddedInvoices"><span>增票资质管理</span></p></a>
					</div>
					<div class="edit">
						<p>设置</p>
						<a title="" class="editAddress"><p class="editAddress"><span>收货地址</span></p></a>
					</div>
				</div>
				<div class="historyOrder-right">
					<h2>填写增票资质信息:</h2>
					<div class="line_h2"><p></p></div><!--下划线-->
					<div class="invoice-content _fir">
						<input type="hidden" name="vatInvoiceId" value="" />
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								单位名称：
							</div>
							<div class="item2">
								<input type="text" id="unitName" maxlength="50"/>
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;单位名称不能超过指定的50个字符限制</span>
							</div>
							<div class="item4" style="display: none;">请填写单位名称</div>
							<div class="item5" style="display: none;"></div>
							<div class="clear"></div>
						</div>
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								纳税人识别码：
							</div>
							<div class="item2">
								<input type="text" id="identificationCode" maxlength="50"/>
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;纳税人识别码不能超过指定的50个字符限制</span>
							</div>
							<div class="item4" style="display: none;">请填写纳税人识别码</div>
							<div class="item5" style="display: none;"></div>
							<div class="clear"></div>
						</div>
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								注册地址：
							</div>
							<div class="item2">
								<input type="text" id="registeredAddress" maxlength="50"/>
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;注册地址不能超过指定的50个字符限制</span>
							</div>
							<div class="item4" style="display: none;">请填注册地址</div>
							<div class="item5" style="display: none;"></div>
							<div class="clear"></div>
						</div>
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								注册电话：
							</div>
							<div class="item2">
								<input type="text" id="registeredPhone" maxlength="50"/>
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;请输入正确格式的注册电话</span>
							</div>
							<div class="item4" style="display: none;">请填写注册电话</div>
							<div class="item5" style="display: none;"></div>
							<div class="clear"></div>
						</div>
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								开户银行：
							</div>
							<div class="item2">
								<input type="text" id="bank" maxlength="50"/>
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;开户银行不能超过指定的50个字符限制</span>
							</div>
							<div class="item4" style="display: none;">请填写开户银行</div>
							<div class="item5" style="display: none;"></div>
							<div class="clear"></div>
						</div>
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								银行账户：
							</div>
							<div class="item2">
								<input type="text" id="bankAccount" maxlength="50" />
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;请输入正确格式的银行账号</span>
							</div>
							<div class="item4" style="display: none;">请填写银行账户</div>
							<div class="item5" style="display: none;"></div>
							<div class="clear"></div>
						</div>
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								税务登记证副本：
							</div>
							<div class="item2 loaditem2" id="uploader0">
								<input type="hidden" id="hideImg0" value=""/>
								<div class="uploadBtn0">上传图片</div>
								<div class="uploaderNote">支持jpg/png图片</div>
								<div class="uploadList0"></div>
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;税务登记税证明话术</span>
							</div>
							<div class="item4" style="display: none;">请上传税务登记税副本</div>
							<div class="item5" style="display: none;"></div>
							<div class="clear"> </div>
							<div class="explanatory-note"> 
								<p>如果没有税务登记证副本，请您提供三证合一的营业执照扫描件：</p>
								<p>少数试点单位现营业执照、企业机构代码证、税务登记证简化为一张证照，即指三证合一的营业执照。</p>
							</div>
							<div class="clear"> </div>
						</div>
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								一般纳税人资格证明：
							</div>
							<div class="item2 loaditem2" id="uploader1">
								<input type="hidden" id="hideImg1" value=""/>
								<div class="uploadBtn1">上传图片</div>
								<div class="uploaderNote">支持jpg/png图片</div>
								<div class="uploadList1"></div>
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;一般纳税人资格证明话术</span>
							</div>
							<div class="item4" style="display: none;">请上传一般纳税人资格证明</div>
							<div class="item5" style="display: none;"></div>
							<div class="clear"> </div>
							<div class="explanatory-note">
								<p>如果没有一般纳税人证书，请您提供以下证件中任何一个扫描件：</p>
								<p>1.盖有“增值税一般纳税人”章的税务登记证副本；</p>
								<p>2.增值税一般纳税人资格登记表；</p>
								<p>3.国家税务局增值税一般纳税人资格认定批复件；</p>
								<p>4.国税局颁发的相关的一般纳税人税务事项通知书；</p>
								<p>5.发票票种核定表</p>
							</div>
							<div class="clear"></div>
						</div>
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								开户许可证：
							</div>
							<div class="item2 loaditem2" id="uploader2">
								<input type="hidden" id="hideImg2" value=""/>
								<div class="uploadBtn2">上传图片</div>
								<div class="uploaderNote">支持jpg/png图片</div>
								<div class="uploadList2"></div>
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;开户许可证话术</span>
							</div>
							<div class="item4" style="display: none;">请上传开户许可证</div>
							<div class="item5" style="display: none;"></div>
							<div class="explanatory-note"></div>
							<div class="clear"></div>
						</div>
						<div class="regLine">
							<div class="item1">
								<span class="ui-star">*</span>
								增票授权委托书：
							</div>
							<div class="item2 loaditem2 loadModel" id="uploader3">
								<input type="hidden" id="hideImg3" value=""/>
								<div class="uploadBtn3">上传图片</div>
								<div class="uploaderNote">支持jpg/png图片</div>
								<div class="uploadList3"></div>
								<a class="downLoad" href="model.doc">下载模板</a>
							</div>
							<div class="item3" style="display: none;">
								<span>&nbsp;增票授权委托书话术</span>
							</div>
							<div class="item4" style="display: none;">请上传增票授权委托书</div>
							<div class="item5" style="display: none;"></div>
							<div class="explanatory-note"></div>
							<div class="clear"></div>
						</div>
						<div id="reggingLine" class="regLine regLineService" style="display: none;">
							<div class="item1" style="height: 40px;line-height: 40px; float: left; width: 205px;"></div>
							<div class="item3" style="height: 40px;line-height: 40px;">
								<input id="regging" type="text" style="display: none; " />
							</div>
							<div style="
								line-height: 40px;
								padding-left: 0;
								background: none transparent scroll repeat 0% 0%;
								height: 40px;
								float: left;"
								class="item4">正在提交
							</div>
							<div class="clear"></div>
						</div>
						<div class="regLine">
							<div class="item1"></div>
							<div class="item3 submitItem3">
								<span class="submit submitOk">确定</span>
								<span class="submit submitCancel">取消</span>
							</div>
								
						</div>
						
					</div>
				</div>
			</div>
		</div>
		<div class="footer"></div>
	</div>
</body>
<script src="js/webuploader.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/uploader.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
/*
 *item3--规则话术--暂时不用
 *item4--错误提示+叉
 *item5--正确对钩
*/
if(!(document.cookie.indexOf('customerId')!=-1)){
   	location.href="index.html";
}
		var username=mall.getCookie('username');
		var customerId=mall.getCookie('customerId');
		var userInfoId=mall.getCookie('customerId');
		var areaCodeId=mall.getCookie('areaCodeId');
$(function(){
	var m=1;
	
	var $vatInvoiceId=$('input[name="vatInvoiceId"]');
	var $unitName=$("#unitName");
	var $identificationCode=$("#identificationCode");
	var $registeredAddress=$("#registeredAddress");
	var $registeredPhone=$("#registeredPhone");
	var $bank=$("#bank");
	var $bankAccount=$("#bankAccount");
	var $taxcodebakPic=$("#uploader0");				//税务登记证
	var $generalTaxpayerPic=$("#uploader1");		//一般纳税人资格证
	var $licensePic=$("#uploader2");				//开户证
	var $entrustPic=$("#uploader3");				//增票授权委托书
	
	var urlVatInvoiceId=$.getQuery('vatInvoiceId');
	if(!(urlVatInvoiceId==undefined||urlVatInvoiceId=='')){
		setInvoiceInfo();
	}
	//上传列表
		$("#unitName,#identificationCode,#registeredAddress,#registeredPhone,#bank,#bankAccount").focus(function(){
			$(this).parents('.regLine').find('.item5').hide();
			$(this).parents('.regLine').find('.item4').hide();
			$(this).parents('.regLine').find('.item3').show();
		})
		.blur(function(){
			Message(true,$(this));
		})
		//银行卡账号数据格式化
		$("#bankAccount").keyup(function(){
			this.value =this.value.replace(/\s/g,'').replace(/(\d{4})(?=\d)/g,"$1 ");
		})
		function Message(isCheck,Elem){
			var obj=Elem;
			var checkThrough=true;
			var objId=obj.attr('id');
			switch(objId){
				case 'unitName':
					if(cacctValidate(true,obj)){m++};
					break;
				case 'identificationCode':
					if(codeValidate(true,obj)){m++};
					break;
				case 'registeredAddress':
					if(addressValidate(true,obj)){m++};
					break;
				case 'registeredPhone':
					if(phoneValidate(true,obj)){m++};
					break;
				case 'bank':
					if(bankValidate(true,obj)){m++};
					break;
				case 'bankAccount':
					if(accountValidate(true,obj)){m++};
					break;
				default:
					break;
			}
			if(m<7){checkThrough=false;}
			return checkThrough;
		}
		function cacctValidate(isCheck,Elem){
			var cacct=Elem;
			var Value=$.trim(cacct.val());
			var checkThrough=true;
			if(Value==""){
				showErr(cacct,"请填写单位名称");
				checkThrough=false;
				return checkThrough;
			}
			regShowCheckThrough(cacct);
			return checkThrough;
		}
		function codeValidate(isCheck,Elem){
			var cacct=Elem;
			var Value=$.trim(cacct.val());
			var checkThrough=true;
			if(Value==""){
				showErr(cacct,"请填写纳税人识别码");
				checkThrough=false;
				return checkThrough;
			}
			regShowCheckThrough(cacct);
			return checkThrough;
		}
		function addressValidate(isCheck,Elem){
			var cacct=Elem;
			var Value=$.trim(cacct.val());
			var checkThrough=true;
			if(Value==""){
				showErr(cacct,"请填写注册地址");
				checkThrough=false;
				return checkThrough;
			}
			regShowCheckThrough(cacct);
			return checkThrough;
		}
		function phoneValidate(isCheck,Elem){
			var cacct=Elem;
			var Value=$.trim(cacct.val());
			var checkThrough=true;
			if(Value==""){
				showErr(cacct,"请填写注册电话");
				checkThrough=false;
				return checkThrough;
			}
			regTel=/^((\+?86)|(\(\+86\)))?\d{3,4}-?\d{7,8}(-?\d{3,4})?$/;
			regMobel=/^((\+?86)|(\(\+86\)))?1\d{10}$/;
			if((!regTel.test(Value))&&(!regMobel.test(Value))){
				showErr(cacct,"请输入正确格式的注册电话");
				checkThrough=false;
				return checkThrough;
			}
			
			regShowCheckThrough(cacct);
			return checkThrough;
		}
		function bankValidate(isCheck,Elem){
			var cacct=Elem;
			var Value=$.trim(cacct.val());
			var checkThrough=true;
			if(Value==""){
				showErr(cacct,"请填写开户银行");
				checkThrough=false;
				return checkThrough;
			}
			regShowCheckThrough(cacct);
			return checkThrough;
		}
		function accountValidate(isCheck,Elem){
			var cacct=Elem;
			var Value=$.trim(cacct.val());
			var checkThrough=true;
			Value=Value.replace(/\s+/g,"");
			if(Value==""){
				showErr(cacct,"请填写银行账户");
				checkThrough=false;
				return checkThrough;
			}
			reg=/^[0-9]{12,24}$/;
			if(!reg.test(Value)){
				showErr(cacct,"请输入正确格式的银行账号");
				checkThrough=false;
				return checkThrough;
			}
			regShowCheckThrough(cacct);
			return checkThrough;
		}
		function imgUploadValidate(){
			var checkThrough=true;
			$("div.regLine div.loaditem2").each(function(i){
				var $dndAre=$(this).find('#hideImg'+i);
				if($dndAre.val()!=''){
					m++;
					regShowCheckThrough($(this));
				}else{
					showErr($(this),'请上传资料图片');
				}
			});
			if(m<5){checkThrough=false;}
			return checkThrough;
		}
		function showErr(obj, str)
		{
			if (obj.attr("id") == "regging") {
				if (str != "") {
					$("#reggingLine").show();
				} else {
					$("#reggingLine").hide();
				}
			}
			if (str != "") {
				obj.parents(".regLine").find(".item4").show();
				obj.parents(".regLine").find(".item4").text(str);
			} else {
				obj.parents(".regLine").find(".item4").hide();
				obj.parents(".regLine").find(".item4").text(str);
			}
			obj.parents(".regLine").find(".item3").hide();
			obj.parents(".regLine").find(".item5").hide();
		}
		function regShowCheckThrough(obj, options){
			var regline_parent = obj.parents(".regLine"); // cache parent
			var reg_item5 = regline_parent.find('.item5');
			reg_item5.show();
			regline_parent.find('.item4').hide();
			regline_parent.find('.item3').hide();
			if( options ){
				if( options.itemExtText ){
					reg_item5.text( options.itemExtText );
				}
			}
		}
//		
//		$("div.statusBar").on('click','.ReuploadBtn',function(){
//			var a=$(this).parents('.loaditem2').attr("id");
//			var b=a.substr(-1,1);
//			var Num=parseInt(b);
//			var initStr='<div class="progress"><span class="text">0%</span><span class="percentage"></span></div><div class="info"></div><div class="btns"><div class="uploadBtn">开始上传</div></div>'
//			var initStrUl='<div id="dndArea" class="placeholder"><div id="filePicker4"></div><span class="load-note">支持jpg/png格式</span></div>'
//			$(this).html(initStr);
//			$(this).siblings().eq(0).html(initStrUl);
//			uploader.mm($(this),Num);
//		})
		function submit(){
		$(".submitOk").click(function(){
			var valid=true;
			if(!cacctValidate(true,$("#unitName"))){valid=false};
			if(!codeValidate(true,$("#identificationCode"))){valid=false};
			if(!addressValidate(true,$("#registeredAddress"))){valid=false};
			if(!phoneValidate(true,$("#registeredPhone"))){valid=false};
			if(!bankValidate(true,$("#bank"))){valid=false};
			if(!accountValidate(true,$("#bankAccount"))){valid=false};
			if(!imgUploadValidate()){valid=false};
			
			if(!valid){
				showErr($("#regging"), "提交信息有误，请检查您填写的信息。");
				return false;
			}else{
				showErr($("#regging"),"正在提交信息，请稍后……");
			}
			
			var bankAccount=$.trim($("#bankAccount").val());
			bankAccount=bankAccount.replace(/\s+/g,"");
			var postData={};
			postData.userInfoId=userInfoId;
			postData.unitName=$.trim($("#unitName").val());
			postData.identificationCode=$.trim($("#identificationCode").val());
			postData.registeredAddress=$.trim($("#registeredAddress").val());
			postData.registeredPhone=$.trim($("#registeredPhone").val());
			postData.bank=$.trim($("#bank").val());
			postData.bankAccount=bankAccount;
			postData.taxcodebakPicUrl=$("#hideImg0").val();//税务登记证副本图
			postData.generalTaxpayerPicUrl=$("#hideImg1").val();//一般纳税人资格证明图
			postData.licensePicUrl=$("#hideImg2").val();//开户许可证图
			postData.entrustPicUrl=$("#hideImg3").val();//增票授权委托书图
			postData.operator=username;

			$.ajax({
				type:"post",
				url:mall.url('/vatInvoice/replace'),
				async:false,
				data:$.toJSON(postData),
				dataType:'json',
				contentType:'application/json;charset=utf-8',
				success:function(data){
					var vatInvoiceId=data.vatInvoiceId;//增值税发票资质ID
					var vatStatus=data.vatStatus;//增票资质状态 0.无效,1.待审核,2.审核通过,3.驳回(此接口理论上只返回1)
					if(vatStatus===1){
						var vatInvoiceId=$('input[name="vatInvoiceId"]').val();
						if(vatInvoiceId!=''){
							mall.alertReFun('增票信息已修改成功，公司将在三个工作日内进行审核','增票资质修改',turnNewPage);
						}else{
							mall.alertReFun('增票信息已提交，公司将在三个工作日内进行审核','增票资质添加',turnNewPage);
						}
						function turnNewPage(){
							window.location.href="invoice.html";
						}
					}
				},
				error:function(xhr){
					var error =JSON.parse(xhr.responseText);
					showErr($("#regging"),error[0].message);
				}
			});
		})
		}
		submit();
		
		//取消
		function cancelInv(){
			$(".submitCancel").click(function(){
				window.history.go(-1);
			});
		}
		cancelInv();
		

		function setInvoiceInfo(){
			$.ajax({
				type:'get',
				url:mall.url('/vatInvoice/get'),
				data:{userInfoId:customerId},
				async:false,
				dataType:"json",
				contentType:"application/json;charset=utf-8",
				success:function(data){
					assign(data);
				},
				error:function(xhr){
					var error=JSON.parse(xhr.responseText);
					mall.alertRe(error[0].message,"");
				}
			});
		}
		
		function assign(information){
			var data=information;
			var bankAccount=data.bankAccount;
			bankAccount=bankAccount.replace(/\s+/g,"");
			bankAccount=bankAccount.replace(/(.{4})/g,"$1 ");
			$vatInvoiceId.val(data.vatInvoiceId);
			$unitName.val(data.unitName);
			$identificationCode.val(data.identificationCode);
			$registeredAddress.val(data.registeredAddress);
			$registeredPhone.val(data.registeredPhone);
			$bank.val(data.bank);
			$bankAccount.val(bankAccount);
			assignImg(0,data.taxcodebakPicUrl,$taxcodebakPic);
			assignImg(1,data.generalTaxpayerPicUrl,$generalTaxpayerPic);
			assignImg(2,data.licensePicUrl,$licensePic);
			assignImg(3,data.entrustPicUrl,$entrustPic);
		}
		function assignImg(num,imgUrl,obj){
			var uploader=obj;
			var imgStr='';
				imgStr+='<div id="Pic'+num+'" class="file-item thumbnail">' +
						'<img src="'+imgUrl+'">' +
						'</div>'
			uploader.find("div.uploadList"+num).html(imgStr);
			$("#hideImg"+num).val(imgUrl);
		}
});


$(function(){
		$('div.top').load('top.html');
		$('div.mainCommen').load('searchAndNav.html');
		$('div.footer').load('footer.html');

		var provinceId="";		//省份ID
		var areaCodeId="";		//城市ID
		var countyId="";		//区县ID
		var provinceName="";	//省份名称
		var areaCodeName="";	//城市名称
		var countyName="";		//区县名称
		var postalAddress="";	//收货详细地址
		var consigneeName="";	//联系人名字
		var mobile="";
		$('p.accoutDetail').html('账号：'+username);
		$("p.selfName span").html(username);
		//订单类型点击
		//设置收货地址
		$('div.edit a.editAddress').unbind('click').bind('click',function(){
			var _url=mall.url('/user/delivery/detail');
			_url+='?userInfoId='+userInfoId;
			$.ajax({
				type:"get",
				url:_url+'&'+new Date().getTime(),
				async:false,
				dataType:'json',
				contentType:"application/json;charset=utf-8",
				success:function(data){
					provinceId=data.provinceId;
					provinceName=data.provinceName;
					areaCodeId=data.areaCodeId;
					areaCodeName=data.areaCodeName;
					countyId=data.countyId;
					countyName=data.countyName;
					postalAddress=data.postalAddress;
					consigneeName=data.consigneeName;
					mobile=data.mobile;
					$('div.Form-editEddrress').show();
					$('.dialog-overlay').show();
		 			$.get(mall.url('/areaCode/getOpeningProvicnes'),function(data){
						var proStr='<option value="">请选择省份</option>'
						$.each(data,function(){
							if(this.id==provinceId){
								proStr+='<option value="'+this.id+'" selected="true">'+this.provinceName+'</option>'
							}else{
								proStr+='<option value="'+this.id+'">'+this.provinceName+'</option>'
							}
						});
						$('select[name="provinceId"]').html(proStr);
						provinceId=$('select[name="provinceId"]').val();
					});
								
				$.get(mall.url('/areaCode/getOpeningCities'),{provinceId:provinceId},function(data2){
					var cityStr='<option value="">请选择城市</option>'
					$.each(data2,function(){
						if(this.id==areaCodeId){
							cityStr+='<option value="'+this.id+'" selected="true">'+this.municipalityName+'</option>'
						}else{
							cityStr+='<option value="'+this.id+'">'+this.municipalityName+'</option>'
						}
					});
					$('select[name="areaCodeId"]').html(cityStr);
					areaCodeId=$('select[name="areaCodeId"]').val();
				});
				
				$.get(mall.url('/areaCode/countries'),{cityId:areaCodeId},function(data3){
					var countyStr='<option value="">请选择区县</option>';
					$.each(data3,function(){
						if(this.id==countyId){
							countyStr+='<option value="'+this.id+'" selected="true">'+this.countyName+'</option>'
						}else{
							countyStr+='<option value="'+this.id+'">'+this.countyName+'</option>'
						}
					});
					$('select[name="countyId"]').html(countyStr)
				});
				$('select[name="provinceId"]').change(function(){
					$('select[name="areaCodeId"]').html('<option value="">请选择城市</option>');
					$('select[name="countyId"]').html('<option value="">请选择区县</option>');
					provinceId=$(this).val();
					$.get(mall.url('/areaCode/getOpeningCities'),{provinceId:provinceId},function(data2){
						var cityStr='<option value="">请选择城市</option>'
						$.each(data2,function(){
							cityStr+='<option value="'+this.id+'">'+this.municipalityName+'</option>'
						});
						$('select[name="areaCodeId"]').html(cityStr);
					});
				});
				$('select[name="areaCodeId"]').change(function(){
					$('select[name="countyId"]').html('<option value="">请选择区县</option>');
					areaCodeId=$(this).val();
					$.get(mall.url('/areaCode/countries'),{cityId:areaCodeId},function(data3){
						var countyStr='<option value="">请选择区县</option>';
						$.each(data3,function(){
							countyStr+='<option value="'+this.id+'">'+this.countyName+'</option>'
						});
						$('select[name="countyId"]').html(countyStr)
					});
				});
				$('textarea[name="postalAddress"]').val(postalAddress);
				$('input[name="consigneeName"]').val(consigneeName);
				$('input[name="mobile"]').val(mobile);
				$('span.Form-editEddrress-save').unbind('click').bind('click',function(){
					var postData={};
					postData.userInfoId=userInfoId;
					postData.consigneeName=$('input[name="consigneeName"]').val();
					postData.mobile=$('input[name="mobile"]').val();
					postData.provinceId=$('select[name="provinceId"]').val();
					postData.areaCodeId=$('select[name="areaCodeId"]').val();
					postData.countyId=$('select[name="countyId"]').val();
					postData.postalAddress=$('textarea[name="postalAddress"]').val();
					if(postData.provinceId==''||postData.areaCodeId==''||postData.countyId==''){
						$('div.Form-editEddrress-con p.ui-note').html('请选择所在省市区');
						return false
					}
					$.ajax({
						type:'post',
						url:mall.url('/user/delivery/replace'),
						data:$.toJSON(postData),
						dataType:'json',
						contentType:'application/json;charset=utf-8',
						success:function(data){
							$('p.ui-note').html('');
							$('div.Form-editEddrress').hide();
							$('div.dialog-overlay').hide();
						},
						error:function(xhr){
							var error=eval('('+xhr.responseText+')');
							$('div.Form-editEddrress-con p.ui-note').html(error[0].message)
						}
					})
				});
				$('div.Form-editEddrress img.dialog-close').unbind('click').bind('click',function(){
					$('p.ui-note').html('');
					$('div.Form-editEddrress').hide();
					$('div.dialog-overlay').hide()
				})
				}
			});
		});
//		$('p.safeQuit span').unbind('click').bind('click',function(){
//			$.ajax({
//	            url : "/ycbmall-uc-ws/ws/0.1/logout",
//	            contentType : "application/json;charset=utf-8",
//	            dataType : "json",
//	            type : "GET",
//	            success : function(data) {
//	            	delCookie('username');
//	            	delCookie('customerId');
//	                window.location = "index.html"
//	            },
//	            error: function(xhr){
//	                var status = xhr.status;
//	                if (status == 200) {
//	                	delCookie('username');
//		            	delCookie('customerId');
//	                    window.location = "index.html"
//	                }
//	            }
//	        });
//		});
		$(".dialog-close").click(function(){
			$(".dialog").hide();
			$(".dialog-overlay").hide();
		});
		$(".dialog-no").click(function(){
			$(".dialog").hide();
			$(".dialog-overlay").hide();
		});
	})

</script>
</html>