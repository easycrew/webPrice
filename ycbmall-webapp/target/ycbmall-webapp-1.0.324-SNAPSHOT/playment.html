<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit">
	<meta name="keywords" content="养车宝，配件商城">
	<meta name="description" content="养车宝配件商城，100%原厂品质，3M、威固、美孚、壳牌Ahell、普利司通、米其林等汽车配件，厂价直销！">
	<title>全网正品汽车配件_养车宝配件商城！</title>
	<link rel="icon" href="favicon.ico">
	<script src="js/jquery-1.10.1.min.js"></script>
	<script language="javascript" src="js/jquery.json-2.2.js"></script> 
	<script src="js/common.js"></script>
	<script src="js/jquery.urlParam.js"></script>
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/playment.css">
	<link rel="stylesheet" href="css/orderDetail.css">
	<link rel="stylesheet" href="css/checkOrderInfo.css">
	<link rel="stylesheet" href="css/selectCharge.css">
	<link rel="stylesheet" href="css/login.css">
	</head>
	<body>
		<div class="Form-goCharge dialog" style="display:none;">
		<div class="dialog-title"><h3></h3><img src="img/alertRe_close.png" class="dialog-close"></div>
		<div class="dialog-con">
			<p class="account">请在单独打开的界面中进行支付。</p>
			<p class="chargeSucAndchargeFail"><span class="chargeSucBtn">支付成功</span><span class="chargeFailBtn">支付遇到问题</span></p>
		</div>
	</div>
	<div class="dialog-overlay" style="display:none;"></div>
	<div class="Form-bank-list" style="display:none;">
		<div class="dialog-title"><h3>选择银行</h3><img src="img/alertRe_close.png" class="dialog-close"></div>
		<div class="form-bank-con">
			<ul>
				<li><input type="radio" name="bankName" value="CMB" checked><img src="img/bankLogo/CMB.png" alt="招商银行"></li>
				<li><input type="radio" name="bankName" value="ABC"><img src="img/bankLogo/ABC.png" alt="中国农业银行"></li>
				<li><input type="radio" name="bankName" value="CCB"><img src="img/bankLogo/CCB.png" alt="中国建设银行"></li>
				<li><input type="radio" name="bankName" value="BJBANK"><img src="img/bankLogo/BJBANK.png" alt="北京银行"></li>
				<li><input type="radio" name="bankName" value="CIB"><img src="img/bankLogo/CIB.png" alt="兴业银行"></li>
				<li><input type="radio" name="bankName" value="COMM"><img src="img/bankLogo/COMM.png" alt="交通银行"></li>
				<li><input type="radio" name="bankName" value="SHBANK"><img src="img/bankLogo/SHBANK.png" alt="上海银行"></li>
				<li><input type="radio" name="bankName" value="SPDB"><img src="img/bankLogo/SPDB.png" alt="上海浦东发展银行"></li>
				<li><input type="radio" name="bankName" value="CMBC"><img src="img/bankLogo/CMBC.png" alt="中国民生银行"></li>
				<!-- <li><input type="radio" name="bankName" value=""><img src="img/bankLogo/HXBANK.png" alt="华夏银行"></li> -->
				<li><input type="radio" name="bankName" value="ICBCB2C"><img src="img/bankLogo/ICBCB2C.png" alt="工商银行"></li>
				<li><input type="radio" name="bankName" value="BOCB2C"><img src="img/bankLogo/BOCB2C.png" alt="中国银行"></li>
				<li><input type="radio" name="bankName" value="PSBC"><img src="img/bankLogo/PSBC.png" alt="邮政银行"></li>
				<li><input type="radio" name="bankName" value="SPABANK"><img src="img/bankLogo/SPABANK.png" alt="平安银行"></li>
				<li><input type="radio" name="bankName" value="GDB"><img src="img/bankLogo/GDB.png" alt="广发银行"></li>
				<li><input type="radio" name="bankName" value="BJRCB"><img src="img/bankLogo/BJRCB.png" alt="北京农商银行"></li>
				<li><input type="radio" name="bankName" value="CITIC"><img src="img/bankLogo/CITIC.png" alt="中信银行"></li>
			</ul>
			<p class="bankSure"><span class="bankSureBtn">确定</span></p>
		</div>
	</div>
		<div class="container">
			<div class="top"></div>
			
			<div class="main">
				<div class="mainCommen"></div>
				<div class="orderDetail" style="display: none;">
				<div class="orderDetail-top"><h2>订单详情</h2><a class="back">返回></a></div>
				<div class="orderDetail-main">
					<h3><img src="img/orderDetail_h3Img.png">订单详情</h3>
					<div class="buyerInfo">
						<div class="buyerAddress">
							<p>
								<span class="buyerInfoText">买家信息</span>
								<span class="buyerAddressDetail"></span>
							</p>
							<p>
								<span class="shopName">店名:汽车用品店</span>
							</p>
							
						</div>
						<div class="buyerContact">
							<p class="buyerContact_p1">
								<span class="buyerName"></span>
								<span class="bringType">配送方式：养车宝配送</span>
							</p>
							<p class="buyerContact_p2">
								<span class="buyerTel"></span>
								<span class="chargeType"></span>
							</p>
						</div>
					</div>
					<div class="theOrderInfo">
						<div class='theOrderInfo-top'>
							<div class="theOrderStatus">
								<span class="theOrderInfoText">订单信息</span>
								<span class="theOrderStatusDetail"><!--订单状态：待确认--></span>
							</div>
							<div class="theOrderNumber">
								<span class="theOrderNumberDetail"><!--订单号：C15052705001047--></span>
								<span class="theOrderTime"><!--下单时间：2015-04-23 23:34:15--></span>
							</div>
						</div>
						<div class="theOrderInfo-main">
							<table class="Table-theOrderInfo" cellpadding="0" cellspacing="0">
								<thead>
									<td class="goodsName">商品信息</td>
									<!--<td>型号规格</td>-->
									<td>价格</td>
									<td>数量</td>
									<!--<td class="operate">操作</td>-->
								</thead>
								<tbody>
									
								</tbody>
							</table>
							<div class="theOrderInfo-main-bottom">
								<p class="goodsAllPrice">商品总价：<span class="goodsAllPrice-detail"><!--￥339.99--></span>快递费：<span class="postMoney"><!--+￥50.00--></span></p>
								<p class="realCharge">
									余额支付金额：<span class="balancePayment" style="padding-right: 20px;">￥0</span> 
									实付款：<span class="realChargeDetail"><!--￥65.63--></span>
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
				<div class="selectCharge">
					<div class="myShopCar-con-topRight">
						<ul>
							<li>
								<div class="li-top">
									<p class="third-line-left line line-left thisP"></p>
									<p class="third-circle circleTh">3</p>
									<p class="third-line-right line line-right thisP"></p>
								</div>
								<div class="li-bottom thisBottom">提交订单</div>
							</li>
							<li class="li-second">
								<div class="li-top">
									<p class="second-line-left line line-left thisP"></p>
									<p class="second-circle circleTh">2</p>
									<p class="second-line-right line line-right thisP"></p>
								</div>
								<div class="li-bottom thisBottom">填写核对订单信息</div>
							</li>
							<li class="li-first">
								<div class="li-top">
									<p class="first-line-left line line-left thisP"></p>
									<p class="first-circle circleTh">1</p>
									<p class="first-line-right line line-right thisP"></p>
								</div>
								<div class="li-bottom thisBottom">我的购物车</div>
							</li>
						</ul>
					</div>
					<div class="orderPrice">
						<p class="orderPrice-detail">
							<span>订单号：</span><span class="orderPrice-orderNumber" id=""></span>
							<span>余额支付金额：</span><span class="orderPrice-balancePayment" style="padding-right: 20px; color: #FD6244;"></span>
							<span>还需支付金额：</span><span class="orderPrice-chargePrice"></span>
						</p>
						<p class="orderPrice-note">请您在提交订单 <span class="limitChargeTime">24小时</span> 内完成支付，否则订单会自动取消。</p>
						<p class="orderPrice-checkOrderDetail"><a>[查看订单详情]</a></p>
					</div>
					<div class="selectChargeDetail">
						<h2>请选择支付方式</h2>
						<div class="selectChargeDetail-con">
							<form action='/ycbmall-ws/ws/0.1/userorder/topay' method="post" class="Form-selectChargeDetail-con" target="_blank">
								<input type="hidden" name="userInfoId">
								<input type="hidden" name="orderNumber">
								<input type="hidden" name="payChannelKey" value="alipay.web">
								<span class='span_wraper Alipay clickSpan_wraper'><input type="radio" name="bankcode" value="alipay" checked="checked"><span class="zfbImg"><img src="img/zfb_img.png"></span></span>
								<span class='span_wraper bannk_pay'><input type="radio" name="bankcode" value="bank" class="bankcode"><span class="bankText">银行卡支付</span></span>
								<span class='span_wraper underLine_pay'><input type="radio" name="underLinecode" value="underLine" class="underLine"><span class="lineText">线下汇款</span></span>
							</form>
						</div>
						<div class="chargeNext"><span>下一步</span></div>
					</div>
				</div>
			</div>
			<div class="footer"></div>
		</div>
		

	</body>
<script type="text/javascript">
if(!(document.cookie.indexOf('customerId')!=-1)){
	location.href="index.html";
}
	$(function(){
		$('div.top').load('top.html');
		$('div.mainCommen').load('searchAndNav.html');
		$('div.footer').load('footer.html');
		var username=mall.getCookie('username');
		var customerId=mall.getCookie('customerId');
		var areaCodeId=mall.getCookie('areaCodeId');
		$("span.span_wraper:eq(0)").find('input[type="radio"]').prop('checked',true);
		$("span.span_wraper:eq(1)").find('input[type="radio"]').prop('checked',false);
		$("span.span_wraper:eq(2)").find('input[type="radio"]').prop('checked',false);
		var url = window.location.search; 
	    var paramJson = {};
	    if(url!=''){
	    	var paramsArr = (url.split("?")[1]).split("&");
		    $.each(paramsArr,function(i){
		        var item = paramsArr[i].split("=");
		        paramJson[item[0]] = item[1]
		    });
	    }
	    var orderNumber=paramJson.orderNumber;
	    //$('div.selectCharge p.orderPrice-checkOrderDetail a').attr('href','orderDetail.html?orderNumber='+orderNumber);
	    $.get(mall.url('/userorder/detail'),{orderNumber:orderNumber},function(data){
			$('div.selectCharge span.orderPrice-orderNumber').attr('id',data.userOrderId).html(data.orderNumber);
			$("div.selectCharge span.orderPrice-balancePayment").html('￥'+data.balancePayment);
			$('div.selectCharge span.orderPrice-chargePrice').html('￥'+data.cashPayment);
		});
		$('div.selectCharge div.chargeNext span').unbind('click').bind('click',function(){
			//隐藏的参数字段
			var userInfoId=-1;
			$('div.selectCharge input[name="userInfoId"]').val(customerId);
			$('div.selectCharge input[name="orderNumber"]').val(orderNumber);
			$('div.selectCharge input[name="payChannelKey"]').val('alipay.web');
			$("form.Form-selectChargeDetail-con span").each(function(){
				if($(this).hasClass('clickSpan_wraper')&&$(this).hasClass('underLine_pay')){
					$('div.selectCharge input[name="payChannelKey"]').val('underLine_pay');
				}
			})
			$.ajax({
			type:"get",
				url:mall.url('/user/shoppingcard/checkOrderSku'),
				async:false,
				data:{userInfoId:customerId,orderNumber:orderNumber,areaCodeId:areaCodeId},
				dataType:"json",
				contentType:"application/json;charset=utf-8",
				success:function(){
					var payChannelKey=$('div.selectCharge input[name="payChannelKey"]').val();
					if(payChannelKey==='underLine_pay'){
						window.location.href='underLinePay.html?orderNumber='+orderNumber;//跳转线下汇款
						return false
					}
					$('div.Form-goCharge').show();
					$('div.dialog-overlay').show();
					$('div.Form-goCharge img.dialog-close,div.Form-goCharge span.chargeSucBtn').unbind('click').bind('click',function(){
						window.location.href="historyOrder.html?userInfoId="+customerId;
					});
					$('div.Form-goCharge img.dialog-close,div.Form-goCharge span.chargeFailBtn').unbind('click').bind('click',function(){
						window.location.href="alipay_web_fail.html";
					});
					$('div.selectCharge form.Form-selectChargeDetail-con').submit();
				},
				error:function(xhr){
					var error =JSON.parse(xhr.responseText);
					mall.alertRe(error[0].message,"");
				}
				
			});
		})
		//银行卡支付
		$('div.selectChargeDetail-con span.bannk_pay ').click(function(){
			var thisElem=$(this);
			if($(this).find('input[type="radio"]').hasClass('bankcode')){
				$('div.Form-bank-list').show();
				$('.login-dialog-overlay').show();
				$('div.Form-bank-list input[name="bankName"]:checked').prop("checked",false);
				$('div.Form-bank-list input[name="bankName"]:first').prop("checked",true);
				$('div.Form-bank-list img.dialog-close').unbind('click').bind('click',function(){
					$('div.Form-bank-list').hide();
					$('.login-dialog-overlay').hide()
				});
				$('div.Form-bank-list span.bankSureBtn').unbind('click').bind('click',function(){
					thisElem.siblings().removeClass('clickSpan_wraper').find('input[type="radio"]').prop('checked',false);
					thisElem.addClass('clickSpan_wraper').find('input[type="radio"]').prop('checked',true);
					var theValue=$('input[name="bankName"]:checked').val();
					$('form.Form-selectChargeDetail-con input.bankcode').val(theValue);
					$('form.Form-selectChargeDetail-con span.bankText').html('<img src="img/bankLogo/'+theValue+'.png">');
					bankValue=theValue;
					$('div.Form-bank-list').hide();
					$('.login-dialog-overlay').hide();
				})
				}
		});
		//支付宝支付
		$('div.selectChargeDetail-con span.Alipay').click(function(){
			$(this).siblings().removeClass('clickSpan_wraper').find('input[type="radio"]').prop('checked',false);
			$(this).addClass('clickSpan_wraper').find('input[type="radio"]').prop('checked',true);
			$('form.Form-selectChargeDetail-con span.bankText').html('银行卡支付');
		});
		
		//线下汇款
		$("div.selectChargeDetail-con span.underLine_pay").click(function(){
			$(this).siblings().removeClass('clickSpan_wraper').find('input[type="radio"]').prop('checked',false);
			$(this).addClass('clickSpan_wraper').find('input[type="radio"]').prop('checked',true);
			
		})
		var bankImgLog="";
		var bankValue="";
		if($('div.selectChargeDetail-con span.bannk_pay input[type="radio"]').prop("checked")){
			
		
		$('form.Form-selectChargeDetail-con input.bankcode').val(bankValue);
		$('form.Form-selectChargeDetail-con span.bankText').html('<img src="img/bankLogo/'+bankValue+'.png">');
		}
		$("p.orderPrice-checkOrderDetail a").click(function(){
			$("div.orderDetail").show();
			$("div.selectCharge").hide();
			searchOrderInf(orderNumber);
		})
		$("div.orderDetail a.back").click(function(){
			$("div.orderDetail").hide();
			$("div.selectCharge").show();
		})
		function searchOrderInf(orderNumber){
		$.get(mall.url('/userorder/detail'),{orderNumber:orderNumber},function(data){
			var entityId=data.entityId;
			$('span.buyerAddressDetail').html('收货地址：'+data.postalAddress);
			$('span.shopName').html('店名：'+username);
			$('span.buyerName').html('联系人：'+data.consigneeName);
			$('span.buyerTel').html('联系电话：'+data.mobile);
			$('span.chargeType').html('支付方式：'+data.payOnlineName);
			$('span.theOrderNumberDetail').html('订单号：'+data.orderNumber);
			$('span.theOrderTime').html('下单时间：'+data.orderDate);
			switch(data.orderStatus){
				case "1":
					if(data.remitAuditStatus==1){
						$('span.theOrderStatusDetail').html('订单状态：汇款确认中...');
					}else{
						$('span.theOrderStatusDetail').html('订单状态：待付款');
					}
					break;
				case "2":
				case "3":
				case "4":
					$('span.theOrderStatusDetail').html('订单状态：待发货');
					break;
				case "5":
					$('span.theOrderStatusDetail').html('订单状态：待收货');
					break;
				case "6":
					$('span.theOrderStatusDetail').html('订单状态：已完成');
					break;
				case "7":
					$('span.theOrderStatusDetail').html('订单状态：已评价');
					break;
				case "8":
					$('span.theOrderStatusDetail').html('订单状态：'+data.orderStatusName);
					break;
				default:
					break;
			}			
			var orderDetailStr='';
			var skulist=data.skulist;
			$.each(skulist,function(i){
				
				if(i==0){
					if(skulist.length>1){
						orderDetailStr+='<tr class="tr-detailCon-first">'
									   +'<td class="td-goodsname" style="text-align:left;padding-left:40px;">'
									   +'<a href="javascript:" class="goodsImg" onclick="judgeStatus('+this.skuId+','+entityId+','+this.commodityId+')">'
									   if(this.commodityType==2){
								  			orderDetailStr+='<i>专享</i>'
								  		}
									   orderDetailStr+='<img src="'+this.smallPicUrl+'" width="78" height="78">'
									   +'</a>'
									   var item_name=this.skuName;
									  if(item_name.length>61){
										item_name=item_name.substring(0,60)+'…'
									  };
					    orderDetailStr+='<span class="goodsNameDetail"><span>'+item_name+'</span></span>'
									   +'</td>'
									   //+'<td>'+this.productModel+'</td>'
									   +'<td>'+this.skuPrice+'</td>'
									   +'<td class="td-goodsPrice" style="border-right:1px solid #e8e8e8">×'+this.skuNum+'</td>'
//									   +'<td class="td-operate firstLength1">'
					}else{
						orderDetailStr+='<tr class="tr-detailCon-first">'
									   +'<td class="td-goodsname" style="text-align:left;padding-left:40px;">'
									   +'<a href="javascript:" class="goodsImg" onclick="judgeStatus('+this.skuId+','+entityId+','+this.commodityId+')">'
									  if(this.commodityType==2){
								  			orderDetailStr+='<i>专享</i>'
								  		}
									   orderDetailStr+='<img src="'+this.smallPicUrl+'" width="78" height="78">'
									   +'</a>'
									   var item_name=this.skuName;
									  if(item_name.length>61){
										item_name=item_name.substring(0,60)+'…'
									  }
					    orderDetailStr+='<span class="goodsNameDetail"><span>'+item_name+'</span></span>'
									   +'</td>'
									   //+'<td>'+this.productModel+'</td>'
									   +'<td>'+this.skuPrice+'</td>'
									   +'<td class="td-goodsPrice" style="border-right:1px solid #e8e8e8">×'+this.skuNum+'</td>'
//									   +'<td class="td-operate">'
					}
//				    
				}else{
					orderDetailStr+='<tr class="tr-detailCon">'
								  +'<td class="td-goodsname" style="text-align:left;padding-left:40px;">'
								  +'<a href="javascript:" class="goodsImg" onclick="judgeStatus('+this.skuId+','+entityId+','+this.commodityId+')">'
								  if(this.commodityType==2){
							  			orderDetailStr+='<i>专享</i>'
							  		}
								   orderDetailStr+='<img src="'+this.smallPicUrl+'" width="78" height="78">'
								   +'</a>'
								   var item_name=this.skuName;
								  if(item_name.length>61){
									item_name=item_name.substring(0,60)+'…'
								  }
				    orderDetailStr+='<span class="goodsNameDetail"><span>'+item_name+'</span></span>'
								  +'</td>'
								  //+'<td>'+this.productModel+'</td>'
								  +'<td>'+this.skuPrice+'</td>'
								  +'<td class="td-goodsPrice" style="border-right:1px solid #e8e8e8">×'+this.skuNum+'</td>'
				}
				    	orderDetailStr+='</tr>'
			});
			$('table.Table-theOrderInfo tbody').html(orderDetailStr);

			$('span.goodsAllPrice-detail').html('￥'+data.originalPayment);
			$('span.postMoney').html('￥'+'0');
			$('span.realChargeDetail').html('￥'+data.cashPayment);
			$(".balancePayment").html('￥'+data.balancePayment);
		});
		}
	});
function judgeStatus(skuId,entityId,commodityId){
	$.get(mall.url('/sku/getSkuById'),{skuId:skuId},function(data){
		if(data.status!=1){
			mall.alertRe("该商品已下架","");
			return false;
		}else{
			location.href='goodsDetail.html?groupPurchasingId='+entityId+'&skuId='+skuId+'&commodityId='+commodityId;
		}
	})
}
	</script>
</html>
