<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit">
	<meta name="keywords" content="养车宝，配件商城">
	<meta name="description" content="养车宝配件商城，100%原厂品质，3M、威固、美孚、壳牌Ahell、普利司通、米其林等汽车配件，厂价直销！">
	<title>全网正品汽车配件_养车宝配件商城！</title>
	<link rel="icon" href="favicon.ico">
	<script src="js/jquery-1.10.1.min.js"></script>
	<script language="javascript" src="js/jquery.json-2.2.js"></script> 
	<script src="js/jquery.urlParam.js"></script>
	<script src="js/common.js"></script>
	<script src="http://pv.sohu.com/cityjson?ie=utf-8"></script><!--根据IP地址获取当前所在地城市-->
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/login.css">
	<link rel="stylesheet" href="css/goodsDetail.css">
	<link rel="stylesheet" href="css/product.css">
	<style type="text/css">
		.sellingPriceRange_change{
			font-family: "微软雅黑"!important;
			font-size: 24px!important;
			cursor: pointer;
		}
		
	</style>
	<script type="text/javascript">
function iframeResize(iframe) {
	try {
	    var idocumentElement = iframe.contentWindow.document.documentElement;
	    if (idocumentElement.scrollHeight > 560) {
	        iframe.height -= 5;
	        iframe.height = idocumentElement.scrollHeight;
	    }
	    else {
	        iframe.height = 560;
	    }
	}
	catch (e) {
	    window.status = 'Error: ' + e.number + '; ' + e.description;
	}
}
	</script>
</head>
<body>
	<!--<div class="dialog-overlay" style="display:none;"></div>-->
	<!--<div class="login-dialog-overlay" style="display:none;"></div>-->
	<div class="putShopCar-success" style="display:none;">
		<div class="hsaPutShopCarImg">
			<img src="img/has_putShopCar.png">
		</div>
		<div class="hasPutShopCarText">
			<p class="p_one">商品已成功加入购物车！</p>
			<p class="p_two">
				<span class="tocarSettle"><a href="myShopCar.html">去购物车结算</a></span>
				<span class="continueShop">您还可以<a href="javascript:">继续购物</a></span>
			</p>
		</div>
	</div>
	<div class="container">
		<div class="top"></div>
		<div class="main">
			<div class="mainCommen"></div>
			<div class="smallNav">您当前的位置：<span class="smallNav_first smallNavMenu"><a href="javascript:">所有结果</a> ></span><span class="smallNav_second smallNavMenu"> <a href="javascript:"><!--黄壳--></a></span></div>
			<div class="goodsDetail_conTop">
				<div class="goodsDetail_conTop_imgs">
					<p class="goodsDetail_big"><img height="500px" width="500px"></p>
					<p class="goodsDetail_small">
						<img src="img/angle.png" class="angle" id="angle">
					</p>
				</div>
				<div class="goodsDetail_conTop_items">
					<h2 class="goodsDetail_conTop_title">
						
					</h2>
					<div class="goodsDetail_conTop_price">
						<div class="commonPrice" style="display: block;">
							<p class="goodsDetail_conTop_mallPrice">商城价：<span><!--¥489.52 - ¥624.35--></span></p>
							<p class="goodsDetail_conTop_marketPrice">市场价：<span><!--¥572.77--></span></p>
						</div>
						<div class="priceGradient" style="display: none;">
							<ul>
								
							</ul>
						</div>
					</div>
					<div class="goodsBasicAttr">
						<p><span class="buyUnit"><!--购买单位：桶--></span><span class="goodsPacking"><!--包装规格：1*1--></span></p>
						<p><span class="goodsBrand"><!--商品品牌：美孚--></span><span class="goodsFactory"><!--生产厂家：壳牌公司--></span></p>
					</div>
					<div class="goodsItems_SKU">
						<form></form>
						
					</div>
					<div class="goodsDetail_buyNum">
						购买数量：<span class="buyNum_down"><img src="img/buyNum_down.png"></span><input type="text" class="selfBuyNum" name="selfBuyNum" value="1"><span class="buyNum_up"><img src="img/buyNum_up.png"></span>
						销量：<span class="buyData_item"><span class="buyData_item_number"> <!--322758--></span><span class="buyData_item_unit"> </span>
						<span class="buyNum_point" style="color: red;padding-left: 20px;"></span>
						<p class="ui-note"></p>
					</div>
					<span id="errorMessage" style="display: none;">
							请勾选您要的商品信息
					</span>
					<div class="buyThis">
						
						<a class="putShopCar" href="javascript:" style="display: inline-block;"><img src="img/shopCar_small.png"> &nbsp;加入购物车</a><a class="minuntBuy" href="javascript:">立即购买</a>
					</div>
					<div class="goodsPermit">
						<ul>
							<li>
								<div class="goodsPermit_itermImg"><img src="img/fkStyle.png"></div>
								<div class="goodsPermit_itermText">
									<p>付款方式</p><p>在线支付</p>
								</div>
							</li>
							<li>
								<div class="goodsPermit_itermImg"><img src="img/psStyle.png"></div>
								<div class="goodsPermit_itermText">
									<p>配送方式</p><p>养车宝配送</p>
								</div>
							</li>
							<li>
								<div class="goodsPermit_itermImg"><img src="img/shService.png"></div>
								<div class="goodsPermit_itermText">
									<p>售后服务</p><p>养车宝售后</p>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="goodsDetail_conBottom detail-product">
				<div class="detail-info">
					<div class="tabTitle detail-h1" style="position:relative;">
						<ul>
							<li class="current" id="goodsDetailTab">商品详情</li>
							<li id="carTypeTab">适用车型</li>
						</ul>
					</div>
					<div class="goodsDetail-info detail-box" id="goodsDetailTab">
						<h3>规格参数</h3>
						<div class="goodsDetail-info-sku">
						</div>
						<h3>详细说明</h3>
						<div class="goodsDetail-info-specific">
							<iframe name="detailIframe" id="detailIframe" frameborder="0" width="100%" scrolling="no" src="" onload="iframeResize(this)"></iframe>
							<script type="text/javascript">
								var url_=window.location.href;
								var a=url_.split("//")[1];
								var b=a.split("/")[0];
								$.get('/ycbmall-ws/ws/0.1/commodity/getCommodityDesc',{commodityId:$.getQuery('commodityId')},function(data){
//									var path = "http://mall.yangchebao.com.cn/group1"+data.descriptionUrl.split("/group1")[1];
									var path = "http://"+b+"/group1"+data.descriptionUrl.split("/group1")[1];
									$("div.goodsDetail-info-specific iframe").attr('src',path);
									
								})
							</script>
						</div>
					</div>
					<div class="carType-info detail-box" style="display:none;" id="carTypeTab">
						<div class="goodsDetail-info-carType">
							<table class="Table-carType" cellpadding="0" cellspacing="0">
							 	<thead class="Table-carType-title">
									<td class="title1">汽车品牌</td>
							 		<td class="title2">车厂</td>
							 		<td class="title3">车系</td>
							 		<td class="title4">车型</td>
								</thead>
								<tbody class="Table-carType-con">
								</tbody>
							</table>
						</div>
						<div class="ui_note" style="display: none;">该商品为通用件，基本适用全部车型，具体请您以驾驶车型做实物参考</div>
					</div>
					
				</div>
			</div>
		</div>
		<div class="footer"></div>
	</div>
</body>
<script type="text/javascript">
	$(function(){
		// 加载top nav footer
		$('div.top').load('top.html');
		$('div.mainCommen').load('searchAndNav.html');
		$('div.footer').load('footer.html');
		var username=mall.getCookie('username');
		var customerId=mall.getCookie('customerId'); 
		var areaCodeId=mall.getCookie('areaCodeId');
		var formLen=0;
		
		$('p.goodsDetail_conTop_mallPrice').on('click','span.sellingPriceRange_change',function(){
			$('div.Form-login').show();
			$('div.login-dialog-overlay').show();
			$('li.login a').html('请登录');
			$('li.username p').html('');	
		})
		// tab点击
		$('div.detail-h1 li').click(function(){
			if($(this).hasClass('current')){
				return false
			}else{
				var id=$(this).attr('id');
				$(this).addClass('current').siblings().removeClass('current');
				$('div#'+id).show().siblings('div.detail-box').hide()
			}
		});

		//获取商品信息
		var commodityId=$.getQuery('commodityId');
		var skuId=$.getQuery('skuId');
		if(!skuId){
			skuId=undefined
		}
		var groupPurchasingId=$.getQuery('groupPurchasingId');
		var sellingPriceRangefit="";
		var marketPriceRangefit="";
		mateCarStyle(skuId);
		var params={};
		params.commodityId=commodityId;
		params.skuId=skuId;
		params.areaCodeId=areaCodeId;
		if(customerId==null){}else{
			params.userInfoId=customerId;
		}
		$.get(mall.url('/commodity/showCommodity'),params,function(data){
			sellingPriceRangefit=data.sellingPriceRange;
			marketPriceRangefit=data.marketPriceRange;
			var groupPurchasingId=data.entityId;
			$('span.smallNav_second a').html(data.name);
			$('h2.goodsDetail_conTop_title').html(data.name);
			if(document.cookie.indexOf('customerId=')!=-1){
				$('p.goodsDetail_conTop_mallPrice span').html('￥'+data.sellingPriceRange).removeClass('sellingPriceRange_change');
			}else{
				$('p.goodsDetail_conTop_mallPrice span').html('登录后即享优惠').addClass('sellingPriceRange_change');
			}
			if(data.promotionType==3){
				$('h2.goodsDetail_conTop_title').html(data.name+'<span class="groupDetailsmark"></span>');
				$("a.putShopCar").hide();
				$("a.minuntBuy").html("确认购买");
				$('a.minuntBuy').unbind('click').bind('click',function(){
					var selfBuyNum=$.trim($('input[name="selfBuyNum"]').val());
					var intBuyNum=parseInt(selfBuyNum);
					$.get(mall.url('/groupPurchasing/getGpInfo'),{groupPurchasingId:groupPurchasingId},function(data){
						groupPurchasingId=data.groupPurchasingId;
						if(data.status==5||data.status==6){
							mall.alertRe("该团购活动已下线","");
							$("div.dialog-overlay").hide();
							$("div.login-dialog-overlay").show();
							return false;
						}
						location.href='groupPurchaseDetails.html?skuId='+skuId+'&intBuyNum='+intBuyNum+'&groupPurchasingId='+groupPurchasingId;
					})
				})
			}
			if(data.promotionType==3&&document.cookie.indexOf('customerId=')!=-1){
				$("div.commonPrice").hide();
				$("div.priceGradient").show();
				
				var priceStr='';
				//var defaultPrice=0;
				priceStr+='<li class="Header">'
			 			+'<span class="num">数量</span>'
			 			+'<span class="price">价格</span>'
			 			+'</li>'
				$.each(data.priceEchelons,function(i){
	 				if(i==0){
	 				priceStr+='<li class="_'+this.echelon+' border_'+this.echelon+'">'
	 					+'<span class="num">'+this.startNum+'-'+this.endNum+'</span>'
	 					+'<span class="price">￥'+this.sellingPrice+'</span>'
	 					+'</li>'
	 					//defaultPrice=this.sellingPrice;
	 				}else{
	 				priceStr+='<li class="_'+this.echelon+'">'
	 					+'<span class="num">'+this.startNum+'-'+this.endNum+'</span>'
	 					+'<span class="price">￥'+this.sellingPrice+'</span>'
	 					+'</li>'
	 				}
		 		});
		 		$("div.priceGradient ul").html(priceStr);
			}
			$('p.goodsDetail_conTop_marketPrice span').html('￥'+data.marketPriceRange);
			$('div.goodsBasicAttr span.buyUnit').html('购买单位：'+data.salesUnit);
			$('div.goodsBasicAttr span.goodsPacking').html('包装规格：'+data.norms);
			$('div.goodsBasicAttr span.goodsBrand').html('商品品牌：'+data.accessoryBrandName);
			$('div.goodsBasicAttr span.goodsFactory').html('生产厂家：'+data.factory);
			$('div.goodsDetail_buyNum span.buyData_item_number').html(' '+data.salesNum);
			$('div.goodsDetail_buyNum span.buyData_item_unit').html(' '+data.salesUnit);

			/*var goodSkuStr='';
			formLen=data.skuParams.length;
			$.each(data.skuParams,function(i){
				var optionName=this.skuParamId;
				goodSkuStr+='<p class="skuParam">' 
						   //+'<input type="hidden" value="'+this.skuParamId+' />'
						   +'<span>'+this.skuParamName+'：</span>'
						   
			    var goodSkuOptionStr='';
			    $.each(this.options,function(j){
			    	var checked='';
			    	if(this.checked=='1'){
			    		checked='checked'
			    	};
			    	goodSkuOptionStr+='<span class="goodsRadio">'
						    	     +'<input type="radio" name="'+optionName+'" value="'+this.optionId+'" '+checked+'>'
						    	     +'<span>'+this.optionName+'</span>'
						    	     +'</span>'
			    });
			    goodSkuStr+=goodSkuOptionStr+'</p>'
			});*/

			//____
			var goodSkuStr='';
			formLen=data.skuParams.length;
			$.each(data.skuParams,function(i){
				var optionName=this.skuParamId;
				goodSkuStr+='<dl class="skuParame selected">'
						  +'<dt>'+this.skuParamName+':</dt>'
						  +'<dd class="skuParameItem">'
						  +'<ul class="skuParameList">'
				var goodSkuOptionStr='';
				$.each(this.options,function(j){
//					var checked='';
					//判断哪个是否有货，无货的自动置灰
//					if(this.checked=='1'){
////						checked='checked'
//						
//					};
					goodSkuOptionStr+='<li>'
					if(this.checked=="1"){
						goodSkuOptionStr+='<a href="javascript:;" name="'+optionName+'" value="'+this.optionId+'" class="selected">'+this.optionName
					}else{
						if(this.ashed =='1'){
							goodSkuOptionStr+='<a href="javascript:;" name="'+optionName+'" value="'+this.optionId+'" class="disabled">'+this.optionName
						}else{
							goodSkuOptionStr+='<a href="javascript:;" name="'+optionName+'" value="'+this.optionId+'">'+this.optionName
						}
					}
					
					goodSkuOptionStr+='<i></i></a>'
									+'</li>'
				});
				goodSkuOptionStr+='</ul></dd></dl>';
				goodSkuStr+=goodSkuOptionStr;
			});
			//_____
			
			if(goodSkuStr==''){
				$('div.goodsItems_SKU').remove()
			}else{
				$('div.goodsItems_SKU form').html(goodSkuStr);
			}
			var smallPicStr='';
			$.each(data.pics,function(i){
				if(this.isCover=="1"){
					$('p.goodsDetail_big img').attr('src',this.picUrl)
				}
				smallPicStr+='<span id="'+this.picUrl+'"><img src="'+this.smallPicUrl+'" width="86px" height="86px"></span>'
			});
			smallPicStr+='<img src="img/angle.png" class="angle" id="angle">';
			$('p.goodsDetail_small').html(smallPicStr);
			$('p.goodsDetail_small span:first').addClass('span_first');
			// 图片变换
			$('p.goodsDetail_small span').hover(function(){
				if($(this).hasClass('span_first')){
					return false
				}else{
					var left=$(this).position().left+43;
					var leftStr=left+'px';
					$(this).addClass('span_first').siblings('span').removeClass('span_first');
					$('img#angle').removeClass('angle').css({position:'absolute',bottom:'89px',left:leftStr});
					$('p.goodsDetail_big img').attr('src',this.id)
				}
				
			})
			
		});
//		var checkedLen=$('div.goodsItems_SKU dl.selected').length;
//		console.log(checkedLen)
//		if(checkedLen==formLen){
//			$('#errorMessage').hide();
//			$('div.goodsItems_SKU').removeClass('kuang');
//		}
		// 不同SKU不同价格和置灰
		var skuIdListIndex=1;
		$("div.goodsItems_SKU").on('click','dd a',function(){
			if($(this).hasClass("disabled")){
				
			}else{
			$(this).toggleClass("selected");
			if($(this).hasClass("selected")){
				$(this).parent().siblings().find('a').removeClass("selected");
				$(this).parents('dl').addClass("selected");
			}else{
				$(this).parents('dl').removeClass("selected");
			}
			var checkedLen=$("div.goodsItems_SKU dl.selected").length;
			var skuPLen=$("div.goodsItems_SKU dl").length;
			var postData={};
			postData.commodityId=commodityId;
			postData.areaCodeId=areaCodeId;
			if(customerId==null){}else{
				postData.userInfoId=customerId;
			}
			postData.options=[];
			$("div.goodsItems_SKU dl.selected dd a.selected").each(function(){
				var thisJson={};
				thisJson.skuParamId=$(this).attr('name');
				thisJson.optionId=$(this).attr('value');
				postData.options.push(thisJson)
			});
			
			var _postData={};
			_postData.commodityId=commodityId;
			_postData.areaCodeId=areaCodeId;
			_postData.options=[];
			$("div.goodsItems_SKU dl dd a").each(function(){
				var thisJson={};
				if($(this).hasClass("selected")){
					thisJson.skuParamId=$(this).attr('name');
					thisJson.optionId=$(this).attr('value');
					_postData.options.push(thisJson);
				}
			});
			$.ajax({
				type:'post',
				url:mall.url('/sku/getUnAshedOptionIds'),
				data:$.toJSON(_postData),
				dataType:'json',
				contentType:'application/json;charset=utf-8',
				success:function(data){
					var unAshedOptionIdList=data.unAshedOptionIdList;
					$("div.goodsItems_SKU dl").each(function(){
						//if(!$(this).hasClass("selected")){
							$(this).find('a').each(function(i){
								var thisEtem=$(this);
								var valueNum=thisEtem.attr('value');
								thisEtem.addClass("disabled");
								$.each(unAshedOptionIdList, function(j){
									if(valueNum==unAshedOptionIdList[j]){
										thisEtem.removeClass("disabled");
									}
								});
							})
 						
					})
				}
			});
			
			if(skuPLen==checkedLen){
				$.ajax({
					type:'post',
					url:mall.url('/sku/getSkuInfo'),
					dataType:'json',
					data:$.toJSON(postData),
					contentType:'application/json;charset=utf-8',
					success:function(data){
						skuId=data.skuId;
						if(document.cookie.indexOf('customerId=')!=-1){
							$('p.goodsDetail_conTop_mallPrice span').html('￥'+data.sellingPriceRange);
						}else{
							$('p.goodsDetail_conTop_mallPrice span').html('登录后即享优惠').addClass('sellingPriceRange_change');
						}
						$('p.goodsDetail_conTop_marketPrice span').html('￥'+data.marketPriceRange);
						mateCarStyle(skuId);
					}
				});
			}else{
				if(document.cookie.indexOf('customerId=')!=-1){
					$('p.goodsDetail_conTop_mallPrice span').html('￥'+sellingPriceRangefit);
				}else{
					$('p.goodsDetail_conTop_mallPrice span').html('登录后即享优惠').addClass('sellingPriceRange_change');
				}
				$('p.goodsDetail_conTop_marketPrice span').html('￥'+marketPriceRangefit);
			}

}
		})
		////////////
		/*var skuIdListIndex=1;
		$('div.goodsItems_SKU').on('click','p input',function(){
			//$(this).parents('p').removeClass('hasChecked').addClass('hasChecked');
			$(this).parents('p').removeClass('hasChecked').addClass('hasChecked');
			$(this).attr('checked',true);
			$(this).parent().siblings('span').find('input').attr('checked',false);
			var checkedLen=$('div.goodsItems_SKU p.hasChecked').length;
			var skuPLen=$('div.goodsItems_SKU p').length;

			var postData={};
			postData.commodityId=commodityId;
			postData.options=[];
			$('div.goodsItems_SKU p.hasChecked input[checked="checked"]').each(function(){
				var thisJson={};
				thisJson.skuParamId=$(this).attr('name');
				thisJson.optionId=$(this).attr('value');
				postData.options.push(thisJson)
			}); 
			if(skuPLen==checkedLen){
			$.ajax({
				type:'post',
				url:mall.url('/sku/getSkuInfo'),
				dataType:'json',
				data:$.toJSON(postData),
				contentType:'application/json;charset=utf-8',
				success:function(data){
					skuId=data.skuId;
					if(document.cookie.indexOf('customerId=')!=-1){
					$('p.goodsDetail_conTop_mallPrice span').html('￥'+data.sellingPriceRange);
					}
					$('p.goodsDetail_conTop_marketPrice span').html('￥'+data.marketPriceRange);
					mateCarStyle(skuId);
				}
			})
			}
			var hasCheckedNum=0;
			$('div.goodsItems_SKU p').each(function(i){
				if(!$(this).hasClass('hasChecked')){
					hasCheckedNum++;
				}
			});
			if(hasCheckedNum+skuIdListIndex==skuPLen){
				$(this).parent().parent('p').attr('id',skuIdListIndex);
				skuIdListIndex++;
			}
			var thisflag=$(this).parents('p').attr('id');
			$('div.goodsItems_SKU p').each(function(){
				if($(this).attr('id')==undefined || $(this).attr('id')>thisflag){
					$(this).removeClass('hasChecked');
					$(this).find('input').each(function(){
						$(this).attr('checked',false);
						$(this).removeAttr('disabled');
					})
				}
			});
			var _postData={};
			_postData.commodityId=commodityId;
			_postData.options=[];
				$('div.goodsItems_SKU p input').each(function(){
					var thisJson={};
					if($(this).attr('checked')=="checked"){
						thisJson.skuParamId=$(this).attr('name');
						thisJson.optionId=$(this).attr('value');
						_postData.options.push(thisJson);
					}
				})
			$.ajax({
				type:'post',
				url:mall.url('/sku/getUnAshedOptionIds'),
				data:$.toJSON(_postData),
				dataType:'json',
				contentType:'application/json;charset=utf-8',
				success:function(data){ 
					var unAshedOptionIdList=data.unAshedOptionIdList;
					$('div.goodsItems_SKU p').each(function(){ 
						if(!($(this).hasClass('hasChecked'))){
							$(this).find('input').each(function(i){
								var theInput=$(this);
								var valueNum=theInput.attr('value');
								var flag=0;
								$.each(unAshedOptionIdList,function(j){
									if(valueNum==unAshedOptionIdList[j]){
										flag=1;
									}
								});
								if (flag==0) {theInput.attr('disabled',true);}
							});
							}
				});
					}
					
		});
			})*/
			
		
		// 购买数量
		
		$('input[name="selfBuyNum"]').focus(function(){
			$('div.goodsDetail_buyNum p.ui-note').html('')
		});
		$('input[name="selfBuyNum"]').blur(function(){
			var selfBuyNum=$.trim($('input[name="selfBuyNum"]').val());
			var intBuyNum=parseInt(selfBuyNum);
			if(!/^[0-9]*[1-9][0-9]*$/.test(selfBuyNum)){
				return false
			}else{
				$("div.priceGradient ul li:gt(0)").each(function(i){
					var skuNumRange=$(this).children('span.num').html();
					var skuNumRangeArr=skuNumRange.split('件')[0].split('-');
					if(intBuyNum>=skuNumRangeArr[0]&&intBuyNum<=skuNumRangeArr[1]){
					var className=$(this).attr("class");
					var smart=1
					$("div.priceGradient ul li:gt(0)").each(function(i){
						if($(this).hasClass('border'+className)){
							
						}else{
							var a='_'+smart;
							$(this).removeClass().addClass(a);
						}
						smart++;
					});
					$(this).addClass('border'+className);
				}
				})
				$('div.goodsDetail_buyNum p.ui-note').html('')
			}
		});

		$('span.buyNum_up').on('click',function(){
			var selfBuyNum=$.trim($('input[name="selfBuyNum"]').val());
			if(!/^[0-9]*[1-9][0-9]*$/.test(selfBuyNum)){
				return false
			}else{
				var intBuyNum=parseInt(selfBuyNum)+1;
				$("div.priceGradient ul li:gt(0)").each(function(i){
					var skuNumRange=$(this).children('span.num').html();
					var skuNumRangeArr=skuNumRange.split('件')[0].split('-');
					if(intBuyNum>=skuNumRangeArr[0]&&intBuyNum<=skuNumRangeArr[1]){
					var className=$(this).attr("class");
					var smart=1
					$("div.priceGradient ul li:gt(0)").each(function(i){
						if($(this).hasClass('border'+className)){
							
						}else{
							var a='_'+smart;
							$(this).removeClass().addClass(a);
						}
						smart++;
					});
					$(this).addClass('border'+className);
				}
				});
				$('input[name="selfBuyNum"]').val(intBuyNum)
			}
		});

		$('span.buyNum_down').on('click',function(){
			var selfBuyNum=$.trim($('input[name="selfBuyNum"]').val());
			if((!/^[0-9]*[1-9][0-9]*$/.test(selfBuyNum))||parseInt(selfBuyNum)==1){
				return false
			}else{
				var intBuyNum=parseInt(selfBuyNum)-1;
				$("div.priceGradient ul li:gt(0)").each(function(i){
					var skuNumRange=$(this).children('span.num').html();
					var skuNumRangeArr=skuNumRange.split('件')[0].split('-');
					if(intBuyNum>=skuNumRangeArr[0]&&intBuyNum<=skuNumRangeArr[1]){
					var className=$(this).attr("class");
					var smart=1
					$("div.priceGradient ul li:gt(0)").each(function(i){
						if($(this).hasClass('border'+className)){
							
						}else{
							var a='_'+smart;
							$(this).removeClass().addClass(a);
						}
						smart++;
					});
					$(this).addClass('border'+className);
				}
				});
				$('input[name="selfBuyNum"]').val(intBuyNum)
			}
		});


		// 规格参数
		$.get(mall.url('/commodity/getComExtAttrInfo'),{commodityId:commodityId},function(data){
			var axtAttrStr='';
			$.each(data,function(){
				axtAttrStr+='<p>'
						   +'<span class="goodsDetail-info-skuName">'+this.extendedAttributeName+'</span>'
						   +'<span class="goodsDetail-info-skuValue">';
			    if(this.type==2||this.type==1){
			    	var optionStr='';
					$.each(this.options,function(){
						optionStr+=this.optionName+' '
					});
					axtAttrStr+=optionStr+'</span></p>'
			    }else{
			    	axtAttrStr+=this.textAnswer+'</span></p>'
			    }
			});
			$('div.goodsDetail-info-sku').html(axtAttrStr)
		});

	// 适用车型
	function mateCarStyle(skuId){ 
		$.get(mall.url('/sku/getCarStyle'),{skuId:skuId},function(data){
			var brandStr=''; 
			var brandName='';
			var factoryName='';
			var modelName='';
			var styleNames='';
			$.each(data,function(i){
				var methodLen=0;
				$.each(this.factories,function(){
					methodLen+=this.models.length
				});
				brandName=this.brandName;
				brandStr+='<tr><td class="brand_td center_td" rowspan="'+methodLen+'">'
						// +'<p><img src="img/'+this.logo+'"></p>'
						 +'<p>'+this.brandName+'</p>'
						 +'</td>';
				var factoryStr='';
			     $.each(this.factories,function(j){
			     	factoryName=this.factoryName;
			    	var thisMethodLen=this.models.length;
			    	if(j==0){
			    		factoryStr+='<td rowspan="'+thisMethodLen+'" class="center_td">'
						       	   +'<p>'+this.factoryName+'</p>'
						       	   +'</td>'
						factoryName=this.factoryName;
			       	    $.each(this.models,function(k){
			       	    	modelName=this.modelName;
			       	    	styleNames=this.styleNames;
			       	    	if(k==0){
			       	    		factoryStr+='<td class="center_td"><p>'+this.modelName+'</p></td>'
					       	    		   +'<td class="carType_td"><p>'+this.styleNames+'</p></td>'
					       	    		   +'</tr>'
			       	    	}else{
			       	    		factoryStr+='<tr>'
					       	    		   +'<td class="center_td"><p>'+this.modelName+'</p></td>'
					       	    		   +'<td class="carType_td"><p>'+this.styleNames+'</p></td>'
					       	    		   +'</tr>'
			       	    	}
			       	    })
			    	}else{
			    		factoryStr+='<tr>'
					    		   +'<td rowspan="'+thisMethodLen+'" class="center_td">'
					    		   +'<p>'+this.factoryName+'</p>'
					    		   +'</td>';
			    		$.each(this.models,function(k){
			    			if(k==0){
			    				factoryStr+='<td class="center_td"><p>'+this.modelName+'</p></td>'
					       	    		   +'<td class="carType_td"><p>'+this.styleNames+'</p></td>'
					       	    		   +'</tr>'
		       	    		}else{
		       	    			factoryStr+='<tr>'
					       	    		   +'<td class="center_td"><p>'+this.modelName+'</p></td>'
					       	    		   +'<td class="carType_td"><p>'+this.styleNames+'</p></td>'
					       	    		   +'</tr>'
		       	    		}
			    		})
			    	}
			    });
				brandStr+=factoryStr
				//}
			});
			$('tbody.Table-carType-con').html(brandStr);
			if(brandName=="全部"&&factoryName=="全部"&&modelName=="全部"&&styleNames=="全部"){
				//$('div.ui_note').html("该商品为通用件，基本适用全部车型，具体请您以驾驶车型做实物参考");
				$('div.ui_note').show();
				$('div.goodsDetail-info-carType table.Table-carType').hide();
			}else{
				$('div.ui_note').hide();
				$('div.goodsDetail-info-carType table.Table-carType').show();
				
			}
		});
	}
		
		//库存校验完善
//		$("div.goodsDetail_buyNum input.selfBuyNum").keypress().change(function(){
//			var selfBuyNum=$(this).val();   
//			$.ajax({
//				type:"get",
//				url:mall.url('/user/shoppingcard/checkInventory'),
//				async:true,
//				data:{skuId:skuId,skuNum:selfBuyNum},
//				dataType:'json',
//				contentType:'application/json;charset=utf-8',
//				success:function(data){
//					if(data.passed){
//						$("div.goodsDetail_buyNum span.buyNum_point").html('');
//					}
//				},
//				error:function(xhr){
//					var error=eval('('+xhr.responseText+')');
//					$("div.goodsDetail_buyNum span.buyNum_point").html(error[0].message);
//					//$(this).parent().find('span.error_note').html(error[0].message);
//				}
//			});
//			
//		});
//		$("div.goodsDetail_buyNum input.selfBuyNum").keyup(function(){
//			var selfBuyNum=$(this).val();
//			checkedNUm(skuId,selfBuyNum);
//		})
//		function checkedNUm(skuId,skuNum){  
//			
//		}

		
		$('div.buyThis a.putShopCar').unbind('click').bind('click',function(){
			if(document.cookie.indexOf('customerId=')!=-1){
			//if($('div.top_con li.username p').attr('id')==''){
				var checkedLen=$('div.goodsItems_SKU a.selected').length;
				if(checkedLen==formLen){
				$('#errorMessage').hide();
				$('div.goodsItems_SKU').removeClass('kuang');
				var selfBuyNum=$("div.goodsDetail_buyNum input.selfBuyNum").val();
				$.ajax({
					type:"get",
					url:mall.url('/user/shoppingcard/checkInventory'),
					async:true,
					data:{skuId:skuId,skuNum:selfBuyNum,userInfoId:customerId,areaCodeId:areaCodeId},
					dataType:'json',
					contentType:'application/json;charset=utf-8',
					success:function(){
						$("div.goodsDetail_buyNum span.buyNum_point").html();
						var postData={};
						postData.userInfoId=$('div.top_con li.username p').attr('id');
						postData.items=[];
						var itemsJson={};
						itemsJson.skuId=skuId;
						itemsJson.skuNum=$('input[name="selfBuyNum"]').val();
						postData.items.push(itemsJson);
						$.ajax({
							type:'post',
							url:mall.url('/user/shoppingcard/replace'),
							async: false,
							data:$.toJSON(postData),
							dataType:'json',
							contentType:'application/json;charset=utf-8',
							success:function(data){
//								$('div.buyThis a.minuntBuy').attr('href',"myShopCar.html");
								$('div.putShopCar-success').show();
								$('div.login-dialog-overlay').show();
								window.scrollTo(0,0);
								$('div.putShopCar-success span.continueShop a').unbind('click').bind('click',function(){
									$('div.putShopCar-success').hide();
									$('div.login-dialog-overlay').hide();
									$('div.footer').load('footer.html');
								});
								$('div.putShopCar-success span.tocarSettle a').attr('href','myShopCar.html?userInfoId='+postData.userInfoId+'?step=1')
								$.get(mall.url('/user/shoppingcard/page'),{userInfoId:customerId,areaCodeId:areaCodeId},function(data){
								var totalCount=data.totalCount;
								$('#goodsNum').html(totalCount);
								});		
							},
							error:function(xhr){
								var error=eval('('+xhr.responseText+')');
								if(error[0].message=='用户未登录'){
									$('div.Form-login').show();
									$('div.login-dialog-overlay').show();
									return false
								}
							}
						});
					},
					error:function(xhr){
						var error =JSON.parse(xhr.responseText);
						$("div.goodsDetail_buyNum span.buyNum_point").html(error[0].message);
					}
				});
				
				}else if(checkedLen<formLen){
					$('div.goodsItems_SKU').addClass('kuang');
					$('#errorMessage').show();
				}	
			}else{
				$('div.Form-login').show();
				$('div.login-dialog-overlay').show();
				$('li.login a').html('请登录');
				$('li.username p').html('');
			}
		});
			$('div.buyThis a.minuntBuy').unbind('click').bind('click',function(){
			if(document.cookie.indexOf('customerId=')!=-1){
				var checkedLen=$('div.goodsItems_SKU dl.selected').length;
				if(checkedLen==formLen){
				$('#errorMessage').hide();
				$('div.goodsItems_SKU').removeClass('kuang');
				var selfBuyNum=$("div.goodsDetail_buyNum input.selfBuyNum").val();
				$.ajax({
					type:"get",
					url:mall.url('/user/shoppingcard/checkInventory'),
					async:false,
					data:{skuId:skuId,skuNum:selfBuyNum,userInfoId:customerId,areaCodeId:areaCodeId},
					dataType:'json',
					contentType:'application/json;charset=utf-8',
					success:function(){
						$("div.goodsDetail_buyNum span.buyNum_point").html();
						var postData={};
						postData.userInfoId=$('div.top_con li.username p').attr('id');
						postData.items=[];
						var itemsJson={};
						itemsJson.skuId=skuId;
						itemsJson.skuNum=$('input[name="selfBuyNum"]').val();
						postData.items.push(itemsJson);
						$.ajax({
							type:'post',
							url:mall.url('/user/shoppingcard/replace'),
							async: false,
							data:$.toJSON(postData),
							dataType:'json',
							contentType:'application/json;charset=utf-8',
							success:function(data){
//								$.get(mall.url('/user/shoppingcard/page'),{userInfoId:customerId},function(data){
//								var totalCount=data.totalCount;
//								$('#goodsNum').html(totalCount);
//								});
								location.href='myShopCar.html?userInfoId='+postData.userInfoId+'?step=1';
							},
							error:function(xhr){
								var error=eval('('+xhr.responseText+')');
								if(error[0].message=='用户未登录'){
									$('div.Form-login').show();
									$('div.login-dialog-overlay').show();
									return false
								}
							}
						});
					},
					error:function(xhr){
						var error =JSON.parse(xhr.responseText);
						$("div.goodsDetail_buyNum span.buyNum_point").html(error[0].message);
					}
				});
				}else if(checkedLen<formLen){
					$('div.goodsItems_SKU').addClass('kuang');
					$('#errorMessage').show();
				}
			}else{
				$('div.Form-login').show();
				$('div.login-dialog-overlay').show();
				$('li.login a').html('请登录');
				$('li.username p').html('');
			}	 
		});
	})

</script>
</html>